{"expireTime":9007200848610891000,"key":"gatsby-plugin-mdx-entire-payload-42dc653c2357a9e9d7bd24601f243acf-","val":{"mdast":{"type":"root","children":[{"type":"import","value":"import DefaultLayout from \"/Users/dennis.okeeffe/Project-Imposter/developer-notes/node_modules/gatsby-theme-docz/src/base/Layout.js\"","position":{"start":{"line":3,"column":1,"offset":2},"end":{"line":3,"column":133,"offset":134},"indent":[]}},{"type":"export","default":true,"value":"export default DefaultLayout","position":{"start":{"line":5,"column":1,"offset":136},"end":{"line":5,"column":29,"offset":164},"indent":[]}},{"type":"heading","depth":1,"children":[{"type":"text","value":"EKS - Deploy Stateless App","position":{"start":{"line":8,"column":3,"offset":169},"end":{"line":8,"column":29,"offset":195},"indent":[]}}],"position":{"start":{"line":8,"column":1,"offset":167},"end":{"line":8,"column":29,"offset":195},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"#eks---deploy-stateless-app","children":[{"type":"text","value":"EKS - Deploy Stateless App","position":{"start":{"line":10,"column":4,"offset":200},"end":{"line":10,"column":30,"offset":226},"indent":[]}}],"position":{"start":{"line":10,"column":3,"offset":199},"end":{"line":10,"column":60,"offset":256},"indent":[]}}],"position":{"start":{"line":10,"column":3,"offset":199},"end":{"line":10,"column":60,"offset":256},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"#in-this-app","children":[{"type":"text","value":"In this app","position":{"start":{"line":11,"column":6,"offset":262},"end":{"line":11,"column":17,"offset":273},"indent":[]}}],"position":{"start":{"line":11,"column":5,"offset":261},"end":{"line":11,"column":32,"offset":288},"indent":[]}}],"position":{"start":{"line":11,"column":5,"offset":261},"end":{"line":11,"column":32,"offset":288},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"#backend","children":[{"type":"text","value":"Backend","position":{"start":{"line":12,"column":8,"offset":296},"end":{"line":12,"column":15,"offset":303},"indent":[]}}],"position":{"start":{"line":12,"column":7,"offset":295},"end":{"line":12,"column":26,"offset":314},"indent":[]}}],"position":{"start":{"line":12,"column":7,"offset":295},"end":{"line":12,"column":26,"offset":314},"indent":[]}}],"position":{"start":{"line":12,"column":5,"offset":293},"end":{"line":12,"column":26,"offset":314},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"#frontend","children":[{"type":"text","value":"Frontend","position":{"start":{"line":13,"column":8,"offset":322},"end":{"line":13,"column":16,"offset":330},"indent":[]}}],"position":{"start":{"line":13,"column":7,"offset":321},"end":{"line":13,"column":28,"offset":342},"indent":[]}}],"position":{"start":{"line":13,"column":7,"offset":321},"end":{"line":13,"column":28,"offset":342},"indent":[]}}],"position":{"start":{"line":13,"column":5,"offset":319},"end":{"line":13,"column":28,"offset":342},"indent":[]}}],"position":{"start":{"line":12,"column":5,"offset":293},"end":{"line":13,"column":28,"offset":342},"indent":[5]}}],"position":{"start":{"line":11,"column":3,"offset":259},"end":{"line":13,"column":28,"offset":342},"indent":[3,3]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"#deploying-the-backend","children":[{"type":"text","value":"Deploying the backend","position":{"start":{"line":14,"column":6,"offset":348},"end":{"line":14,"column":27,"offset":369},"indent":[]}}],"position":{"start":{"line":14,"column":5,"offset":347},"end":{"line":14,"column":52,"offset":394},"indent":[]}}],"position":{"start":{"line":14,"column":5,"offset":347},"end":{"line":14,"column":52,"offset":394},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"#the-redis-master","children":[{"type":"text","value":"The Redis Master","position":{"start":{"line":15,"column":8,"offset":402},"end":{"line":15,"column":24,"offset":418},"indent":[]}}],"position":{"start":{"line":15,"column":7,"offset":401},"end":{"line":15,"column":44,"offset":438},"indent":[]}}],"position":{"start":{"line":15,"column":7,"offset":401},"end":{"line":15,"column":44,"offset":438},"indent":[]}}],"position":{"start":{"line":15,"column":5,"offset":399},"end":{"line":15,"column":44,"offset":438},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"#the-redis-slaves","children":[{"type":"text","value":"The Redis Slaves","position":{"start":{"line":16,"column":8,"offset":446},"end":{"line":16,"column":24,"offset":462},"indent":[]}}],"position":{"start":{"line":16,"column":7,"offset":445},"end":{"line":16,"column":44,"offset":482},"indent":[]}}],"position":{"start":{"line":16,"column":7,"offset":445},"end":{"line":16,"column":44,"offset":482},"indent":[]}}],"position":{"start":{"line":16,"column":5,"offset":443},"end":{"line":16,"column":44,"offset":482},"indent":[]}}],"position":{"start":{"line":15,"column":5,"offset":399},"end":{"line":16,"column":44,"offset":482},"indent":[5]}}],"position":{"start":{"line":14,"column":3,"offset":345},"end":{"line":16,"column":44,"offset":482},"indent":[3,3]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"#deploying-the-frontend","children":[{"type":"text","value":"Deploying the Frontend","position":{"start":{"line":17,"column":6,"offset":488},"end":{"line":17,"column":28,"offset":510},"indent":[]}}],"position":{"start":{"line":17,"column":5,"offset":487},"end":{"line":17,"column":54,"offset":536},"indent":[]}}],"position":{"start":{"line":17,"column":5,"offset":487},"end":{"line":17,"column":54,"offset":536},"indent":[]}}],"position":{"start":{"line":17,"column":3,"offset":485},"end":{"line":17,"column":54,"offset":536},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"#scaling-pods-up-and-down","children":[{"type":"text","value":"Scaling Pods up and down","position":{"start":{"line":18,"column":6,"offset":542},"end":{"line":18,"column":30,"offset":566},"indent":[]}}],"position":{"start":{"line":18,"column":5,"offset":541},"end":{"line":18,"column":58,"offset":594},"indent":[]}}],"position":{"start":{"line":18,"column":5,"offset":541},"end":{"line":18,"column":58,"offset":594},"indent":[]}}],"position":{"start":{"line":18,"column":3,"offset":539},"end":{"line":18,"column":58,"offset":594},"indent":[]}}],"position":{"start":{"line":11,"column":3,"offset":259},"end":{"line":18,"column":58,"offset":594},"indent":[3,3,3,3,3,3,3]}}],"position":{"start":{"line":10,"column":1,"offset":197},"end":{"line":18,"column":58,"offset":594},"indent":[1,1,1,1,1,1,1,1]}}],"position":{"start":{"line":10,"column":1,"offset":197},"end":{"line":18,"column":58,"offset":594},"indent":[1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"In this example, we will be build a basic guestbook example from Kubernetes.","position":{"start":{"line":20,"column":1,"offset":596},"end":{"line":20,"column":77,"offset":672},"indent":[]}}],"position":{"start":{"line":20,"column":1,"offset":596},"end":{"line":20,"column":77,"offset":672},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"In this app","position":{"start":{"line":22,"column":4,"offset":677},"end":{"line":22,"column":15,"offset":688},"indent":[]}}],"position":{"start":{"line":22,"column":1,"offset":674},"end":{"line":22,"column":15,"offset":688},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"We will deploy the guestbook app at ","position":{"start":{"line":24,"column":1,"offset":690},"end":{"line":24,"column":37,"offset":726},"indent":[]}},{"type":"link","title":null,"url":"https://github.com/kubernetes/examples/tree/master/guestbook","children":[{"type":"text","value":"https://github.com/kubernetes/examples/tree/master/guestbook","position":{"start":{"line":24,"column":37,"offset":726},"end":{"line":24,"column":97,"offset":786},"indent":[]}}],"position":{"start":{"line":24,"column":37,"offset":726},"end":{"line":24,"column":97,"offset":786},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":24,"column":97,"offset":786},"end":{"line":24,"column":98,"offset":787},"indent":[]}}],"position":{"start":{"line":24,"column":1,"offset":690},"end":{"line":24,"column":98,"offset":787},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"We will need to deploy backend resources, frontend resources, scale Pods up/down and some chaos testing.","position":{"start":{"line":26,"column":1,"offset":789},"end":{"line":26,"column":105,"offset":893},"indent":[]}}],"position":{"start":{"line":26,"column":1,"offset":789},"end":{"line":26,"column":105,"offset":893},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Our application will be accessible from an AWS Load Balancer.","position":{"start":{"line":28,"column":1,"offset":895},"end":{"line":28,"column":62,"offset":956},"indent":[]}}],"position":{"start":{"line":28,"column":1,"offset":895},"end":{"line":28,"column":62,"offset":956},"indent":[]}},{"type":"paragraph","children":[{"type":"image","title":null,"url":"https://res.cloudinary.com/gitgoodclub/image/upload/v1548246181/eks-course/Screen_Shot_2019-01-23_at_11.22.49_pm.png","alt":"App layout","position":{"start":{"line":30,"column":1,"offset":958},"end":{"line":30,"column":132,"offset":1089},"indent":[]}}],"position":{"start":{"line":30,"column":1,"offset":958},"end":{"line":30,"column":132,"offset":1089},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Backend","position":{"start":{"line":32,"column":5,"offset":1095},"end":{"line":32,"column":12,"offset":1102},"indent":[]}}],"position":{"start":{"line":32,"column":1,"offset":1091},"end":{"line":32,"column":12,"offset":1102},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Redis:","position":{"start":{"line":34,"column":1,"offset":1104},"end":{"line":34,"column":7,"offset":1110},"indent":[]}}],"position":{"start":{"line":34,"column":1,"offset":1104},"end":{"line":34,"column":7,"offset":1110},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Single Master (WRITES)","position":{"start":{"line":36,"column":3,"offset":1114},"end":{"line":36,"column":25,"offset":1136},"indent":[]}}],"position":{"start":{"line":36,"column":3,"offset":1114},"end":{"line":36,"column":25,"offset":1136},"indent":[]}}],"position":{"start":{"line":36,"column":1,"offset":1112},"end":{"line":36,"column":25,"offset":1136},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Multi Slaves (READ)","position":{"start":{"line":37,"column":3,"offset":1139},"end":{"line":37,"column":22,"offset":1158},"indent":[]}}],"position":{"start":{"line":37,"column":3,"offset":1139},"end":{"line":37,"column":22,"offset":1158},"indent":[]}}],"position":{"start":{"line":37,"column":1,"offset":1137},"end":{"line":37,"column":22,"offset":1158},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Slaves sync continuously from Master","position":{"start":{"line":38,"column":3,"offset":1161},"end":{"line":38,"column":39,"offset":1197},"indent":[]}}],"position":{"start":{"line":38,"column":3,"offset":1161},"end":{"line":38,"column":39,"offset":1197},"indent":[]}}],"position":{"start":{"line":38,"column":1,"offset":1159},"end":{"line":38,"column":39,"offset":1197},"indent":[]}}],"position":{"start":{"line":36,"column":1,"offset":1112},"end":{"line":38,"column":39,"offset":1197},"indent":[1,1]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Frontend","position":{"start":{"line":40,"column":5,"offset":1203},"end":{"line":40,"column":13,"offset":1211},"indent":[]}}],"position":{"start":{"line":40,"column":1,"offset":1199},"end":{"line":40,"column":13,"offset":1211},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"PHP App:","position":{"start":{"line":42,"column":1,"offset":1213},"end":{"line":42,"column":9,"offset":1221},"indent":[]}}],"position":{"start":{"line":42,"column":1,"offset":1213},"end":{"line":42,"column":9,"offset":1221},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Load balanced to public with ELB","position":{"start":{"line":44,"column":3,"offset":1225},"end":{"line":44,"column":35,"offset":1257},"indent":[]}}],"position":{"start":{"line":44,"column":3,"offset":1225},"end":{"line":44,"column":35,"offset":1257},"indent":[]}}],"position":{"start":{"line":44,"column":1,"offset":1223},"end":{"line":44,"column":35,"offset":1257},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Read balanced over multiple salve DBs","position":{"start":{"line":45,"column":3,"offset":1260},"end":{"line":45,"column":40,"offset":1297},"indent":[]}}],"position":{"start":{"line":45,"column":3,"offset":1260},"end":{"line":45,"column":40,"offset":1297},"indent":[]}}],"position":{"start":{"line":45,"column":1,"offset":1258},"end":{"line":45,"column":40,"offset":1297},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Write req to single Master DB","position":{"start":{"line":46,"column":3,"offset":1300},"end":{"line":46,"column":32,"offset":1329},"indent":[]}}],"position":{"start":{"line":46,"column":3,"offset":1300},"end":{"line":46,"column":32,"offset":1329},"indent":[]}}],"position":{"start":{"line":46,"column":1,"offset":1298},"end":{"line":46,"column":32,"offset":1329},"indent":[]}}],"position":{"start":{"line":44,"column":1,"offset":1223},"end":{"line":46,"column":32,"offset":1329},"indent":[1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Deploying the backend","position":{"start":{"line":48,"column":4,"offset":1334},"end":{"line":48,"column":25,"offset":1355},"indent":[]}}],"position":{"start":{"line":48,"column":1,"offset":1331},"end":{"line":48,"column":25,"offset":1355},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"We need to create:","position":{"start":{"line":50,"column":1,"offset":1357},"end":{"line":50,"column":19,"offset":1375},"indent":[]}}],"position":{"start":{"line":50,"column":1,"offset":1357},"end":{"line":50,"column":19,"offset":1375},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Redis Master pod","position":{"start":{"line":52,"column":3,"offset":1379},"end":{"line":52,"column":19,"offset":1395},"indent":[]}}],"position":{"start":{"line":52,"column":3,"offset":1379},"end":{"line":52,"column":19,"offset":1395},"indent":[]}}],"position":{"start":{"line":52,"column":1,"offset":1377},"end":{"line":52,"column":19,"offset":1395},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Redis Master service","position":{"start":{"line":53,"column":3,"offset":1398},"end":{"line":53,"column":23,"offset":1418},"indent":[]}}],"position":{"start":{"line":53,"column":3,"offset":1398},"end":{"line":53,"column":23,"offset":1418},"indent":[]}}],"position":{"start":{"line":53,"column":1,"offset":1396},"end":{"line":53,"column":23,"offset":1418},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Redis Slave pods","position":{"start":{"line":54,"column":3,"offset":1421},"end":{"line":54,"column":19,"offset":1437},"indent":[]}}],"position":{"start":{"line":54,"column":3,"offset":1421},"end":{"line":54,"column":19,"offset":1437},"indent":[]}}],"position":{"start":{"line":54,"column":1,"offset":1419},"end":{"line":54,"column":19,"offset":1437},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Redis Slave services","position":{"start":{"line":55,"column":3,"offset":1440},"end":{"line":55,"column":23,"offset":1460},"indent":[]}}],"position":{"start":{"line":55,"column":3,"offset":1440},"end":{"line":55,"column":23,"offset":1460},"indent":[]}}],"position":{"start":{"line":55,"column":1,"offset":1438},"end":{"line":55,"column":23,"offset":1460},"indent":[]}}],"position":{"start":{"line":52,"column":1,"offset":1377},"end":{"line":55,"column":23,"offset":1460},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Then we will do some AWS networking (ENI) inspection.","position":{"start":{"line":57,"column":1,"offset":1462},"end":{"line":57,"column":54,"offset":1515},"indent":[]}}],"position":{"start":{"line":57,"column":1,"offset":1462},"end":{"line":57,"column":54,"offset":1515},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"The Redis Master","position":{"start":{"line":59,"column":5,"offset":1521},"end":{"line":59,"column":21,"offset":1537},"indent":[]}}],"position":{"start":{"line":59,"column":1,"offset":1517},"end":{"line":59,"column":21,"offset":1537},"indent":[]}},{"type":"code","lang":"yaml","meta":null,"value":"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: redis-master\n  labels:\n    app: redis\nspec:\n  selector:\n    matchLabels:\n      app: redis\n      role: master\n      tier: backend\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: redis\n        role: master\n        tier: backend\n    spec:\n      containers:\n        - name: master\n          image: k8s.gcr.io/redis:e2e # or just image: redis\n          resources:\n            requests:\n              cpu: 100m\n              memory: 100Mi\n          ports:\n            - containerPort: 6379\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: redis-master\n  labels:\n    app: redis\n    role: master\n    tier: backend\nspec:\n  ports:\n    - port: 6379\n      targetPort: 6379\n  selector:\n    app: redis\n    role: master\n    tier: backend","position":{"start":{"line":61,"column":1,"offset":1539},"end":{"line":108,"column":4,"offset":2349},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Apply this file using kubectl and then you can check what has been deployed. Notice there is a Cluster IP but not an external IP as it is not exposed to the public.","position":{"start":{"line":110,"column":1,"offset":2351},"end":{"line":110,"column":165,"offset":2515},"indent":[]}}],"position":{"start":{"line":110,"column":1,"offset":2351},"end":{"line":110,"column":165,"offset":2515},"indent":[]}},{"type":"code","lang":"shell","meta":null,"value":"kubectl get svc\n\nNAME           TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE\nkubernetes     ClusterIP   [REDACTED]       <none>        443/TCP    1h\nredis-master   ClusterIP   [REDACTED]       <none>        6379/TCP   16s","position":{"start":{"line":112,"column":1,"offset":2517},"end":{"line":118,"column":4,"offset":2764},"indent":[1,1,1,1,1,1]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"The Redis Slaves","position":{"start":{"line":120,"column":5,"offset":2770},"end":{"line":120,"column":21,"offset":2786},"indent":[]}}],"position":{"start":{"line":120,"column":1,"offset":2766},"end":{"line":120,"column":21,"offset":2786},"indent":[]}},{"type":"code","lang":"yml","meta":null,"value":"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: redis-slave\n  labels:\n    app: redis\nspec:\n  selector:\n    matchLabels:\n      app: redis\n      role: slave\n      tier: backend\n  replicas: 2\n  template:\n    metadata:\n      labels:\n        app: redis\n        role: slave\n        tier: backend\n    spec:\n      containers:\n        - name: slave\n          image: gcr.io/google_samples/gb-redisslave:v1\n          resources:\n            requests:\n              cpu: 100m\n              memory: 100Mi\n          env:\n            - name: GET_HOSTS_FROM\n              value: dns\n          ports:\n            - containerPort: 6379\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: redis-slave\n  labels:\n    app: redis\n    role: slave\n    tier: backend\nspec:\n  ports:\n    - port: 6379\n  selector:\n    app: redis\n    role: slave\n    tier: backend","position":{"start":{"line":122,"column":1,"offset":2788},"end":{"line":171,"column":4,"offset":3637},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"After applying the file, we can run ","position":{"start":{"line":173,"column":1,"offset":3639},"end":{"line":173,"column":37,"offset":3675},"indent":[]}},{"type":"inlineCode","value":"kubectl get pods","position":{"start":{"line":173,"column":37,"offset":3675},"end":{"line":173,"column":55,"offset":3693},"indent":[]}},{"type":"text","value":" and see something similar to the following:","position":{"start":{"line":173,"column":55,"offset":3693},"end":{"line":173,"column":99,"offset":3737},"indent":[]}}],"position":{"start":{"line":173,"column":1,"offset":3639},"end":{"line":173,"column":99,"offset":3737},"indent":[]}},{"type":"code","lang":"shell","meta":null,"value":"NAME                            READY   STATUS    RESTARTS   AGE\nredis-master-6b464554c8-kqkpr   1/1     Running   0          7m\nredis-slave-b58dc4644-dk9cg     1/1     Running   0          12s\nredis-slave-b58dc4644-jx6mz     1/1     Running   0          12s","position":{"start":{"line":175,"column":1,"offset":3739},"end":{"line":180,"column":4,"offset":4010},"indent":[1,1,1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Deploying the Frontend","position":{"start":{"line":182,"column":4,"offset":4015},"end":{"line":182,"column":26,"offset":4037},"indent":[]}}],"position":{"start":{"line":182,"column":1,"offset":4012},"end":{"line":182,"column":26,"offset":4037},"indent":[]}},{"type":"code","lang":"yaml","meta":null,"value":"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: frontend\n  labels:\n    app: guestbook\nspec:\n  selector:\n    # matches Service\n    matchLabels:\n      app: guestbook\n      tier: frontend\n  replicas: 3\n  template:\n    metadata:\n      labels:\n        app: guestbook\n        tier: frontend\n    spec:\n      containers:\n        - name: php-redis\n          image: gcr.io/google-samples/gb-frontend:v4\n          resources:\n            requests:\n              cpu: 100m\n              memory: 100Mi\n          env:\n            - name: GET_HOSTS_FROM\n              value: dns\n              # Using `GET_HOSTS_FROM=dns` requires your cluster to\n              # provide a dns service. As of Kubernetes 1.3, DNS is a built-in\n              # service launched automatically. However, if the cluster you are using\n              # does not have a built-in DNS service, you can instead\n              # access an environment variable to find the master\n              # service's host. To do so, comment out the 'value: dns' line above, and\n              # uncomment the line below:\n              # value: env\n          ports:\n            - containerPort: 80\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: frontend\n  labels:\n    app: guestbook\n    tier: frontend\nspec:\n  # comment or delete the following line if you want to use a LoadBalancer\n  #type: NodePort\n  # if your cluster supports it, uncomment the following to automatically create\n  # an external load-balanced IP for the frontend service.\n  type: LoadBalancer\n  ports:\n    - port: 80\n  selector:\n    app: guestbook\n    tier: frontend","position":{"start":{"line":184,"column":1,"offset":4039},"end":{"line":243,"column":4,"offset":5636},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"After deploying, we should see all the pods and services deploying.","position":{"start":{"line":245,"column":1,"offset":5638},"end":{"line":245,"column":68,"offset":5705},"indent":[]}}],"position":{"start":{"line":245,"column":1,"offset":5638},"end":{"line":245,"column":68,"offset":5705},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"If we then run ","position":{"start":{"line":247,"column":1,"offset":5707},"end":{"line":247,"column":16,"offset":5722},"indent":[]}},{"type":"inlineCode","value":"kubectl describe service frontend","position":{"start":{"line":247,"column":16,"offset":5722},"end":{"line":247,"column":51,"offset":5757},"indent":[]}},{"type":"text","value":", we should be able to see information on the ELB that we have just deployed.","position":{"start":{"line":247,"column":51,"offset":5757},"end":{"line":247,"column":128,"offset":5834},"indent":[]}}],"position":{"start":{"line":247,"column":1,"offset":5707},"end":{"line":247,"column":128,"offset":5834},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"From this information, we should be able to fetch the ","position":{"start":{"line":249,"column":1,"offset":5836},"end":{"line":249,"column":55,"offset":5890},"indent":[]}},{"type":"inlineCode","value":"LoadBalancer Ingress","position":{"start":{"line":249,"column":55,"offset":5890},"end":{"line":249,"column":77,"offset":5912},"indent":[]}},{"type":"text","value":" address to open up the guest book.","position":{"start":{"line":249,"column":77,"offset":5912},"end":{"line":249,"column":112,"offset":5947},"indent":[]}}],"position":{"start":{"line":249,"column":1,"offset":5836},"end":{"line":249,"column":112,"offset":5947},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Scaling Pods up and down","position":{"start":{"line":251,"column":4,"offset":5952},"end":{"line":251,"column":28,"offset":5976},"indent":[]}}],"position":{"start":{"line":251,"column":1,"offset":5949},"end":{"line":251,"column":28,"offset":5976},"indent":[]}},{"type":"code","lang":"yml","meta":null,"value":"# Scale to 5 replicas of deployment frontend\nkubectl scale --replicas 5 deployment frontend\n# kubectl get pods will show us 5\nkubectl scale --replicas 4 deployment frontend\n# kubectl get pods will show us 4","position":{"start":{"line":253,"column":1,"offset":5978},"end":{"line":259,"column":4,"offset":6195},"indent":[1,1,1,1,1,1]}},{"type":"export","value":"export const _frontmatter = {}","position":{"start":{"line":262,"column":1,"offset":6198},"end":{"line":262,"column":31,"offset":6228},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":262,"column":31,"offset":6228}}},"scopeImports":[],"scopeIdentifiers":[],"rawMDXOutput":"/* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\nimport DefaultLayout from \"/Users/dennis.okeeffe/Project-Imposter/developer-notes/node_modules/gatsby-theme-docz/src/base/Layout.js\"\nexport const _frontmatter = {};\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\")\n  return <div {...props}/>\n};\n\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1 {...{\n      \"id\": \"eks---deploy-stateless-app\"\n    }}>{`EKS - Deploy Stateless App`}</h1>\n    <ul>\n      <li parentName=\"ul\"><a parentName=\"li\" {...{\n          \"href\": \"#eks---deploy-stateless-app\"\n        }}>{`EKS - Deploy Stateless App`}</a><ul parentName=\"li\">\n          <li parentName=\"ul\"><a parentName=\"li\" {...{\n              \"href\": \"#in-this-app\"\n            }}>{`In this app`}</a><ul parentName=\"li\">\n              <li parentName=\"ul\"><a parentName=\"li\" {...{\n                  \"href\": \"#backend\"\n                }}>{`Backend`}</a></li>\n              <li parentName=\"ul\"><a parentName=\"li\" {...{\n                  \"href\": \"#frontend\"\n                }}>{`Frontend`}</a></li>\n            </ul></li>\n          <li parentName=\"ul\"><a parentName=\"li\" {...{\n              \"href\": \"#deploying-the-backend\"\n            }}>{`Deploying the backend`}</a><ul parentName=\"li\">\n              <li parentName=\"ul\"><a parentName=\"li\" {...{\n                  \"href\": \"#the-redis-master\"\n                }}>{`The Redis Master`}</a></li>\n              <li parentName=\"ul\"><a parentName=\"li\" {...{\n                  \"href\": \"#the-redis-slaves\"\n                }}>{`The Redis Slaves`}</a></li>\n            </ul></li>\n          <li parentName=\"ul\"><a parentName=\"li\" {...{\n              \"href\": \"#deploying-the-frontend\"\n            }}>{`Deploying the Frontend`}</a></li>\n          <li parentName=\"ul\"><a parentName=\"li\" {...{\n              \"href\": \"#scaling-pods-up-and-down\"\n            }}>{`Scaling Pods up and down`}</a></li>\n        </ul></li>\n    </ul>\n    <p>{`In this example, we will be build a basic guestbook example from Kubernetes.`}</p>\n    <h2 {...{\n      \"id\": \"in-this-app\"\n    }}>{`In this app`}</h2>\n    <p>{`We will deploy the guestbook app at `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/kubernetes/examples/tree/master/guestbook\"\n      }}>{`https://github.com/kubernetes/examples/tree/master/guestbook`}</a>{`.`}</p>\n    <p>{`We will need to deploy backend resources, frontend resources, scale Pods up/down and some chaos testing.`}</p>\n    <p>{`Our application will be accessible from an AWS Load Balancer.`}</p>\n    <p><img alt=\"App layout\" src=\"https://res.cloudinary.com/gitgoodclub/image/upload/v1548246181/eks-course/Screen_Shot_2019-01-23_at_11.22.49_pm.png\" /></p>\n    <h3 {...{\n      \"id\": \"backend\"\n    }}>{`Backend`}</h3>\n    <p>{`Redis:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Single Master (WRITES)`}</li>\n      <li parentName=\"ul\">{`Multi Slaves (READ)`}</li>\n      <li parentName=\"ul\">{`Slaves sync continuously from Master`}</li>\n    </ul>\n    <h3 {...{\n      \"id\": \"frontend\"\n    }}>{`Frontend`}</h3>\n    <p>{`PHP App:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Load balanced to public with ELB`}</li>\n      <li parentName=\"ul\">{`Read balanced over multiple salve DBs`}</li>\n      <li parentName=\"ul\">{`Write req to single Master DB`}</li>\n    </ul>\n    <h2 {...{\n      \"id\": \"deploying-the-backend\"\n    }}>{`Deploying the backend`}</h2>\n    <p>{`We need to create:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Redis Master pod`}</li>\n      <li parentName=\"ul\">{`Redis Master service`}</li>\n      <li parentName=\"ul\">{`Redis Slave pods`}</li>\n      <li parentName=\"ul\">{`Redis Slave services`}</li>\n    </ul>\n    <p>{`Then we will do some AWS networking (ENI) inspection.`}</p>\n    <h3 {...{\n      \"id\": \"the-redis-master\"\n    }}>{`The Redis Master`}</h3>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: redis-master\n  labels:\n    app: redis\nspec:\n  selector:\n    matchLabels:\n      app: redis\n      role: master\n      tier: backend\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: redis\n        role: master\n        tier: backend\n    spec:\n      containers:\n        - name: master\n          image: k8s.gcr.io/redis:e2e # or just image: redis\n          resources:\n            requests:\n              cpu: 100m\n              memory: 100Mi\n          ports:\n            - containerPort: 6379\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: redis-master\n  labels:\n    app: redis\n    role: master\n    tier: backend\nspec:\n  ports:\n    - port: 6379\n      targetPort: 6379\n  selector:\n    app: redis\n    role: master\n    tier: backend\n`}</code></pre>\n    <p>{`Apply this file using kubectl and then you can check what has been deployed. Notice there is a Cluster IP but not an external IP as it is not exposed to the public.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-shell\"\n      }}>{`kubectl get svc\n\nNAME           TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE\nkubernetes     ClusterIP   [REDACTED]       <none>        443/TCP    1h\nredis-master   ClusterIP   [REDACTED]       <none>        6379/TCP   16s\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"the-redis-slaves\"\n    }}>{`The Redis Slaves`}</h3>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yml\"\n      }}>{`apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: redis-slave\n  labels:\n    app: redis\nspec:\n  selector:\n    matchLabels:\n      app: redis\n      role: slave\n      tier: backend\n  replicas: 2\n  template:\n    metadata:\n      labels:\n        app: redis\n        role: slave\n        tier: backend\n    spec:\n      containers:\n        - name: slave\n          image: gcr.io/google_samples/gb-redisslave:v1\n          resources:\n            requests:\n              cpu: 100m\n              memory: 100Mi\n          env:\n            - name: GET_HOSTS_FROM\n              value: dns\n          ports:\n            - containerPort: 6379\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: redis-slave\n  labels:\n    app: redis\n    role: slave\n    tier: backend\nspec:\n  ports:\n    - port: 6379\n  selector:\n    app: redis\n    role: slave\n    tier: backend\n`}</code></pre>\n    <p>{`After applying the file, we can run `}<inlineCode parentName=\"p\">{`kubectl get pods`}</inlineCode>{` and see something similar to the following:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-shell\"\n      }}>{`NAME                            READY   STATUS    RESTARTS   AGE\nredis-master-6b464554c8-kqkpr   1/1     Running   0          7m\nredis-slave-b58dc4644-dk9cg     1/1     Running   0          12s\nredis-slave-b58dc4644-jx6mz     1/1     Running   0          12s\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"deploying-the-frontend\"\n    }}>{`Deploying the Frontend`}</h2>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: frontend\n  labels:\n    app: guestbook\nspec:\n  selector:\n    # matches Service\n    matchLabels:\n      app: guestbook\n      tier: frontend\n  replicas: 3\n  template:\n    metadata:\n      labels:\n        app: guestbook\n        tier: frontend\n    spec:\n      containers:\n        - name: php-redis\n          image: gcr.io/google-samples/gb-frontend:v4\n          resources:\n            requests:\n              cpu: 100m\n              memory: 100Mi\n          env:\n            - name: GET_HOSTS_FROM\n              value: dns\n              # Using \\`GET_HOSTS_FROM=dns\\` requires your cluster to\n              # provide a dns service. As of Kubernetes 1.3, DNS is a built-in\n              # service launched automatically. However, if the cluster you are using\n              # does not have a built-in DNS service, you can instead\n              # access an environment variable to find the master\n              # service's host. To do so, comment out the 'value: dns' line above, and\n              # uncomment the line below:\n              # value: env\n          ports:\n            - containerPort: 80\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: frontend\n  labels:\n    app: guestbook\n    tier: frontend\nspec:\n  # comment or delete the following line if you want to use a LoadBalancer\n  #type: NodePort\n  # if your cluster supports it, uncomment the following to automatically create\n  # an external load-balanced IP for the frontend service.\n  type: LoadBalancer\n  ports:\n    - port: 80\n  selector:\n    app: guestbook\n    tier: frontend\n`}</code></pre>\n    <p>{`After deploying, we should see all the pods and services deploying.`}</p>\n    <p>{`If we then run `}<inlineCode parentName=\"p\">{`kubectl describe service frontend`}</inlineCode>{`, we should be able to see information on the ELB that we have just deployed.`}</p>\n    <p>{`From this information, we should be able to fetch the `}<inlineCode parentName=\"p\">{`LoadBalancer Ingress`}</inlineCode>{` address to open up the guest book.`}</p>\n    <h2 {...{\n      \"id\": \"scaling-pods-up-and-down\"\n    }}>{`Scaling Pods up and down`}</h2>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yml\"\n      }}>{`# Scale to 5 replicas of deployment frontend\nkubectl scale --replicas 5 deployment frontend\n# kubectl get pods will show us 5\nkubectl scale --replicas 4 deployment frontend\n# kubectl get pods will show us 4\n`}</code></pre>\n\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;"}}