{"expireTime":9007200852878404000,"key":"gatsby-plugin-mdx-entire-payload-c11c95b7125b66eabaa579a0f037512c-","val":{"mdast":{"type":"root","children":[{"type":"import","value":"import DefaultLayout from \"/Users/dennis.okeeffe/Project-Imposter/developer-notes/node_modules/gatsby-theme-docz/src/base/Layout.js\"","position":{"start":{"line":3,"column":1,"offset":2},"end":{"line":3,"column":133,"offset":134},"indent":[]}},{"type":"export","default":true,"value":"export default DefaultLayout","position":{"start":{"line":5,"column":1,"offset":136},"end":{"line":5,"column":29,"offset":164},"indent":[]}},{"type":"heading","depth":1,"children":[{"type":"text","value":"Advanced Topics","position":{"start":{"line":8,"column":3,"offset":169},"end":{"line":8,"column":18,"offset":184},"indent":[]}}],"position":{"start":{"line":8,"column":1,"offset":167},"end":{"line":8,"column":18,"offset":184},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Service Discovery","position":{"start":{"line":10,"column":4,"offset":189},"end":{"line":10,"column":21,"offset":206},"indent":[]}}],"position":{"start":{"line":10,"column":1,"offset":186},"end":{"line":10,"column":21,"offset":206},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"As of Kubernetes 1.3, DNS is a ","position":{"start":{"line":12,"column":1,"offset":208},"end":{"line":12,"column":32,"offset":239},"indent":[]}},{"type":"inlineCode","value":"built-in","position":{"start":{"line":12,"column":32,"offset":239},"end":{"line":12,"column":42,"offset":249},"indent":[]}},{"type":"text","value":" service launched automatically using the addon manager.","position":{"start":{"line":12,"column":42,"offset":249},"end":{"line":12,"column":98,"offset":305},"indent":[]}}],"position":{"start":{"line":12,"column":1,"offset":208},"end":{"line":12,"column":98,"offset":305},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The addons are in the ","position":{"start":{"line":14,"column":1,"offset":307},"end":{"line":14,"column":23,"offset":329},"indent":[]}},{"type":"inlineCode","value":"/etc/kubernetes/addons","position":{"start":{"line":14,"column":23,"offset":329},"end":{"line":14,"column":47,"offset":353},"indent":[]}},{"type":"text","value":" directory on the master node.","position":{"start":{"line":14,"column":47,"offset":353},"end":{"line":14,"column":77,"offset":383},"indent":[]}}],"position":{"start":{"line":14,"column":1,"offset":307},"end":{"line":14,"column":77,"offset":383},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The service can be used within pods to find other services running on the same cluster.","position":{"start":{"line":16,"column":1,"offset":385},"end":{"line":16,"column":88,"offset":472},"indent":[]}}],"position":{"start":{"line":16,"column":1,"offset":385},"end":{"line":16,"column":88,"offset":472},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Multiple containers within 1 pod don't need this service, as they can contact each other directly. A container in the same pod can just use ","position":{"start":{"line":18,"column":1,"offset":474},"end":{"line":18,"column":141,"offset":614},"indent":[]}},{"type":"inlineCode","value":"localhost:port","position":{"start":{"line":18,"column":141,"offset":614},"end":{"line":18,"column":157,"offset":630},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":18,"column":157,"offset":630},"end":{"line":18,"column":158,"offset":631},"indent":[]}}],"position":{"start":{"line":18,"column":1,"offset":474},"end":{"line":18,"column":158,"offset":631},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"To make DNS work, a pod will need a ","position":{"start":{"line":20,"column":1,"offset":633},"end":{"line":20,"column":37,"offset":669},"indent":[]}},{"type":"inlineCode","value":"service definition","position":{"start":{"line":20,"column":37,"offset":669},"end":{"line":20,"column":57,"offset":689},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":20,"column":57,"offset":689},"end":{"line":20,"column":58,"offset":690},"indent":[]}}],"position":{"start":{"line":20,"column":1,"offset":633},"end":{"line":20,"column":58,"offset":690},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"How can app 1 reach app 2 using DNS? The container itself can talk to the service of App 2.","position":{"start":{"line":22,"column":1,"offset":692},"end":{"line":22,"column":92,"offset":783},"indent":[]}}],"position":{"start":{"line":22,"column":1,"offset":692},"end":{"line":22,"column":92,"offset":783},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"If you ran the host for ","position":{"start":{"line":24,"column":1,"offset":785},"end":{"line":24,"column":25,"offset":809},"indent":[]}},{"type":"inlineCode","value":"app1-service","position":{"start":{"line":24,"column":25,"offset":809},"end":{"line":24,"column":39,"offset":823},"indent":[]}},{"type":"text","value":" and got back 10.0.0.1, ","position":{"start":{"line":24,"column":39,"offset":823},"end":{"line":24,"column":63,"offset":847},"indent":[]}},{"type":"inlineCode","value":"host app2-service","position":{"start":{"line":24,"column":63,"offset":847},"end":{"line":24,"column":82,"offset":866},"indent":[]}},{"type":"text","value":" could get back 10.0.0.2.","position":{"start":{"line":24,"column":82,"offset":866},"end":{"line":24,"column":107,"offset":891},"indent":[]}}],"position":{"start":{"line":24,"column":1,"offset":785},"end":{"line":24,"column":107,"offset":891},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Examples from the CL","position":{"start":{"line":26,"column":1,"offset":893},"end":{"line":26,"column":21,"offset":913},"indent":[]}}],"position":{"start":{"line":26,"column":1,"offset":893},"end":{"line":26,"column":21,"offset":913},"indent":[]}},{"type":"code","lang":"bash","meta":null,"value":"host app1-service\n# has addr 10.0.0.1\nhost app2-service\n# has addr 10.0.0.2\nhost app2-service.default\n# app2-service.default has address 10.0.0.2\nhost app2-service.default.svc.cluster.local\n# app2-service.default.svc.cluster.local has addr 10.0.0.2","position":{"start":{"line":28,"column":1,"offset":915},"end":{"line":37,"column":4,"offset":1175},"indent":[1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":39,"column":1,"offset":1177},"end":{"line":39,"column":5,"offset":1181},"indent":[]}},{"type":"inlineCode","value":"default","position":{"start":{"line":39,"column":5,"offset":1181},"end":{"line":39,"column":14,"offset":1190},"indent":[]}},{"type":"text","value":" stands for default namespace. Pods and services can be launched in different namespaces (to logically seperate your cluster).","position":{"start":{"line":39,"column":14,"offset":1190},"end":{"line":39,"column":140,"offset":1316},"indent":[]}}],"position":{"start":{"line":39,"column":1,"offset":1177},"end":{"line":39,"column":140,"offset":1316},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"So how does this resolution work?","position":{"start":{"line":41,"column":1,"offset":1318},"end":{"line":41,"column":34,"offset":1351},"indent":[]}}],"position":{"start":{"line":41,"column":1,"offset":1318},"end":{"line":41,"column":34,"offset":1351},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Say we have a pod and we run ","position":{"start":{"line":43,"column":1,"offset":1353},"end":{"line":43,"column":30,"offset":1382},"indent":[]}},{"type":"inlineCode","value":"kubectl run -i -tty busybox --image=busybox --restart=Never -- sh","position":{"start":{"line":43,"column":30,"offset":1382},"end":{"line":43,"column":97,"offset":1449},"indent":[]}},{"type":"text","value":" and the from the shell run ","position":{"start":{"line":43,"column":97,"offset":1449},"end":{"line":43,"column":125,"offset":1477},"indent":[]}},{"type":"inlineCode","value":"cat /etc/resolv.conf","position":{"start":{"line":43,"column":125,"offset":1477},"end":{"line":43,"column":147,"offset":1499},"indent":[]}},{"type":"text","value":", can can see that there will be a ","position":{"start":{"line":43,"column":147,"offset":1499},"end":{"line":43,"column":182,"offset":1534},"indent":[]}},{"type":"inlineCode","value":"nameserver","position":{"start":{"line":43,"column":182,"offset":1534},"end":{"line":43,"column":194,"offset":1546},"indent":[]}},{"type":"text","value":". If you do a lookup of the service name in this folder, you'll see why the above works with ","position":{"start":{"line":43,"column":194,"offset":1546},"end":{"line":43,"column":287,"offset":1639},"indent":[]}},{"type":"inlineCode","value":".default","position":{"start":{"line":43,"column":287,"offset":1639},"end":{"line":43,"column":297,"offset":1649},"indent":[]}},{"type":"text","value":" and ","position":{"start":{"line":43,"column":297,"offset":1649},"end":{"line":43,"column":302,"offset":1654},"indent":[]}},{"type":"inlineCode","value":".default.svc.whatever","position":{"start":{"line":43,"column":302,"offset":1654},"end":{"line":43,"column":325,"offset":1677},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":43,"column":325,"offset":1677},"end":{"line":43,"column":326,"offset":1678},"indent":[]}}],"position":{"start":{"line":43,"column":1,"offset":1353},"end":{"line":43,"column":326,"offset":1678},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Demo: Service Discovery","position":{"start":{"line":45,"column":5,"offset":1684},"end":{"line":45,"column":28,"offset":1707},"indent":[]}}],"position":{"start":{"line":45,"column":1,"offset":1680},"end":{"line":45,"column":28,"offset":1707},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"After creating a secrets type, pod type for a database (SQL using the secrets), and a service for exposing certain ports for the database and then deploying three replicas for a ","position":{"start":{"line":47,"column":1,"offset":1709},"end":{"line":47,"column":179,"offset":1887},"indent":[]}},{"type":"inlineCode","value":"helloworld-deployment","position":{"start":{"line":47,"column":179,"offset":1887},"end":{"line":47,"column":202,"offset":1910},"indent":[]}},{"type":"text","value":" that also has a ","position":{"start":{"line":47,"column":202,"offset":1910},"end":{"line":47,"column":219,"offset":1927},"indent":[]}},{"type":"inlineCode","value":"index-db.js","position":{"start":{"line":47,"column":219,"offset":1927},"end":{"line":47,"column":232,"offset":1940},"indent":[]}},{"type":"text","value":" file which we run ","position":{"start":{"line":47,"column":232,"offset":1940},"end":{"line":47,"column":251,"offset":1959},"indent":[]}},{"type":"inlineCode","value":"node index-db.js","position":{"start":{"line":47,"column":251,"offset":1959},"end":{"line":47,"column":269,"offset":1977},"indent":[]}},{"type":"text","value":" which will have code that works on the service. The value of the ","position":{"start":{"line":47,"column":269,"offset":1977},"end":{"line":47,"column":335,"offset":2043},"indent":[]}},{"type":"inlineCode","value":"MYSQL_HOST","position":{"start":{"line":47,"column":335,"offset":2043},"end":{"line":47,"column":347,"offset":2055},"indent":[]}},{"type":"text","value":" being set to ","position":{"start":{"line":47,"column":347,"offset":2055},"end":{"line":47,"column":361,"offset":2069},"indent":[]}},{"type":"inlineCode","value":"database-service","position":{"start":{"line":47,"column":361,"offset":2069},"end":{"line":47,"column":379,"offset":2087},"indent":[]}},{"type":"text","value":" will resolve with the database-service.yml file where the metadata ","position":{"start":{"line":47,"column":379,"offset":2087},"end":{"line":47,"column":447,"offset":2155},"indent":[]}},{"type":"inlineCode","value":"name","position":{"start":{"line":47,"column":447,"offset":2155},"end":{"line":47,"column":453,"offset":2161},"indent":[]}},{"type":"text","value":" is ","position":{"start":{"line":47,"column":453,"offset":2161},"end":{"line":47,"column":457,"offset":2165},"indent":[]}},{"type":"inlineCode","value":"database-service","position":{"start":{"line":47,"column":457,"offset":2165},"end":{"line":47,"column":475,"offset":2183},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":47,"column":475,"offset":2183},"end":{"line":47,"column":476,"offset":2184},"indent":[]}}],"position":{"start":{"line":47,"column":1,"offset":1709},"end":{"line":47,"column":476,"offset":2184},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Running ","position":{"start":{"line":49,"column":1,"offset":2186},"end":{"line":49,"column":9,"offset":2194},"indent":[]}},{"type":"inlineCode","value":"kubectl get pod","position":{"start":{"line":49,"column":9,"offset":2194},"end":{"line":49,"column":26,"offset":2211},"indent":[]}},{"type":"text","value":" we should see the database plus 3 pods running for the deployment.","position":{"start":{"line":49,"column":26,"offset":2211},"end":{"line":49,"column":93,"offset":2278},"indent":[]}}],"position":{"start":{"line":49,"column":1,"offset":2186},"end":{"line":49,"column":93,"offset":2278},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Running ","position":{"start":{"line":51,"column":1,"offset":2280},"end":{"line":51,"column":9,"offset":2288},"indent":[]}},{"type":"inlineCode","value":"kubectl logs [deployment-name]","position":{"start":{"line":51,"column":9,"offset":2288},"end":{"line":51,"column":41,"offset":2320},"indent":[]}},{"type":"text","value":" will also show us the logs for that pod.","position":{"start":{"line":51,"column":41,"offset":2320},"end":{"line":51,"column":82,"offset":2361},"indent":[]}}],"position":{"start":{"line":51,"column":1,"offset":2280},"end":{"line":51,"column":82,"offset":2361},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Again, remember that running ","position":{"start":{"line":53,"column":1,"offset":2363},"end":{"line":53,"column":30,"offset":2392},"indent":[]}},{"type":"inlineCode","value":"kubectl get svc","position":{"start":{"line":53,"column":30,"offset":2392},"end":{"line":53,"column":47,"offset":2409},"indent":[]}},{"type":"text","value":" will get all the services available.","position":{"start":{"line":53,"column":47,"offset":2409},"end":{"line":53,"column":84,"offset":2446},"indent":[]}}],"position":{"start":{"line":53,"column":1,"offset":2363},"end":{"line":53,"column":84,"offset":2446},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"ConfigMap","position":{"start":{"line":55,"column":4,"offset":2451},"end":{"line":55,"column":13,"offset":2460},"indent":[]}}],"position":{"start":{"line":55,"column":1,"offset":2448},"end":{"line":55,"column":13,"offset":2460},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Config params that are not secret can be put in the ConfigMap.","position":{"start":{"line":57,"column":1,"offset":2462},"end":{"line":57,"column":63,"offset":2524},"indent":[]}}],"position":{"start":{"line":57,"column":1,"offset":2462},"end":{"line":57,"column":63,"offset":2524},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The input is again key-value pairs.","position":{"start":{"line":59,"column":1,"offset":2526},"end":{"line":59,"column":36,"offset":2561},"indent":[]}}],"position":{"start":{"line":59,"column":1,"offset":2526},"end":{"line":59,"column":36,"offset":2561},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":61,"column":1,"offset":2563},"end":{"line":61,"column":5,"offset":2567},"indent":[]}},{"type":"inlineCode","value":"ConfigMap","position":{"start":{"line":61,"column":5,"offset":2567},"end":{"line":61,"column":16,"offset":2578},"indent":[]}},{"type":"text","value":" key-value pairs can then be read by the app using:","position":{"start":{"line":61,"column":16,"offset":2578},"end":{"line":61,"column":67,"offset":2629},"indent":[]}}],"position":{"start":{"line":61,"column":1,"offset":2563},"end":{"line":61,"column":67,"offset":2629},"indent":[]}},{"type":"list","ordered":true,"start":1,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Env variables","position":{"start":{"line":63,"column":5,"offset":2635},"end":{"line":63,"column":18,"offset":2648},"indent":[]}}],"position":{"start":{"line":63,"column":5,"offset":2635},"end":{"line":63,"column":18,"offset":2648},"indent":[]}}],"position":{"start":{"line":63,"column":1,"offset":2631},"end":{"line":63,"column":18,"offset":2648},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Container commandline args in the Pod config","position":{"start":{"line":64,"column":5,"offset":2653},"end":{"line":64,"column":49,"offset":2697},"indent":[]}}],"position":{"start":{"line":64,"column":5,"offset":2653},"end":{"line":64,"column":49,"offset":2697},"indent":[]}}],"position":{"start":{"line":64,"column":1,"offset":2649},"end":{"line":64,"column":49,"offset":2697},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Using volumes","position":{"start":{"line":65,"column":5,"offset":2702},"end":{"line":65,"column":18,"offset":2715},"indent":[]}}],"position":{"start":{"line":65,"column":5,"offset":2702},"end":{"line":65,"column":18,"offset":2715},"indent":[]}}],"position":{"start":{"line":65,"column":1,"offset":2698},"end":{"line":65,"column":18,"offset":2715},"indent":[]}}],"position":{"start":{"line":63,"column":1,"offset":2631},"end":{"line":65,"column":18,"offset":2715},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"It can also contain full config files eg. a webserver config file. Then that file can then be mounted using volumes where the application expects its config file.","position":{"start":{"line":67,"column":1,"offset":2717},"end":{"line":67,"column":163,"offset":2879},"indent":[]}}],"position":{"start":{"line":67,"column":1,"offset":2717},"end":{"line":67,"column":163,"offset":2879},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"This was you can ","position":{"start":{"line":69,"column":1,"offset":2881},"end":{"line":69,"column":18,"offset":2898},"indent":[]}},{"type":"inlineCode","value":"inject","position":{"start":{"line":69,"column":18,"offset":2898},"end":{"line":69,"column":26,"offset":2906},"indent":[]}},{"type":"text","value":" config settings into containers without changing the container itself.","position":{"start":{"line":69,"column":26,"offset":2906},"end":{"line":69,"column":97,"offset":2977},"indent":[]}}],"position":{"start":{"line":69,"column":1,"offset":2881},"end":{"line":69,"column":97,"offset":2977},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"To generate a configmap using files:","position":{"start":{"line":71,"column":1,"offset":2979},"end":{"line":71,"column":37,"offset":3015},"indent":[]}}],"position":{"start":{"line":71,"column":1,"offset":2979},"end":{"line":71,"column":37,"offset":3015},"indent":[]}},{"type":"code","lang":"bash","meta":null,"value":"$ cat << EOF > app.properties\ndriver=jdbc\ndatabase=postgres\nlookandfeel=1\notherparams=xyz\nparam.with.hierarchy=xyz\nEOF\n$ kubectl create configmap app-config --from-file=app.properties","position":{"start":{"line":73,"column":1,"offset":3017},"end":{"line":82,"column":4,"offset":3212},"indent":[1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"How to use it? You can create a pod that exposes the ConfigMap using a volume.","position":{"start":{"line":84,"column":1,"offset":3214},"end":{"line":84,"column":79,"offset":3292},"indent":[]}}],"position":{"start":{"line":84,"column":1,"offset":3214},"end":{"line":84,"column":79,"offset":3292},"indent":[]}},{"type":"code","lang":"yaml","meta":null,"value":"# pod-helloworld.yml w/ secrets\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nodehelloworld.example.com\n  labels:\n  app: helloworld\nspec:\n  # The containers are listed here\n  containers:\n  - name: k8s-demo\n  image: okeeffed/docker-demo\n  ports:\n  - containerPort: 3000\n  # @@@ This are the envs in a volume mount\n  volumeMounts:\n  - name: credvolume\n    mountPath: /etc/creds\n    readOnly: true\n  # @@@ For the ConfigMap\n  - name: config-volume\n    mountPath: /etc/config\n  volumes:\n  - name: credvolume\n  secret:\n    secretName: db-secrets\n  # @@@ For the ConfigMap\n  - name: config-volume\n  configMap:\n    name: app-config","position":{"start":{"line":86,"column":1,"offset":3294},"end":{"line":117,"column":4,"offset":3928},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"From ","position":{"start":{"line":119,"column":1,"offset":3930},"end":{"line":119,"column":6,"offset":3935},"indent":[]}},{"type":"inlineCode","value":"/etc/config","position":{"start":{"line":119,"column":6,"offset":3935},"end":{"line":119,"column":19,"offset":3948},"indent":[]}},{"type":"text","value":" , the config values will be stored in files at ","position":{"start":{"line":119,"column":19,"offset":3948},"end":{"line":119,"column":67,"offset":3996},"indent":[]}},{"type":"inlineCode","value":"/etc/config/driver","position":{"start":{"line":119,"column":67,"offset":3996},"end":{"line":119,"column":87,"offset":4016},"indent":[]}},{"type":"text","value":" and ","position":{"start":{"line":119,"column":87,"offset":4016},"end":{"line":119,"column":92,"offset":4021},"indent":[]}},{"type":"inlineCode","value":"/etc/config/param/with/hierarchy","position":{"start":{"line":119,"column":92,"offset":4021},"end":{"line":119,"column":126,"offset":4055},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":119,"column":126,"offset":4055},"end":{"line":119,"column":127,"offset":4056},"indent":[]}}],"position":{"start":{"line":119,"column":1,"offset":3930},"end":{"line":119,"column":127,"offset":4056},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"This is an example of a pod that exposes the ConfigMap as env variables:","position":{"start":{"line":121,"column":1,"offset":4058},"end":{"line":121,"column":73,"offset":4130},"indent":[]}}],"position":{"start":{"line":121,"column":1,"offset":4058},"end":{"line":121,"column":73,"offset":4130},"indent":[]}},{"type":"code","lang":"yaml","meta":null,"value":"# pod-helloworld.yml w/ secrets\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nodehelloworld.example.com\n  labels:\n  app: helloworld\nspec:\n  # The containers are listed here\n  containers:\n  - name: k8s-demo\n  image: okeeffed/docker-demo\n  ports:\n  - containerPort: 3000\n  # @@@ This are the envs in a volume mount\n  env:\n  - name: DRIVER\n    valueFrom: # where you get the value from\n    configMapKeyRef: # ensuring the ref comes from the configMap\n    name: app-config\n    key: driver\n  - name: DATABASE\n  [ ... ]","position":{"start":{"line":123,"column":1,"offset":4132},"end":{"line":147,"column":4,"offset":4655},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Demo: Config Map","position":{"start":{"line":149,"column":5,"offset":4661},"end":{"line":149,"column":21,"offset":4677},"indent":[]}}],"position":{"start":{"line":149,"column":1,"offset":4657},"end":{"line":149,"column":21,"offset":4677},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Using an example for a reverse proxy config for NGINX:","position":{"start":{"line":151,"column":1,"offset":4679},"end":{"line":151,"column":55,"offset":4733},"indent":[]}}],"position":{"start":{"line":151,"column":1,"offset":4679},"end":{"line":151,"column":55,"offset":4733},"indent":[]}},{"type":"code","lang":null,"meta":null,"value":"server {\n  listen  80;\n  server_name localhost;\n\n  location / {\n  proxy_bind 127.0.0.1;\n  proxy_pass http://127.0.0.1:3000;\n  }\n\n  error_page  500 502 503 504 /50x.html;\n  location = /50x.html {\n  root    /usr/share/nginx/html;\n  }\n}","position":{"start":{"line":153,"column":1,"offset":4735},"end":{"line":168,"column":4,"offset":4976},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"We could then create this config map with ","position":{"start":{"line":170,"column":1,"offset":4978},"end":{"line":170,"column":43,"offset":5020},"indent":[]}},{"type":"inlineCode","value":"kubectl create configmap nginx-config --from-file=reverseproxy.conf","position":{"start":{"line":170,"column":43,"offset":5020},"end":{"line":170,"column":112,"offset":5089},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":170,"column":112,"offset":5089},"end":{"line":170,"column":113,"offset":5090},"indent":[]}}],"position":{"start":{"line":170,"column":1,"offset":4978},"end":{"line":170,"column":113,"offset":5090},"indent":[]}},{"type":"code","lang":"yaml","meta":null,"value":"# pod-helloworld.yml w/ secrets\napiVersion: v1\nkind: Pod\nmetadata:\n  name: hellonginx.example.com\n  labels:\n  app: hellonginx\nspec:\n  # The containers are listed here\n  containers:\n\t- name: nginx\n\timage: nginx:1.11\n\tports:\n\t- containerPort: 80\n\t# @@@ The import conf stuff\n\tvolumeMounts:\n\t- name: config-volume\n\t\tmountPath: /etc/nginx/conf.d\n  - name: k8s-demo\n  image: okeeffed/docker-demo\n  ports:\n    - containerPort: 3000\n  # @@@ The important mounting\n  volumes:\n\t- name: config-volume # @@@ this is referred to above in volumeMounts\n\tconfigMap:\n\t\tname: nginx-config\n\t\titems:\n\t\t- key: reverseproxy.conf\n\t\tpath: reverseproxy.conf","position":{"start":{"line":172,"column":1,"offset":5092},"end":{"line":203,"column":4,"offset":5737},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"After then also creating the service, we can grab the minikube service url and use curl to get info on that request. From here, would could see that it is ","position":{"start":{"line":205,"column":1,"offset":5739},"end":{"line":205,"column":156,"offset":5894},"indent":[]}},{"type":"inlineCode","value":"nginx","position":{"start":{"line":205,"column":156,"offset":5894},"end":{"line":205,"column":163,"offset":5901},"indent":[]}},{"type":"text","value":" answer the request and transferring it to the Node port.","position":{"start":{"line":205,"column":163,"offset":5901},"end":{"line":205,"column":220,"offset":5958},"indent":[]}}],"position":{"start":{"line":205,"column":1,"offset":5739},"end":{"line":205,"column":220,"offset":5958},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"If we then want to jump into the nginx container to see what is going on, we can run ","position":{"start":{"line":207,"column":1,"offset":5960},"end":{"line":207,"column":86,"offset":6045},"indent":[]}},{"type":"inlineCode","value":"kubectl exec -i -t helloworld-nginx -c nginx -- bash","position":{"start":{"line":207,"column":86,"offset":6045},"end":{"line":207,"column":140,"offset":6099},"indent":[]}},{"type":"text","value":" (-c flag to specify container) and run ","position":{"start":{"line":207,"column":140,"offset":6099},"end":{"line":207,"column":180,"offset":6139},"indent":[]}},{"type":"inlineCode","value":"ps x","position":{"start":{"line":207,"column":180,"offset":6139},"end":{"line":207,"column":186,"offset":6145},"indent":[]}},{"type":"text","value":" to see the processes and we can ","position":{"start":{"line":207,"column":186,"offset":6145},"end":{"line":207,"column":219,"offset":6178},"indent":[]}},{"type":"inlineCode","value":"cat /etc/nginx/conf.d/reverseproxy.conf","position":{"start":{"line":207,"column":219,"offset":6178},"end":{"line":207,"column":260,"offset":6219},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":207,"column":260,"offset":6219},"end":{"line":207,"column":261,"offset":6220},"indent":[]}}],"position":{"start":{"line":207,"column":1,"offset":5960},"end":{"line":207,"column":261,"offset":6220},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"At this stage, we can enable SSL for NGINX.","position":{"start":{"line":209,"column":1,"offset":6222},"end":{"line":209,"column":44,"offset":6265},"indent":[]}}],"position":{"start":{"line":209,"column":1,"offset":6222},"end":{"line":209,"column":44,"offset":6265},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Ingress Controller","position":{"start":{"line":211,"column":4,"offset":6270},"end":{"line":211,"column":22,"offset":6288},"indent":[]}}],"position":{"start":{"line":211,"column":1,"offset":6267},"end":{"line":211,"column":22,"offset":6288},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Ingress a solution since Kub 1.1 that allows inbound connections to the cluster.","position":{"start":{"line":213,"column":1,"offset":6290},"end":{"line":213,"column":81,"offset":6370},"indent":[]}}],"position":{"start":{"line":213,"column":1,"offset":6290},"end":{"line":213,"column":81,"offset":6370},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"It's an alternative to the external ","position":{"start":{"line":215,"column":1,"offset":6372},"end":{"line":215,"column":37,"offset":6408},"indent":[]}},{"type":"inlineCode","value":"LoadBalancer","position":{"start":{"line":215,"column":37,"offset":6408},"end":{"line":215,"column":51,"offset":6422},"indent":[]}},{"type":"text","value":" and ","position":{"start":{"line":215,"column":51,"offset":6422},"end":{"line":215,"column":56,"offset":6427},"indent":[]}},{"type":"inlineCode","value":"nodePorts","position":{"start":{"line":215,"column":56,"offset":6427},"end":{"line":215,"column":67,"offset":6438},"indent":[]}},{"type":"text","value":". It allows you to easily expose services that need to be accessible from outside to the cluster.","position":{"start":{"line":215,"column":67,"offset":6438},"end":{"line":215,"column":164,"offset":6535},"indent":[]}}],"position":{"start":{"line":215,"column":1,"offset":6372},"end":{"line":215,"column":164,"offset":6535},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"With ingress you can run your own ingress controller (basically a loudbalancer) within the Kub Cluster.","position":{"start":{"line":217,"column":1,"offset":6537},"end":{"line":217,"column":104,"offset":6640},"indent":[]}}],"position":{"start":{"line":217,"column":1,"offset":6537},"end":{"line":217,"column":104,"offset":6640},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"There are default ingress controller available, or you can write your own ingress controller.","position":{"start":{"line":219,"column":1,"offset":6642},"end":{"line":219,"column":94,"offset":6735},"indent":[]}}],"position":{"start":{"line":219,"column":1,"offset":6642},"end":{"line":219,"column":94,"offset":6735},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"How does it work? If you connect over 80/443 you will first hit the ","position":{"start":{"line":221,"column":1,"offset":6737},"end":{"line":221,"column":69,"offset":6805},"indent":[]}},{"type":"inlineCode","value":"Ingress Controller","position":{"start":{"line":221,"column":69,"offset":6805},"end":{"line":221,"column":89,"offset":6825},"indent":[]}},{"type":"text","value":". You can use the NGINX controller that comes with Kubernetes. That controller will the dirrect all the traffic.","position":{"start":{"line":221,"column":89,"offset":6825},"end":{"line":221,"column":201,"offset":6937},"indent":[]}}],"position":{"start":{"line":221,"column":1,"offset":6737},"end":{"line":221,"column":201,"offset":6937},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":223,"column":1,"offset":6939},"end":{"line":223,"column":5,"offset":6943},"indent":[]}},{"type":"inlineCode","value":"ingress rules","position":{"start":{"line":223,"column":5,"offset":6943},"end":{"line":223,"column":20,"offset":6958},"indent":[]}},{"type":"text","value":" could define that if you go to ","position":{"start":{"line":223,"column":20,"offset":6958},"end":{"line":223,"column":52,"offset":6990},"indent":[]}},{"type":"inlineCode","value":"host-x.example.com","position":{"start":{"line":223,"column":52,"offset":6990},"end":{"line":223,"column":72,"offset":7010},"indent":[]}},{"type":"text","value":" you go to ","position":{"start":{"line":223,"column":72,"offset":7010},"end":{"line":223,"column":83,"offset":7021},"indent":[]}},{"type":"inlineCode","value":"Pod 1","position":{"start":{"line":223,"column":83,"offset":7021},"end":{"line":223,"column":90,"offset":7028},"indent":[]}},{"type":"text","value":" etc. You can even redirect slash URLs specifically.","position":{"start":{"line":223,"column":90,"offset":7028},"end":{"line":223,"column":142,"offset":7080},"indent":[]}}],"position":{"start":{"line":223,"column":1,"offset":6939},"end":{"line":223,"column":142,"offset":7080},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"To create an Ingress Controller:","position":{"start":{"line":225,"column":1,"offset":7082},"end":{"line":225,"column":33,"offset":7114},"indent":[]}}],"position":{"start":{"line":225,"column":1,"offset":7082},"end":{"line":225,"column":33,"offset":7114},"indent":[]}},{"type":"code","lang":"yaml","meta":null,"value":"# ingress-controller.yml w/ secrets\napiVersion: extensions/v1beta1\nkind: Ingress\nmetadata:\n  name: helloworld-rules\nspec:\n  # @@@ Setting the important rules\n  rules:\n\t- host: helloworld-v1.example.com\n\t  http:\n\t\tpaths:\n\t\t  - path: /\n\t\t  backend:\n\t\t\tserviceName: helloworld-v1\n\t\t\tservicePort: 80\n    - host: helloworld-v2.example.com\n\t  http:\n\t\tpaths:\n\t\t  - path: /\n\t\t  backend:\n\t\t\tserviceName: helloworld-v2\n\t\t\tservicePort: 80","position":{"start":{"line":227,"column":1,"offset":7116},"end":{"line":250,"column":4,"offset":7555},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Demo: Ingress Controller","position":{"start":{"line":252,"column":5,"offset":7561},"end":{"line":252,"column":29,"offset":7585},"indent":[]}}],"position":{"start":{"line":252,"column":1,"offset":7557},"end":{"line":252,"column":29,"offset":7585},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"In the example, the ingress controller is a ","position":{"start":{"line":254,"column":1,"offset":7587},"end":{"line":254,"column":45,"offset":7631},"indent":[]}},{"type":"inlineCode","value":"Replication Controller","position":{"start":{"line":254,"column":45,"offset":7631},"end":{"line":254,"column":69,"offset":7655},"indent":[]}},{"type":"text","value":" to ensure that there is always one up and running.","position":{"start":{"line":254,"column":69,"offset":7655},"end":{"line":254,"column":120,"offset":7706},"indent":[]}}],"position":{"start":{"line":254,"column":1,"offset":7587},"end":{"line":254,"column":120,"offset":7706},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"After deploying, if we curl with the -H host flag with ","position":{"start":{"line":256,"column":1,"offset":7708},"end":{"line":256,"column":56,"offset":7763},"indent":[]}},{"type":"inlineCode","value":"helloworld-v1.whatever.com","position":{"start":{"line":256,"column":56,"offset":7763},"end":{"line":256,"column":84,"offset":7791},"indent":[]}},{"type":"text","value":" and v2 respectively, it would have the ingress controller route to each server.","position":{"start":{"line":256,"column":84,"offset":7791},"end":{"line":256,"column":164,"offset":7871},"indent":[]}}],"position":{"start":{"line":256,"column":1,"offset":7708},"end":{"line":256,"column":164,"offset":7871},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"External DNS","position":{"start":{"line":258,"column":4,"offset":7876},"end":{"line":258,"column":16,"offset":7888},"indent":[]}}],"position":{"start":{"line":258,"column":1,"offset":7873},"end":{"line":258,"column":16,"offset":7888},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"On public cloud providers, you can use the ingress controller to ","position":{"start":{"line":260,"column":1,"offset":7890},"end":{"line":260,"column":66,"offset":7955},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"reduce the cost of your LoadBalancers","position":{"start":{"line":260,"column":68,"offset":7957},"end":{"line":260,"column":105,"offset":7994},"indent":[]}}],"position":{"start":{"line":260,"column":66,"offset":7955},"end":{"line":260,"column":107,"offset":7996},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":260,"column":107,"offset":7996},"end":{"line":260,"column":108,"offset":7997},"indent":[]}}],"position":{"start":{"line":260,"column":1,"offset":7890},"end":{"line":260,"column":108,"offset":7997},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"You could use 1 LoadBalancer that captures all the external traffic and send it to the ingress controller.","position":{"start":{"line":262,"column":3,"offset":8001},"end":{"line":262,"column":109,"offset":8107},"indent":[]}}],"position":{"start":{"line":262,"column":3,"offset":8001},"end":{"line":262,"column":109,"offset":8107},"indent":[]}}],"position":{"start":{"line":262,"column":1,"offset":7999},"end":{"line":262,"column":109,"offset":8107},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"IngCont can be configured to route the different traffic to all your apps based on HTTP rules.","position":{"start":{"line":263,"column":3,"offset":8110},"end":{"line":263,"column":97,"offset":8204},"indent":[]}}],"position":{"start":{"line":263,"column":3,"offset":8110},"end":{"line":263,"column":97,"offset":8204},"indent":[]}}],"position":{"start":{"line":263,"column":1,"offset":8108},"end":{"line":263,"column":97,"offset":8204},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Only works for HTTP(s)-based apps","position":{"start":{"line":264,"column":3,"offset":8207},"end":{"line":264,"column":36,"offset":8240},"indent":[]}}],"position":{"start":{"line":264,"column":3,"offset":8207},"end":{"line":264,"column":36,"offset":8240},"indent":[]}}],"position":{"start":{"line":264,"column":1,"offset":8205},"end":{"line":264,"column":36,"offset":8240},"indent":[]}}],"position":{"start":{"line":262,"column":1,"offset":7999},"end":{"line":264,"column":36,"offset":8240},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"The External DNS tool will automatically create the necessary DNS records in your external DNS server (like route53).","position":{"start":{"line":266,"column":1,"offset":8242},"end":{"line":266,"column":118,"offset":8359},"indent":[]}}],"position":{"start":{"line":266,"column":1,"offset":8242},"end":{"line":266,"column":118,"offset":8359},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"For every hostname used in ingress, it'll create a new record to send traffic to load balancer.","position":{"start":{"line":268,"column":3,"offset":8363},"end":{"line":268,"column":98,"offset":8458},"indent":[]}}],"position":{"start":{"line":268,"column":3,"offset":8363},"end":{"line":268,"column":98,"offset":8458},"indent":[]}}],"position":{"start":{"line":268,"column":1,"offset":8361},"end":{"line":268,"column":98,"offset":8458},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The major DNS providers are supported: Route53, Google CloudDNS, CloudFlare etc.","position":{"start":{"line":269,"column":3,"offset":8461},"end":{"line":269,"column":83,"offset":8541},"indent":[]}}],"position":{"start":{"line":269,"column":3,"offset":8461},"end":{"line":269,"column":83,"offset":8541},"indent":[]}}],"position":{"start":{"line":269,"column":1,"offset":8459},"end":{"line":269,"column":83,"offset":8541},"indent":[]}}],"position":{"start":{"line":268,"column":1,"offset":8361},"end":{"line":269,"column":83,"offset":8541},"indent":[1]}},{"type":"paragraph","children":[{"type":"image","title":null,"url":"https://res.cloudinary.com/gitgoodclub/image/upload/v1539998347/Screen_Shot_2018-10-20_at_12.18.14_pm.png","alt":"Diagram","position":{"start":{"line":271,"column":1,"offset":8543},"end":{"line":271,"column":118,"offset":8660},"indent":[]}}],"position":{"start":{"line":271,"column":1,"offset":8543},"end":{"line":271,"column":118,"offset":8660},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Volumes","position":{"start":{"line":273,"column":4,"offset":8665},"end":{"line":273,"column":11,"offset":8672},"indent":[]}}],"position":{"start":{"line":273,"column":1,"offset":8662},"end":{"line":273,"column":11,"offset":8672},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"How can we run stateful apps?","position":{"start":{"line":275,"column":1,"offset":8674},"end":{"line":275,"column":30,"offset":8703},"indent":[]}}],"position":{"start":{"line":275,"column":1,"offset":8674},"end":{"line":275,"column":30,"offset":8703},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Volumes in kubernetes allow you to store data outside of the container. So far, all the applications have been stateless for this reason. This can be done with external services like a database, caching server (eg MySQL, AWS S3).","position":{"start":{"line":277,"column":1,"offset":8705},"end":{"line":277,"column":230,"offset":8934},"indent":[]}}],"position":{"start":{"line":277,"column":1,"offset":8705},"end":{"line":277,"column":230,"offset":8934},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Persistent Volumes in Kubernetes allow you to attach a volume to a container that exists even when the container stops. Volumes can be attached using different volume plugins. Eg local volume, EBS Storage etc.","position":{"start":{"line":279,"column":1,"offset":8936},"end":{"line":279,"column":210,"offset":9145},"indent":[]}}],"position":{"start":{"line":279,"column":1,"offset":8936},"end":{"line":279,"column":210,"offset":9145},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Using EBS Storage","position":{"start":{"line":281,"column":5,"offset":9151},"end":{"line":281,"column":22,"offset":9168},"indent":[]}}],"position":{"start":{"line":281,"column":1,"offset":9147},"end":{"line":281,"column":22,"offset":9168},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"With this, we can keep state. You could run a ","position":{"start":{"line":283,"column":1,"offset":9170},"end":{"line":283,"column":47,"offset":9216},"indent":[]}},{"type":"inlineCode","value":"MySQL","position":{"start":{"line":283,"column":47,"offset":9216},"end":{"line":283,"column":54,"offset":9223},"indent":[]}},{"type":"text","value":" database using persistent volumes, although this may not be ready for production yet.","position":{"start":{"line":283,"column":54,"offset":9223},"end":{"line":283,"column":140,"offset":9309},"indent":[]}}],"position":{"start":{"line":283,"column":1,"offset":9170},"end":{"line":283,"column":140,"offset":9309},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The use case is that if your node stops working, the pod can be rescheduled on another node, and the volume can be attached to the new node.","position":{"start":{"line":285,"column":1,"offset":9311},"end":{"line":285,"column":141,"offset":9451},"indent":[]}}],"position":{"start":{"line":285,"column":1,"offset":9311},"end":{"line":285,"column":141,"offset":9451},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"To use volumes, you first need to create the volume:","position":{"start":{"line":287,"column":1,"offset":9453},"end":{"line":287,"column":53,"offset":9505},"indent":[]}}],"position":{"start":{"line":287,"column":1,"offset":9453},"end":{"line":287,"column":53,"offset":9505},"indent":[]}},{"type":"code","lang":"bash","meta":null,"value":"aws ec2 create-volume --sze 1- --region us-east-1 --availability-zone us-east-1 --volume-type gp2","position":{"start":{"line":289,"column":1,"offset":9507},"end":{"line":291,"column":4,"offset":9616},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Next, we need to create a pod with a volume def:","position":{"start":{"line":293,"column":1,"offset":9618},"end":{"line":293,"column":49,"offset":9666},"indent":[]}}],"position":{"start":{"line":293,"column":1,"offset":9618},"end":{"line":293,"column":49,"offset":9666},"indent":[]}},{"type":"code","lang":"yaml","meta":null,"value":"# pod-helloworld.yml w/ secrets\napiVersion: v1\nkind: Pod\nmetadata:\n  name: hellonginx.example.com\n  labels:\n  app: hellonginx\nspec:\n  # The containers are listed here\n  containers:\n\t- name: k8s-demo\n\timage: okeeffed/k8s-demo\n\tvolumeMounts:\n\t- name: myvolume\n\t  mountPath: myvolume\n  # @@@ The important mounting\n  volumes:\n\t- name: myvolume # @@@ this is referred to above in volumeMounts\n\t  awsElasticBlockStore:\n\t    volumeID: vol-9835id","position":{"start":{"line":295,"column":1,"offset":9668},"end":{"line":316,"column":4,"offset":10119},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Demo: Volumes","position":{"start":{"line":318,"column":5,"offset":10125},"end":{"line":318,"column":18,"offset":10138},"indent":[]}}],"position":{"start":{"line":318,"column":1,"offset":10121},"end":{"line":318,"column":18,"offset":10138},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Using Vagrant for kops, we can first create a volume using the above mentioned command.","position":{"start":{"line":320,"column":1,"offset":10140},"end":{"line":320,"column":88,"offset":10227},"indent":[]}}],"position":{"start":{"line":320,"column":1,"offset":10140},"end":{"line":320,"column":88,"offset":10227},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"After receiving a response, you can replace the .yml pod definition config file to attach that volumeID. Once the deployment is created and deployed. ","position":{"start":{"line":322,"column":1,"offset":10229},"end":{"line":322,"column":151,"offset":10379},"indent":[]}}],"position":{"start":{"line":322,"column":1,"offset":10229},"end":{"line":322,"column":151,"offset":10379},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"After create and confirmation, we can get the pod name ","position":{"start":{"line":324,"column":3,"offset":10383},"end":{"line":324,"column":58,"offset":10438},"indent":[]}},{"type":"inlineCode","value":"kubectl get pod","position":{"start":{"line":324,"column":58,"offset":10438},"end":{"line":324,"column":75,"offset":10455},"indent":[]}},{"type":"text","value":" and attach ","position":{"start":{"line":324,"column":75,"offset":10455},"end":{"line":324,"column":87,"offset":10467},"indent":[]}},{"type":"inlineCode","value":"kubectl exec helloworld-deployment-923id -i -t -- bash","position":{"start":{"line":324,"column":87,"offset":10467},"end":{"line":324,"column":143,"offset":10523},"indent":[]}},{"type":"text","value":" and then run ","position":{"start":{"line":324,"column":143,"offset":10523},"end":{"line":324,"column":157,"offset":10537},"indent":[]}},{"type":"inlineCode","value":"ls -ahl /myvol/","position":{"start":{"line":324,"column":157,"offset":10537},"end":{"line":324,"column":174,"offset":10554},"indent":[]}},{"type":"text","value":" to check for volume.","position":{"start":{"line":324,"column":174,"offset":10554},"end":{"line":324,"column":195,"offset":10575},"indent":[]}}],"position":{"start":{"line":324,"column":3,"offset":10383},"end":{"line":324,"column":195,"offset":10575},"indent":[]}}],"position":{"start":{"line":324,"column":1,"offset":10381},"end":{"line":324,"column":195,"offset":10575},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"If we run ","position":{"start":{"line":325,"column":3,"offset":10578},"end":{"line":325,"column":13,"offset":10588},"indent":[]}},{"type":"inlineCode","value":"echo 'test' > /myvol/myvol.txt","position":{"start":{"line":325,"column":13,"offset":10588},"end":{"line":325,"column":45,"offset":10620},"indent":[]}},{"type":"text","value":" and ","position":{"start":{"line":325,"column":45,"offset":10620},"end":{"line":325,"column":50,"offset":10625},"indent":[]}},{"type":"inlineCode","value":"echo 'test 2' > /test.txt","position":{"start":{"line":325,"column":50,"offset":10625},"end":{"line":325,"column":77,"offset":10652},"indent":[]}},{"type":"text","value":", we know that the latter file will not persist if the pod is restarted/rescheduled.","position":{"start":{"line":325,"column":77,"offset":10652},"end":{"line":325,"column":161,"offset":10736},"indent":[]}}],"position":{"start":{"line":325,"column":3,"offset":10578},"end":{"line":325,"column":161,"offset":10736},"indent":[]}}],"position":{"start":{"line":325,"column":1,"offset":10576},"end":{"line":325,"column":161,"offset":10736},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"If we run ","position":{"start":{"line":326,"column":3,"offset":10739},"end":{"line":326,"column":13,"offset":10749},"indent":[]}},{"type":"inlineCode","value":"kubectl drain ip --force","position":{"start":{"line":326,"column":13,"offset":10749},"end":{"line":326,"column":39,"offset":10775},"indent":[]}},{"type":"text","value":" we can drain the pod. Assuming this is a ","position":{"start":{"line":326,"column":39,"offset":10775},"end":{"line":326,"column":81,"offset":10817},"indent":[]}},{"type":"inlineCode","value":"Replication Controller","position":{"start":{"line":326,"column":81,"offset":10817},"end":{"line":326,"column":105,"offset":10841},"indent":[]}},{"type":"text","value":" or ","position":{"start":{"line":326,"column":105,"offset":10841},"end":{"line":326,"column":109,"offset":10845},"indent":[]}},{"type":"inlineCode","value":"Deployment","position":{"start":{"line":326,"column":109,"offset":10845},"end":{"line":326,"column":121,"offset":10857},"indent":[]}},{"type":"text","value":", another container should spin up.","position":{"start":{"line":326,"column":121,"offset":10857},"end":{"line":326,"column":156,"offset":10892},"indent":[]}}],"position":{"start":{"line":326,"column":3,"offset":10739},"end":{"line":326,"column":156,"offset":10892},"indent":[]}}],"position":{"start":{"line":326,"column":1,"offset":10737},"end":{"line":326,"column":156,"offset":10892},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Once that pod is attached to another node, we can also attach back to the pod on the new node with the ","position":{"start":{"line":327,"column":4,"offset":10896},"end":{"line":327,"column":107,"offset":10999},"indent":[]}},{"type":"inlineCode","value":"exec","position":{"start":{"line":327,"column":107,"offset":10999},"end":{"line":327,"column":113,"offset":11005},"indent":[]}},{"type":"text","value":" command and we can confirm that the ","position":{"start":{"line":327,"column":113,"offset":11005},"end":{"line":327,"column":150,"offset":11042},"indent":[]}},{"type":"inlineCode","value":"/myvol/myvol.txt","position":{"start":{"line":327,"column":150,"offset":11042},"end":{"line":327,"column":168,"offset":11060},"indent":[]}},{"type":"text","value":" is still there, although the other ","position":{"start":{"line":327,"column":168,"offset":11060},"end":{"line":327,"column":204,"offset":11096},"indent":[]}},{"type":"inlineCode","value":"/test.txt","position":{"start":{"line":327,"column":204,"offset":11096},"end":{"line":327,"column":215,"offset":11107},"indent":[]}},{"type":"text","value":" is no longer there since it was not saved to the volume.","position":{"start":{"line":327,"column":215,"offset":11107},"end":{"line":327,"column":272,"offset":11164},"indent":[]}}],"position":{"start":{"line":327,"column":4,"offset":10896},"end":{"line":327,"column":272,"offset":11164},"indent":[]}}],"position":{"start":{"line":327,"column":1,"offset":10893},"end":{"line":327,"column":272,"offset":11164},"indent":[]}}],"position":{"start":{"line":324,"column":1,"offset":10381},"end":{"line":327,"column":272,"offset":11164},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"If you need to remove the ebs volume, you can run ","position":{"start":{"line":329,"column":1,"offset":11166},"end":{"line":329,"column":51,"offset":11216},"indent":[]}},{"type":"inlineCode","value":"aws ec2 delete-volume --volume-id vol-[id]","position":{"start":{"line":329,"column":51,"offset":11216},"end":{"line":329,"column":95,"offset":11260},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":329,"column":95,"offset":11260},"end":{"line":329,"column":96,"offset":11261},"indent":[]}}],"position":{"start":{"line":329,"column":1,"offset":11166},"end":{"line":329,"column":96,"offset":11261},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Volume Provisioning","position":{"start":{"line":331,"column":4,"offset":11266},"end":{"line":331,"column":23,"offset":11285},"indent":[]}}],"position":{"start":{"line":331,"column":1,"offset":11263},"end":{"line":331,"column":23,"offset":11285},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The kubs plugins have the capability to ","position":{"start":{"line":333,"column":1,"offset":11287},"end":{"line":333,"column":41,"offset":11327},"indent":[]}},{"type":"inlineCode","value":"provision storage","position":{"start":{"line":333,"column":41,"offset":11327},"end":{"line":333,"column":60,"offset":11346},"indent":[]}},{"type":"text","value":" for you. The AWS Plugin can for instance ","position":{"start":{"line":333,"column":60,"offset":11346},"end":{"line":333,"column":102,"offset":11388},"indent":[]}},{"type":"inlineCode","value":"provision storage","position":{"start":{"line":333,"column":102,"offset":11388},"end":{"line":333,"column":121,"offset":11407},"indent":[]}},{"type":"text","value":" for you by creating the volumes in AWS before attaching them to a node.","position":{"start":{"line":333,"column":121,"offset":11407},"end":{"line":333,"column":193,"offset":11479},"indent":[]}}],"position":{"start":{"line":333,"column":1,"offset":11287},"end":{"line":333,"column":193,"offset":11479},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"This is done using the ","position":{"start":{"line":335,"column":1,"offset":11481},"end":{"line":335,"column":24,"offset":11504},"indent":[]}},{"type":"inlineCode","value":"StorageClass","position":{"start":{"line":335,"column":24,"offset":11504},"end":{"line":335,"column":38,"offset":11518},"indent":[]}},{"type":"text","value":" object -- this is beta for the course but should be stable soon.","position":{"start":{"line":335,"column":38,"offset":11518},"end":{"line":335,"column":103,"offset":11583},"indent":[]}}],"position":{"start":{"line":335,"column":1,"offset":11481},"end":{"line":335,"column":103,"offset":11583},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"To use autoprovisioing, create the following:","position":{"start":{"line":337,"column":1,"offset":11585},"end":{"line":337,"column":46,"offset":11630},"indent":[]}}],"position":{"start":{"line":337,"column":1,"offset":11585},"end":{"line":337,"column":46,"offset":11630},"indent":[]}},{"type":"code","lang":"yaml","meta":null,"value":"# storage.yml\nkind: StorageClass\napiVersion: storage.k8s.io/v1\nmetadata:\n  name: standard\nprovisioner: kubernetes.io/aws-ebs\nparameters:\n  type: gp2\n  zone: ap-southeast-1","position":{"start":{"line":339,"column":1,"offset":11632},"end":{"line":349,"column":4,"offset":11815},"indent":[1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Next, you can create a volume claim and specify the size:","position":{"start":{"line":351,"column":1,"offset":11817},"end":{"line":351,"column":58,"offset":11874},"indent":[]}}],"position":{"start":{"line":351,"column":1,"offset":11817},"end":{"line":351,"column":58,"offset":11874},"indent":[]}},{"type":"code","lang":"yaml","meta":null,"value":"# my-volume-claim.yml\nkind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\n  name: myclaim\n  annotations:\n    volume.beta.kubernetes.io/storage-class: \"standard\"\nspec:\n  accessModes:\n\t- ReadWriteOnce\n  resources:\n\trequests:\n\t  storage: 8Gi","position":{"start":{"line":353,"column":1,"offset":11876},"end":{"line":367,"column":4,"offset":12127},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Finally, if launching a pod:","position":{"start":{"line":369,"column":1,"offset":12129},"end":{"line":369,"column":29,"offset":12157},"indent":[]}}],"position":{"start":{"line":369,"column":1,"offset":12129},"end":{"line":369,"column":29,"offset":12157},"indent":[]}},{"type":"code","lang":"yaml","meta":null,"value":"# pod-helloworld.yml w/ secrets\napiVersion: v1\nkind: Pod\nmetadata:\n  name: mypod\nspec:\n  # The containers are listed here\n  containers:\n\t- name: myfrontend\n\timage: nginx\n\tvolumeMounts:\n\t- name: mypd\n\t  mountPath: '/var/www/html'\n  # @@@ The important mounting\n  volumes:\n\t- name: mypd # @@@ this is referred to above in volumeMounts\n\t  persistentVolumeClaim:\n\t    claimName: myclaim # @@@ refers to my claim from the previous type definition","position":{"start":{"line":371,"column":1,"offset":12159},"end":{"line":390,"column":4,"offset":12612},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Demo: Using Wordpress with Volumes","position":{"start":{"line":392,"column":4,"offset":12617},"end":{"line":392,"column":38,"offset":12651},"indent":[]}}],"position":{"start":{"line":392,"column":1,"offset":12614},"end":{"line":392,"column":38,"offset":12651},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"After declaring a ","position":{"start":{"line":394,"column":1,"offset":12653},"end":{"line":394,"column":19,"offset":12671},"indent":[]}},{"type":"inlineCode","value":"StorageClass","position":{"start":{"line":394,"column":19,"offset":12671},"end":{"line":394,"column":33,"offset":12685},"indent":[]}},{"type":"text","value":" class from a yaml file and a ","position":{"start":{"line":394,"column":33,"offset":12685},"end":{"line":394,"column":63,"offset":12715},"indent":[]}},{"type":"inlineCode","value":"PersistentVolumeClaim","position":{"start":{"line":394,"column":63,"offset":12715},"end":{"line":394,"column":86,"offset":12738},"indent":[]}},{"type":"text","value":" class.","position":{"start":{"line":394,"column":86,"offset":12738},"end":{"line":394,"column":93,"offset":12745},"indent":[]}}],"position":{"start":{"line":394,"column":1,"offset":12653},"end":{"line":394,"column":93,"offset":12745},"indent":[]}},{"type":"code","lang":"yaml","meta":null,"value":"# storage.yml\nkind: StorageClass\napiVersion: storage.k8s.io/v1beta1\nmetadata:\n  name: standard\nprovisioner: kubernetes.io/aws-ebs\nparameters:\n  type: gp2\n  zone: eu-west-1a","position":{"start":{"line":396,"column":1,"offset":12747},"end":{"line":406,"column":4,"offset":12931},"indent":[1,1,1,1,1,1,1,1,1,1]}},{"type":"code","lang":"yaml","meta":null,"value":"# PV Claim\nkind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\n  name: db-storage\n  annotations:\n    volume.beta.kubernetes.io/storage-class: \"standard\"\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 8Gi","position":{"start":{"line":408,"column":1,"offset":12933},"end":{"line":422,"column":4,"offset":13185},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"There is also a simple ReplicationController for the Wordpress DB. In the spe for the container for mysql, we declare where the ","position":{"start":{"line":424,"column":1,"offset":13187},"end":{"line":424,"column":129,"offset":13315},"indent":[]}},{"type":"inlineCode","value":"mountPath","position":{"start":{"line":424,"column":129,"offset":13315},"end":{"line":424,"column":140,"offset":13326},"indent":[]}},{"type":"text","value":" will be.","position":{"start":{"line":424,"column":140,"offset":13326},"end":{"line":424,"column":149,"offset":13335},"indent":[]}}],"position":{"start":{"line":424,"column":1,"offset":13187},"end":{"line":424,"column":149,"offset":13335},"indent":[]}},{"type":"code","lang":"yaml","meta":null,"value":"apiVersion: v1\nkind: ReplicationController\nmetadata:\n  name: wordpress-db\nspec:\n  replicas: 1\n  selector:\n    app: wordpress-db\n  template:\n    metadata:\n      name: wordpress-db\n      labels:\n        app: wordpress-db\n    spec:\n      containers:\n      - name: mysql\n        image: mysql:5.7\n        args:\n          - \"--ignore-db-dir=lost+found\"\n        ports:\n        - name: mysql-port\n          containerPort: 3306\n        env:\n          - name: MYSQL_ROOT_PASSWORD\n            valueFrom:\n              secretKeyRef:\n                name: wordpress-secrets\n                key: db-password\n        volumeMounts:\n        - mountPath: \"/var/lib/mysql\"\n          name: mysql-storage\n      volumes:\n        - name: mysql-storage\n          persistentVolumeClaim:\n            claimName: db-storage","position":{"start":{"line":426,"column":1,"offset":13337},"end":{"line":462,"column":4,"offset":14144},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Having a makeshift secrets file for secrets:","position":{"start":{"line":464,"column":1,"offset":14146},"end":{"line":464,"column":45,"offset":14190},"indent":[]}}],"position":{"start":{"line":464,"column":1,"offset":14146},"end":{"line":464,"column":45,"offset":14190},"indent":[]}},{"type":"code","lang":"yaml","meta":null,"value":"apiVersion: v1\nkind: Secret\nmetadata:\n  name: wordpress-secrets\ntype: Opaque\ndata:\n  db-password: cGFzc3dvcmQ=\n  # random sha1 strings - change all these lines\n  authkey: MTQ3ZDVhMTIzYmU1ZTRiMWQ1NzUyOWFlNWE2YzRjY2FhMDkyZGQ4OA==\n  loggedinkey: MTQ3ZDVhMTIzYmU1ZTRiMWQ1NzUyOWFlNWE2YzRjY2FhMDkyZGQ4OQ==\n  secureauthkey: MTQ3ZDVhMTIzYmU1ZTRiMWQ1NzUyOWFlNWE2YzRjY2FhMDkyZGQ5MQ==\n  noncekey: MTQ3ZDVhMTIzYmU1ZTRiMWQ1NzUyOWFlNWE2YzRjY2FhMDkyZGQ5MA==\n  authsalt: MTQ3ZDVhMTIzYmU1ZTRiMWQ1NzUyOWFlNWE2YzRjY2FhMDkyZGQ5Mg==\n  secureauthsalt: MTQ3ZDVhMTIzYmU1ZTRiMWQ1NzUyOWFlNWE2YzRjY2FhMDkyZGQ5Mw==\n  loggedinsalt: MTQ3ZDVhMTIzYmU1ZTRiMWQ1NzUyOWFlNWE2YzRjY2FhMDkyZGQ5NA==\n  noncesalt: MTQ3ZDVhMTIzYmU1ZTRiMWQ1NzUyOWFlNWE2YzRjY2FhMDkyZGQ5NQ==","position":{"start":{"line":466,"column":1,"offset":14192},"end":{"line":483,"column":4,"offset":14933},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"To open up the service for the port:","position":{"start":{"line":485,"column":1,"offset":14935},"end":{"line":485,"column":37,"offset":14971},"indent":[]}}],"position":{"start":{"line":485,"column":1,"offset":14935},"end":{"line":485,"column":37,"offset":14971},"indent":[]}},{"type":"code","lang":"yaml","meta":null,"value":"apiVersion: v1\nkind: Service\nmetadata:\n  name: wordpress-db\nspec:\n  ports:\n  - port: 3306\n    protocol: TCP\n  selector:\n    app: wordpress-db\n  type: NodePort","position":{"start":{"line":487,"column":1,"offset":14973},"end":{"line":499,"column":4,"offset":15143},"indent":[1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Opening up the web and web service:","position":{"start":{"line":501,"column":1,"offset":15145},"end":{"line":501,"column":36,"offset":15180},"indent":[]}}],"position":{"start":{"line":501,"column":1,"offset":15145},"end":{"line":501,"column":36,"offset":15180},"indent":[]}},{"type":"code","lang":"yaml","meta":null,"value":"apiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: wordpress-deployment\nspec:\n  replicas: 2\n  template:\n    metadata:\n      labels:\n        app: wordpress\n    spec:\n      containers:\n      - name: wordpress\n        image: wordpress:4-php7.0\n        # uncomment to fix perm issue, see also https://github.com/kubernetes/kubernetes/issues/2630\n        # command: ['bash', '-c', 'chown www-data:www-data /var/www/html/wp-content/uploads && apache2-foreground']\n        ports:\n        - name: http-port\n          containerPort: 80\n        env:\n          - name: WORDPRESS_DB_PASSWORD\n            valueFrom:\n              secretKeyRef:\n                name: wordpress-secrets\n                key: db-password\n          - name: WORDPRESS_AUTH_KEY\n            valueFrom:\n              secretKeyRef:\n                name: wordpress-secrets\n                key: authkey\n          - name: WORDPRESS_LOGGED_IN_KEY\n            valueFrom:\n              secretKeyRef:\n                name: wordpress-secrets\n                key: loggedinkey\n          - name: WORDPRESS_SECURE_AUTH_KEY\n            valueFrom:\n              secretKeyRef:\n                name: wordpress-secrets\n                key: secureauthkey\n          - name: WORDPRESS_NONCE_KEY\n            valueFrom:\n              secretKeyRef:\n                name: wordpress-secrets\n                key: noncekey\n          - name: WORDPRESS_AUTH_SALT\n            valueFrom:\n              secretKeyRef:\n                name: wordpress-secrets\n                key: authsalt\n          - name: WORDPRESS_SECURE_AUTH_SALT\n            valueFrom:\n              secretKeyRef:\n                name: wordpress-secrets\n                key: secureauthsalt\n          - name: WORDPRESS_LOGGED_IN_SALT\n            valueFrom:\n              secretKeyRef:\n                name: wordpress-secrets\n                key: loggedinsalt\n          - name: WORDPRESS_NONCE_SALT\n            valueFrom:\n              secretKeyRef:\n                name: wordpress-secrets\n                key: noncesalt\n          - name: WORDPRESS_DB_HOST\n            value: wordpress-db\n        volumeMounts:\n        # shared storage for things like media\n        - mountPath: /var/www/html/wp-content/uploads\n          name: uploads\n      volumes:\n      - name: uploads\n        nfs:\n          server: eu-west-1a.fs-5714e89e.efs.eu-west-1.amazonaws.com\n          path: /","position":{"start":{"line":503,"column":1,"offset":15182},"end":{"line":580,"column":4,"offset":17576},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"code","lang":"yaml","meta":null,"value":"apiVersion: v1\nkind: Service\nmetadata:\n  name: wordpress\nspec:\n  ports:\n  - port: 80\n    targetPort: http-port\n    protocol: TCP\n  selector:\n    app: wordpress\n  type: LoadBalancer","position":{"start":{"line":582,"column":1,"offset":17578},"end":{"line":595,"column":4,"offset":17770},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"With the AWS Commandline, you can create a file system and mount target. For the fs, run ","position":{"start":{"line":597,"column":1,"offset":17772},"end":{"line":597,"column":90,"offset":17861},"indent":[]}},{"type":"inlineCode","value":"aws efs create-file-system --creation-token","position":{"start":{"line":597,"column":90,"offset":17861},"end":{"line":597,"column":135,"offset":17906},"indent":[]}},{"type":"text","value":" and then after grabbing the file-system-id and subnet-id, you can run ","position":{"start":{"line":597,"column":135,"offset":17906},"end":{"line":597,"column":206,"offset":17977},"indent":[]}},{"type":"inlineCode","value":"aws efs create-mount-target --file-system-id <id> --security-groups <sg>","position":{"start":{"line":597,"column":206,"offset":17977},"end":{"line":597,"column":280,"offset":18051},"indent":[]}},{"type":"text","value":". Ensure in the above ","position":{"start":{"line":597,"column":280,"offset":18051},"end":{"line":597,"column":302,"offset":18073},"indent":[]}},{"type":"inlineCode","value":"nfs","position":{"start":{"line":597,"column":302,"offset":18073},"end":{"line":597,"column":307,"offset":18078},"indent":[]}},{"type":"text","value":" volume you update the fs id.","position":{"start":{"line":597,"column":307,"offset":18078},"end":{"line":597,"column":336,"offset":18107},"indent":[]}}],"position":{"start":{"line":597,"column":1,"offset":17772},"end":{"line":597,"column":336,"offset":18107},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Pod Presets","position":{"start":{"line":599,"column":4,"offset":18112},"end":{"line":599,"column":15,"offset":18123},"indent":[]}}],"position":{"start":{"line":599,"column":1,"offset":18109},"end":{"line":599,"column":15,"offset":18123},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Pod presets can inject information into pods at runtime.","position":{"start":{"line":601,"column":1,"offset":18125},"end":{"line":601,"column":57,"offset":18181},"indent":[]}}],"position":{"start":{"line":601,"column":1,"offset":18125},"end":{"line":601,"column":57,"offset":18181},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Used to inject Kubernetes Resources like Secrets, ConfigMaps, Volumes and Environment variables. ","position":{"start":{"line":603,"column":3,"offset":18185},"end":{"line":603,"column":100,"offset":18282},"indent":[]}}],"position":{"start":{"line":603,"column":3,"offset":18185},"end":{"line":603,"column":100,"offset":18282},"indent":[]}}],"position":{"start":{"line":603,"column":1,"offset":18183},"end":{"line":603,"column":100,"offset":18282},"indent":[]}}],"position":{"start":{"line":603,"column":1,"offset":18183},"end":{"line":603,"column":100,"offset":18282},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Imagine you have 20 apps to deploy, all with a specific credential. You can edit the 20 specs and add the creds, or you can use presets to create 1 ","position":{"start":{"line":605,"column":1,"offset":18284},"end":{"line":605,"column":149,"offset":18432},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"Preset Object","position":{"start":{"line":605,"column":151,"offset":18434},"end":{"line":605,"column":164,"offset":18447},"indent":[]}}],"position":{"start":{"line":605,"column":149,"offset":18432},"end":{"line":605,"column":166,"offset":18449},"indent":[]}},{"type":"text","value":", which will ","position":{"start":{"line":605,"column":166,"offset":18449},"end":{"line":605,"column":179,"offset":18462},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"inject an environment variable or config file to all matching pods.","position":{"start":{"line":605,"column":181,"offset":18464},"end":{"line":605,"column":248,"offset":18531},"indent":[]}}],"position":{"start":{"line":605,"column":179,"offset":18462},"end":{"line":605,"column":250,"offset":18533},"indent":[]}}],"position":{"start":{"line":605,"column":1,"offset":18284},"end":{"line":605,"column":250,"offset":18533},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"When injecting env vars and volume mounts, the Pod Preset will apply the changes to ll containers within the pod.","position":{"start":{"line":607,"column":1,"offset":18535},"end":{"line":607,"column":114,"offset":18648},"indent":[]}}],"position":{"start":{"line":607,"column":1,"offset":18535},"end":{"line":607,"column":114,"offset":18648},"indent":[]}},{"type":"code","lang":"yaml","meta":null,"value":"# PodPreset File\napiVersion: settings.k8s.io/v1alpha1\nkind: PodPreset\nmetadata:\n  name: allow-database\nspec:\n  selector:\n    matchLabels:\n      role: frontend\n  env:\n    - name: DB_PORT\n      value: '6379'\n  volumeMounts:\n    - mountPath: /cache\n      name: cache-volume\n  volumes:\n    - name: cache-volume\n      emptyDir: {}","position":{"start":{"line":609,"column":1,"offset":18650},"end":{"line":628,"column":4,"offset":18987},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"code","lang":"yml","meta":null,"value":"# Pod file using PodPreset\napiVersion: v1\nkind: Pod\nmetadata:\n  name: website\n  labels:\n    app: website\n    role: frontend\nspec:\n  containers:\n    - name: website\n      image: nginx\n      ports:\n        - containerPort: 80\n","position":{"start":{"line":630,"column":1,"offset":18989},"end":{"line":646,"column":4,"offset":19224},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"code","lang":"bash","meta":null,"value":"$ kubectl create -f pod-preset.yml\n$ kubectl create -f pod.yml","position":{"start":{"line":648,"column":1,"offset":19226},"end":{"line":651,"column":4,"offset":19300},"indent":[1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Stateful Sets - (formerly Pet Sets)","position":{"start":{"line":655,"column":4,"offset":19307},"end":{"line":655,"column":39,"offset":19342},"indent":[]}}],"position":{"start":{"line":655,"column":1,"offset":19304},"end":{"line":655,"column":39,"offset":19342},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Stateful dist apps - new feature from Kub 1.3.","position":{"start":{"line":657,"column":1,"offset":19344},"end":{"line":657,"column":47,"offset":19390},"indent":[]}}],"position":{"start":{"line":657,"column":1,"offset":19344},"end":{"line":657,"column":47,"offset":19390},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"It is introduced to be able to run ","position":{"start":{"line":659,"column":1,"offset":19392},"end":{"line":659,"column":36,"offset":19427},"indent":[]}},{"type":"inlineCode","value":"stateful applications","position":{"start":{"line":659,"column":36,"offset":19427},"end":{"line":659,"column":59,"offset":19450},"indent":[]}},{"type":"text","value":" that need:","position":{"start":{"line":659,"column":59,"offset":19450},"end":{"line":659,"column":70,"offset":19461},"indent":[]}}],"position":{"start":{"line":659,"column":1,"offset":19392},"end":{"line":659,"column":70,"offset":19461},"indent":[]}},{"type":"list","ordered":true,"start":1,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"A stable pod hostname (instead of podname-randomstr) - will have an index ie podname-0, podname-1 etc.","position":{"start":{"line":661,"column":5,"offset":19467},"end":{"line":661,"column":107,"offset":19569},"indent":[]}}],"position":{"start":{"line":661,"column":5,"offset":19467},"end":{"line":661,"column":107,"offset":19569},"indent":[]}}],"position":{"start":{"line":661,"column":1,"offset":19463},"end":{"line":661,"column":107,"offset":19569},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Stateful app requires multi pods with vols based on their ordinal number. Currently deleting and/or scaling a PetSet down will not deleted volumes associated.","position":{"start":{"line":662,"column":5,"offset":19574},"end":{"line":662,"column":163,"offset":19732},"indent":[]}}],"position":{"start":{"line":662,"column":5,"offset":19574},"end":{"line":662,"column":163,"offset":19732},"indent":[]}}],"position":{"start":{"line":662,"column":1,"offset":19570},"end":{"line":662,"column":163,"offset":19732},"indent":[]}}],"position":{"start":{"line":661,"column":1,"offset":19463},"end":{"line":662,"column":163,"offset":19732},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"A pet set will allow your stateful app to use DNS to find out peers. One running node of the Pet Set is called a ","position":{"start":{"line":664,"column":1,"offset":19734},"end":{"line":664,"column":114,"offset":19847},"indent":[]}},{"type":"inlineCode","value":"Pet","position":{"start":{"line":664,"column":114,"offset":19847},"end":{"line":664,"column":119,"offset":19852},"indent":[]}},{"type":"text","value":". Using Pet Sets you can run for instance 5 cassandra nodes on Kubs named cass-1 until cass-5.","position":{"start":{"line":664,"column":119,"offset":19852},"end":{"line":664,"column":213,"offset":19946},"indent":[]}}],"position":{"start":{"line":664,"column":1,"offset":19734},"end":{"line":664,"column":213,"offset":19946},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The big difference is that you don't want to connect just any specific service, you want to make sure pod whatever definitely connects to another pod.","position":{"start":{"line":666,"column":1,"offset":19948},"end":{"line":666,"column":151,"offset":20098},"indent":[]}}],"position":{"start":{"line":666,"column":1,"offset":19948},"end":{"line":666,"column":151,"offset":20098},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"This pet set also allows order to startup and teardown of pets.","position":{"start":{"line":668,"column":1,"offset":20100},"end":{"line":668,"column":64,"offset":20163},"indent":[]}}],"position":{"start":{"line":668,"column":1,"offset":20100},"end":{"line":668,"column":64,"offset":20163},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Still a lot of work for future work.","position":{"start":{"line":670,"column":1,"offset":20165},"end":{"line":670,"column":37,"offset":20201},"indent":[]}}],"position":{"start":{"line":670,"column":1,"offset":20165},"end":{"line":670,"column":37,"offset":20201},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Daemon Sets","position":{"start":{"line":672,"column":4,"offset":20206},"end":{"line":672,"column":15,"offset":20217},"indent":[]}}],"position":{"start":{"line":672,"column":1,"offset":20203},"end":{"line":672,"column":15,"offset":20217},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Ensure that every single node in the Kubernetes cluster runs the same pod resource. This is useful to ensure a certain pod is running on every single kubernetes node.","position":{"start":{"line":674,"column":5,"offset":20223},"end":{"line":674,"column":171,"offset":20389},"indent":[]}}],"position":{"start":{"line":674,"column":5,"offset":20223},"end":{"line":674,"column":171,"offset":20389},"indent":[]}}],"position":{"start":{"line":674,"column":1,"offset":20219},"end":{"line":674,"column":171,"offset":20389},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"When a node is added to the cluster, a new pod will be started automatically","position":{"start":{"line":675,"column":5,"offset":20394},"end":{"line":675,"column":81,"offset":20470},"indent":[]}}],"position":{"start":{"line":675,"column":5,"offset":20394},"end":{"line":675,"column":81,"offset":20470},"indent":[]}}],"position":{"start":{"line":675,"column":1,"offset":20390},"end":{"line":675,"column":81,"offset":20470},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Same when a node is removed, the pod will not be rescheduled on another node","position":{"start":{"line":676,"column":5,"offset":20475},"end":{"line":676,"column":81,"offset":20551},"indent":[]}}],"position":{"start":{"line":676,"column":5,"offset":20475},"end":{"line":676,"column":81,"offset":20551},"indent":[]}}],"position":{"start":{"line":676,"column":1,"offset":20471},"end":{"line":676,"column":81,"offset":20551},"indent":[]}}],"position":{"start":{"line":674,"column":1,"offset":20219},"end":{"line":676,"column":81,"offset":20551},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Use cases:","position":{"start":{"line":678,"column":1,"offset":20553},"end":{"line":678,"column":11,"offset":20563},"indent":[]}}],"position":{"start":{"line":678,"column":1,"offset":20553},"end":{"line":678,"column":11,"offset":20563},"indent":[]}},{"type":"list","ordered":true,"start":1,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Logging aggregators","position":{"start":{"line":680,"column":5,"offset":20569},"end":{"line":680,"column":24,"offset":20588},"indent":[]}}],"position":{"start":{"line":680,"column":5,"offset":20569},"end":{"line":680,"column":24,"offset":20588},"indent":[]}}],"position":{"start":{"line":680,"column":1,"offset":20565},"end":{"line":680,"column":24,"offset":20588},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Monitoring","position":{"start":{"line":681,"column":5,"offset":20593},"end":{"line":681,"column":15,"offset":20603},"indent":[]}}],"position":{"start":{"line":681,"column":5,"offset":20593},"end":{"line":681,"column":15,"offset":20603},"indent":[]}}],"position":{"start":{"line":681,"column":1,"offset":20589},"end":{"line":681,"column":15,"offset":20603},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Load Balancers/Reverse Proxies/API Gateways","position":{"start":{"line":682,"column":5,"offset":20608},"end":{"line":682,"column":48,"offset":20651},"indent":[]}}],"position":{"start":{"line":682,"column":5,"offset":20608},"end":{"line":682,"column":48,"offset":20651},"indent":[]}}],"position":{"start":{"line":682,"column":1,"offset":20604},"end":{"line":682,"column":48,"offset":20651},"indent":[]}}],"position":{"start":{"line":680,"column":1,"offset":20565},"end":{"line":682,"column":48,"offset":20651},"indent":[1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Resource Usage Monitoring","position":{"start":{"line":684,"column":4,"offset":20656},"end":{"line":684,"column":29,"offset":20681},"indent":[]}}],"position":{"start":{"line":684,"column":1,"offset":20653},"end":{"line":684,"column":29,"offset":20681},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Heapster enables ","position":{"start":{"line":686,"column":3,"offset":20685},"end":{"line":686,"column":20,"offset":20702},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"Container Cluster Monitoring","position":{"start":{"line":686,"column":22,"offset":20704},"end":{"line":686,"column":50,"offset":20732},"indent":[]}}],"position":{"start":{"line":686,"column":20,"offset":20702},"end":{"line":686,"column":52,"offset":20734},"indent":[]}},{"type":"text","value":" and ","position":{"start":{"line":686,"column":52,"offset":20734},"end":{"line":686,"column":57,"offset":20739},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"Performance Analysis","position":{"start":{"line":686,"column":59,"offset":20741},"end":{"line":686,"column":79,"offset":20761},"indent":[]}}],"position":{"start":{"line":686,"column":57,"offset":20739},"end":{"line":686,"column":81,"offset":20763},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":686,"column":81,"offset":20763},"end":{"line":686,"column":82,"offset":20764},"indent":[]}}],"position":{"start":{"line":686,"column":3,"offset":20685},"end":{"line":686,"column":82,"offset":20764},"indent":[]}}],"position":{"start":{"line":686,"column":1,"offset":20683},"end":{"line":686,"column":82,"offset":20764},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"It's providing a monitoring platform for Kubernetes.","position":{"start":{"line":687,"column":3,"offset":20767},"end":{"line":687,"column":55,"offset":20819},"indent":[]}}],"position":{"start":{"line":687,"column":3,"offset":20767},"end":{"line":687,"column":55,"offset":20819},"indent":[]}}],"position":{"start":{"line":687,"column":1,"offset":20765},"end":{"line":687,"column":55,"offset":20819},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"It's a prerequisite if you want to do ","position":{"start":{"line":688,"column":3,"offset":20822},"end":{"line":688,"column":41,"offset":20860},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"pod auto-scaling","position":{"start":{"line":688,"column":43,"offset":20862},"end":{"line":688,"column":59,"offset":20878},"indent":[]}}],"position":{"start":{"line":688,"column":41,"offset":20860},"end":{"line":688,"column":61,"offset":20880},"indent":[]}},{"type":"text","value":" in Kubernetes.","position":{"start":{"line":688,"column":61,"offset":20880},"end":{"line":688,"column":76,"offset":20895},"indent":[]}}],"position":{"start":{"line":688,"column":3,"offset":20822},"end":{"line":688,"column":76,"offset":20895},"indent":[]}}],"position":{"start":{"line":688,"column":1,"offset":20820},"end":{"line":688,"column":76,"offset":20895},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Heapster exports cluster metrix ","position":{"start":{"line":689,"column":3,"offset":20898},"end":{"line":689,"column":35,"offset":20930},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"via REST endpoints","position":{"start":{"line":689,"column":37,"offset":20932},"end":{"line":689,"column":55,"offset":20950},"indent":[]}}],"position":{"start":{"line":689,"column":35,"offset":20930},"end":{"line":689,"column":57,"offset":20952},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":689,"column":57,"offset":20952},"end":{"line":689,"column":58,"offset":20953},"indent":[]}}],"position":{"start":{"line":689,"column":3,"offset":20898},"end":{"line":689,"column":58,"offset":20953},"indent":[]}}],"position":{"start":{"line":689,"column":1,"offset":20896},"end":{"line":689,"column":58,"offset":20953},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"You can use different backends with Heapster.","position":{"start":{"line":690,"column":3,"offset":20956},"end":{"line":690,"column":48,"offset":21001},"indent":[]}}],"position":{"start":{"line":690,"column":3,"offset":20956},"end":{"line":690,"column":48,"offset":21001},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Demo uses ","position":{"start":{"line":691,"column":5,"offset":21006},"end":{"line":691,"column":15,"offset":21016},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"InfluxDB","position":{"start":{"line":691,"column":17,"offset":21018},"end":{"line":691,"column":25,"offset":21026},"indent":[]}}],"position":{"start":{"line":691,"column":15,"offset":21016},"end":{"line":691,"column":27,"offset":21028},"indent":[]}},{"type":"text","value":", but Kafka is also possible.","position":{"start":{"line":691,"column":27,"offset":21028},"end":{"line":691,"column":56,"offset":21057},"indent":[]}}],"position":{"start":{"line":691,"column":5,"offset":21006},"end":{"line":691,"column":56,"offset":21057},"indent":[]}}],"position":{"start":{"line":691,"column":3,"offset":21004},"end":{"line":691,"column":56,"offset":21057},"indent":[]}}],"position":{"start":{"line":691,"column":3,"offset":21004},"end":{"line":691,"column":56,"offset":21057},"indent":[]}}],"position":{"start":{"line":690,"column":1,"offset":20954},"end":{"line":691,"column":56,"offset":21057},"indent":[1]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Visualisations can be shown with Grafana. ","position":{"start":{"line":692,"column":3,"offset":21060},"end":{"line":692,"column":45,"offset":21102},"indent":[]}}],"position":{"start":{"line":692,"column":3,"offset":21060},"end":{"line":692,"column":45,"offset":21102},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Kubernetes dashboard will also show graphs once monitoring is enabled.","position":{"start":{"line":693,"column":5,"offset":21107},"end":{"line":693,"column":75,"offset":21177},"indent":[]}}],"position":{"start":{"line":693,"column":5,"offset":21107},"end":{"line":693,"column":75,"offset":21177},"indent":[]}}],"position":{"start":{"line":693,"column":3,"offset":21105},"end":{"line":693,"column":75,"offset":21177},"indent":[]}}],"position":{"start":{"line":693,"column":3,"offset":21105},"end":{"line":693,"column":75,"offset":21177},"indent":[]}}],"position":{"start":{"line":692,"column":1,"offset":21058},"end":{"line":693,"column":75,"offset":21177},"indent":[1]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"All these technologies can be started in pods","position":{"start":{"line":694,"column":3,"offset":21180},"end":{"line":694,"column":48,"offset":21225},"indent":[]}}],"position":{"start":{"line":694,"column":3,"offset":21180},"end":{"line":694,"column":48,"offset":21225},"indent":[]}}],"position":{"start":{"line":694,"column":1,"offset":21178},"end":{"line":694,"column":48,"offset":21225},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":695,"column":3,"offset":21228},"end":{"line":695,"column":7,"offset":21232},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"yaml files","position":{"start":{"line":695,"column":9,"offset":21234},"end":{"line":695,"column":19,"offset":21244},"indent":[]}}],"position":{"start":{"line":695,"column":7,"offset":21232},"end":{"line":695,"column":21,"offset":21246},"indent":[]}},{"type":"text","value":" can be found on the github repo of Heapster.","position":{"start":{"line":695,"column":21,"offset":21246},"end":{"line":695,"column":66,"offset":21291},"indent":[]}}],"position":{"start":{"line":695,"column":3,"offset":21228},"end":{"line":695,"column":66,"offset":21291},"indent":[]}}],"position":{"start":{"line":695,"column":1,"offset":21226},"end":{"line":695,"column":66,"offset":21291},"indent":[]}}],"position":{"start":{"line":686,"column":1,"offset":20683},"end":{"line":695,"column":66,"offset":21291},"indent":[1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Since Heapster is now deprecated, you would have to use ","position":{"start":{"line":697,"column":1,"offset":21293},"end":{"line":697,"column":57,"offset":21349},"indent":[]}},{"type":"inlineCode","value":"metrics-server","position":{"start":{"line":697,"column":57,"offset":21349},"end":{"line":697,"column":73,"offset":21365},"indent":[]}},{"type":"text","value":" or an alternative like ","position":{"start":{"line":697,"column":73,"offset":21365},"end":{"line":697,"column":97,"offset":21389},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"Prometheus","position":{"start":{"line":697,"column":99,"offset":21391},"end":{"line":697,"column":109,"offset":21401},"indent":[]}}],"position":{"start":{"line":697,"column":97,"offset":21389},"end":{"line":697,"column":111,"offset":21403},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":697,"column":111,"offset":21403},"end":{"line":697,"column":112,"offset":21404},"indent":[]}}],"position":{"start":{"line":697,"column":1,"offset":21293},"end":{"line":697,"column":112,"offset":21404},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Horiztonal Pod Autoscaling","position":{"start":{"line":699,"column":4,"offset":21409},"end":{"line":699,"column":30,"offset":21435},"indent":[]}}],"position":{"start":{"line":699,"column":1,"offset":21406},"end":{"line":699,"column":30,"offset":21435},"indent":[]}},{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/","children":[{"type":"text","value":"Link to main Kubernetes site","position":{"start":{"line":701,"column":2,"offset":21438},"end":{"line":701,"column":30,"offset":21466},"indent":[]}}],"position":{"start":{"line":701,"column":1,"offset":21437},"end":{"line":701,"column":119,"offset":21555},"indent":[]}}],"position":{"start":{"line":701,"column":1,"offset":21437},"end":{"line":701,"column":119,"offset":21555},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":true,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Kubernetes has the possibility to autoscale pods based on metrics.","position":{"start":{"line":703,"column":3,"offset":21559},"end":{"line":703,"column":69,"offset":21625},"indent":[]}}],"position":{"start":{"line":703,"column":3,"offset":21559},"end":{"line":703,"column":69,"offset":21625},"indent":[]}}],"position":{"start":{"line":703,"column":1,"offset":21557},"end":{"line":703,"column":69,"offset":21625},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Kubernetes can autoscale Deployment, Replication Controller or ReplicaSet.","position":{"start":{"line":704,"column":3,"offset":21628},"end":{"line":704,"column":77,"offset":21702},"indent":[]}}],"position":{"start":{"line":704,"column":3,"offset":21628},"end":{"line":704,"column":77,"offset":21702},"indent":[]}}],"position":{"start":{"line":704,"column":1,"offset":21626},"end":{"line":704,"column":77,"offset":21702},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"In Kubernetes 1.3 ","position":{"start":{"line":705,"column":3,"offset":21705},"end":{"line":705,"column":21,"offset":21723},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"scaling based on CPU","position":{"start":{"line":705,"column":23,"offset":21725},"end":{"line":705,"column":43,"offset":21745},"indent":[]}}],"position":{"start":{"line":705,"column":21,"offset":21723},"end":{"line":705,"column":45,"offset":21747},"indent":[]}},{"type":"text","value":" usage is possible out of the box.","position":{"start":{"line":705,"column":45,"offset":21747},"end":{"line":705,"column":79,"offset":21781},"indent":[]}}],"position":{"start":{"line":705,"column":3,"offset":21705},"end":{"line":705,"column":79,"offset":21781},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Application based metrics are also available (like queries per second or average request latency).","position":{"start":{"line":706,"column":5,"offset":21786},"end":{"line":706,"column":103,"offset":21884},"indent":[]}}],"position":{"start":{"line":706,"column":5,"offset":21786},"end":{"line":706,"column":103,"offset":21884},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"To enable, the cluster has to be started with env var ENABLE_CUSTOM_METRICS to be true.","position":{"start":{"line":707,"column":7,"offset":21891},"end":{"line":707,"column":94,"offset":21978},"indent":[]}}],"position":{"start":{"line":707,"column":7,"offset":21891},"end":{"line":707,"column":94,"offset":21978},"indent":[]}}],"position":{"start":{"line":707,"column":5,"offset":21889},"end":{"line":707,"column":94,"offset":21978},"indent":[]}}],"position":{"start":{"line":707,"column":5,"offset":21889},"end":{"line":707,"column":94,"offset":21978},"indent":[]}}],"position":{"start":{"line":706,"column":3,"offset":21784},"end":{"line":707,"column":94,"offset":21978},"indent":[3]}}],"position":{"start":{"line":706,"column":3,"offset":21784},"end":{"line":707,"column":94,"offset":21978},"indent":[3]}}],"position":{"start":{"line":705,"column":1,"offset":21703},"end":{"line":708,"column":1,"offset":21979},"indent":[1,1,1]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"It will periodically query the utilization for the targeted pods.","position":{"start":{"line":709,"column":3,"offset":21982},"end":{"line":709,"column":68,"offset":22047},"indent":[]}}],"position":{"start":{"line":709,"column":3,"offset":21982},"end":{"line":709,"column":68,"offset":22047},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"By default 30 sec, can be changed using the ","position":{"start":{"line":710,"column":5,"offset":22052},"end":{"line":710,"column":49,"offset":22096},"indent":[]}},{"type":"inlineCode","value":"--horizontal-pod-autoscaler-sync-period","position":{"start":{"line":710,"column":49,"offset":22096},"end":{"line":710,"column":90,"offset":22137},"indent":[]}},{"type":"text","value":"flag when launching the controller manager.","position":{"start":{"line":710,"column":90,"offset":22137},"end":{"line":710,"column":133,"offset":22180},"indent":[]}}],"position":{"start":{"line":710,"column":5,"offset":22052},"end":{"line":710,"column":133,"offset":22180},"indent":[]}}],"position":{"start":{"line":710,"column":3,"offset":22050},"end":{"line":710,"column":133,"offset":22180},"indent":[]}}],"position":{"start":{"line":710,"column":3,"offset":22050},"end":{"line":710,"column":133,"offset":22180},"indent":[]}}],"position":{"start":{"line":709,"column":1,"offset":21980},"end":{"line":710,"column":133,"offset":22180},"indent":[1]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Requires the metrics system to work.","position":{"start":{"line":711,"column":3,"offset":22183},"end":{"line":711,"column":39,"offset":22219},"indent":[]}}],"position":{"start":{"line":711,"column":3,"offset":22183},"end":{"line":711,"column":39,"offset":22219},"indent":[]}}],"position":{"start":{"line":711,"column":1,"offset":22181},"end":{"line":711,"column":39,"offset":22219},"indent":[]}}],"position":{"start":{"line":703,"column":1,"offset":21557},"end":{"line":711,"column":39,"offset":22219},"indent":[1,1,1,1,1,1,1,1]}},{"type":"code","lang":"yaml","meta":null,"value":"apiVersion: autoscaling/v1\nkind: HorizontalPodAutoscaler\nmetadata:\n  name: hpa-example-autoscaler\nspec:\n  scaleTargetRef:\n    apiVersion: extensions/v1beta1\n    kind: Deployment\n    name: hpa-example\n  minReplicas: 1\n  maxReplicas: 10\n  targetCPUUtilizationPercentage: 50","position":{"start":{"line":713,"column":1,"offset":22221},"end":{"line":726,"column":4,"offset":22504},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Affinity/Anti-Affinity","position":{"start":{"line":728,"column":4,"offset":22509},"end":{"line":728,"column":26,"offset":22531},"indent":[]}}],"position":{"start":{"line":728,"column":1,"offset":22506},"end":{"line":728,"column":26,"offset":22531},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The affinity/anti-affinity feature allows you to do ","position":{"start":{"line":730,"column":3,"offset":22535},"end":{"line":730,"column":55,"offset":22587},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"more complex scheduling","position":{"start":{"line":730,"column":57,"offset":22589},"end":{"line":730,"column":80,"offset":22612},"indent":[]}}],"position":{"start":{"line":730,"column":55,"offset":22587},"end":{"line":730,"column":82,"offset":22614},"indent":[]}},{"type":"text","value":" than the nodeSelector and also ","position":{"start":{"line":730,"column":82,"offset":22614},"end":{"line":730,"column":114,"offset":22646},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"works on Pods","position":{"start":{"line":730,"column":116,"offset":22648},"end":{"line":730,"column":129,"offset":22661},"indent":[]}}],"position":{"start":{"line":730,"column":114,"offset":22646},"end":{"line":730,"column":131,"offset":22663},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":730,"column":131,"offset":22663},"end":{"line":730,"column":132,"offset":22664},"indent":[]}}],"position":{"start":{"line":730,"column":3,"offset":22535},"end":{"line":730,"column":132,"offset":22664},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The language is ","position":{"start":{"line":731,"column":5,"offset":22669},"end":{"line":731,"column":21,"offset":22685},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"more expressive","position":{"start":{"line":731,"column":23,"offset":22687},"end":{"line":731,"column":38,"offset":22702},"indent":[]}}],"position":{"start":{"line":731,"column":21,"offset":22685},"end":{"line":731,"column":40,"offset":22704},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":731,"column":40,"offset":22704},"end":{"line":731,"column":41,"offset":22705},"indent":[]}}],"position":{"start":{"line":731,"column":5,"offset":22669},"end":{"line":731,"column":41,"offset":22705},"indent":[]}}],"position":{"start":{"line":731,"column":3,"offset":22667},"end":{"line":731,"column":41,"offset":22705},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"You can create ","position":{"start":{"line":732,"column":5,"offset":22710},"end":{"line":732,"column":20,"offset":22725},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"rules that are not hard requirements","position":{"start":{"line":732,"column":22,"offset":22727},"end":{"line":732,"column":58,"offset":22763},"indent":[]}}],"position":{"start":{"line":732,"column":20,"offset":22725},"end":{"line":732,"column":60,"offset":22765},"indent":[]}},{"type":"text","value":", but rather a ","position":{"start":{"line":732,"column":60,"offset":22765},"end":{"line":732,"column":75,"offset":22780},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"preferred rule","position":{"start":{"line":732,"column":77,"offset":22782},"end":{"line":732,"column":91,"offset":22796},"indent":[]}}],"position":{"start":{"line":732,"column":75,"offset":22780},"end":{"line":732,"column":93,"offset":22798},"indent":[]}},{"type":"text","value":", meaning that the scheduler will stil be able to schedule your pod, even if the rules cannot be met.","position":{"start":{"line":732,"column":93,"offset":22798},"end":{"line":732,"column":194,"offset":22899},"indent":[]}}],"position":{"start":{"line":732,"column":5,"offset":22710},"end":{"line":732,"column":194,"offset":22899},"indent":[]}}],"position":{"start":{"line":732,"column":3,"offset":22708},"end":{"line":732,"column":194,"offset":22899},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"You can create rules to take other pod labels into account","position":{"start":{"line":733,"column":5,"offset":22904},"end":{"line":733,"column":63,"offset":22962},"indent":[]}}],"position":{"start":{"line":733,"column":5,"offset":22904},"end":{"line":733,"column":63,"offset":22962},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Example, you can make sure two different pods are never on the same node.","position":{"start":{"line":734,"column":7,"offset":22969},"end":{"line":734,"column":80,"offset":23042},"indent":[]}}],"position":{"start":{"line":734,"column":7,"offset":22969},"end":{"line":734,"column":80,"offset":23042},"indent":[]}}],"position":{"start":{"line":734,"column":5,"offset":22967},"end":{"line":734,"column":80,"offset":23042},"indent":[]}}],"position":{"start":{"line":734,"column":5,"offset":22967},"end":{"line":734,"column":80,"offset":23042},"indent":[]}}],"position":{"start":{"line":733,"column":3,"offset":22902},"end":{"line":734,"column":80,"offset":23042},"indent":[3]}}],"position":{"start":{"line":731,"column":3,"offset":22667},"end":{"line":734,"column":80,"offset":23042},"indent":[3,3,3]}}],"position":{"start":{"line":730,"column":1,"offset":22533},"end":{"line":734,"column":80,"offset":23042},"indent":[1,1,1,1]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Kubernetes can do ","position":{"start":{"line":735,"column":3,"offset":23045},"end":{"line":735,"column":21,"offset":23063},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"node affinity","position":{"start":{"line":735,"column":23,"offset":23065},"end":{"line":735,"column":36,"offset":23078},"indent":[]}}],"position":{"start":{"line":735,"column":21,"offset":23063},"end":{"line":735,"column":38,"offset":23080},"indent":[]}},{"type":"text","value":" and ","position":{"start":{"line":735,"column":38,"offset":23080},"end":{"line":735,"column":43,"offset":23085},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"pod affinity/anti-affinity","position":{"start":{"line":735,"column":45,"offset":23087},"end":{"line":735,"column":71,"offset":23113},"indent":[]}}],"position":{"start":{"line":735,"column":43,"offset":23085},"end":{"line":735,"column":73,"offset":23115},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":735,"column":73,"offset":23115},"end":{"line":735,"column":74,"offset":23116},"indent":[]}}],"position":{"start":{"line":735,"column":3,"offset":23045},"end":{"line":735,"column":74,"offset":23116},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Node affinity is similar to the nodeSelector.","position":{"start":{"line":736,"column":5,"offset":23121},"end":{"line":736,"column":50,"offset":23166},"indent":[]}}],"position":{"start":{"line":736,"column":5,"offset":23121},"end":{"line":736,"column":50,"offset":23166},"indent":[]}}],"position":{"start":{"line":736,"column":3,"offset":23119},"end":{"line":736,"column":50,"offset":23166},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Pod affinity/anti-affinity allows you to create rules ","position":{"start":{"line":737,"column":5,"offset":23171},"end":{"line":737,"column":59,"offset":23225},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"how pods should be scheduled taking into account other running pods","position":{"start":{"line":737,"column":61,"offset":23227},"end":{"line":737,"column":128,"offset":23294},"indent":[]}}],"position":{"start":{"line":737,"column":59,"offset":23225},"end":{"line":737,"column":130,"offset":23296},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":737,"column":130,"offset":23296},"end":{"line":737,"column":131,"offset":23297},"indent":[]}}],"position":{"start":{"line":737,"column":5,"offset":23171},"end":{"line":737,"column":131,"offset":23297},"indent":[]}}],"position":{"start":{"line":737,"column":3,"offset":23169},"end":{"line":737,"column":131,"offset":23297},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Affinity/anti-affinity mechanism is only relevant during scheduling, once a pod is running, it'll need to be recreated to apply the rules again.","position":{"start":{"line":738,"column":5,"offset":23302},"end":{"line":738,"column":149,"offset":23446},"indent":[]}}],"position":{"start":{"line":738,"column":5,"offset":23302},"end":{"line":738,"column":149,"offset":23446},"indent":[]}}],"position":{"start":{"line":738,"column":3,"offset":23300},"end":{"line":738,"column":149,"offset":23446},"indent":[]}}],"position":{"start":{"line":736,"column":3,"offset":23119},"end":{"line":738,"column":149,"offset":23446},"indent":[3,3]}}],"position":{"start":{"line":735,"column":1,"offset":23043},"end":{"line":738,"column":149,"offset":23446},"indent":[1,1,1]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"There are currently 2 types you can use for node affinity:","position":{"start":{"line":739,"column":3,"offset":23449},"end":{"line":739,"column":61,"offset":23507},"indent":[]}}],"position":{"start":{"line":739,"column":3,"offset":23449},"end":{"line":739,"column":61,"offset":23507},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"1) requiredDuringSchedulingIgnoredDuringExecution","position":{"start":{"line":740,"column":5,"offset":23512},"end":{"line":740,"column":54,"offset":23561},"indent":[]}}],"position":{"start":{"line":740,"column":5,"offset":23512},"end":{"line":740,"column":54,"offset":23561},"indent":[]}}],"position":{"start":{"line":740,"column":3,"offset":23510},"end":{"line":740,"column":54,"offset":23561},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"2) preferredDuringSchedulingIgnoredDuringExecution","position":{"start":{"line":741,"column":5,"offset":23566},"end":{"line":741,"column":55,"offset":23616},"indent":[]}}],"position":{"start":{"line":741,"column":5,"offset":23566},"end":{"line":741,"column":55,"offset":23616},"indent":[]}}],"position":{"start":{"line":741,"column":3,"offset":23564},"end":{"line":741,"column":55,"offset":23616},"indent":[]}}],"position":{"start":{"line":740,"column":3,"offset":23510},"end":{"line":741,"column":55,"offset":23616},"indent":[3]}}],"position":{"start":{"line":739,"column":1,"offset":23447},"end":{"line":741,"column":55,"offset":23616},"indent":[1,1]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":742,"column":3,"offset":23619},"end":{"line":742,"column":7,"offset":23623},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"first one","position":{"start":{"line":742,"column":9,"offset":23625},"end":{"line":742,"column":18,"offset":23634},"indent":[]}}],"position":{"start":{"line":742,"column":7,"offset":23623},"end":{"line":742,"column":20,"offset":23636},"indent":[]}},{"type":"text","value":" sets a ","position":{"start":{"line":742,"column":20,"offset":23636},"end":{"line":742,"column":28,"offset":23644},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"hard requirement","position":{"start":{"line":742,"column":30,"offset":23646},"end":{"line":742,"column":46,"offset":23662},"indent":[]}}],"position":{"start":{"line":742,"column":28,"offset":23644},"end":{"line":742,"column":48,"offset":23664},"indent":[]}},{"type":"text","value":" (like the nodeSelector).","position":{"start":{"line":742,"column":48,"offset":23664},"end":{"line":742,"column":73,"offset":23689},"indent":[]}}],"position":{"start":{"line":742,"column":3,"offset":23619},"end":{"line":742,"column":73,"offset":23689},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The rules must be met before the pod can be scheduled.","position":{"start":{"line":743,"column":5,"offset":23694},"end":{"line":743,"column":59,"offset":23748},"indent":[]}}],"position":{"start":{"line":743,"column":5,"offset":23694},"end":{"line":743,"column":59,"offset":23748},"indent":[]}}],"position":{"start":{"line":743,"column":3,"offset":23692},"end":{"line":743,"column":59,"offset":23748},"indent":[]}}],"position":{"start":{"line":743,"column":3,"offset":23692},"end":{"line":743,"column":59,"offset":23748},"indent":[]}}],"position":{"start":{"line":742,"column":1,"offset":23617},"end":{"line":743,"column":59,"offset":23748},"indent":[1]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":744,"column":3,"offset":23751},"end":{"line":744,"column":7,"offset":23755},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"second type","position":{"start":{"line":744,"column":9,"offset":23757},"end":{"line":744,"column":20,"offset":23768},"indent":[]}}],"position":{"start":{"line":744,"column":7,"offset":23755},"end":{"line":744,"column":22,"offset":23770},"indent":[]}},{"type":"text","value":" will try to enforce the rule, but it will not guarantee it.","position":{"start":{"line":744,"column":22,"offset":23770},"end":{"line":744,"column":82,"offset":23830},"indent":[]}}],"position":{"start":{"line":744,"column":3,"offset":23751},"end":{"line":744,"column":82,"offset":23830},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Even if the rule is not met, the pod can still be scheduled, it's a soft requirement, a preference.","position":{"start":{"line":745,"column":5,"offset":23835},"end":{"line":745,"column":104,"offset":23934},"indent":[]}}],"position":{"start":{"line":745,"column":5,"offset":23835},"end":{"line":745,"column":104,"offset":23934},"indent":[]}}],"position":{"start":{"line":745,"column":3,"offset":23833},"end":{"line":745,"column":104,"offset":23934},"indent":[]}}],"position":{"start":{"line":745,"column":3,"offset":23833},"end":{"line":745,"column":104,"offset":23934},"indent":[]}}],"position":{"start":{"line":744,"column":1,"offset":23749},"end":{"line":745,"column":104,"offset":23934},"indent":[1]}}],"position":{"start":{"line":730,"column":1,"offset":22533},"end":{"line":745,"column":104,"offset":23934},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"code","lang":"yaml","meta":null,"value":"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: <% helloworld-deployment %>\nspec:\n  replicas: 2\n  template:\n    metadata:\n      labels:\n        app: <% app_name %>\n    spec:\n      affinity:\n        nodeAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            nodeSelectorTerms:\n              - matchExpressions:\n                  - key: env\n                    operator: In\n                    values:\n                      - dev\n          preferredDuringSchedulingIgnoredDuringExecution:\n            - weight: 1 # higher the weighting, the more emphasis on rule\n              preference:\n                matchExpressions:\n                  - key: team\n                    operator: In\n                    values:\n                      - engineering-project1\n      containers:\n        - name: k8s-demo\n          image: <% image_name %>\n          port:\n            - containerPort: 3000","position":{"start":{"line":747,"column":1,"offset":23936},"end":{"line":781,"column":4,"offset":24863},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"When scheduling, Kubernetes will score every node by summarizing the weightings per node.","position":{"start":{"line":783,"column":1,"offset":24865},"end":{"line":783,"column":90,"offset":24954},"indent":[]}}],"position":{"start":{"line":783,"column":1,"offset":24865},"end":{"line":783,"column":90,"offset":24954},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Eg two different rules with weights 1and 5.","position":{"start":{"line":785,"column":4,"offset":24959},"end":{"line":785,"column":47,"offset":25002},"indent":[]}}],"position":{"start":{"line":785,"column":4,"offset":24959},"end":{"line":785,"column":47,"offset":25002},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"If both rules match, score 6.","position":{"start":{"line":786,"column":7,"offset":25009},"end":{"line":786,"column":36,"offset":25038},"indent":[]}}],"position":{"start":{"line":786,"column":7,"offset":25009},"end":{"line":786,"column":36,"offset":25038},"indent":[]}}],"position":{"start":{"line":786,"column":4,"offset":25006},"end":{"line":786,"column":36,"offset":25038},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"If only rule with weight 1 matches, score 1.","position":{"start":{"line":787,"column":7,"offset":25045},"end":{"line":787,"column":51,"offset":25089},"indent":[]}}],"position":{"start":{"line":787,"column":7,"offset":25045},"end":{"line":787,"column":51,"offset":25089},"indent":[]}}],"position":{"start":{"line":787,"column":4,"offset":25042},"end":{"line":787,"column":51,"offset":25089},"indent":[]}}],"position":{"start":{"line":786,"column":4,"offset":25006},"end":{"line":787,"column":51,"offset":25089},"indent":[4]}}],"position":{"start":{"line":785,"column":1,"offset":24956},"end":{"line":787,"column":51,"offset":25089},"indent":[1,1]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The node that has the highest total score, that's where the pod will be scheduled on.","position":{"start":{"line":788,"column":4,"offset":25093},"end":{"line":788,"column":89,"offset":25178},"indent":[]}}],"position":{"start":{"line":788,"column":4,"offset":25093},"end":{"line":788,"column":89,"offset":25178},"indent":[]}}],"position":{"start":{"line":788,"column":1,"offset":25090},"end":{"line":788,"column":89,"offset":25178},"indent":[]}}],"position":{"start":{"line":785,"column":1,"offset":24956},"end":{"line":788,"column":89,"offset":25178},"indent":[1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"3.13 Interpod Affinity/Anti-Affinity","position":{"start":{"line":790,"column":4,"offset":25183},"end":{"line":790,"column":40,"offset":25219},"indent":[]}}],"position":{"start":{"line":790,"column":1,"offset":25180},"end":{"line":790,"column":40,"offset":25219},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"This allows you to influence scheduling based on the labels of other pods that are ","position":{"start":{"line":792,"column":3,"offset":25223},"end":{"line":792,"column":86,"offset":25306},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"already running","position":{"start":{"line":792,"column":88,"offset":25308},"end":{"line":792,"column":103,"offset":25323},"indent":[]}}],"position":{"start":{"line":792,"column":86,"offset":25306},"end":{"line":792,"column":105,"offset":25325},"indent":[]}},{"type":"text","value":" on the cluster.","position":{"start":{"line":792,"column":105,"offset":25325},"end":{"line":792,"column":121,"offset":25341},"indent":[]}}],"position":{"start":{"line":792,"column":3,"offset":25223},"end":{"line":792,"column":121,"offset":25341},"indent":[]}}],"position":{"start":{"line":792,"column":1,"offset":25221},"end":{"line":792,"column":121,"offset":25341},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Pods belong to a namespace, so rules apply to namespace (default to pod name).","position":{"start":{"line":793,"column":3,"offset":25344},"end":{"line":793,"column":81,"offset":25422},"indent":[]}}],"position":{"start":{"line":793,"column":3,"offset":25344},"end":{"line":793,"column":81,"offset":25422},"indent":[]}}],"position":{"start":{"line":793,"column":1,"offset":25342},"end":{"line":793,"column":81,"offset":25422},"indent":[]}}],"position":{"start":{"line":792,"column":1,"offset":25221},"end":{"line":793,"column":81,"offset":25422},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"Two types:","position":{"start":{"line":795,"column":1,"offset":25424},"end":{"line":795,"column":11,"offset":25434},"indent":[]}}],"position":{"start":{"line":795,"column":1,"offset":25424},"end":{"line":795,"column":11,"offset":25434},"indent":[]}},{"type":"list","ordered":true,"start":1,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"requiredDuringSchedulingIgnoredDuringExecution","position":{"start":{"line":797,"column":4,"offset":25439},"end":{"line":797,"column":50,"offset":25485},"indent":[]}}],"position":{"start":{"line":797,"column":4,"offset":25439},"end":{"line":797,"column":50,"offset":25485},"indent":[]}}],"position":{"start":{"line":797,"column":1,"offset":25436},"end":{"line":797,"column":50,"offset":25485},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"preferredDuringSchedulingIgnoredDuringExecution","position":{"start":{"line":798,"column":4,"offset":25489},"end":{"line":798,"column":51,"offset":25536},"indent":[]}}],"position":{"start":{"line":798,"column":4,"offset":25489},"end":{"line":798,"column":51,"offset":25536},"indent":[]}}],"position":{"start":{"line":798,"column":1,"offset":25486},"end":{"line":798,"column":51,"offset":25536},"indent":[]}}],"position":{"start":{"line":797,"column":1,"offset":25436},"end":{"line":798,"column":51,"offset":25536},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"The required type create rules that must be met for the pod to be scheduled, the preferred type is a \"soft\" type and the rules may be met.","position":{"start":{"line":800,"column":1,"offset":25538},"end":{"line":800,"column":139,"offset":25676},"indent":[]}}],"position":{"start":{"line":800,"column":1,"offset":25538},"end":{"line":800,"column":139,"offset":25676},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"A good use case for ","position":{"start":{"line":802,"column":1,"offset":25678},"end":{"line":802,"column":21,"offset":25698},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"pod affinity is co-located pods","position":{"start":{"line":802,"column":23,"offset":25700},"end":{"line":802,"column":54,"offset":25731},"indent":[]}}],"position":{"start":{"line":802,"column":21,"offset":25698},"end":{"line":802,"column":56,"offset":25733},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":802,"column":56,"offset":25733},"end":{"line":802,"column":57,"offset":25734},"indent":[]}}],"position":{"start":{"line":802,"column":1,"offset":25678},"end":{"line":802,"column":57,"offset":25734},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Example, you have an app that uses redis as cache and you want to have the Redis pod on the same node as the app itself.","position":{"start":{"line":804,"column":3,"offset":25738},"end":{"line":804,"column":123,"offset":25858},"indent":[]}}],"position":{"start":{"line":804,"column":3,"offset":25738},"end":{"line":804,"column":123,"offset":25858},"indent":[]}}],"position":{"start":{"line":804,"column":1,"offset":25736},"end":{"line":804,"column":123,"offset":25858},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Another use-case is to co-locate pods within the ","position":{"start":{"line":805,"column":3,"offset":25861},"end":{"line":805,"column":52,"offset":25910},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"same availability zone","position":{"start":{"line":805,"column":54,"offset":25912},"end":{"line":805,"column":76,"offset":25934},"indent":[]}}],"position":{"start":{"line":805,"column":52,"offset":25910},"end":{"line":805,"column":78,"offset":25936},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":805,"column":78,"offset":25936},"end":{"line":805,"column":79,"offset":25937},"indent":[]}}],"position":{"start":{"line":805,"column":3,"offset":25861},"end":{"line":805,"column":79,"offset":25937},"indent":[]}}],"position":{"start":{"line":805,"column":1,"offset":25859},"end":{"line":805,"column":79,"offset":25937},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"When writing your pod affinity and anti-affinity rules, you need to specify a ","position":{"start":{"line":806,"column":3,"offset":25940},"end":{"line":806,"column":81,"offset":26018},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"topology domain","position":{"start":{"line":806,"column":83,"offset":26020},"end":{"line":806,"column":98,"offset":26035},"indent":[]}}],"position":{"start":{"line":806,"column":81,"offset":26018},"end":{"line":806,"column":100,"offset":26037},"indent":[]}},{"type":"text","value":", called ","position":{"start":{"line":806,"column":100,"offset":26037},"end":{"line":806,"column":109,"offset":26046},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"topologyKey","position":{"start":{"line":806,"column":111,"offset":26048},"end":{"line":806,"column":122,"offset":26059},"indent":[]}}],"position":{"start":{"line":806,"column":109,"offset":26046},"end":{"line":806,"column":124,"offset":26061},"indent":[]}},{"type":"text","value":" in the rules.","position":{"start":{"line":806,"column":124,"offset":26061},"end":{"line":806,"column":138,"offset":26075},"indent":[]}}],"position":{"start":{"line":806,"column":3,"offset":25940},"end":{"line":806,"column":138,"offset":26075},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Key refers to a node label.","position":{"start":{"line":807,"column":5,"offset":26080},"end":{"line":807,"column":32,"offset":26107},"indent":[]}}],"position":{"start":{"line":807,"column":5,"offset":26080},"end":{"line":807,"column":32,"offset":26107},"indent":[]}}],"position":{"start":{"line":807,"column":3,"offset":26078},"end":{"line":807,"column":32,"offset":26107},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"If affinity rule matches, ","position":{"start":{"line":808,"column":5,"offset":26112},"end":{"line":808,"column":31,"offset":26138},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"new pod","position":{"start":{"line":808,"column":33,"offset":26140},"end":{"line":808,"column":40,"offset":26147},"indent":[]}}],"position":{"start":{"line":808,"column":31,"offset":26138},"end":{"line":808,"column":42,"offset":26149},"indent":[]}},{"type":"text","value":" will only be scheduled on ","position":{"start":{"line":808,"column":42,"offset":26149},"end":{"line":808,"column":69,"offset":26176},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"nodes","position":{"start":{"line":808,"column":71,"offset":26178},"end":{"line":808,"column":76,"offset":26183},"indent":[]}}],"position":{"start":{"line":808,"column":69,"offset":26176},"end":{"line":808,"column":78,"offset":26185},"indent":[]}},{"type":"text","value":" that have the ","position":{"start":{"line":808,"column":78,"offset":26185},"end":{"line":808,"column":93,"offset":26200},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"same topologyKey","position":{"start":{"line":808,"column":95,"offset":26202},"end":{"line":808,"column":111,"offset":26218},"indent":[]}}],"position":{"start":{"line":808,"column":93,"offset":26200},"end":{"line":808,"column":113,"offset":26220},"indent":[]}},{"type":"text","value":" value as the ","position":{"start":{"line":808,"column":113,"offset":26220},"end":{"line":808,"column":127,"offset":26234},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"current running pod","position":{"start":{"line":808,"column":129,"offset":26236},"end":{"line":808,"column":148,"offset":26255},"indent":[]}}],"position":{"start":{"line":808,"column":127,"offset":26234},"end":{"line":808,"column":150,"offset":26257},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":808,"column":150,"offset":26257},"end":{"line":808,"column":151,"offset":26258},"indent":[]}}],"position":{"start":{"line":808,"column":5,"offset":26112},"end":{"line":808,"column":151,"offset":26258},"indent":[]}}],"position":{"start":{"line":808,"column":3,"offset":26110},"end":{"line":808,"column":151,"offset":26258},"indent":[]}}],"position":{"start":{"line":807,"column":3,"offset":26078},"end":{"line":808,"column":151,"offset":26258},"indent":[3]}}],"position":{"start":{"line":806,"column":1,"offset":25938},"end":{"line":808,"column":151,"offset":26258},"indent":[1,1]}}],"position":{"start":{"line":804,"column":1,"offset":25736},"end":{"line":808,"column":151,"offset":26258},"indent":[1,1,1,1]}},{"type":"paragraph","children":[{"type":"image","title":null,"url":"https://res.cloudinary.com/gitgoodclub/image/upload/v1540165720/Screen_Shot_2018-10-22_at_10.48.04_am.png","alt":"Interpod Affinity and anti-affinity","position":{"start":{"line":810,"column":1,"offset":26260},"end":{"line":810,"column":146,"offset":26405},"indent":[]}}],"position":{"start":{"line":810,"column":1,"offset":26260},"end":{"line":810,"column":146,"offset":26405},"indent":[]}},{"type":"paragraph","children":[{"type":"image","title":null,"url":"https://res.cloudinary.com/gitgoodclub/image/upload/v1540165853/Screen_Shot_2018-10-22_at_10.50.27_am.png","alt":"Zone topology","position":{"start":{"line":812,"column":1,"offset":26407},"end":{"line":812,"column":124,"offset":26530},"indent":[]}}],"position":{"start":{"line":812,"column":1,"offset":26407},"end":{"line":812,"column":124,"offset":26530},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Anti-affinity","position":{"start":{"line":814,"column":5,"offset":26536},"end":{"line":814,"column":18,"offset":26549},"indent":[]}}],"position":{"start":{"line":814,"column":1,"offset":26532},"end":{"line":814,"column":18,"offset":26549},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"You can use anti-affinity to make sure a ","position":{"start":{"line":816,"column":1,"offset":26551},"end":{"line":816,"column":42,"offset":26592},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"pod is only scehduled once on a node","position":{"start":{"line":816,"column":44,"offset":26594},"end":{"line":816,"column":80,"offset":26630},"indent":[]}}],"position":{"start":{"line":816,"column":42,"offset":26592},"end":{"line":816,"column":82,"offset":26632},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":816,"column":82,"offset":26632},"end":{"line":816,"column":83,"offset":26633},"indent":[]}}],"position":{"start":{"line":816,"column":1,"offset":26551},"end":{"line":816,"column":83,"offset":26633},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Example 3 nodes and you want to schedule 2 pods but they shouldn't be on the same node.","position":{"start":{"line":818,"column":3,"offset":26637},"end":{"line":818,"column":90,"offset":26724},"indent":[]}}],"position":{"start":{"line":818,"column":3,"offset":26637},"end":{"line":818,"column":90,"offset":26724},"indent":[]}}],"position":{"start":{"line":818,"column":1,"offset":26635},"end":{"line":818,"column":90,"offset":26724},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Pod anti-affinity allows you to create a rule that say to ","position":{"start":{"line":819,"column":3,"offset":26727},"end":{"line":819,"column":61,"offset":26785},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"not schedule on the same host if a pod label matches","position":{"start":{"line":819,"column":63,"offset":26787},"end":{"line":819,"column":115,"offset":26839},"indent":[]}}],"position":{"start":{"line":819,"column":61,"offset":26785},"end":{"line":819,"column":117,"offset":26841},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":819,"column":117,"offset":26841},"end":{"line":819,"column":118,"offset":26842},"indent":[]}}],"position":{"start":{"line":819,"column":3,"offset":26727},"end":{"line":819,"column":118,"offset":26842},"indent":[]}}],"position":{"start":{"line":819,"column":1,"offset":26725},"end":{"line":819,"column":118,"offset":26842},"indent":[]}}],"position":{"start":{"line":818,"column":1,"offset":26635},"end":{"line":819,"column":118,"offset":26842},"indent":[1]}},{"type":"paragraph","children":[{"type":"image","title":null,"url":"https://res.cloudinary.com/gitgoodclub/image/upload/v1540165853/Screen_Shot_2018-10-22_at_10.50.27_am.png","alt":"Anti-affinity","position":{"start":{"line":821,"column":1,"offset":26844},"end":{"line":821,"column":124,"offset":26967},"indent":[]}}],"position":{"start":{"line":821,"column":1,"offset":26844},"end":{"line":821,"column":124,"offset":26967},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Topology operators","position":{"start":{"line":823,"column":5,"offset":26973},"end":{"line":823,"column":23,"offset":26991},"indent":[]}}],"position":{"start":{"line":823,"column":1,"offset":26969},"end":{"line":823,"column":23,"offset":26991},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"In","position":{"start":{"line":825,"column":3,"offset":26995},"end":{"line":825,"column":5,"offset":26997},"indent":[]}}],"position":{"start":{"line":825,"column":3,"offset":26995},"end":{"line":825,"column":5,"offset":26997},"indent":[]}}],"position":{"start":{"line":825,"column":1,"offset":26993},"end":{"line":825,"column":5,"offset":26997},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"NotIn","position":{"start":{"line":826,"column":3,"offset":27000},"end":{"line":826,"column":8,"offset":27005},"indent":[]}}],"position":{"start":{"line":826,"column":3,"offset":27000},"end":{"line":826,"column":8,"offset":27005},"indent":[]}}],"position":{"start":{"line":826,"column":1,"offset":26998},"end":{"line":826,"column":8,"offset":27005},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Exists","position":{"start":{"line":827,"column":3,"offset":27008},"end":{"line":827,"column":9,"offset":27014},"indent":[]}}],"position":{"start":{"line":827,"column":3,"offset":27008},"end":{"line":827,"column":9,"offset":27014},"indent":[]}}],"position":{"start":{"line":827,"column":1,"offset":27006},"end":{"line":827,"column":9,"offset":27014},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"DoesNotExist","position":{"start":{"line":828,"column":3,"offset":27017},"end":{"line":828,"column":15,"offset":27029},"indent":[]}}],"position":{"start":{"line":828,"column":3,"offset":27017},"end":{"line":828,"column":15,"offset":27029},"indent":[]}}],"position":{"start":{"line":828,"column":1,"offset":27015},"end":{"line":828,"column":15,"offset":27029},"indent":[]}}],"position":{"start":{"line":825,"column":1,"offset":26993},"end":{"line":828,"column":15,"offset":27029},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Affinity requires a substantial amount of processor. Take this into account if you have a lot of rules.","position":{"start":{"line":830,"column":1,"offset":27031},"end":{"line":830,"column":104,"offset":27134},"indent":[]}}],"position":{"start":{"line":830,"column":1,"offset":27031},"end":{"line":830,"column":104,"offset":27134},"indent":[]}},{"type":"code","lang":"yaml","meta":null,"value":"# pod-affinity.yml\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: pod-affinity-1\nspec:\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: pod-affinity-1\n    spec:\n      containers:\n      - name: k8s-demo\n        image: wardviaene/k8s-demo\n        ports:\n        - name: nodejs-port\n          containerPort: 3000\n---\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: pod-affinity-2\nspec:\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: pod-affinity-2\n    spec:\n      affinity:\n        podAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            - labelSelector:\n                matchExpressions:\n                  - key: \"app\"\n                    operator: In\n                    values:\n                    - pod-affinity-1\n              topologyKey: \"kubernetes.io/hostname\" # this could be change for zoning\n      containers:\n      - name: redis\n        image: redis\n        ports:\n        - name: redis-port\n          containerPort: 6379","position":{"start":{"line":832,"column":1,"offset":27136},"end":{"line":879,"column":4,"offset":28181},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"We can then check this is fine by running ","position":{"start":{"line":881,"column":1,"offset":28183},"end":{"line":881,"column":43,"offset":28225},"indent":[]}},{"type":"inlineCode","value":"kubectl get pod -o wide","position":{"start":{"line":881,"column":43,"offset":28225},"end":{"line":881,"column":68,"offset":28250},"indent":[]}},{"type":"text","value":" to see the Node the pods are running on.","position":{"start":{"line":881,"column":68,"offset":28250},"end":{"line":881,"column":109,"offset":28291},"indent":[]}}],"position":{"start":{"line":881,"column":1,"offset":28183},"end":{"line":881,"column":109,"offset":28291},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"As for anti-affinity:","position":{"start":{"line":883,"column":1,"offset":28293},"end":{"line":883,"column":22,"offset":28314},"indent":[]}}],"position":{"start":{"line":883,"column":1,"offset":28293},"end":{"line":883,"column":22,"offset":28314},"indent":[]}},{"type":"code","lang":"yaml","meta":null,"value":"apiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: pod-affinity-1\nspec:\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: pod-affinity-1\n    spec:\n      containers:\n      - name: k8s-demo\n        image: wardviaene/k8s-demo\n        ports:\n        - name: nodejs-port\n          containerPort: 3000\n---\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: pod-affinity-2\nspec:\n  replicas: 3\n  template:\n    metadata:\n      labels:\n        app: pod-affinity-2\n    spec:\n      affinity:\n        podAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            - labelSelector:\n                matchExpressions:\n                  - key: \"app\"\n                    operator: In\n                    values:\n                    - pod-affinity-1\n              topologyKey: \"kubernetes.io/hostname\"\n      containers:\n      - name: redis\n        image: redis\n        ports:\n        - name: redis-port\n          containerPort: 6379\n---\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: pod-affinity-3\nspec:\n  replicas: 3\n  template:\n    metadata:\n      labels:\n        app: pod-affinity-3\n    spec:\n      affinity:\n        podAntiAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            - labelSelector:\n                matchExpressions:\n                  - key: \"app\"\n                    operator: In\n                    values:\n                    - pod-affinity-1\n              topologyKey: \"kubernetes.io/hostname\"\n      containers:\n      - name: k8s-demo\n        image: wardviaene/k8s-demo\n        ports:\n        - name: nodejs-port\n          containerPort: 3000\n---\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: pod-affinity-4\nspec:\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: pod-affinity-4\n    spec:\n      affinity:\n        podAntiAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            - labelSelector:\n                matchExpressions:\n                  - key: \"app\"\n                    operator: In\n                    values:\n                    - pod-affinity-1\n                    - pod-affinity-3\n              topologyKey: \"kubernetes.io/hostname\"\n      containers:\n      - name: k8s-demo\n        image: wardviaene/k8s-demo\n        ports:\n        - name: nodejs-port\n          containerPort: 3000\n---","position":{"start":{"line":885,"column":1,"offset":28316},"end":{"line":989,"column":4,"offset":30699},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"image","title":null,"url":"https://res.cloudinary.com/gitgoodclub/image/upload/v1540170357/Screen_Shot_2018-10-22_at_12.05.28_pm.png","alt":"Resulting run with the affinity/anti-affinity","position":{"start":{"line":991,"column":1,"offset":30701},"end":{"line":991,"column":156,"offset":30856},"indent":[]}}],"position":{"start":{"line":991,"column":1,"offset":30701},"end":{"line":991,"column":156,"offset":30856},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Note that there are differences between ","position":{"start":{"line":993,"column":1,"offset":30858},"end":{"line":993,"column":41,"offset":30898},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"preferred","position":{"start":{"line":993,"column":43,"offset":30900},"end":{"line":993,"column":52,"offset":30909},"indent":[]}}],"position":{"start":{"line":993,"column":41,"offset":30898},"end":{"line":993,"column":54,"offset":30911},"indent":[]}},{"type":"text","value":" and ","position":{"start":{"line":993,"column":54,"offset":30911},"end":{"line":993,"column":59,"offset":30916},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"required","position":{"start":{"line":993,"column":61,"offset":30918},"end":{"line":993,"column":69,"offset":30926},"indent":[]}}],"position":{"start":{"line":993,"column":59,"offset":30916},"end":{"line":993,"column":71,"offset":30928},"indent":[]}},{"type":"text","value":". With preferred, you may still have the pod scheduled in events we don't necessarily want as a best case scenario.","position":{"start":{"line":993,"column":71,"offset":30928},"end":{"line":993,"column":186,"offset":31043},"indent":[]}}],"position":{"start":{"line":993,"column":1,"offset":30858},"end":{"line":993,"column":186,"offset":31043},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"3.14 Taints and Tolerations","position":{"start":{"line":995,"column":4,"offset":31048},"end":{"line":995,"column":31,"offset":31075},"indent":[]}}],"position":{"start":{"line":995,"column":1,"offset":31045},"end":{"line":995,"column":31,"offset":31075},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Tolerations is the opposite of node affinity.","position":{"start":{"line":997,"column":1,"offset":31077},"end":{"line":997,"column":46,"offset":31122},"indent":[]}}],"position":{"start":{"line":997,"column":1,"offset":31077},"end":{"line":997,"column":46,"offset":31122},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Allows a node to ","position":{"start":{"line":999,"column":3,"offset":31126},"end":{"line":999,"column":20,"offset":31143},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"repels a set of pods","position":{"start":{"line":999,"column":22,"offset":31145},"end":{"line":999,"column":42,"offset":31165},"indent":[]}}],"position":{"start":{"line":999,"column":20,"offset":31143},"end":{"line":999,"column":44,"offset":31167},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":999,"column":44,"offset":31167},"end":{"line":999,"column":45,"offset":31168},"indent":[]}}],"position":{"start":{"line":999,"column":3,"offset":31126},"end":{"line":999,"column":45,"offset":31168},"indent":[]}}],"position":{"start":{"line":999,"column":1,"offset":31124},"end":{"line":999,"column":45,"offset":31168},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Taints mark","position":{"start":{"line":1000,"column":5,"offset":31173},"end":{"line":1000,"column":16,"offset":31184},"indent":[]}}],"position":{"start":{"line":1000,"column":3,"offset":31171},"end":{"line":1000,"column":18,"offset":31186},"indent":[]}},{"type":"text","value":" a node, tolerations are applied to pods to influence the scheduling of a pod.","position":{"start":{"line":1000,"column":18,"offset":31186},"end":{"line":1000,"column":96,"offset":31264},"indent":[]}}],"position":{"start":{"line":1000,"column":3,"offset":31171},"end":{"line":1000,"column":96,"offset":31264},"indent":[]}}],"position":{"start":{"line":1000,"column":1,"offset":31169},"end":{"line":1000,"column":96,"offset":31264},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"One use case for taints is to make sure that when you create a new pod, they're not scheduled on the master (","position":{"start":{"line":1001,"column":3,"offset":31267},"end":{"line":1001,"column":112,"offset":31376},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"node-role.kubernetes.io/master:NoSchedule","position":{"start":{"line":1001,"column":114,"offset":31378},"end":{"line":1001,"column":155,"offset":31419},"indent":[]}}],"position":{"start":{"line":1001,"column":112,"offset":31376},"end":{"line":1001,"column":157,"offset":31421},"indent":[]}},{"type":"text","value":"). This is the default.","position":{"start":{"line":1001,"column":157,"offset":31421},"end":{"line":1001,"column":180,"offset":31444},"indent":[]}}],"position":{"start":{"line":1001,"column":3,"offset":31267},"end":{"line":1001,"column":180,"offset":31444},"indent":[]}}],"position":{"start":{"line":1001,"column":1,"offset":31265},"end":{"line":1001,"column":180,"offset":31444},"indent":[]}}],"position":{"start":{"line":999,"column":1,"offset":31124},"end":{"line":1001,"column":180,"offset":31444},"indent":[1,1]}},{"type":"code","lang":"bash","meta":null,"value":"# To add a taint\n$ kubectl taint nodes node1 key=value:NoSchedule # This will make sure that no pods will be scheduled on node1 as long as they don't have a matching toleration","position":{"start":{"line":1003,"column":1,"offset":31446},"end":{"line":1006,"column":4,"offset":31634},"indent":[1,1,1]}},{"type":"code","lang":"yaml","meta":null,"value":"# tolerations.yml\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: tolerations-1\nspec:\n  replicas: 3\n  template:\n    metadata:\n      labels:\n        app: tolerations-1\n    spec:\n      containers:\n      - name: k8s-demo\n        image: wardviaene/k8s-demo\n        ports:\n        - name: nodejs-port\n          containerPort: 3000\n---\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: tolerations-2\nspec:\n  replicas: 3\n  template:\n    metadata:\n      labels:\n        app: tolerations-2\n    spec:\n      tolerations:\n      - key: \"type\"\n        operator: \"Equal\"\n        value: \"specialnode\"\n        effect: \"NoSchedule\"\n      containers:\n      - name: k8s-demo\n        image: wardviaene/k8s-demo\n        ports:\n        - name: nodejs-port\n          containerPort: 3000","position":{"start":{"line":1008,"column":1,"offset":31636},"end":{"line":1050,"column":4,"offset":32444},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Tolerations usage","position":{"start":{"line":1052,"column":5,"offset":32450},"end":{"line":1052,"column":22,"offset":32467},"indent":[]}}],"position":{"start":{"line":1052,"column":1,"offset":32446},"end":{"line":1052,"column":22,"offset":32467},"indent":[]}},{"type":"code","lang":"bash","meta":null,"value":"# Taint a node\n$ kubectl taint nodes NODE-NAME type=specialnode:NoSchedule\n\n# Taint with NoExecute\n$ kubectl taint nodes NODE-NAME testkey=testvalue:NoExecute","position":{"start":{"line":1054,"column":1,"offset":32469},"end":{"line":1060,"column":4,"offset":32639},"indent":[1,1,1,1,1,1]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Keys","position":{"start":{"line":1062,"column":5,"offset":32645},"end":{"line":1062,"column":9,"offset":32649},"indent":[]}}],"position":{"start":{"line":1062,"column":1,"offset":32641},"end":{"line":1062,"column":9,"offset":32649},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Operators","position":{"start":{"line":1064,"column":3,"offset":32653},"end":{"line":1064,"column":12,"offset":32662},"indent":[]}}],"position":{"start":{"line":1064,"column":3,"offset":32653},"end":{"line":1064,"column":12,"offset":32662},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Equal","position":{"start":{"line":1065,"column":7,"offset":32669},"end":{"line":1065,"column":12,"offset":32674},"indent":[]}}],"position":{"start":{"line":1065,"column":5,"offset":32667},"end":{"line":1065,"column":14,"offset":32676},"indent":[]}},{"type":"text","value":" (providing key + value)","position":{"start":{"line":1065,"column":14,"offset":32676},"end":{"line":1065,"column":38,"offset":32700},"indent":[]}}],"position":{"start":{"line":1065,"column":5,"offset":32667},"end":{"line":1065,"column":38,"offset":32700},"indent":[]}}],"position":{"start":{"line":1065,"column":3,"offset":32665},"end":{"line":1065,"column":38,"offset":32700},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"Exists","position":{"start":{"line":1066,"column":7,"offset":32707},"end":{"line":1066,"column":13,"offset":32713},"indent":[]}}],"position":{"start":{"line":1066,"column":5,"offset":32705},"end":{"line":1066,"column":15,"offset":32715},"indent":[]}},{"type":"text","value":" (only providing a key, checking only whether a key exists)","position":{"start":{"line":1066,"column":15,"offset":32715},"end":{"line":1066,"column":74,"offset":32774},"indent":[]}}],"position":{"start":{"line":1066,"column":5,"offset":32705},"end":{"line":1066,"column":74,"offset":32774},"indent":[]}}],"position":{"start":{"line":1066,"column":3,"offset":32703},"end":{"line":1066,"column":74,"offset":32774},"indent":[]}}],"position":{"start":{"line":1065,"column":3,"offset":32665},"end":{"line":1066,"column":74,"offset":32774},"indent":[3]}}],"position":{"start":{"line":1064,"column":1,"offset":32651},"end":{"line":1066,"column":74,"offset":32774},"indent":[1,1]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Effects","position":{"start":{"line":1067,"column":3,"offset":32777},"end":{"line":1067,"column":10,"offset":32784},"indent":[]}}],"position":{"start":{"line":1067,"column":3,"offset":32777},"end":{"line":1067,"column":10,"offset":32784},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"NoSchedule","position":{"start":{"line":1068,"column":7,"offset":32791},"end":{"line":1068,"column":17,"offset":32801},"indent":[]}}],"position":{"start":{"line":1068,"column":5,"offset":32789},"end":{"line":1068,"column":19,"offset":32803},"indent":[]}},{"type":"text","value":" (hard requirement that apod will not be scheduled unless there is a matching toleration)","position":{"start":{"line":1068,"column":19,"offset":32803},"end":{"line":1068,"column":108,"offset":32892},"indent":[]}}],"position":{"start":{"line":1068,"column":5,"offset":32789},"end":{"line":1068,"column":108,"offset":32892},"indent":[]}}],"position":{"start":{"line":1068,"column":3,"offset":32787},"end":{"line":1068,"column":108,"offset":32892},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"PreferNoSchedule","position":{"start":{"line":1069,"column":7,"offset":32899},"end":{"line":1069,"column":23,"offset":32915},"indent":[]}}],"position":{"start":{"line":1069,"column":5,"offset":32897},"end":{"line":1069,"column":25,"offset":32917},"indent":[]}},{"type":"text","value":" (avoid placing a pod that doesn't have a matching tolerationg, but it's not a hard requirement)","position":{"start":{"line":1069,"column":25,"offset":32917},"end":{"line":1069,"column":121,"offset":33013},"indent":[]}}],"position":{"start":{"line":1069,"column":5,"offset":32897},"end":{"line":1069,"column":121,"offset":33013},"indent":[]}}],"position":{"start":{"line":1069,"column":3,"offset":32895},"end":{"line":1069,"column":121,"offset":33013},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"NoExecute","position":{"start":{"line":1070,"column":7,"offset":33020},"end":{"line":1070,"column":16,"offset":33029},"indent":[]}}],"position":{"start":{"line":1070,"column":5,"offset":33018},"end":{"line":1070,"column":18,"offset":33031},"indent":[]}},{"type":"text","value":" (evict pods with non-matching tolerations)","position":{"start":{"line":1070,"column":18,"offset":33031},"end":{"line":1070,"column":61,"offset":33074},"indent":[]}}],"position":{"start":{"line":1070,"column":5,"offset":33018},"end":{"line":1070,"column":61,"offset":33074},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"tolerationSeconds","position":{"start":{"line":1071,"column":9,"offset":33083},"end":{"line":1071,"column":26,"offset":33100},"indent":[]}}],"position":{"start":{"line":1071,"column":7,"offset":33081},"end":{"line":1071,"column":28,"offset":33102},"indent":[]}},{"type":"text","value":" key can be applied with a time in seconds for how long a node can run before it is evicted.","position":{"start":{"line":1071,"column":28,"offset":33102},"end":{"line":1071,"column":120,"offset":33194},"indent":[]}}],"position":{"start":{"line":1071,"column":7,"offset":33081},"end":{"line":1071,"column":120,"offset":33194},"indent":[]}}],"position":{"start":{"line":1071,"column":5,"offset":33079},"end":{"line":1071,"column":120,"offset":33194},"indent":[]}}],"position":{"start":{"line":1071,"column":5,"offset":33079},"end":{"line":1071,"column":120,"offset":33194},"indent":[]}}],"position":{"start":{"line":1070,"column":3,"offset":33016},"end":{"line":1071,"column":120,"offset":33194},"indent":[3]}}],"position":{"start":{"line":1068,"column":3,"offset":32787},"end":{"line":1071,"column":120,"offset":33194},"indent":[3,3,3]}}],"position":{"start":{"line":1067,"column":1,"offset":32775},"end":{"line":1071,"column":120,"offset":33194},"indent":[1,1,1,1]}}],"position":{"start":{"line":1064,"column":1,"offset":32651},"end":{"line":1071,"column":120,"offset":33194},"indent":[1,1,1,1,1,1,1]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Use Cases","position":{"start":{"line":1073,"column":5,"offset":33200},"end":{"line":1073,"column":14,"offset":33209},"indent":[]}}],"position":{"start":{"line":1073,"column":1,"offset":33196},"end":{"line":1073,"column":14,"offset":33209},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Existing node taints for ","position":{"start":{"line":1075,"column":3,"offset":33213},"end":{"line":1075,"column":28,"offset":33238},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"master nodes","position":{"start":{"line":1075,"column":30,"offset":33240},"end":{"line":1075,"column":42,"offset":33252},"indent":[]}}],"position":{"start":{"line":1075,"column":28,"offset":33238},"end":{"line":1075,"column":44,"offset":33254},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":1075,"column":44,"offset":33254},"end":{"line":1075,"column":45,"offset":33255},"indent":[]}}],"position":{"start":{"line":1075,"column":3,"offset":33213},"end":{"line":1075,"column":45,"offset":33255},"indent":[]}}],"position":{"start":{"line":1075,"column":1,"offset":33211},"end":{"line":1075,"column":45,"offset":33255},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Taint nodes that are ","position":{"start":{"line":1076,"column":3,"offset":33258},"end":{"line":1076,"column":24,"offset":33279},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"dedicated","position":{"start":{"line":1076,"column":26,"offset":33281},"end":{"line":1076,"column":35,"offset":33290},"indent":[]}}],"position":{"start":{"line":1076,"column":24,"offset":33279},"end":{"line":1076,"column":37,"offset":33292},"indent":[]}},{"type":"text","value":" for a team or user.","position":{"start":{"line":1076,"column":37,"offset":33292},"end":{"line":1076,"column":57,"offset":33312},"indent":[]}}],"position":{"start":{"line":1076,"column":3,"offset":33258},"end":{"line":1076,"column":57,"offset":33312},"indent":[]}}],"position":{"start":{"line":1076,"column":1,"offset":33256},"end":{"line":1076,"column":57,"offset":33312},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Node for ","position":{"start":{"line":1077,"column":3,"offset":33315},"end":{"line":1077,"column":12,"offset":33324},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"specific hardware","position":{"start":{"line":1077,"column":14,"offset":33326},"end":{"line":1077,"column":31,"offset":33343},"indent":[]}}],"position":{"start":{"line":1077,"column":12,"offset":33324},"end":{"line":1077,"column":33,"offset":33345},"indent":[]}},{"type":"text","value":" (ie GPUs) you can taint them to void running non-specific applications on those nodes.","position":{"start":{"line":1077,"column":33,"offset":33345},"end":{"line":1077,"column":120,"offset":33432},"indent":[]}}],"position":{"start":{"line":1077,"column":3,"offset":33315},"end":{"line":1077,"column":120,"offset":33432},"indent":[]}}],"position":{"start":{"line":1077,"column":1,"offset":33313},"end":{"line":1077,"column":120,"offset":33432},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Alpha but soon-to-be beta feature is to ","position":{"start":{"line":1078,"column":3,"offset":33435},"end":{"line":1078,"column":43,"offset":33475},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"taint nodes by condition","position":{"start":{"line":1078,"column":45,"offset":33477},"end":{"line":1078,"column":69,"offset":33501},"indent":[]}}],"position":{"start":{"line":1078,"column":43,"offset":33475},"end":{"line":1078,"column":71,"offset":33503},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":1078,"column":71,"offset":33503},"end":{"line":1078,"column":72,"offset":33504},"indent":[]}}],"position":{"start":{"line":1078,"column":3,"offset":33435},"end":{"line":1078,"column":72,"offset":33504},"indent":[]}}],"position":{"start":{"line":1078,"column":1,"offset":33433},"end":{"line":1078,"column":72,"offset":33504},"indent":[]}}],"position":{"start":{"line":1075,"column":1,"offset":33211},"end":{"line":1078,"column":72,"offset":33504},"indent":[1,1,1]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Useful Taints and Tolerations","position":{"start":{"line":1080,"column":5,"offset":33510},"end":{"line":1080,"column":34,"offset":33539},"indent":[]}}],"position":{"start":{"line":1080,"column":1,"offset":33506},"end":{"line":1080,"column":34,"offset":33539},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"node.kubernetes.io/not-ready","position":{"start":{"line":1082,"column":5,"offset":33545},"end":{"line":1082,"column":33,"offset":33573},"indent":[]}}],"position":{"start":{"line":1082,"column":3,"offset":33543},"end":{"line":1082,"column":35,"offset":33575},"indent":[]}}],"position":{"start":{"line":1082,"column":3,"offset":33543},"end":{"line":1082,"column":35,"offset":33575},"indent":[]}}],"position":{"start":{"line":1082,"column":1,"offset":33541},"end":{"line":1082,"column":35,"offset":33575},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"node.kubernetes.io/unreachable","position":{"start":{"line":1083,"column":5,"offset":33580},"end":{"line":1083,"column":35,"offset":33610},"indent":[]}}],"position":{"start":{"line":1083,"column":3,"offset":33578},"end":{"line":1083,"column":37,"offset":33612},"indent":[]}}],"position":{"start":{"line":1083,"column":3,"offset":33578},"end":{"line":1083,"column":37,"offset":33612},"indent":[]}}],"position":{"start":{"line":1083,"column":1,"offset":33576},"end":{"line":1083,"column":37,"offset":33612},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"node.kubernetes.io/out-of-disk","position":{"start":{"line":1084,"column":5,"offset":33617},"end":{"line":1084,"column":35,"offset":33647},"indent":[]}}],"position":{"start":{"line":1084,"column":3,"offset":33615},"end":{"line":1084,"column":37,"offset":33649},"indent":[]}}],"position":{"start":{"line":1084,"column":3,"offset":33615},"end":{"line":1084,"column":37,"offset":33649},"indent":[]}}],"position":{"start":{"line":1084,"column":1,"offset":33613},"end":{"line":1084,"column":37,"offset":33649},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"node.kubernetes.io/memory-pressure","position":{"start":{"line":1085,"column":5,"offset":33654},"end":{"line":1085,"column":39,"offset":33688},"indent":[]}}],"position":{"start":{"line":1085,"column":3,"offset":33652},"end":{"line":1085,"column":41,"offset":33690},"indent":[]}}],"position":{"start":{"line":1085,"column":3,"offset":33652},"end":{"line":1085,"column":41,"offset":33690},"indent":[]}}],"position":{"start":{"line":1085,"column":1,"offset":33650},"end":{"line":1085,"column":41,"offset":33690},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"node.kubernetes.io/disk-pressure","position":{"start":{"line":1086,"column":5,"offset":33695},"end":{"line":1086,"column":37,"offset":33727},"indent":[]}}],"position":{"start":{"line":1086,"column":3,"offset":33693},"end":{"line":1086,"column":39,"offset":33729},"indent":[]}}],"position":{"start":{"line":1086,"column":3,"offset":33693},"end":{"line":1086,"column":39,"offset":33729},"indent":[]}}],"position":{"start":{"line":1086,"column":1,"offset":33691},"end":{"line":1086,"column":39,"offset":33729},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"node.kubernetes.io/network-unavailable","position":{"start":{"line":1087,"column":5,"offset":33734},"end":{"line":1087,"column":43,"offset":33772},"indent":[]}}],"position":{"start":{"line":1087,"column":3,"offset":33732},"end":{"line":1087,"column":45,"offset":33774},"indent":[]}}],"position":{"start":{"line":1087,"column":3,"offset":33732},"end":{"line":1087,"column":45,"offset":33774},"indent":[]}}],"position":{"start":{"line":1087,"column":1,"offset":33730},"end":{"line":1087,"column":45,"offset":33774},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"node.kubernetes.io/unschedulable","position":{"start":{"line":1088,"column":5,"offset":33779},"end":{"line":1088,"column":37,"offset":33811},"indent":[]}}],"position":{"start":{"line":1088,"column":3,"offset":33777},"end":{"line":1088,"column":39,"offset":33813},"indent":[]}}],"position":{"start":{"line":1088,"column":3,"offset":33777},"end":{"line":1088,"column":39,"offset":33813},"indent":[]}}],"position":{"start":{"line":1088,"column":1,"offset":33775},"end":{"line":1088,"column":39,"offset":33813},"indent":[]}}],"position":{"start":{"line":1082,"column":1,"offset":33541},"end":{"line":1088,"column":39,"offset":33813},"indent":[1,1,1,1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"3.15 Customer Resource Definitions (CRDs)","position":{"start":{"line":1090,"column":4,"offset":33818},"end":{"line":1090,"column":45,"offset":33859},"indent":[]}}],"position":{"start":{"line":1090,"column":1,"offset":33815},"end":{"line":1090,"column":45,"offset":33859},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Let's you extend Kubernetes API.","position":{"start":{"line":1092,"column":3,"offset":33863},"end":{"line":1092,"column":35,"offset":33895},"indent":[]}}],"position":{"start":{"line":1092,"column":3,"offset":33863},"end":{"line":1092,"column":35,"offset":33895},"indent":[]}}],"position":{"start":{"line":1092,"column":1,"offset":33861},"end":{"line":1092,"column":35,"offset":33895},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Resources are the endpoints in the Kubernetes API that store collections of API Objects (ie Deployment, LoadBalancer).","position":{"start":{"line":1093,"column":3,"offset":33898},"end":{"line":1093,"column":121,"offset":34016},"indent":[]}}],"position":{"start":{"line":1093,"column":3,"offset":33898},"end":{"line":1093,"column":121,"offset":34016},"indent":[]}}],"position":{"start":{"line":1093,"column":1,"offset":33896},"end":{"line":1093,"column":121,"offset":34016},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Operators use CRDs to extend the Kubernetes API with their own functionality.","position":{"start":{"line":1094,"column":3,"offset":34019},"end":{"line":1094,"column":80,"offset":34096},"indent":[]}}],"position":{"start":{"line":1094,"column":3,"offset":34019},"end":{"line":1094,"column":80,"offset":34096},"indent":[]}}],"position":{"start":{"line":1094,"column":1,"offset":34017},"end":{"line":1094,"column":80,"offset":34096},"indent":[]}}],"position":{"start":{"line":1092,"column":1,"offset":33861},"end":{"line":1094,"column":80,"offset":34096},"indent":[1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"3.16 Operators","position":{"start":{"line":1096,"column":4,"offset":34101},"end":{"line":1096,"column":18,"offset":34115},"indent":[]}}],"position":{"start":{"line":1096,"column":1,"offset":34098},"end":{"line":1096,"column":18,"offset":34115},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"An ","position":{"start":{"line":1098,"column":1,"offset":34117},"end":{"line":1098,"column":4,"offset":34120},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"Operator","position":{"start":{"line":1098,"column":6,"offset":34122},"end":{"line":1098,"column":14,"offset":34130},"indent":[]}}],"position":{"start":{"line":1098,"column":4,"offset":34120},"end":{"line":1098,"column":16,"offset":34132},"indent":[]}},{"type":"text","value":" is a method of ","position":{"start":{"line":1098,"column":16,"offset":34132},"end":{"line":1098,"column":32,"offset":34148},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"packaging, deploying and managing","position":{"start":{"line":1098,"column":34,"offset":34150},"end":{"line":1098,"column":67,"offset":34183},"indent":[]}}],"position":{"start":{"line":1098,"column":32,"offset":34148},"end":{"line":1098,"column":69,"offset":34185},"indent":[]}},{"type":"text","value":" a Kubernetes Application.","position":{"start":{"line":1098,"column":69,"offset":34185},"end":{"line":1098,"column":95,"offset":34211},"indent":[]}}],"position":{"start":{"line":1098,"column":1,"offset":34117},"end":{"line":1098,"column":95,"offset":34211},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"It puts ","position":{"start":{"line":1100,"column":1,"offset":34213},"end":{"line":1100,"column":9,"offset":34221},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"operational knowledge","position":{"start":{"line":1100,"column":11,"offset":34223},"end":{"line":1100,"column":32,"offset":34244},"indent":[]}}],"position":{"start":{"line":1100,"column":9,"offset":34221},"end":{"line":1100,"column":34,"offset":34246},"indent":[]}},{"type":"text","value":" in an application.","position":{"start":{"line":1100,"column":34,"offset":34246},"end":{"line":1100,"column":53,"offset":34265},"indent":[]}}],"position":{"start":{"line":1100,"column":1,"offset":34213},"end":{"line":1100,"column":53,"offset":34265},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Brings the user ","position":{"start":{"line":1102,"column":3,"offset":34269},"end":{"line":1102,"column":19,"offset":34285},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"closer to the experience of managed cloud services","position":{"start":{"line":1102,"column":21,"offset":34287},"end":{"line":1102,"column":71,"offset":34337},"indent":[]}}],"position":{"start":{"line":1102,"column":19,"offset":34285},"end":{"line":1102,"column":73,"offset":34339},"indent":[]}},{"type":"text","value":", rather than having to know all the specifics of an application deployed to Kubernetes.","position":{"start":{"line":1102,"column":73,"offset":34339},"end":{"line":1102,"column":161,"offset":34427},"indent":[]}}],"position":{"start":{"line":1102,"column":3,"offset":34269},"end":{"line":1102,"column":161,"offset":34427},"indent":[]}}],"position":{"start":{"line":1102,"column":1,"offset":34267},"end":{"line":1102,"column":161,"offset":34427},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Once an Operator is deployed, it can be ","position":{"start":{"line":1103,"column":3,"offset":34430},"end":{"line":1103,"column":43,"offset":34470},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"managed using Custom Resource Definitions","position":{"start":{"line":1103,"column":45,"offset":34472},"end":{"line":1103,"column":86,"offset":34513},"indent":[]}}],"position":{"start":{"line":1103,"column":43,"offset":34470},"end":{"line":1103,"column":88,"offset":34515},"indent":[]}},{"type":"text","value":" (arbitraty types that extend the Kubernetes API).","position":{"start":{"line":1103,"column":88,"offset":34515},"end":{"line":1103,"column":138,"offset":34565},"indent":[]}}],"position":{"start":{"line":1103,"column":3,"offset":34430},"end":{"line":1103,"column":138,"offset":34565},"indent":[]}}],"position":{"start":{"line":1103,"column":1,"offset":34428},"end":{"line":1103,"column":138,"offset":34565},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"It also provides a great way to deploy Stateful applications to Kubernetes.","position":{"start":{"line":1104,"column":3,"offset":34568},"end":{"line":1104,"column":78,"offset":34643},"indent":[]}}],"position":{"start":{"line":1104,"column":3,"offset":34568},"end":{"line":1104,"column":78,"offset":34643},"indent":[]}}],"position":{"start":{"line":1104,"column":1,"offset":34566},"end":{"line":1104,"column":78,"offset":34643},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"There are operators for Prometheus, Valut, Rook (storage), MySQL, PostgresSQL and so on.","position":{"start":{"line":1105,"column":3,"offset":34646},"end":{"line":1105,"column":91,"offset":34734},"indent":[]}}],"position":{"start":{"line":1105,"column":3,"offset":34646},"end":{"line":1105,"column":91,"offset":34734},"indent":[]}}],"position":{"start":{"line":1105,"column":1,"offset":34644},"end":{"line":1105,"column":91,"offset":34734},"indent":[]}}],"position":{"start":{"line":1102,"column":1,"offset":34267},"end":{"line":1105,"column":91,"offset":34734},"indent":[1,1,1]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"PostgreSQL Operator Demo","position":{"start":{"line":1107,"column":5,"offset":34740},"end":{"line":1107,"column":29,"offset":34764},"indent":[]}}],"position":{"start":{"line":1107,"column":1,"offset":34736},"end":{"line":1107,"column":29,"offset":34764},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"If you just deploy a PostgreSQL container, it'd only start the database. But if you're going to use this ","position":{"start":{"line":1109,"column":1,"offset":34766},"end":{"line":1109,"column":106,"offset":34871},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"operator","position":{"start":{"line":1109,"column":108,"offset":34873},"end":{"line":1109,"column":116,"offset":34881},"indent":[]}}],"position":{"start":{"line":1109,"column":106,"offset":34871},"end":{"line":1109,"column":118,"offset":34883},"indent":[]}},{"type":"text","value":", it'll allow you to also ","position":{"start":{"line":1109,"column":118,"offset":34883},"end":{"line":1109,"column":144,"offset":34909},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"create replicas, initiate a failover, create backups, scale","position":{"start":{"line":1109,"column":146,"offset":34911},"end":{"line":1109,"column":205,"offset":34970},"indent":[]}}],"position":{"start":{"line":1109,"column":144,"offset":34909},"end":{"line":1109,"column":207,"offset":34972},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":1109,"column":207,"offset":34972},"end":{"line":1109,"column":208,"offset":34973},"indent":[]}}],"position":{"start":{"line":1109,"column":1,"offset":34766},"end":{"line":1109,"column":208,"offset":34973},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"An operator contains a lot of the ","position":{"start":{"line":1111,"column":3,"offset":34977},"end":{"line":1111,"column":37,"offset":35011},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"management logic","position":{"start":{"line":1111,"column":39,"offset":35013},"end":{"line":1111,"column":55,"offset":35029},"indent":[]}}],"position":{"start":{"line":1111,"column":37,"offset":35011},"end":{"line":1111,"column":57,"offset":35031},"indent":[]}},{"type":"text","value":" that you as an administrator or user might want, rather than having to implement it yourself.","position":{"start":{"line":1111,"column":57,"offset":35031},"end":{"line":1111,"column":151,"offset":35125},"indent":[]}}],"position":{"start":{"line":1111,"column":3,"offset":34977},"end":{"line":1111,"column":151,"offset":35125},"indent":[]}}],"position":{"start":{"line":1111,"column":1,"offset":34975},"end":{"line":1111,"column":151,"offset":35125},"indent":[]}}],"position":{"start":{"line":1111,"column":1,"offset":34975},"end":{"line":1111,"column":151,"offset":35125},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Intro to kubeadm","position":{"start":{"line":1114,"column":4,"offset":35131},"end":{"line":1114,"column":20,"offset":35147},"indent":[]}}],"position":{"start":{"line":1114,"column":1,"offset":35128},"end":{"line":1114,"column":20,"offset":35147},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"This is an alternative to running Kubernetes that is not using ","position":{"start":{"line":1116,"column":1,"offset":35149},"end":{"line":1116,"column":64,"offset":35212},"indent":[]}},{"type":"inlineCode","value":"kops","position":{"start":{"line":1116,"column":64,"offset":35212},"end":{"line":1116,"column":70,"offset":35218},"indent":[]}}],"position":{"start":{"line":1116,"column":1,"offset":35149},"end":{"line":1116,"column":70,"offset":35218},"indent":[]}},{"type":"export","value":"export const _frontmatter = {}","position":{"start":{"line":1118,"column":1,"offset":35220},"end":{"line":1118,"column":31,"offset":35250},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":1118,"column":31,"offset":35250}}},"scopeImports":[],"scopeIdentifiers":[],"rawMDXOutput":"/* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\nimport DefaultLayout from \"/Users/dennis.okeeffe/Project-Imposter/developer-notes/node_modules/gatsby-theme-docz/src/base/Layout.js\"\nexport const _frontmatter = {};\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\")\n  return <div {...props}/>\n};\n\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1 {...{\n      \"id\": \"advanced-topics\"\n    }}>{`Advanced Topics`}</h1>\n    <h2 {...{\n      \"id\": \"service-discovery\"\n    }}>{`Service Discovery`}</h2>\n    <p>{`As of Kubernetes 1.3, DNS is a `}<inlineCode parentName=\"p\">{`built-in`}</inlineCode>{` service launched automatically using the addon manager.`}</p>\n    <p>{`The addons are in the `}<inlineCode parentName=\"p\">{`/etc/kubernetes/addons`}</inlineCode>{` directory on the master node.`}</p>\n    <p>{`The service can be used within pods to find other services running on the same cluster.`}</p>\n    <p>{`Multiple containers within 1 pod don't need this service, as they can contact each other directly. A container in the same pod can just use `}<inlineCode parentName=\"p\">{`localhost:port`}</inlineCode>{`.`}</p>\n    <p>{`To make DNS work, a pod will need a `}<inlineCode parentName=\"p\">{`service definition`}</inlineCode>{`.`}</p>\n    <p>{`How can app 1 reach app 2 using DNS? The container itself can talk to the service of App 2.`}</p>\n    <p>{`If you ran the host for `}<inlineCode parentName=\"p\">{`app1-service`}</inlineCode>{` and got back 10.0.0.1, `}<inlineCode parentName=\"p\">{`host app2-service`}</inlineCode>{` could get back 10.0.0.2.`}</p>\n    <p>{`Examples from the CL`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`host app1-service\n# has addr 10.0.0.1\nhost app2-service\n# has addr 10.0.0.2\nhost app2-service.default\n# app2-service.default has address 10.0.0.2\nhost app2-service.default.svc.cluster.local\n# app2-service.default.svc.cluster.local has addr 10.0.0.2\n`}</code></pre>\n    <p>{`The `}<inlineCode parentName=\"p\">{`default`}</inlineCode>{` stands for default namespace. Pods and services can be launched in different namespaces (to logically seperate your cluster).`}</p>\n    <p>{`So how does this resolution work?`}</p>\n    <p>{`Say we have a pod and we run `}<inlineCode parentName=\"p\">{`kubectl run -i -tty busybox --image=busybox --restart=Never -- sh`}</inlineCode>{` and the from the shell run `}<inlineCode parentName=\"p\">{`cat /etc/resolv.conf`}</inlineCode>{`, can can see that there will be a `}<inlineCode parentName=\"p\">{`nameserver`}</inlineCode>{`. If you do a lookup of the service name in this folder, you'll see why the above works with `}<inlineCode parentName=\"p\">{`.default`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`.default.svc.whatever`}</inlineCode>{`.`}</p>\n    <h3 {...{\n      \"id\": \"demo-service-discovery\"\n    }}>{`Demo: Service Discovery`}</h3>\n    <p>{`After creating a secrets type, pod type for a database (SQL using the secrets), and a service for exposing certain ports for the database and then deploying three replicas for a `}<inlineCode parentName=\"p\">{`helloworld-deployment`}</inlineCode>{` that also has a `}<inlineCode parentName=\"p\">{`index-db.js`}</inlineCode>{` file which we run `}<inlineCode parentName=\"p\">{`node index-db.js`}</inlineCode>{` which will have code that works on the service. The value of the `}<inlineCode parentName=\"p\">{`MYSQL_HOST`}</inlineCode>{` being set to `}<inlineCode parentName=\"p\">{`database-service`}</inlineCode>{` will resolve with the database-service.yml file where the metadata `}<inlineCode parentName=\"p\">{`name`}</inlineCode>{` is `}<inlineCode parentName=\"p\">{`database-service`}</inlineCode>{`.`}</p>\n    <p>{`Running `}<inlineCode parentName=\"p\">{`kubectl get pod`}</inlineCode>{` we should see the database plus 3 pods running for the deployment.`}</p>\n    <p>{`Running `}<inlineCode parentName=\"p\">{`kubectl logs [deployment-name]`}</inlineCode>{` will also show us the logs for that pod.`}</p>\n    <p>{`Again, remember that running `}<inlineCode parentName=\"p\">{`kubectl get svc`}</inlineCode>{` will get all the services available.`}</p>\n    <h2 {...{\n      \"id\": \"configmap\"\n    }}>{`ConfigMap`}</h2>\n    <p>{`Config params that are not secret can be put in the ConfigMap.`}</p>\n    <p>{`The input is again key-value pairs.`}</p>\n    <p>{`The `}<inlineCode parentName=\"p\">{`ConfigMap`}</inlineCode>{` key-value pairs can then be read by the app using:`}</p>\n    <ol>\n      <li parentName=\"ol\">{`Env variables`}</li>\n      <li parentName=\"ol\">{`Container commandline args in the Pod config`}</li>\n      <li parentName=\"ol\">{`Using volumes`}</li>\n    </ol>\n    <p>{`It can also contain full config files eg. a webserver config file. Then that file can then be mounted using volumes where the application expects its config file.`}</p>\n    <p>{`This was you can `}<inlineCode parentName=\"p\">{`inject`}</inlineCode>{` config settings into containers without changing the container itself.`}</p>\n    <p>{`To generate a configmap using files:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`$ cat << EOF > app.properties\ndriver=jdbc\ndatabase=postgres\nlookandfeel=1\notherparams=xyz\nparam.with.hierarchy=xyz\nEOF\n$ kubectl create configmap app-config --from-file=app.properties\n`}</code></pre>\n    <p>{`How to use it? You can create a pod that exposes the ConfigMap using a volume.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`# pod-helloworld.yml w/ secrets\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nodehelloworld.example.com\n  labels:\n  app: helloworld\nspec:\n  # The containers are listed here\n  containers:\n  - name: k8s-demo\n  image: okeeffed/docker-demo\n  ports:\n  - containerPort: 3000\n  # @@@ This are the envs in a volume mount\n  volumeMounts:\n  - name: credvolume\n    mountPath: /etc/creds\n    readOnly: true\n  # @@@ For the ConfigMap\n  - name: config-volume\n    mountPath: /etc/config\n  volumes:\n  - name: credvolume\n  secret:\n    secretName: db-secrets\n  # @@@ For the ConfigMap\n  - name: config-volume\n  configMap:\n    name: app-config\n`}</code></pre>\n    <p>{`From `}<inlineCode parentName=\"p\">{`/etc/config`}</inlineCode>{` , the config values will be stored in files at `}<inlineCode parentName=\"p\">{`/etc/config/driver`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`/etc/config/param/with/hierarchy`}</inlineCode>{`.`}</p>\n    <p>{`This is an example of a pod that exposes the ConfigMap as env variables:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`# pod-helloworld.yml w/ secrets\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nodehelloworld.example.com\n  labels:\n  app: helloworld\nspec:\n  # The containers are listed here\n  containers:\n  - name: k8s-demo\n  image: okeeffed/docker-demo\n  ports:\n  - containerPort: 3000\n  # @@@ This are the envs in a volume mount\n  env:\n  - name: DRIVER\n    valueFrom: # where you get the value from\n    configMapKeyRef: # ensuring the ref comes from the configMap\n    name: app-config\n    key: driver\n  - name: DATABASE\n  [ ... ]\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"demo-config-map\"\n    }}>{`Demo: Config Map`}</h3>\n    <p>{`Using an example for a reverse proxy config for NGINX:`}</p>\n    <pre><code parentName=\"pre\" {...{}}>{`server {\n  listen  80;\n  server_name localhost;\n\n  location / {\n  proxy_bind 127.0.0.1;\n  proxy_pass http://127.0.0.1:3000;\n  }\n\n  error_page  500 502 503 504 /50x.html;\n  location = /50x.html {\n  root    /usr/share/nginx/html;\n  }\n}\n`}</code></pre>\n    <p>{`We could then create this config map with `}<inlineCode parentName=\"p\">{`kubectl create configmap nginx-config --from-file=reverseproxy.conf`}</inlineCode>{`.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`# pod-helloworld.yml w/ secrets\napiVersion: v1\nkind: Pod\nmetadata:\n  name: hellonginx.example.com\n  labels:\n  app: hellonginx\nspec:\n  # The containers are listed here\n  containers:\n    - name: nginx\n    image: nginx:1.11\n    ports:\n    - containerPort: 80\n    # @@@ The import conf stuff\n    volumeMounts:\n    - name: config-volume\n        mountPath: /etc/nginx/conf.d\n  - name: k8s-demo\n  image: okeeffed/docker-demo\n  ports:\n    - containerPort: 3000\n  # @@@ The important mounting\n  volumes:\n    - name: config-volume # @@@ this is referred to above in volumeMounts\n    configMap:\n        name: nginx-config\n        items:\n        - key: reverseproxy.conf\n        path: reverseproxy.conf\n`}</code></pre>\n    <p>{`After then also creating the service, we can grab the minikube service url and use curl to get info on that request. From here, would could see that it is `}<inlineCode parentName=\"p\">{`nginx`}</inlineCode>{` answer the request and transferring it to the Node port.`}</p>\n    <p>{`If we then want to jump into the nginx container to see what is going on, we can run `}<inlineCode parentName=\"p\">{`kubectl exec -i -t helloworld-nginx -c nginx -- bash`}</inlineCode>{` (-c flag to specify container) and run `}<inlineCode parentName=\"p\">{`ps x`}</inlineCode>{` to see the processes and we can `}<inlineCode parentName=\"p\">{`cat /etc/nginx/conf.d/reverseproxy.conf`}</inlineCode>{`.`}</p>\n    <p>{`At this stage, we can enable SSL for NGINX.`}</p>\n    <h2 {...{\n      \"id\": \"ingress-controller\"\n    }}>{`Ingress Controller`}</h2>\n    <p>{`Ingress a solution since Kub 1.1 that allows inbound connections to the cluster.`}</p>\n    <p>{`It's an alternative to the external `}<inlineCode parentName=\"p\">{`LoadBalancer`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`nodePorts`}</inlineCode>{`. It allows you to easily expose services that need to be accessible from outside to the cluster.`}</p>\n    <p>{`With ingress you can run your own ingress controller (basically a loudbalancer) within the Kub Cluster.`}</p>\n    <p>{`There are default ingress controller available, or you can write your own ingress controller.`}</p>\n    <p>{`How does it work? If you connect over 80/443 you will first hit the `}<inlineCode parentName=\"p\">{`Ingress Controller`}</inlineCode>{`. You can use the NGINX controller that comes with Kubernetes. That controller will the dirrect all the traffic.`}</p>\n    <p>{`The `}<inlineCode parentName=\"p\">{`ingress rules`}</inlineCode>{` could define that if you go to `}<inlineCode parentName=\"p\">{`host-x.example.com`}</inlineCode>{` you go to `}<inlineCode parentName=\"p\">{`Pod 1`}</inlineCode>{` etc. You can even redirect slash URLs specifically.`}</p>\n    <p>{`To create an Ingress Controller:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`# ingress-controller.yml w/ secrets\napiVersion: extensions/v1beta1\nkind: Ingress\nmetadata:\n  name: helloworld-rules\nspec:\n  # @@@ Setting the important rules\n  rules:\n    - host: helloworld-v1.example.com\n      http:\n        paths:\n          - path: /\n          backend:\n            serviceName: helloworld-v1\n            servicePort: 80\n    - host: helloworld-v2.example.com\n      http:\n        paths:\n          - path: /\n          backend:\n            serviceName: helloworld-v2\n            servicePort: 80\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"demo-ingress-controller\"\n    }}>{`Demo: Ingress Controller`}</h3>\n    <p>{`In the example, the ingress controller is a `}<inlineCode parentName=\"p\">{`Replication Controller`}</inlineCode>{` to ensure that there is always one up and running.`}</p>\n    <p>{`After deploying, if we curl with the -H host flag with `}<inlineCode parentName=\"p\">{`helloworld-v1.whatever.com`}</inlineCode>{` and v2 respectively, it would have the ingress controller route to each server.`}</p>\n    <h2 {...{\n      \"id\": \"external-dns\"\n    }}>{`External DNS`}</h2>\n    <p>{`On public cloud providers, you can use the ingress controller to `}<strong parentName=\"p\">{`reduce the cost of your LoadBalancers`}</strong>{`.`}</p>\n    <ul>\n      <li parentName=\"ul\">{`You could use 1 LoadBalancer that captures all the external traffic and send it to the ingress controller.`}</li>\n      <li parentName=\"ul\">{`IngCont can be configured to route the different traffic to all your apps based on HTTP rules.`}</li>\n      <li parentName=\"ul\">{`Only works for HTTP(s)-based apps`}</li>\n    </ul>\n    <p>{`The External DNS tool will automatically create the necessary DNS records in your external DNS server (like route53).`}</p>\n    <ul>\n      <li parentName=\"ul\">{`For every hostname used in ingress, it'll create a new record to send traffic to load balancer.`}</li>\n      <li parentName=\"ul\">{`The major DNS providers are supported: Route53, Google CloudDNS, CloudFlare etc.`}</li>\n    </ul>\n    <p><img alt=\"Diagram\" src=\"https://res.cloudinary.com/gitgoodclub/image/upload/v1539998347/Screen_Shot_2018-10-20_at_12.18.14_pm.png\" /></p>\n    <h2 {...{\n      \"id\": \"volumes\"\n    }}>{`Volumes`}</h2>\n    <p>{`How can we run stateful apps?`}</p>\n    <p>{`Volumes in kubernetes allow you to store data outside of the container. So far, all the applications have been stateless for this reason. This can be done with external services like a database, caching server (eg MySQL, AWS S3).`}</p>\n    <p>{`Persistent Volumes in Kubernetes allow you to attach a volume to a container that exists even when the container stops. Volumes can be attached using different volume plugins. Eg local volume, EBS Storage etc.`}</p>\n    <h3 {...{\n      \"id\": \"using-ebs-storage\"\n    }}>{`Using EBS Storage`}</h3>\n    <p>{`With this, we can keep state. You could run a `}<inlineCode parentName=\"p\">{`MySQL`}</inlineCode>{` database using persistent volumes, although this may not be ready for production yet.`}</p>\n    <p>{`The use case is that if your node stops working, the pod can be rescheduled on another node, and the volume can be attached to the new node.`}</p>\n    <p>{`To use volumes, you first need to create the volume:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`aws ec2 create-volume --sze 1- --region us-east-1 --availability-zone us-east-1 --volume-type gp2\n`}</code></pre>\n    <p>{`Next, we need to create a pod with a volume def:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`# pod-helloworld.yml w/ secrets\napiVersion: v1\nkind: Pod\nmetadata:\n  name: hellonginx.example.com\n  labels:\n  app: hellonginx\nspec:\n  # The containers are listed here\n  containers:\n    - name: k8s-demo\n    image: okeeffed/k8s-demo\n    volumeMounts:\n    - name: myvolume\n      mountPath: myvolume\n  # @@@ The important mounting\n  volumes:\n    - name: myvolume # @@@ this is referred to above in volumeMounts\n      awsElasticBlockStore:\n        volumeID: vol-9835id\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"demo-volumes\"\n    }}>{`Demo: Volumes`}</h3>\n    <p>{`Using Vagrant for kops, we can first create a volume using the above mentioned command.`}</p>\n    <p>{`After receiving a response, you can replace the .yml pod definition config file to attach that volumeID. Once the deployment is created and deployed. `}</p>\n    <ul>\n      <li parentName=\"ul\">{`After create and confirmation, we can get the pod name `}<inlineCode parentName=\"li\">{`kubectl get pod`}</inlineCode>{` and attach `}<inlineCode parentName=\"li\">{`kubectl exec helloworld-deployment-923id -i -t -- bash`}</inlineCode>{` and then run `}<inlineCode parentName=\"li\">{`ls -ahl /myvol/`}</inlineCode>{` to check for volume.`}</li>\n      <li parentName=\"ul\">{`If we run `}<inlineCode parentName=\"li\">{`echo 'test' > /myvol/myvol.txt`}</inlineCode>{` and `}<inlineCode parentName=\"li\">{`echo 'test 2' > /test.txt`}</inlineCode>{`, we know that the latter file will not persist if the pod is restarted/rescheduled.`}</li>\n      <li parentName=\"ul\">{`If we run `}<inlineCode parentName=\"li\">{`kubectl drain ip --force`}</inlineCode>{` we can drain the pod. Assuming this is a `}<inlineCode parentName=\"li\">{`Replication Controller`}</inlineCode>{` or `}<inlineCode parentName=\"li\">{`Deployment`}</inlineCode>{`, another container should spin up.`}</li>\n      <li parentName=\"ul\">{`Once that pod is attached to another node, we can also attach back to the pod on the new node with the `}<inlineCode parentName=\"li\">{`exec`}</inlineCode>{` command and we can confirm that the `}<inlineCode parentName=\"li\">{`/myvol/myvol.txt`}</inlineCode>{` is still there, although the other `}<inlineCode parentName=\"li\">{`/test.txt`}</inlineCode>{` is no longer there since it was not saved to the volume.`}</li>\n    </ul>\n    <p>{`If you need to remove the ebs volume, you can run `}<inlineCode parentName=\"p\">{`aws ec2 delete-volume --volume-id vol-[id]`}</inlineCode>{`.`}</p>\n    <h2 {...{\n      \"id\": \"volume-provisioning\"\n    }}>{`Volume Provisioning`}</h2>\n    <p>{`The kubs plugins have the capability to `}<inlineCode parentName=\"p\">{`provision storage`}</inlineCode>{` for you. The AWS Plugin can for instance `}<inlineCode parentName=\"p\">{`provision storage`}</inlineCode>{` for you by creating the volumes in AWS before attaching them to a node.`}</p>\n    <p>{`This is done using the `}<inlineCode parentName=\"p\">{`StorageClass`}</inlineCode>{` object -- this is beta for the course but should be stable soon.`}</p>\n    <p>{`To use autoprovisioing, create the following:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`# storage.yml\nkind: StorageClass\napiVersion: storage.k8s.io/v1\nmetadata:\n  name: standard\nprovisioner: kubernetes.io/aws-ebs\nparameters:\n  type: gp2\n  zone: ap-southeast-1\n`}</code></pre>\n    <p>{`Next, you can create a volume claim and specify the size:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`# my-volume-claim.yml\nkind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\n  name: myclaim\n  annotations:\n    volume.beta.kubernetes.io/storage-class: \"standard\"\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 8Gi\n`}</code></pre>\n    <p>{`Finally, if launching a pod:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`# pod-helloworld.yml w/ secrets\napiVersion: v1\nkind: Pod\nmetadata:\n  name: mypod\nspec:\n  # The containers are listed here\n  containers:\n    - name: myfrontend\n    image: nginx\n    volumeMounts:\n    - name: mypd\n      mountPath: '/var/www/html'\n  # @@@ The important mounting\n  volumes:\n    - name: mypd # @@@ this is referred to above in volumeMounts\n      persistentVolumeClaim:\n        claimName: myclaim # @@@ refers to my claim from the previous type definition\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"demo-using-wordpress-with-volumes\"\n    }}>{`Demo: Using Wordpress with Volumes`}</h2>\n    <p>{`After declaring a `}<inlineCode parentName=\"p\">{`StorageClass`}</inlineCode>{` class from a yaml file and a `}<inlineCode parentName=\"p\">{`PersistentVolumeClaim`}</inlineCode>{` class.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`# storage.yml\nkind: StorageClass\napiVersion: storage.k8s.io/v1beta1\nmetadata:\n  name: standard\nprovisioner: kubernetes.io/aws-ebs\nparameters:\n  type: gp2\n  zone: eu-west-1a\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`# PV Claim\nkind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\n  name: db-storage\n  annotations:\n    volume.beta.kubernetes.io/storage-class: \"standard\"\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 8Gi\n`}</code></pre>\n    <p>{`There is also a simple ReplicationController for the Wordpress DB. In the spe for the container for mysql, we declare where the `}<inlineCode parentName=\"p\">{`mountPath`}</inlineCode>{` will be.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`apiVersion: v1\nkind: ReplicationController\nmetadata:\n  name: wordpress-db\nspec:\n  replicas: 1\n  selector:\n    app: wordpress-db\n  template:\n    metadata:\n      name: wordpress-db\n      labels:\n        app: wordpress-db\n    spec:\n      containers:\n      - name: mysql\n        image: mysql:5.7\n        args:\n          - \"--ignore-db-dir=lost+found\"\n        ports:\n        - name: mysql-port\n          containerPort: 3306\n        env:\n          - name: MYSQL_ROOT_PASSWORD\n            valueFrom:\n              secretKeyRef:\n                name: wordpress-secrets\n                key: db-password\n        volumeMounts:\n        - mountPath: \"/var/lib/mysql\"\n          name: mysql-storage\n      volumes:\n        - name: mysql-storage\n          persistentVolumeClaim:\n            claimName: db-storage\n`}</code></pre>\n    <p>{`Having a makeshift secrets file for secrets:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`apiVersion: v1\nkind: Secret\nmetadata:\n  name: wordpress-secrets\ntype: Opaque\ndata:\n  db-password: cGFzc3dvcmQ=\n  # random sha1 strings - change all these lines\n  authkey: MTQ3ZDVhMTIzYmU1ZTRiMWQ1NzUyOWFlNWE2YzRjY2FhMDkyZGQ4OA==\n  loggedinkey: MTQ3ZDVhMTIzYmU1ZTRiMWQ1NzUyOWFlNWE2YzRjY2FhMDkyZGQ4OQ==\n  secureauthkey: MTQ3ZDVhMTIzYmU1ZTRiMWQ1NzUyOWFlNWE2YzRjY2FhMDkyZGQ5MQ==\n  noncekey: MTQ3ZDVhMTIzYmU1ZTRiMWQ1NzUyOWFlNWE2YzRjY2FhMDkyZGQ5MA==\n  authsalt: MTQ3ZDVhMTIzYmU1ZTRiMWQ1NzUyOWFlNWE2YzRjY2FhMDkyZGQ5Mg==\n  secureauthsalt: MTQ3ZDVhMTIzYmU1ZTRiMWQ1NzUyOWFlNWE2YzRjY2FhMDkyZGQ5Mw==\n  loggedinsalt: MTQ3ZDVhMTIzYmU1ZTRiMWQ1NzUyOWFlNWE2YzRjY2FhMDkyZGQ5NA==\n  noncesalt: MTQ3ZDVhMTIzYmU1ZTRiMWQ1NzUyOWFlNWE2YzRjY2FhMDkyZGQ5NQ==\n`}</code></pre>\n    <p>{`To open up the service for the port:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`apiVersion: v1\nkind: Service\nmetadata:\n  name: wordpress-db\nspec:\n  ports:\n  - port: 3306\n    protocol: TCP\n  selector:\n    app: wordpress-db\n  type: NodePort\n`}</code></pre>\n    <p>{`Opening up the web and web service:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`apiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: wordpress-deployment\nspec:\n  replicas: 2\n  template:\n    metadata:\n      labels:\n        app: wordpress\n    spec:\n      containers:\n      - name: wordpress\n        image: wordpress:4-php7.0\n        # uncomment to fix perm issue, see also https://github.com/kubernetes/kubernetes/issues/2630\n        # command: ['bash', '-c', 'chown www-data:www-data /var/www/html/wp-content/uploads && apache2-foreground']\n        ports:\n        - name: http-port\n          containerPort: 80\n        env:\n          - name: WORDPRESS_DB_PASSWORD\n            valueFrom:\n              secretKeyRef:\n                name: wordpress-secrets\n                key: db-password\n          - name: WORDPRESS_AUTH_KEY\n            valueFrom:\n              secretKeyRef:\n                name: wordpress-secrets\n                key: authkey\n          - name: WORDPRESS_LOGGED_IN_KEY\n            valueFrom:\n              secretKeyRef:\n                name: wordpress-secrets\n                key: loggedinkey\n          - name: WORDPRESS_SECURE_AUTH_KEY\n            valueFrom:\n              secretKeyRef:\n                name: wordpress-secrets\n                key: secureauthkey\n          - name: WORDPRESS_NONCE_KEY\n            valueFrom:\n              secretKeyRef:\n                name: wordpress-secrets\n                key: noncekey\n          - name: WORDPRESS_AUTH_SALT\n            valueFrom:\n              secretKeyRef:\n                name: wordpress-secrets\n                key: authsalt\n          - name: WORDPRESS_SECURE_AUTH_SALT\n            valueFrom:\n              secretKeyRef:\n                name: wordpress-secrets\n                key: secureauthsalt\n          - name: WORDPRESS_LOGGED_IN_SALT\n            valueFrom:\n              secretKeyRef:\n                name: wordpress-secrets\n                key: loggedinsalt\n          - name: WORDPRESS_NONCE_SALT\n            valueFrom:\n              secretKeyRef:\n                name: wordpress-secrets\n                key: noncesalt\n          - name: WORDPRESS_DB_HOST\n            value: wordpress-db\n        volumeMounts:\n        # shared storage for things like media\n        - mountPath: /var/www/html/wp-content/uploads\n          name: uploads\n      volumes:\n      - name: uploads\n        nfs:\n          server: eu-west-1a.fs-5714e89e.efs.eu-west-1.amazonaws.com\n          path: /\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`apiVersion: v1\nkind: Service\nmetadata:\n  name: wordpress\nspec:\n  ports:\n  - port: 80\n    targetPort: http-port\n    protocol: TCP\n  selector:\n    app: wordpress\n  type: LoadBalancer\n`}</code></pre>\n    <p>{`With the AWS Commandline, you can create a file system and mount target. For the fs, run `}<inlineCode parentName=\"p\">{`aws efs create-file-system --creation-token`}</inlineCode>{` and then after grabbing the file-system-id and subnet-id, you can run `}<inlineCode parentName=\"p\">{`aws efs create-mount-target --file-system-id <id> --security-groups <sg>`}</inlineCode>{`. Ensure in the above `}<inlineCode parentName=\"p\">{`nfs`}</inlineCode>{` volume you update the fs id.`}</p>\n    <h2 {...{\n      \"id\": \"pod-presets\"\n    }}>{`Pod Presets`}</h2>\n    <p>{`Pod presets can inject information into pods at runtime.`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Used to inject Kubernetes Resources like Secrets, ConfigMaps, Volumes and Environment variables. `}</li>\n    </ul>\n    <p>{`Imagine you have 20 apps to deploy, all with a specific credential. You can edit the 20 specs and add the creds, or you can use presets to create 1 `}<strong parentName=\"p\">{`Preset Object`}</strong>{`, which will `}<strong parentName=\"p\">{`inject an environment variable or config file to all matching pods.`}</strong></p>\n    <p>{`When injecting env vars and volume mounts, the Pod Preset will apply the changes to ll containers within the pod.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`# PodPreset File\napiVersion: settings.k8s.io/v1alpha1\nkind: PodPreset\nmetadata:\n  name: allow-database\nspec:\n  selector:\n    matchLabels:\n      role: frontend\n  env:\n    - name: DB_PORT\n      value: '6379'\n  volumeMounts:\n    - mountPath: /cache\n      name: cache-volume\n  volumes:\n    - name: cache-volume\n      emptyDir: {}\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yml\"\n      }}>{`# Pod file using PodPreset\napiVersion: v1\nkind: Pod\nmetadata:\n  name: website\n  labels:\n    app: website\n    role: frontend\nspec:\n  containers:\n    - name: website\n      image: nginx\n      ports:\n        - containerPort: 80\n\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`$ kubectl create -f pod-preset.yml\n$ kubectl create -f pod.yml\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"stateful-sets---formerly-pet-sets\"\n    }}>{`Stateful Sets - (formerly Pet Sets)`}</h2>\n    <p>{`Stateful dist apps - new feature from Kub 1.3.`}</p>\n    <p>{`It is introduced to be able to run `}<inlineCode parentName=\"p\">{`stateful applications`}</inlineCode>{` that need:`}</p>\n    <ol>\n      <li parentName=\"ol\">{`A stable pod hostname (instead of podname-randomstr) - will have an index ie podname-0, podname-1 etc.`}</li>\n      <li parentName=\"ol\">{`Stateful app requires multi pods with vols based on their ordinal number. Currently deleting and/or scaling a PetSet down will not deleted volumes associated.`}</li>\n    </ol>\n    <p>{`A pet set will allow your stateful app to use DNS to find out peers. One running node of the Pet Set is called a `}<inlineCode parentName=\"p\">{`Pet`}</inlineCode>{`. Using Pet Sets you can run for instance 5 cassandra nodes on Kubs named cass-1 until cass-5.`}</p>\n    <p>{`The big difference is that you don't want to connect just any specific service, you want to make sure pod whatever definitely connects to another pod.`}</p>\n    <p>{`This pet set also allows order to startup and teardown of pets.`}</p>\n    <p>{`Still a lot of work for future work.`}</p>\n    <h2 {...{\n      \"id\": \"daemon-sets\"\n    }}>{`Daemon Sets`}</h2>\n    <ul>\n      <li parentName=\"ul\">{`Ensure that every single node in the Kubernetes cluster runs the same pod resource. This is useful to ensure a certain pod is running on every single kubernetes node.`}</li>\n      <li parentName=\"ul\">{`When a node is added to the cluster, a new pod will be started automatically`}</li>\n      <li parentName=\"ul\">{`Same when a node is removed, the pod will not be rescheduled on another node`}</li>\n    </ul>\n    <p>{`Use cases:`}</p>\n    <ol>\n      <li parentName=\"ol\">{`Logging aggregators`}</li>\n      <li parentName=\"ol\">{`Monitoring`}</li>\n      <li parentName=\"ol\">{`Load Balancers/Reverse Proxies/API Gateways`}</li>\n    </ol>\n    <h2 {...{\n      \"id\": \"resource-usage-monitoring\"\n    }}>{`Resource Usage Monitoring`}</h2>\n    <ul>\n      <li parentName=\"ul\">{`Heapster enables `}<strong parentName=\"li\">{`Container Cluster Monitoring`}</strong>{` and `}<strong parentName=\"li\">{`Performance Analysis`}</strong>{`.`}</li>\n      <li parentName=\"ul\">{`It's providing a monitoring platform for Kubernetes.`}</li>\n      <li parentName=\"ul\">{`It's a prerequisite if you want to do `}<strong parentName=\"li\">{`pod auto-scaling`}</strong>{` in Kubernetes.`}</li>\n      <li parentName=\"ul\">{`Heapster exports cluster metrix `}<strong parentName=\"li\">{`via REST endpoints`}</strong>{`.`}</li>\n      <li parentName=\"ul\">{`You can use different backends with Heapster.`}<ul parentName=\"li\">\n          <li parentName=\"ul\">{`Demo uses `}<strong parentName=\"li\">{`InfluxDB`}</strong>{`, but Kafka is also possible.`}</li>\n        </ul></li>\n      <li parentName=\"ul\">{`Visualisations can be shown with Grafana. `}<ul parentName=\"li\">\n          <li parentName=\"ul\">{`Kubernetes dashboard will also show graphs once monitoring is enabled.`}</li>\n        </ul></li>\n      <li parentName=\"ul\">{`All these technologies can be started in pods`}</li>\n      <li parentName=\"ul\">{`The `}<strong parentName=\"li\">{`yaml files`}</strong>{` can be found on the github repo of Heapster.`}</li>\n    </ul>\n    <p>{`Since Heapster is now deprecated, you would have to use `}<inlineCode parentName=\"p\">{`metrics-server`}</inlineCode>{` or an alternative like `}<strong parentName=\"p\">{`Prometheus`}</strong>{`.`}</p>\n    <h2 {...{\n      \"id\": \"horiztonal-pod-autoscaling\"\n    }}>{`Horiztonal Pod Autoscaling`}</h2>\n    <p><a parentName=\"p\" {...{\n        \"href\": \"https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale-walkthrough/\"\n      }}>{`Link to main Kubernetes site`}</a></p>\n    <ul>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`Kubernetes has the possibility to autoscale pods based on metrics.`}</p>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`Kubernetes can autoscale Deployment, Replication Controller or ReplicaSet.`}</p>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`In Kubernetes 1.3 `}<strong parentName=\"p\">{`scaling based on CPU`}</strong>{` usage is possible out of the box.`}</p>\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">{`Application based metrics are also available (like queries per second or average request latency).`}<ul parentName=\"li\">\n              <li parentName=\"ul\">{`To enable, the cluster has to be started with env var ENABLE_CUSTOM_METRICS to be true.`}</li>\n            </ul></li>\n        </ul>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`It will periodically query the utilization for the targeted pods.`}</p>\n        <ul parentName=\"li\">\n          <li parentName=\"ul\">{`By default 30 sec, can be changed using the `}<inlineCode parentName=\"li\">{`--horizontal-pod-autoscaler-sync-period`}</inlineCode>{`flag when launching the controller manager.`}</li>\n        </ul>\n      </li>\n      <li parentName=\"ul\">\n        <p parentName=\"li\">{`Requires the metrics system to work.`}</p>\n      </li>\n    </ul>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`apiVersion: autoscaling/v1\nkind: HorizontalPodAutoscaler\nmetadata:\n  name: hpa-example-autoscaler\nspec:\n  scaleTargetRef:\n    apiVersion: extensions/v1beta1\n    kind: Deployment\n    name: hpa-example\n  minReplicas: 1\n  maxReplicas: 10\n  targetCPUUtilizationPercentage: 50\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"affinityanti-affinity\"\n    }}>{`Affinity/Anti-Affinity`}</h2>\n    <ul>\n      <li parentName=\"ul\">{`The affinity/anti-affinity feature allows you to do `}<strong parentName=\"li\">{`more complex scheduling`}</strong>{` than the nodeSelector and also `}<strong parentName=\"li\">{`works on Pods`}</strong>{`.`}<ul parentName=\"li\">\n          <li parentName=\"ul\">{`The language is `}<strong parentName=\"li\">{`more expressive`}</strong>{`.`}</li>\n          <li parentName=\"ul\">{`You can create `}<strong parentName=\"li\">{`rules that are not hard requirements`}</strong>{`, but rather a `}<strong parentName=\"li\">{`preferred rule`}</strong>{`, meaning that the scheduler will stil be able to schedule your pod, even if the rules cannot be met.`}</li>\n          <li parentName=\"ul\">{`You can create rules to take other pod labels into account`}<ul parentName=\"li\">\n              <li parentName=\"ul\">{`Example, you can make sure two different pods are never on the same node.`}</li>\n            </ul></li>\n        </ul></li>\n      <li parentName=\"ul\">{`Kubernetes can do `}<strong parentName=\"li\">{`node affinity`}</strong>{` and `}<strong parentName=\"li\">{`pod affinity/anti-affinity`}</strong>{`.`}<ul parentName=\"li\">\n          <li parentName=\"ul\">{`Node affinity is similar to the nodeSelector.`}</li>\n          <li parentName=\"ul\">{`Pod affinity/anti-affinity allows you to create rules `}<strong parentName=\"li\">{`how pods should be scheduled taking into account other running pods`}</strong>{`.`}</li>\n          <li parentName=\"ul\">{`Affinity/anti-affinity mechanism is only relevant during scheduling, once a pod is running, it'll need to be recreated to apply the rules again.`}</li>\n        </ul></li>\n      <li parentName=\"ul\">{`There are currently 2 types you can use for node affinity:`}<ul parentName=\"li\">\n          <li parentName=\"ul\">{`1) requiredDuringSchedulingIgnoredDuringExecution`}</li>\n          <li parentName=\"ul\">{`2) preferredDuringSchedulingIgnoredDuringExecution`}</li>\n        </ul></li>\n      <li parentName=\"ul\">{`The `}<strong parentName=\"li\">{`first one`}</strong>{` sets a `}<strong parentName=\"li\">{`hard requirement`}</strong>{` (like the nodeSelector).`}<ul parentName=\"li\">\n          <li parentName=\"ul\">{`The rules must be met before the pod can be scheduled.`}</li>\n        </ul></li>\n      <li parentName=\"ul\">{`The `}<strong parentName=\"li\">{`second type`}</strong>{` will try to enforce the rule, but it will not guarantee it.`}<ul parentName=\"li\">\n          <li parentName=\"ul\">{`Even if the rule is not met, the pod can still be scheduled, it's a soft requirement, a preference.`}</li>\n        </ul></li>\n    </ul>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: <% helloworld-deployment %>\nspec:\n  replicas: 2\n  template:\n    metadata:\n      labels:\n        app: <% app_name %>\n    spec:\n      affinity:\n        nodeAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            nodeSelectorTerms:\n              - matchExpressions:\n                  - key: env\n                    operator: In\n                    values:\n                      - dev\n          preferredDuringSchedulingIgnoredDuringExecution:\n            - weight: 1 # higher the weighting, the more emphasis on rule\n              preference:\n                matchExpressions:\n                  - key: team\n                    operator: In\n                    values:\n                      - engineering-project1\n      containers:\n        - name: k8s-demo\n          image: <% image_name %>\n          port:\n            - containerPort: 3000\n`}</code></pre>\n    <p>{`When scheduling, Kubernetes will score every node by summarizing the weightings per node.`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Eg two different rules with weights 1and 5.`}<ul parentName=\"li\">\n          <li parentName=\"ul\">{`If both rules match, score 6.`}</li>\n          <li parentName=\"ul\">{`If only rule with weight 1 matches, score 1.`}</li>\n        </ul></li>\n      <li parentName=\"ul\">{`The node that has the highest total score, that's where the pod will be scheduled on.`}</li>\n    </ul>\n    <h2 {...{\n      \"id\": \"313-interpod-affinityanti-affinity\"\n    }}>{`3.13 Interpod Affinity/Anti-Affinity`}</h2>\n    <ul>\n      <li parentName=\"ul\">{`This allows you to influence scheduling based on the labels of other pods that are `}<strong parentName=\"li\">{`already running`}</strong>{` on the cluster.`}</li>\n      <li parentName=\"ul\">{`Pods belong to a namespace, so rules apply to namespace (default to pod name).`}</li>\n    </ul>\n    <p>{`Two types:`}</p>\n    <ol>\n      <li parentName=\"ol\">{`requiredDuringSchedulingIgnoredDuringExecution`}</li>\n      <li parentName=\"ol\">{`preferredDuringSchedulingIgnoredDuringExecution`}</li>\n    </ol>\n    <p>{`The required type create rules that must be met for the pod to be scheduled, the preferred type is a \"soft\" type and the rules may be met.`}</p>\n    <p>{`A good use case for `}<strong parentName=\"p\">{`pod affinity is co-located pods`}</strong>{`.`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Example, you have an app that uses redis as cache and you want to have the Redis pod on the same node as the app itself.`}</li>\n      <li parentName=\"ul\">{`Another use-case is to co-locate pods within the `}<strong parentName=\"li\">{`same availability zone`}</strong>{`.`}</li>\n      <li parentName=\"ul\">{`When writing your pod affinity and anti-affinity rules, you need to specify a `}<strong parentName=\"li\">{`topology domain`}</strong>{`, called `}<strong parentName=\"li\">{`topologyKey`}</strong>{` in the rules.`}<ul parentName=\"li\">\n          <li parentName=\"ul\">{`Key refers to a node label.`}</li>\n          <li parentName=\"ul\">{`If affinity rule matches, `}<strong parentName=\"li\">{`new pod`}</strong>{` will only be scheduled on `}<strong parentName=\"li\">{`nodes`}</strong>{` that have the `}<strong parentName=\"li\">{`same topologyKey`}</strong>{` value as the `}<strong parentName=\"li\">{`current running pod`}</strong>{`.`}</li>\n        </ul></li>\n    </ul>\n    <p><img alt=\"Interpod Affinity and anti-affinity\" src=\"https://res.cloudinary.com/gitgoodclub/image/upload/v1540165720/Screen_Shot_2018-10-22_at_10.48.04_am.png\" /></p>\n    <p><img alt=\"Zone topology\" src=\"https://res.cloudinary.com/gitgoodclub/image/upload/v1540165853/Screen_Shot_2018-10-22_at_10.50.27_am.png\" /></p>\n    <h3 {...{\n      \"id\": \"anti-affinity\"\n    }}>{`Anti-affinity`}</h3>\n    <p>{`You can use anti-affinity to make sure a `}<strong parentName=\"p\">{`pod is only scehduled once on a node`}</strong>{`.`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Example 3 nodes and you want to schedule 2 pods but they shouldn't be on the same node.`}</li>\n      <li parentName=\"ul\">{`Pod anti-affinity allows you to create a rule that say to `}<strong parentName=\"li\">{`not schedule on the same host if a pod label matches`}</strong>{`.`}</li>\n    </ul>\n    <p><img alt=\"Anti-affinity\" src=\"https://res.cloudinary.com/gitgoodclub/image/upload/v1540165853/Screen_Shot_2018-10-22_at_10.50.27_am.png\" /></p>\n    <h3 {...{\n      \"id\": \"topology-operators\"\n    }}>{`Topology operators`}</h3>\n    <ul>\n      <li parentName=\"ul\">{`In`}</li>\n      <li parentName=\"ul\">{`NotIn`}</li>\n      <li parentName=\"ul\">{`Exists`}</li>\n      <li parentName=\"ul\">{`DoesNotExist`}</li>\n    </ul>\n    <p>{`Affinity requires a substantial amount of processor. Take this into account if you have a lot of rules.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`# pod-affinity.yml\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: pod-affinity-1\nspec:\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: pod-affinity-1\n    spec:\n      containers:\n      - name: k8s-demo\n        image: wardviaene/k8s-demo\n        ports:\n        - name: nodejs-port\n          containerPort: 3000\n---\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: pod-affinity-2\nspec:\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: pod-affinity-2\n    spec:\n      affinity:\n        podAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            - labelSelector:\n                matchExpressions:\n                  - key: \"app\"\n                    operator: In\n                    values:\n                    - pod-affinity-1\n              topologyKey: \"kubernetes.io/hostname\" # this could be change for zoning\n      containers:\n      - name: redis\n        image: redis\n        ports:\n        - name: redis-port\n          containerPort: 6379\n`}</code></pre>\n    <p>{`We can then check this is fine by running `}<inlineCode parentName=\"p\">{`kubectl get pod -o wide`}</inlineCode>{` to see the Node the pods are running on.`}</p>\n    <p>{`As for anti-affinity:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`apiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: pod-affinity-1\nspec:\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: pod-affinity-1\n    spec:\n      containers:\n      - name: k8s-demo\n        image: wardviaene/k8s-demo\n        ports:\n        - name: nodejs-port\n          containerPort: 3000\n---\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: pod-affinity-2\nspec:\n  replicas: 3\n  template:\n    metadata:\n      labels:\n        app: pod-affinity-2\n    spec:\n      affinity:\n        podAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            - labelSelector:\n                matchExpressions:\n                  - key: \"app\"\n                    operator: In\n                    values:\n                    - pod-affinity-1\n              topologyKey: \"kubernetes.io/hostname\"\n      containers:\n      - name: redis\n        image: redis\n        ports:\n        - name: redis-port\n          containerPort: 6379\n---\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: pod-affinity-3\nspec:\n  replicas: 3\n  template:\n    metadata:\n      labels:\n        app: pod-affinity-3\n    spec:\n      affinity:\n        podAntiAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            - labelSelector:\n                matchExpressions:\n                  - key: \"app\"\n                    operator: In\n                    values:\n                    - pod-affinity-1\n              topologyKey: \"kubernetes.io/hostname\"\n      containers:\n      - name: k8s-demo\n        image: wardviaene/k8s-demo\n        ports:\n        - name: nodejs-port\n          containerPort: 3000\n---\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: pod-affinity-4\nspec:\n  replicas: 1\n  template:\n    metadata:\n      labels:\n        app: pod-affinity-4\n    spec:\n      affinity:\n        podAntiAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            - labelSelector:\n                matchExpressions:\n                  - key: \"app\"\n                    operator: In\n                    values:\n                    - pod-affinity-1\n                    - pod-affinity-3\n              topologyKey: \"kubernetes.io/hostname\"\n      containers:\n      - name: k8s-demo\n        image: wardviaene/k8s-demo\n        ports:\n        - name: nodejs-port\n          containerPort: 3000\n---\n`}</code></pre>\n    <p><img alt=\"Resulting run with the affinity/anti-affinity\" src=\"https://res.cloudinary.com/gitgoodclub/image/upload/v1540170357/Screen_Shot_2018-10-22_at_12.05.28_pm.png\" /></p>\n    <p>{`Note that there are differences between `}<strong parentName=\"p\">{`preferred`}</strong>{` and `}<strong parentName=\"p\">{`required`}</strong>{`. With preferred, you may still have the pod scheduled in events we don't necessarily want as a best case scenario.`}</p>\n    <h2 {...{\n      \"id\": \"314-taints-and-tolerations\"\n    }}>{`3.14 Taints and Tolerations`}</h2>\n    <p>{`Tolerations is the opposite of node affinity.`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Allows a node to `}<strong parentName=\"li\">{`repels a set of pods`}</strong>{`.`}</li>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`Taints mark`}</strong>{` a node, tolerations are applied to pods to influence the scheduling of a pod.`}</li>\n      <li parentName=\"ul\">{`One use case for taints is to make sure that when you create a new pod, they're not scheduled on the master (`}<strong parentName=\"li\">{`node-role.kubernetes.io/master:NoSchedule`}</strong>{`). This is the default.`}</li>\n    </ul>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`# To add a taint\n$ kubectl taint nodes node1 key=value:NoSchedule # This will make sure that no pods will be scheduled on node1 as long as they don't have a matching toleration\n`}</code></pre>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`# tolerations.yml\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: tolerations-1\nspec:\n  replicas: 3\n  template:\n    metadata:\n      labels:\n        app: tolerations-1\n    spec:\n      containers:\n      - name: k8s-demo\n        image: wardviaene/k8s-demo\n        ports:\n        - name: nodejs-port\n          containerPort: 3000\n---\napiVersion: extensions/v1beta1\nkind: Deployment\nmetadata:\n  name: tolerations-2\nspec:\n  replicas: 3\n  template:\n    metadata:\n      labels:\n        app: tolerations-2\n    spec:\n      tolerations:\n      - key: \"type\"\n        operator: \"Equal\"\n        value: \"specialnode\"\n        effect: \"NoSchedule\"\n      containers:\n      - name: k8s-demo\n        image: wardviaene/k8s-demo\n        ports:\n        - name: nodejs-port\n          containerPort: 3000\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"tolerations-usage\"\n    }}>{`Tolerations usage`}</h3>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`# Taint a node\n$ kubectl taint nodes NODE-NAME type=specialnode:NoSchedule\n\n# Taint with NoExecute\n$ kubectl taint nodes NODE-NAME testkey=testvalue:NoExecute\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"keys\"\n    }}>{`Keys`}</h3>\n    <ul>\n      <li parentName=\"ul\">{`Operators`}<ul parentName=\"li\">\n          <li parentName=\"ul\"><strong parentName=\"li\">{`Equal`}</strong>{` (providing key + value)`}</li>\n          <li parentName=\"ul\"><strong parentName=\"li\">{`Exists`}</strong>{` (only providing a key, checking only whether a key exists)`}</li>\n        </ul></li>\n      <li parentName=\"ul\">{`Effects`}<ul parentName=\"li\">\n          <li parentName=\"ul\"><strong parentName=\"li\">{`NoSchedule`}</strong>{` (hard requirement that apod will not be scheduled unless there is a matching toleration)`}</li>\n          <li parentName=\"ul\"><strong parentName=\"li\">{`PreferNoSchedule`}</strong>{` (avoid placing a pod that doesn't have a matching tolerationg, but it's not a hard requirement)`}</li>\n          <li parentName=\"ul\"><strong parentName=\"li\">{`NoExecute`}</strong>{` (evict pods with non-matching tolerations)`}<ul parentName=\"li\">\n              <li parentName=\"ul\"><strong parentName=\"li\">{`tolerationSeconds`}</strong>{` key can be applied with a time in seconds for how long a node can run before it is evicted.`}</li>\n            </ul></li>\n        </ul></li>\n    </ul>\n    <h3 {...{\n      \"id\": \"use-cases\"\n    }}>{`Use Cases`}</h3>\n    <ul>\n      <li parentName=\"ul\">{`Existing node taints for `}<strong parentName=\"li\">{`master nodes`}</strong>{`.`}</li>\n      <li parentName=\"ul\">{`Taint nodes that are `}<strong parentName=\"li\">{`dedicated`}</strong>{` for a team or user.`}</li>\n      <li parentName=\"ul\">{`Node for `}<strong parentName=\"li\">{`specific hardware`}</strong>{` (ie GPUs) you can taint them to void running non-specific applications on those nodes.`}</li>\n      <li parentName=\"ul\">{`Alpha but soon-to-be beta feature is to `}<strong parentName=\"li\">{`taint nodes by condition`}</strong>{`.`}</li>\n    </ul>\n    <h3 {...{\n      \"id\": \"useful-taints-and-tolerations\"\n    }}>{`Useful Taints and Tolerations`}</h3>\n    <ul>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`node.kubernetes.io/not-ready`}</strong></li>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`node.kubernetes.io/unreachable`}</strong></li>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`node.kubernetes.io/out-of-disk`}</strong></li>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`node.kubernetes.io/memory-pressure`}</strong></li>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`node.kubernetes.io/disk-pressure`}</strong></li>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`node.kubernetes.io/network-unavailable`}</strong></li>\n      <li parentName=\"ul\"><strong parentName=\"li\">{`node.kubernetes.io/unschedulable`}</strong></li>\n    </ul>\n    <h2 {...{\n      \"id\": \"315-customer-resource-definitions-crds\"\n    }}>{`3.15 Customer Resource Definitions (CRDs)`}</h2>\n    <ul>\n      <li parentName=\"ul\">{`Let's you extend Kubernetes API.`}</li>\n      <li parentName=\"ul\">{`Resources are the endpoints in the Kubernetes API that store collections of API Objects (ie Deployment, LoadBalancer).`}</li>\n      <li parentName=\"ul\">{`Operators use CRDs to extend the Kubernetes API with their own functionality.`}</li>\n    </ul>\n    <h2 {...{\n      \"id\": \"316-operators\"\n    }}>{`3.16 Operators`}</h2>\n    <p>{`An `}<strong parentName=\"p\">{`Operator`}</strong>{` is a method of `}<strong parentName=\"p\">{`packaging, deploying and managing`}</strong>{` a Kubernetes Application.`}</p>\n    <p>{`It puts `}<strong parentName=\"p\">{`operational knowledge`}</strong>{` in an application.`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Brings the user `}<strong parentName=\"li\">{`closer to the experience of managed cloud services`}</strong>{`, rather than having to know all the specifics of an application deployed to Kubernetes.`}</li>\n      <li parentName=\"ul\">{`Once an Operator is deployed, it can be `}<strong parentName=\"li\">{`managed using Custom Resource Definitions`}</strong>{` (arbitraty types that extend the Kubernetes API).`}</li>\n      <li parentName=\"ul\">{`It also provides a great way to deploy Stateful applications to Kubernetes.`}</li>\n      <li parentName=\"ul\">{`There are operators for Prometheus, Valut, Rook (storage), MySQL, PostgresSQL and so on.`}</li>\n    </ul>\n    <h3 {...{\n      \"id\": \"postgresql-operator-demo\"\n    }}>{`PostgreSQL Operator Demo`}</h3>\n    <p>{`If you just deploy a PostgreSQL container, it'd only start the database. But if you're going to use this `}<strong parentName=\"p\">{`operator`}</strong>{`, it'll allow you to also `}<strong parentName=\"p\">{`create replicas, initiate a failover, create backups, scale`}</strong>{`.`}</p>\n    <ul>\n      <li parentName=\"ul\">{`An operator contains a lot of the `}<strong parentName=\"li\">{`management logic`}</strong>{` that you as an administrator or user might want, rather than having to implement it yourself.`}</li>\n    </ul>\n    <h2 {...{\n      \"id\": \"intro-to-kubeadm\"\n    }}>{`Intro to kubeadm`}</h2>\n    <p>{`This is an alternative to running Kubernetes that is not using `}<inlineCode parentName=\"p\">{`kops`}</inlineCode></p>\n\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;"}}