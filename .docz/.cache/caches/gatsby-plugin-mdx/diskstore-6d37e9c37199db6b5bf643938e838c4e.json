{"expireTime":9007200867335987000,"key":"gatsby-plugin-mdx-entire-payload-02baf57cd7c0e0b3452802620610b331-","val":{"mdast":{"type":"root","children":[{"type":"import","value":"import DefaultLayout from \"/Users/dennis.okeeffe/Project-Imposter/developer-notes/node_modules/gatsby-theme-docz/src/base/Layout.js\"","position":{"start":{"line":3,"column":1,"offset":2},"end":{"line":3,"column":133,"offset":134},"indent":[]}},{"type":"export","default":true,"value":"export default DefaultLayout","position":{"start":{"line":5,"column":1,"offset":136},"end":{"line":5,"column":29,"offset":164},"indent":[]}},{"type":"heading","depth":1,"children":[{"type":"text","value":"SQL","position":{"start":{"line":8,"column":3,"offset":169},"end":{"line":8,"column":6,"offset":172},"indent":[]}}],"position":{"start":{"line":8,"column":1,"offset":167},"end":{"line":8,"column":6,"offset":172},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Resources","position":{"start":{"line":10,"column":4,"offset":177},"end":{"line":10,"column":13,"offset":186},"indent":[]}}],"position":{"start":{"line":10,"column":1,"offset":174},"end":{"line":10,"column":13,"offset":186},"indent":[]}},{"type":"list","ordered":true,"start":1,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"link","title":null,"url":"https://btholt.github.io/complete-intro-to-databases/intro-to-sql-databases","children":[{"type":"text","value":"Complete Intro To Databases","position":{"start":{"line":12,"column":5,"offset":192},"end":{"line":12,"column":32,"offset":219},"indent":[]}}],"position":{"start":{"line":12,"column":4,"offset":191},"end":{"line":12,"column":110,"offset":297},"indent":[]}}],"position":{"start":{"line":12,"column":4,"offset":191},"end":{"line":12,"column":110,"offset":297},"indent":[]}}],"position":{"start":{"line":12,"column":1,"offset":188},"end":{"line":12,"column":110,"offset":297},"indent":[]}}],"position":{"start":{"line":12,"column":1,"offset":188},"end":{"line":12,"column":110,"offset":297},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"What is SQL?","position":{"start":{"line":14,"column":4,"offset":302},"end":{"line":14,"column":16,"offset":314},"indent":[]}}],"position":{"start":{"line":14,"column":1,"offset":299},"end":{"line":14,"column":16,"offset":314},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Pronounced through the letters instead of \"sequel\".","position":{"start":{"line":16,"column":1,"offset":316},"end":{"line":16,"column":52,"offset":367},"indent":[]}}],"position":{"start":{"line":16,"column":1,"offset":316},"end":{"line":16,"column":52,"offset":367},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"SQL means \"relational database\" (referring to relational database management systems).","position":{"start":{"line":18,"column":1,"offset":369},"end":{"line":18,"column":87,"offset":455},"indent":[]}}],"position":{"start":{"line":18,"column":1,"offset":369},"end":{"line":18,"column":87,"offset":455},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The best thing to think about is with \"excel\" with a table of data.","position":{"start":{"line":20,"column":1,"offset":457},"end":{"line":20,"column":68,"offset":524},"indent":[]}}],"position":{"start":{"line":20,"column":1,"offset":457},"end":{"line":20,"column":68,"offset":524},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"It has a defined and a very structured schema.","position":{"start":{"line":22,"column":1,"offset":526},"end":{"line":22,"column":47,"offset":572},"indent":[]}}],"position":{"start":{"line":22,"column":1,"offset":526},"end":{"line":22,"column":47,"offset":572},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"SQL databases are very good at describing relations. In things like Mongo, you do not want to join collections to other collections.","position":{"start":{"line":24,"column":1,"offset":574},"end":{"line":24,"column":133,"offset":706},"indent":[]}}],"position":{"start":{"line":24,"column":1,"offset":574},"end":{"line":24,"column":133,"offset":706},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"PostgresQL","position":{"start":{"line":26,"column":4,"offset":711},"end":{"line":26,"column":14,"offset":721},"indent":[]}}],"position":{"start":{"line":26,"column":1,"offset":708},"end":{"line":26,"column":14,"offset":721},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Enjoys a lot of market share and has some killer features.","position":{"start":{"line":28,"column":1,"offset":723},"end":{"line":28,"column":59,"offset":781},"indent":[]}}],"position":{"start":{"line":28,"column":1,"offset":723},"end":{"line":28,"column":59,"offset":781},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"For this course, Brian runs Postgres in a Docker container. After pulling the image, we can start a ","position":{"start":{"line":30,"column":1,"offset":783},"end":{"line":30,"column":101,"offset":883},"indent":[]}},{"type":"inlineCode","value":"hello-postgres","position":{"start":{"line":30,"column":101,"offset":883},"end":{"line":30,"column":117,"offset":899},"indent":[]}},{"type":"text","value":" container:","position":{"start":{"line":30,"column":117,"offset":899},"end":{"line":30,"column":128,"offset":910},"indent":[]}}],"position":{"start":{"line":30,"column":1,"offset":783},"end":{"line":30,"column":128,"offset":910},"indent":[]}},{"type":"code","lang":"s","meta":null,"value":"# Start the container\ndocker run --name hello-postgres -p 5432:5432 -e POSTGRES_PASSWORD=mysecretpassword -d --rm postgres\n# Attach to the container\ndocker exec -it -u postgres hello-postgres psql","position":{"start":{"line":32,"column":1,"offset":912},"end":{"line":37,"column":4,"offset":1117},"indent":[1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"In the new Postgres program, run the following to create a database and attach:","position":{"start":{"line":39,"column":1,"offset":1119},"end":{"line":39,"column":80,"offset":1198},"indent":[]}}],"position":{"start":{"line":39,"column":1,"offset":1119},"end":{"line":39,"column":80,"offset":1198},"indent":[]}},{"type":"code","lang":"s","meta":null,"value":"postgres=# CREATE DATABASE message_boards;\nCREATE DATABASE\n# \\c is short for `connect`\npostgres=# \\c message_boards;\nYou are now connected to database \"message_boards\" as user \"postgres\".","position":{"start":{"line":41,"column":1,"offset":1200},"end":{"line":47,"column":4,"offset":1396},"indent":[1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Other useful commands:","position":{"start":{"line":49,"column":1,"offset":1398},"end":{"line":49,"column":23,"offset":1420},"indent":[]}}],"position":{"start":{"line":49,"column":1,"offset":1398},"end":{"line":49,"column":23,"offset":1420},"indent":[]}},{"type":"table","align":[null,null],"children":[{"type":"tableRow","children":[{"type":"tableCell","children":[{"type":"text","value":"Command","position":{"start":{"line":51,"column":3,"offset":1424},"end":{"line":51,"column":10,"offset":1431},"indent":[]}}],"position":{"start":{"line":51,"column":3,"offset":1424},"end":{"line":51,"column":15,"offset":1436},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"Description","position":{"start":{"line":51,"column":18,"offset":1439},"end":{"line":51,"column":29,"offset":1450},"indent":[]}}],"position":{"start":{"line":51,"column":18,"offset":1439},"end":{"line":51,"column":59,"offset":1480},"indent":[]}}],"position":{"start":{"line":51,"column":1,"offset":1422},"end":{"line":51,"column":61,"offset":1482},"indent":[]}},{"type":"tableRow","children":[{"type":"tableCell","children":[{"type":"inlineCode","value":"\\c","position":{"start":{"line":53,"column":3,"offset":1546},"end":{"line":53,"column":7,"offset":1550},"indent":[]}}],"position":{"start":{"line":53,"column":3,"offset":1546},"end":{"line":53,"column":15,"offset":1558},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"Connect","position":{"start":{"line":53,"column":18,"offset":1561},"end":{"line":53,"column":25,"offset":1568},"indent":[]}}],"position":{"start":{"line":53,"column":18,"offset":1561},"end":{"line":53,"column":59,"offset":1602},"indent":[]}}],"position":{"start":{"line":53,"column":1,"offset":1544},"end":{"line":53,"column":61,"offset":1604},"indent":[]}},{"type":"tableRow","children":[{"type":"tableCell","children":[{"type":"inlineCode","value":"\\d","position":{"start":{"line":54,"column":3,"offset":1607},"end":{"line":54,"column":7,"offset":1611},"indent":[]}}],"position":{"start":{"line":54,"column":3,"offset":1607},"end":{"line":54,"column":15,"offset":1619},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"Show Tables","position":{"start":{"line":54,"column":18,"offset":1622},"end":{"line":54,"column":29,"offset":1633},"indent":[]}}],"position":{"start":{"line":54,"column":18,"offset":1622},"end":{"line":54,"column":59,"offset":1663},"indent":[]}}],"position":{"start":{"line":54,"column":1,"offset":1605},"end":{"line":54,"column":61,"offset":1665},"indent":[]}},{"type":"tableRow","children":[{"type":"tableCell","children":[{"type":"inlineCode","value":"\\?","position":{"start":{"line":55,"column":3,"offset":1668},"end":{"line":55,"column":7,"offset":1672},"indent":[]}}],"position":{"start":{"line":55,"column":3,"offset":1668},"end":{"line":55,"column":15,"offset":1680},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"Will show commands","position":{"start":{"line":55,"column":18,"offset":1683},"end":{"line":55,"column":36,"offset":1701},"indent":[]}}],"position":{"start":{"line":55,"column":18,"offset":1683},"end":{"line":55,"column":59,"offset":1724},"indent":[]}}],"position":{"start":{"line":55,"column":1,"offset":1666},"end":{"line":55,"column":61,"offset":1726},"indent":[]}},{"type":"tableRow","children":[{"type":"tableCell","children":[{"type":"inlineCode","value":"\\h","position":{"start":{"line":56,"column":3,"offset":1729},"end":{"line":56,"column":7,"offset":1733},"indent":[]}}],"position":{"start":{"line":56,"column":3,"offset":1729},"end":{"line":56,"column":15,"offset":1741},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"Displays kinds of queries that you can do","position":{"start":{"line":56,"column":18,"offset":1744},"end":{"line":56,"column":59,"offset":1785},"indent":[]}}],"position":{"start":{"line":56,"column":18,"offset":1744},"end":{"line":56,"column":59,"offset":1785},"indent":[]}}],"position":{"start":{"line":56,"column":1,"offset":1727},"end":{"line":56,"column":61,"offset":1787},"indent":[]}},{"type":"tableRow","children":[{"type":"tableCell","children":[{"type":"inlineCode","value":"-- [input]","position":{"start":{"line":57,"column":3,"offset":1790},"end":{"line":57,"column":15,"offset":1802},"indent":[]}}],"position":{"start":{"line":57,"column":3,"offset":1790},"end":{"line":57,"column":15,"offset":1802},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"How to do a comment","position":{"start":{"line":57,"column":18,"offset":1805},"end":{"line":57,"column":37,"offset":1824},"indent":[]}}],"position":{"start":{"line":57,"column":18,"offset":1805},"end":{"line":57,"column":59,"offset":1846},"indent":[]}}],"position":{"start":{"line":57,"column":1,"offset":1788},"end":{"line":57,"column":61,"offset":1848},"indent":[]}}],"position":{"start":{"line":51,"column":1,"offset":1422},"end":{"line":57,"column":61,"offset":1848},"indent":[1,1,1,1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Creating a database","position":{"start":{"line":59,"column":4,"offset":1853},"end":{"line":59,"column":23,"offset":1872},"indent":[]}}],"position":{"start":{"line":59,"column":1,"offset":1850},"end":{"line":59,"column":23,"offset":1872},"indent":[]}},{"type":"code","lang":"s","meta":null,"value":"message_boards=# CREATE TABLE users (\n# This is to autoincrement the IDs\nmessage_boards(# user_id INTEGER PRIMARY KEY GENERATED ALWAYS AS IDENTITY,\n# VARCHAR ( NUMBER ) sets a limit for the characters\nmessage_boards(# username VARCHAR ( 25 ) UNIQUE NOT NULL,\nmessage_boards(# email VARCHAR ( 50 ) UNIQUE NOT NULL,\nmessage_boards(# full_name VARCHAR ( 100 ) NOT NULL,\nmessage_boards(# last_login TIMESTAMP,\nmessage_boards(# created_on TIMESTAMP NOT NULL\nmessage_boards(# );\nCREATE TABLE\nmessage_boards=# \\d\n                List of relations\n Schema |       Name        |   Type   |  Owner\n--------+-------------------+----------+----------\n public | users             | table    | postgres\n public | users_user_id_seq | sequence | postgres\n(2 rows)\n","position":{"start":{"line":61,"column":1,"offset":1874},"end":{"line":81,"column":4,"offset":2631},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Inserting into a database table","position":{"start":{"line":83,"column":4,"offset":2636},"end":{"line":83,"column":35,"offset":2667},"indent":[]}}],"position":{"start":{"line":83,"column":1,"offset":2633},"end":{"line":83,"column":35,"offset":2667},"indent":[]}},{"type":"code","lang":"s","meta":null,"value":"message_boards=# INSERT INTO users (username, email, full_name, created_on) VALUES ('btholt', 'foo@baz.com', 'Brian Holt', NOW());\n# 0 represents OID, 1 represents success\nINSERT 0 1\n\nmessage_boards=# SELECT * FROM users;\n user_id | username |    email    | full_name  | last_login |         created_on\n---------+----------+-------------+------------+------------+----------------------------\n       1 | btholt   | foo@baz.com | Brian Holt |            | 2021-02-02 07:07:17.482125\n(1 row)","position":{"start":{"line":85,"column":1,"offset":2669},"end":{"line":95,"column":4,"offset":3167},"indent":[1,1,1,1,1,1,1,1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"SELECT, LIMIT, WHERE","position":{"start":{"line":97,"column":4,"offset":3172},"end":{"line":97,"column":24,"offset":3192},"indent":[]}}],"position":{"start":{"line":97,"column":1,"offset":3169},"end":{"line":97,"column":24,"offset":3192},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"There is dummy data installed from the ","position":{"start":{"line":99,"column":1,"offset":3194},"end":{"line":99,"column":40,"offset":3233},"indent":[]}},{"type":"link","title":null,"url":"https://btholt.github.io/complete-intro-to-databases/querying-postgresql","children":[{"type":"text","value":"website","position":{"start":{"line":99,"column":41,"offset":3234},"end":{"line":99,"column":48,"offset":3241},"indent":[]}}],"position":{"start":{"line":99,"column":40,"offset":3233},"end":{"line":99,"column":123,"offset":3316},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":99,"column":123,"offset":3316},"end":{"line":99,"column":124,"offset":3317},"indent":[]}}],"position":{"start":{"line":99,"column":1,"offset":3194},"end":{"line":99,"column":124,"offset":3317},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"After it is done, you will have a ton of data.","position":{"start":{"line":101,"column":1,"offset":3319},"end":{"line":101,"column":47,"offset":3365},"indent":[]}}],"position":{"start":{"line":101,"column":1,"offset":3319},"end":{"line":101,"column":47,"offset":3365},"indent":[]}},{"type":"code","lang":"s","meta":null,"value":"message_boards=# \\d\n                     List of relations\n Schema |            Name             |   Type   |  Owner\n--------+-----------------------------+----------+----------\n public | boards                      | table    | postgres\n public | boards_board_id_seq         | sequence | postgres\n public | comments                    | table    | postgres\n public | comments_comment_id_seq     | sequence | postgres\n public | rich_content                | table    | postgres\n public | rich_content_content_id_seq | sequence | postgres\n public | users                       | table    | postgres\n public | users_user_id_seq           | sequence | postgres\n(8 rows)\n\nmessage_boards=# SELECT * FROM users LIMIT 5;\n user_id |  username  |          email           |    full_name    |         last_login         |\n   created_on\n---------+------------+--------------------------+-----------------+----------------------------+------\n----------------------\n       1 | dpuckring0 | dpuckring0@wikimedia.org | Dicky Puckring  |                            | 2021-01-26 07:11:40.091563\n       2 | ssiviour1  | ssiviour1@ow.ly          | Suzanna Siviour | 2021-01-31 07:11:40.091563 | 2021-01-30 07:11:40.091563\n       3 | gsomerled2 | gsomerled2@auda.org.au   | Geneva Somerled |                            | 2021-01-29 07:11:40.091563\n       4 | wedginton3 | wedginton3@google.com    | Winny Edginton  | 2021-01-28 07:11:40.091563 | 2021-01-27 07:11:40.091563\n       5 | mshine4    | mshine4@army.mil         | Mitchael Shine  | 2021-01-26 07:11:40.091563 | 2021-01-25 07:11:40.091563\n(5 rows)","position":{"start":{"line":103,"column":1,"offset":3367},"end":{"line":129,"column":4,"offset":4962},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":131,"column":1,"offset":4964},"end":{"line":131,"column":5,"offset":4968},"indent":[]}},{"type":"inlineCode","value":"WHERE","position":{"start":{"line":131,"column":5,"offset":4968},"end":{"line":131,"column":12,"offset":4975},"indent":[]}},{"type":"text","value":" clause is a straightforward projection:","position":{"start":{"line":131,"column":12,"offset":4975},"end":{"line":131,"column":52,"offset":5015},"indent":[]}}],"position":{"start":{"line":131,"column":1,"offset":4964},"end":{"line":131,"column":52,"offset":5015},"indent":[]}},{"type":"code","lang":"s","meta":null,"value":"message_boards=# SELECT * FROM users WHERE user_id = 1;\n user_id |  username  |          email           |   full_name    | last_login |         created_on\n---------+------------+--------------------------+----------------+------------+----------------------------\n       1 | dpuckring0 | dpuckring0@wikimedia.org | Dicky Puckring |            | 2021-01-26 07:11:40.091563\n(1 row)\n\nmessage_boards=# SELECT username, email, user_id FROM users WHERE last_login IS NULL AND created_on < NOW() - interval '6 months' LIMIT 10;\n  username   |         email          | user_id\n-------------+------------------------+---------\n ggodboltfl  | ggodboltfl@hc360.com   |     562\n gplankfp    | gplankfp@google.nl     |     566\n gturlefs    | gturlefs@nsw.gov.au    |     569\n aordemannfx | aordemannfx@i2i.jp     |     574\n taldisfz    | taldisfz@ameblo.jp     |     576\n cwayong2    | cwayong2@biglobe.ne.jp |     579\n yraittg3    | yraittg3@msu.edu       |     580\n dbyrthg4    | dbyrthg4@sakura.ne.jp  |     581\n cmorsheadg5 | cmorsheadg5@go.com     |     582\n dkoppensg7  | dkoppensg7@globo.com   |     584\n(10 rows)","position":{"start":{"line":133,"column":1,"offset":5017},"end":{"line":154,"column":4,"offset":6134},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"COUNT, SORT, UPDATE and DELETE","position":{"start":{"line":156,"column":4,"offset":6139},"end":{"line":156,"column":34,"offset":6169},"indent":[]}}],"position":{"start":{"line":156,"column":1,"offset":6136},"end":{"line":156,"column":34,"offset":6169},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Sorted by ","position":{"start":{"line":158,"column":1,"offset":6171},"end":{"line":158,"column":11,"offset":6181},"indent":[]}},{"type":"inlineCode","value":"created_on","position":{"start":{"line":158,"column":11,"offset":6181},"end":{"line":158,"column":23,"offset":6193},"indent":[]}},{"type":"text","value":":","position":{"start":{"line":158,"column":23,"offset":6193},"end":{"line":158,"column":24,"offset":6194},"indent":[]}}],"position":{"start":{"line":158,"column":1,"offset":6171},"end":{"line":158,"column":24,"offset":6194},"indent":[]}},{"type":"code","lang":"s","meta":null,"value":"# Oldest\nmessage_boards=# SELECT user_id, email, created_on FROM users ORDER BY created_on LIMIT 10;\n user_id |            email            |         created_on\n---------+-----------------------------+----------------------------\n     926 | edepp@360.cn                | 2020-01-31 07:11:40.091563\n     929 | saspinps@wired.com          | 2020-01-31 07:11:40.091563\n     923 | kdohertypm@mayoclinic.com   | 2020-01-31 07:11:40.091563\n     925 | hderrickpo@wsj.com          | 2020-01-31 07:11:40.091563\n     927 | jsappypq@sciencedaily.com   | 2020-01-31 07:11:40.091563\n     928 | cmottepr@bbc.co.uk          | 2020-01-31 07:11:40.091563\n     921 | akarlemanpk@blogs.com       | 2020-01-31 07:11:40.091563\n     922 | gtivolierpl@istockphoto.com | 2020-01-31 07:11:40.091563\n     924 | vwindridgepn@umn.edu        | 2020-01-31 07:11:40.091563\n     930 | bbrookespt@skyrock.com      | 2020-01-31 07:11:40.091563\n(10 rows)\n\n# Newest\nmessage_boards=# SELECT user_id, email, created_on FROM users ORDER BY created_on DESC LIMIT 10;\n user_id |              email              |         created_on\n---------+---------------------------------+----------------------------\n       2 | ssiviour1@ow.ly                 | 2021-01-30 07:11:40.091563\n       3 | gsomerled2@auda.org.au          | 2021-01-29 07:11:40.091563\n       4 | wedginton3@google.com           | 2021-01-27 07:11:40.091563\n       1 | dpuckring0@wikimedia.org        | 2021-01-26 07:11:40.091563\n       5 | mshine4@army.mil                | 2021-01-25 07:11:40.091563\n       6 | marnli5@google.co.uk            | 2021-01-23 07:11:40.091563\n       7 | wjohnston6@omniture.com         | 2021-01-21 07:11:40.091563\n       8 | shenstone7@networksolutions.com | 2021-01-19 07:11:40.091563\n       9 | chuffey8@csmonitor.com          | 2021-01-17 07:11:40.091563\n      10 | asandiland9@sun.com             | 2021-01-15 07:11:40.091563\n(10 rows)","position":{"start":{"line":160,"column":1,"offset":6196},"end":{"line":192,"column":4,"offset":8098},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"inlineCode","value":"COUNT","position":{"start":{"line":194,"column":1,"offset":8100},"end":{"line":194,"column":8,"offset":8107},"indent":[]}},{"type":"text","value":" can return the number:","position":{"start":{"line":194,"column":8,"offset":8107},"end":{"line":194,"column":31,"offset":8130},"indent":[]}}],"position":{"start":{"line":194,"column":1,"offset":8100},"end":{"line":194,"column":31,"offset":8130},"indent":[]}},{"type":"code","lang":"s","meta":null,"value":"message_boards=# SELECT COUNT(*) FROM users;\n count\n-------\n  1000\n(1 row)\n\n# Users that have logged in\nmessage_boards=# SELECT COUNT(last_login) FROM users;\n count\n-------\n   678\n(1 row)","position":{"start":{"line":196,"column":1,"offset":8132},"end":{"line":209,"column":4,"offset":8328},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"inlineCode","value":"UPDATE","position":{"start":{"line":211,"column":1,"offset":8330},"end":{"line":211,"column":9,"offset":8338},"indent":[]}},{"type":"text","value":" to change records:","position":{"start":{"line":211,"column":9,"offset":8338},"end":{"line":211,"column":28,"offset":8357},"indent":[]}}],"position":{"start":{"line":211,"column":1,"offset":8330},"end":{"line":211,"column":28,"offset":8357},"indent":[]}},{"type":"code","lang":"s","meta":null,"value":"message_boards=# UPDATE users SET last_login=NOW() WHERE user_id=1;\nUPDATE 1\n# To update and return the values\nmessage_boards=# UPDATE users SET last_login=NOW() WHERE user_id=1 RETURNING *;\n user_id |  username  |          email           |   full_name    |         last_login         |         created_on\n---------+------------+--------------------------+----------------+----------------------------+----------------------------\n       1 | dpuckring0 | dpuckring0@wikimedia.org | Dicky Puckring | 2021-02-02 07:23:42.988165 | 2021-01-26 07:11:40.091563\n(1 row)\n\nUPDATE 1","position":{"start":{"line":213,"column":1,"offset":8359},"end":{"line":224,"column":4,"offset":8941},"indent":[1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"inlineCode","value":"DELETE","position":{"start":{"line":226,"column":1,"offset":8943},"end":{"line":226,"column":9,"offset":8951},"indent":[]}},{"type":"text","value":" is also fairly straight forward:","position":{"start":{"line":226,"column":9,"offset":8951},"end":{"line":226,"column":42,"offset":8984},"indent":[]}}],"position":{"start":{"line":226,"column":1,"offset":8943},"end":{"line":226,"column":42,"offset":8984},"indent":[]}},{"type":"code","lang":"s","meta":null,"value":"message_boards=# DELETE FROM users WHERE user_id=1000;\nDELETE 1","position":{"start":{"line":228,"column":1,"offset":8986},"end":{"line":231,"column":4,"offset":9058},"indent":[1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Foreign Keys","position":{"start":{"line":233,"column":4,"offset":9063},"end":{"line":233,"column":16,"offset":9075},"indent":[]}}],"position":{"start":{"line":233,"column":1,"offset":9060},"end":{"line":233,"column":16,"offset":9075},"indent":[]}},{"type":"code","lang":"sql","meta":null,"value":"CREATE TABLE users (\n  user_id INTEGER PRIMARY KEY GENERATED ALWAYS AS IDENTITY,\n  username VARCHAR ( 25 ) UNIQUE NOT NULL,\n  email VARCHAR ( 50 ) UNIQUE NOT NULL,\n  full_name VARCHAR ( 100 ) NOT NULL,\n  last_login TIMESTAMP,\n  created_on TIMESTAMP NOT NULL\n);\n\nCREATE TABLE boards (\n  board_id INTEGER PRIMARY KEY GENERATED ALWAYS AS IDENTITY,\n  board_name VARCHAR ( 50 ) UNIQUE NOT NULL,\n  board_description TEXT NOT NULL\n);\n\nCREATE TABLE comments (\n  comment_id INTEGER PRIMARY KEY GENERATED ALWAYS AS IDENTITY,\n  -- Says to reference the `user_id` from the user table.\n  -- ON DELETE CASCADE means if the user gets deleted, go into\n  -- comments and delete related cascade.\n  -- By default (ON DELETE NO ACTION), it would say \"you cannot delete user\".\n  -- There is even a ON DELETE SET NULL to set that value to NULL if deleted.\n  user_id INT REFERENCES users(user_id) ON DELETE CASCADE,\n  board_id INT REFERENCES boards(board_id) ON DELETE CASCADE,\n  comment TEXT NOT NULL,\n  time TIMESTAMP\n);","position":{"start":{"line":235,"column":1,"offset":9077},"end":{"line":263,"column":4,"offset":10087},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"JOIN","position":{"start":{"line":265,"column":4,"offset":10092},"end":{"line":265,"column":8,"offset":10096},"indent":[]}}],"position":{"start":{"line":265,"column":1,"offset":10089},"end":{"line":265,"column":8,"offset":10096},"indent":[]}},{"type":"paragraph","children":[{"type":"image","title":null,"url":"./joins.png","alt":"Join types","position":{"start":{"line":267,"column":1,"offset":10098},"end":{"line":267,"column":27,"offset":10124},"indent":[]}}],"position":{"start":{"line":267,"column":1,"offset":10098},"end":{"line":267,"column":27,"offset":10124},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"For an inner join - it allows us to match up all the keys from one table to another.","position":{"start":{"line":269,"column":1,"offset":10126},"end":{"line":269,"column":85,"offset":10210},"indent":[]}}],"position":{"start":{"line":269,"column":1,"offset":10126},"end":{"line":269,"column":85,"offset":10210},"indent":[]}},{"type":"code","lang":"sql","meta":null,"value":"SELECT\n  comment_id, comments.user_id, users.username, time, LEFT(comment, 20) AS preview\nFROM\n  comments\nINNER JOIN\n  users\nON\n  comments.user_id = users.user_id\nWHERE\n  board_id = 39;","position":{"start":{"line":271,"column":1,"offset":10212},"end":{"line":282,"column":4,"offset":10408},"indent":[1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"inlineCode","value":"INNER JOIN","position":{"start":{"line":284,"column":1,"offset":10410},"end":{"line":284,"column":13,"offset":10422},"indent":[]}},{"type":"text","value":" which allows us to match up all the keys from one table to another. We do that in ON clause where we say userids match is where you can join together those records into one record.","position":{"start":{"line":284,"column":13,"offset":10422},"end":{"line":284,"column":194,"offset":10603},"indent":[]}}],"position":{"start":{"line":284,"column":1,"offset":10410},"end":{"line":284,"column":194,"offset":10603},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"A ","position":{"start":{"line":286,"column":1,"offset":10605},"end":{"line":286,"column":3,"offset":10607},"indent":[]}},{"type":"inlineCode","value":"LEFT JOIN","position":{"start":{"line":286,"column":3,"offset":10607},"end":{"line":286,"column":14,"offset":10618},"indent":[]}},{"type":"text","value":" would say \"if a comment has a user_id that doesn't exist, include it anyway.\" A RIGHT JOIN wouldn't make much sense here but it would include users even if they didn't have a comment on that board.","position":{"start":{"line":286,"column":14,"offset":10618},"end":{"line":286,"column":212,"offset":10816},"indent":[]}}],"position":{"start":{"line":286,"column":1,"offset":10605},"end":{"line":286,"column":212,"offset":10816},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"We can also an ","position":{"start":{"line":288,"column":1,"offset":10818},"end":{"line":288,"column":16,"offset":10833},"indent":[]}},{"type":"inlineCode","value":"OUTER JOIN","position":{"start":{"line":288,"column":16,"offset":10833},"end":{"line":288,"column":28,"offset":10845},"indent":[]}},{"type":"text","value":" which would be everything that doesn't match. In our database, that would be nothing because we're guaranteed everything has match due to our constraints.","position":{"start":{"line":288,"column":28,"offset":10845},"end":{"line":288,"column":183,"offset":11000},"indent":[]}}],"position":{"start":{"line":288,"column":1,"offset":10818},"end":{"line":288,"column":183,"offset":11000},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"You can also do a ","position":{"start":{"line":290,"column":1,"offset":11002},"end":{"line":290,"column":19,"offset":11020},"indent":[]}},{"type":"inlineCode","value":"FULL OUTER JOIN","position":{"start":{"line":290,"column":19,"offset":11020},"end":{"line":290,"column":36,"offset":11037},"indent":[]}},{"type":"text","value":" which says just include everything. If it doesn't have a match from either side, include it. If it does have a match, include it.","position":{"start":{"line":290,"column":36,"offset":11037},"end":{"line":290,"column":166,"offset":11167},"indent":[]}}],"position":{"start":{"line":290,"column":1,"offset":11002},"end":{"line":290,"column":166,"offset":11167},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Another rarely useful join is the ","position":{"start":{"line":292,"column":1,"offset":11169},"end":{"line":292,"column":35,"offset":11203},"indent":[]}},{"type":"inlineCode","value":"CROSS JOIN","position":{"start":{"line":292,"column":35,"offset":11203},"end":{"line":292,"column":47,"offset":11215},"indent":[]}},{"type":"text","value":". This gives the Cartesian product of the two tables which can be enormous. A Cartesian product would be every row matched with every other row in the other table. If you have A, B, and C in one table with D and E in the other, your CROSS JOIN would be AD, AE, BD, BE, CD, an CE. If you do a cross join between two tables with 1,000 rows each, you'd get 1,000,000 records back.","position":{"start":{"line":292,"column":47,"offset":11215},"end":{"line":292,"column":424,"offset":11592},"indent":[]}}],"position":{"start":{"line":292,"column":1,"offset":11169},"end":{"line":292,"column":424,"offset":11592},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Tables can also be self-joined. Imagine you have a table of employees and one of the fields is directreports which contains employeeids of employees that report the original employee. You could do a ","position":{"start":{"line":294,"column":1,"offset":11594},"end":{"line":294,"column":200,"offset":11793},"indent":[]}},{"type":"inlineCode","value":"SELF JOIN","position":{"start":{"line":294,"column":200,"offset":11793},"end":{"line":294,"column":211,"offset":11804},"indent":[]}},{"type":"text","value":" to get the information for the reports.","position":{"start":{"line":294,"column":211,"offset":11804},"end":{"line":294,"column":251,"offset":11844},"indent":[]}}],"position":{"start":{"line":294,"column":1,"offset":11594},"end":{"line":294,"column":251,"offset":11844},"indent":[]}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"text","value":"\"95% of what I do is covered by INNER and LEFT joins.\" - Brian","position":{"start":{"line":296,"column":3,"offset":11848},"end":{"line":296,"column":65,"offset":11910},"indent":[]}}],"position":{"start":{"line":296,"column":3,"offset":11848},"end":{"line":296,"column":65,"offset":11910},"indent":[]}}],"position":{"start":{"line":296,"column":1,"offset":11846},"end":{"line":296,"column":65,"offset":11910},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Something we can do is a ","position":{"start":{"line":298,"column":1,"offset":11912},"end":{"line":298,"column":26,"offset":11937},"indent":[]}},{"type":"inlineCode","value":"NATURAL JOIN","position":{"start":{"line":298,"column":26,"offset":11937},"end":{"line":298,"column":40,"offset":11951},"indent":[]}},{"type":"text","value":":","position":{"start":{"line":298,"column":40,"offset":11951},"end":{"line":298,"column":41,"offset":11952},"indent":[]}}],"position":{"start":{"line":298,"column":1,"offset":11912},"end":{"line":298,"column":41,"offset":11952},"indent":[]}},{"type":"code","lang":"sql","meta":null,"value":"SELECT\n  comment_id, comments.user_id, users.username, time, LEFT(comment, 20) AS preview\nFROM\n  comments\nNATURAL INNER JOIN\n  users\nWHERE\n  board_id = 39;","position":{"start":{"line":300,"column":1,"offset":11954},"end":{"line":309,"column":4,"offset":12120},"indent":[1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"This will work like it did above. ","position":{"start":{"line":311,"column":1,"offset":12122},"end":{"line":311,"column":35,"offset":12156},"indent":[]}},{"type":"inlineCode","value":"NATURAL JOIN","position":{"start":{"line":311,"column":35,"offset":12156},"end":{"line":311,"column":49,"offset":12170},"indent":[]}},{"type":"text","value":" tells PostgreSQL \"I named things the same in both tables, go ahead and match it together yourself. It is often better to be explicit what about your intent is for joins. So use cautiously and/or for neat party tricks.","position":{"start":{"line":311,"column":49,"offset":12170},"end":{"line":311,"column":267,"offset":12388},"indent":[]}}],"position":{"start":{"line":311,"column":1,"offset":12122},"end":{"line":311,"column":267,"offset":12388},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Subqueries","position":{"start":{"line":313,"column":4,"offset":12393},"end":{"line":313,"column":14,"offset":12403},"indent":[]}}],"position":{"start":{"line":313,"column":1,"offset":12390},"end":{"line":313,"column":14,"offset":12403},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Just be wary with this in terms of cost...","position":{"start":{"line":315,"column":1,"offset":12405},"end":{"line":315,"column":43,"offset":12447},"indent":[]}}],"position":{"start":{"line":315,"column":1,"offset":12405},"end":{"line":315,"column":43,"offset":12447},"indent":[]}},{"type":"code","lang":"sql","meta":null,"value":"SELECT comment_id, user_id, LEFT(comment, 20) FROM comments WHERE user_id = (SELECT user_id FROM users WHERE full_name = 'Maynord Simonich');","position":{"start":{"line":317,"column":1,"offset":12449},"end":{"line":319,"column":4,"offset":12601},"indent":[1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"GROUP BY","position":{"start":{"line":321,"column":4,"offset":12606},"end":{"line":321,"column":12,"offset":12614},"indent":[]}}],"position":{"start":{"line":321,"column":1,"offset":12603},"end":{"line":321,"column":12,"offset":12614},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"What if you were making a report and you wante to show the top ten most posted-to message boards?","position":{"start":{"line":323,"column":1,"offset":12616},"end":{"line":323,"column":98,"offset":12713},"indent":[]}}],"position":{"start":{"line":323,"column":1,"offset":12616},"end":{"line":323,"column":98,"offset":12713},"indent":[]}},{"type":"code","lang":"sql","meta":null,"value":"SELECT\n  boards.board_name, COUNT(*) AS comment_count\nFROM\n  comments\nINNER JOIN\n  boards\nON\n  boards.board_id = comments.board_id\nGROUP BY\n  boards.board_name\nORDER BY\n  comment_count DESC\nLIMIT 10;","position":{"start":{"line":325,"column":1,"offset":12715},"end":{"line":339,"column":4,"offset":12925},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"JSON","position":{"start":{"line":341,"column":4,"offset":12930},"end":{"line":341,"column":8,"offset":12934},"indent":[]}}],"position":{"start":{"line":341,"column":1,"offset":12927},"end":{"line":341,"column":8,"offset":12934},"indent":[]}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"text","value":"This course incorrectly chooses to use the ","position":{"start":{"line":343,"column":3,"offset":12938},"end":{"line":343,"column":46,"offset":12981},"indent":[]}},{"type":"inlineCode","value":"JSON","position":{"start":{"line":343,"column":46,"offset":12981},"end":{"line":343,"column":52,"offset":12987},"indent":[]}},{"type":"text","value":" data type when it should have used the ","position":{"start":{"line":343,"column":52,"offset":12987},"end":{"line":343,"column":92,"offset":13027},"indent":[]}},{"type":"inlineCode","value":"JSONB","position":{"start":{"line":343,"column":92,"offset":13027},"end":{"line":343,"column":99,"offset":13034},"indent":[]}},{"type":"text","value":" data type. You want to choose JSONB because it stores the data in a more queryable format and more optimized for querying whereas JSON is a glorified text field.","position":{"start":{"line":343,"column":99,"offset":13034},"end":{"line":343,"column":261,"offset":13196},"indent":[]}}],"position":{"start":{"line":343,"column":3,"offset":12938},"end":{"line":343,"column":261,"offset":13196},"indent":[]}}],"position":{"start":{"line":343,"column":1,"offset":12936},"end":{"line":343,"column":261,"offset":13196},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"There is a schemaless JSON type in PostgresQL. This does not exist in many SQL types. This is one place where document based databases like MongoDB really shine; their schemaless database works really well in these situations.","position":{"start":{"line":345,"column":1,"offset":13198},"end":{"line":345,"column":227,"offset":13424},"indent":[]}}],"position":{"start":{"line":345,"column":1,"offset":13198},"end":{"line":345,"column":227,"offset":13424},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Here is an example of creating some JSONB values:","position":{"start":{"line":347,"column":1,"offset":13426},"end":{"line":347,"column":50,"offset":13475},"indent":[]}}],"position":{"start":{"line":347,"column":1,"offset":13426},"end":{"line":347,"column":50,"offset":13475},"indent":[]}},{"type":"code","lang":"sql","meta":null,"value":"DROP TABLE IF EXISTS rich_content;\n\nCREATE TABLE rich_content (\n  content_id INTEGER PRIMARY KEY GENERATED ALWAYS AS IDENTITY,\n  comment_id INT REFERENCES comments(comment_id) ON DELETE CASCADE,\n  content JSONB NOT NULL\n);\n\nINSERT INTO rich_content\n  (comment_id, content)\nVALUES\n  (63, '{ \"type\": \"poll\", \"question\": \"What is your favorite color?\", \"options\": [\"blue\", \"red\", \"green\", \"yellow\"] }'),\n  (358, '{ \"type\": \"video\", \"url\": \"https://youtu.be/dQw4w9WgXcQ\", \"dimensions\": { \"height\": 1080, \"width\": 1920 }}'),\n  (358, '{ \"type\": \"poll\", \"question\": \"Is this your favorite video?\", \"options\": [\"yes\", \"no\", \"oh you\"] }'),\n  (410, '{ \"type\": \"image\", \"url\": \"https://btholt.github.io/complete-intro-to-linux-and-the-cli/WORDMARK-Small.png\", \"dimensions\": { \"height\": 400, \"width\": 1084 }}'),\n  (485, '{ \"type\": \"image\", \"url\": \"https://btholt.github.io/complete-intro-to-linux-and-the-cli/HEADER.png\", \"dimensions\": { \"height\": 237 , \"width\": 3301 }}');","position":{"start":{"line":349,"column":1,"offset":13477},"end":{"line":366,"column":4,"offset":14449},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"list","ordered":true,"start":1,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"The JSONB data type is the shining star here. This allows us to insert JSON objects to be queried later.","position":{"start":{"line":368,"column":4,"offset":14454},"end":{"line":368,"column":108,"offset":14558},"indent":[]}}],"position":{"start":{"line":368,"column":4,"offset":14454},"end":{"line":368,"column":108,"offset":14558},"indent":[]}}],"position":{"start":{"line":368,"column":1,"offset":14451},"end":{"line":368,"column":108,"offset":14558},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"PostgreSQL won't let you insert malformatted JSON so it does validate it for you.","position":{"start":{"line":369,"column":4,"offset":14562},"end":{"line":369,"column":85,"offset":14643},"indent":[]}}],"position":{"start":{"line":369,"column":4,"offset":14562},"end":{"line":369,"column":85,"offset":14643},"indent":[]}}],"position":{"start":{"line":369,"column":1,"offset":14559},"end":{"line":369,"column":85,"offset":14643},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Notice you can have as much nesting as you want. Any valid JSON is valid here.","position":{"start":{"line":370,"column":4,"offset":14647},"end":{"line":370,"column":82,"offset":14725},"indent":[]}}],"position":{"start":{"line":370,"column":4,"offset":14647},"end":{"line":370,"column":82,"offset":14725},"indent":[]}}],"position":{"start":{"line":370,"column":1,"offset":14644},"end":{"line":370,"column":82,"offset":14725},"indent":[]}}],"position":{"start":{"line":368,"column":1,"offset":14451},"end":{"line":370,"column":82,"offset":14725},"indent":[1,1]}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"emphasis","children":[{"type":"text","value":"'We're going to use two new symbols, -> and ->>. The -> means \"give me back the JSON object\". The return type will be a JSON object, even if it's just a string. It's basically a black box to PostgreSQL and it treats all JSON the same, whether it's an array, object, or just a string. The ->> means \"give me this back as a string.\"'","position":{"start":{"line":372,"column":4,"offset":14730},"end":{"line":372,"column":335,"offset":15061},"indent":[]}}],"position":{"start":{"line":372,"column":3,"offset":14729},"end":{"line":372,"column":336,"offset":15062},"indent":[]}}],"position":{"start":{"line":372,"column":3,"offset":14729},"end":{"line":372,"column":336,"offset":15062},"indent":[]}}],"position":{"start":{"line":372,"column":1,"offset":14727},"end":{"line":372,"column":336,"offset":15062},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Here is some queriying is ","position":{"start":{"line":374,"column":1,"offset":15064},"end":{"line":374,"column":27,"offset":15090},"indent":[]}},{"type":"inlineCode","value":"psql","position":{"start":{"line":374,"column":27,"offset":15090},"end":{"line":374,"column":33,"offset":15096},"indent":[]}},{"type":"text","value":" in action:","position":{"start":{"line":374,"column":33,"offset":15096},"end":{"line":374,"column":44,"offset":15107},"indent":[]}}],"position":{"start":{"line":374,"column":1,"offset":15064},"end":{"line":374,"column":44,"offset":15107},"indent":[]}},{"type":"code","lang":"sql","meta":null,"value":"message_boards=# SELECT * FROM rich_content;\n content_id | comment_id |                                                                          content\n\n------------+------------+----------------------------------------------------------------------------------------------------------------------------------------------\n-------------\n          1 |         63 | {\"type\": \"poll\", \"options\": [\"blue\", \"red\", \"green\", \"yellow\"], \"question\": \"What is your favorite color?\"}\n          2 |        358 | {\"url\": \"https://youtu.be/dQw4w9WgXcQ\", \"type\": \"video\", \"dimensions\": {\"width\": 1920, \"height\": 1080}}\n          3 |        358 | {\"type\": \"poll\", \"options\": [\"yes\", \"no\", \"oh you\"], \"question\": \"Is this your favorite video?\"}\n          4 |        410 | {\"url\": \"https://btholt.github.io/complete-intro-to-linux-and-the-cli/WORDMARK-Small.png\", \"type\": \"image\", \"dimensions\": {\"width\": 1084, \"height\": 400}}\n          5 |        485 | {\"url\": \"https://btholt.github.io/complete-intro-to-linux-and-the-cli/HEADER.png\", \"type\": \"image\", \"dimensions\": {\"width\": 3301, \"height\": 237}}\n(5 rows)\n\nmessage_boards=# SELECT content -> 'type' FROM rich_content;\n ?column?\n----------\n \"poll\"\n \"video\"\n \"poll\"\n \"image\"\n \"image\"\n(5 rows)\n\n-- Ensure to use actual content\nmessage_boards=# SELECT content -> 'type' AS content_type FROM rich_content;\n content_type\n--------------\n \"poll\"\n \"video\"\n \"poll\"\n \"image\"\n \"image\"\n(5 rows)\n\n-- You can \"cast\" to be enable to use operations of a particular data type\nmessage_boards=# SELECT DISTINCT CAST(content -> 'type' AS TEXT) AS content_type FROM rich_content;\n content_type\n--------------\n \"image\"\n \"poll\"\n \"video\"\n(3 rows)\n\n-- We can cast immediately here to a string with ->>\nmessage_boards=# SELECT DISTINCT content ->> 'type' AS content_type FROM rich_content;\n content_type\n--------------\n video\n poll\n image\n(3 rows)","position":{"start":{"line":376,"column":1,"offset":15109},"end":{"line":427,"column":4,"offset":16974},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"For going deeper into the JSON object:","position":{"start":{"line":429,"column":1,"offset":16976},"end":{"line":429,"column":39,"offset":17014},"indent":[]}}],"position":{"start":{"line":429,"column":1,"offset":16976},"end":{"line":429,"column":39,"offset":17014},"indent":[]}},{"type":"code","lang":"sql","meta":null,"value":"SELECT\n  content -> 'dimensions' ->> 'height' AS height,\n  content -> 'dimensions' ->> 'width' AS width,\n  comment_id\nFROM\n  rich_content\nWHERE\n  content -> 'dimensions' IS NOT NULL;","position":{"start":{"line":431,"column":1,"offset":17016},"end":{"line":440,"column":4,"offset":17209},"indent":[1,1,1,1,1,1,1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Indexes in PostgresSQL","position":{"start":{"line":442,"column":4,"offset":17214},"end":{"line":442,"column":26,"offset":17236},"indent":[]}}],"position":{"start":{"line":442,"column":1,"offset":17211},"end":{"line":442,"column":26,"offset":17236},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Performance is always a concern.","position":{"start":{"line":444,"column":1,"offset":17238},"end":{"line":444,"column":33,"offset":17270},"indent":[]}}],"position":{"start":{"line":444,"column":1,"offset":17238},"end":{"line":444,"column":33,"offset":17270},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"You can put ","position":{"start":{"line":446,"column":1,"offset":17272},"end":{"line":446,"column":13,"offset":17284},"indent":[]}},{"type":"inlineCode","value":"EXPLAIN","position":{"start":{"line":446,"column":13,"offset":17284},"end":{"line":446,"column":22,"offset":17293},"indent":[]}},{"type":"text","value":" in front of any query and it will given you an overview about how the query will run:","position":{"start":{"line":446,"column":22,"offset":17293},"end":{"line":446,"column":108,"offset":17379},"indent":[]}}],"position":{"start":{"line":446,"column":1,"offset":17272},"end":{"line":446,"column":108,"offset":17379},"indent":[]}},{"type":"code","lang":"sql","meta":null,"value":"message_boards=# EXPLAIN SELECT comment_id, user_id, time, LEFT(comment, 20) FROM comments WHERE board_id = 39 ORDER BY time DESC LIMIT 40;\n                              QUERY PLAN\n-----------------------------------------------------------------------\n Limit  (cost=65.75..65.78 rows=12 width=48)\n   ->  Sort  (cost=65.75..65.78 rows=12 width=48)\n         Sort Key: \"time\" DESC\n         ->  Seq Scan on comments  (cost=0.00..65.53 rows=12 width=48)\n               Filter: (board_id = 39)\n(5 rows)","position":{"start":{"line":448,"column":1,"offset":17381},"end":{"line":458,"column":4,"offset":17889},"indent":[1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"65 is not a great search and we are seeing the ","position":{"start":{"line":460,"column":1,"offset":17891},"end":{"line":460,"column":48,"offset":17938},"indent":[]}},{"type":"inlineCode","value":"sequential scans","position":{"start":{"line":460,"column":48,"offset":17938},"end":{"line":460,"column":66,"offset":17956},"indent":[]}},{"type":"text","value":" that we are not hoping to see.","position":{"start":{"line":460,"column":66,"offset":17956},"end":{"line":460,"column":97,"offset":17987},"indent":[]}}],"position":{"start":{"line":460,"column":1,"offset":17891},"end":{"line":460,"column":97,"offset":17987},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"In this scenario, given the access pattern, we will want to add an index on ","position":{"start":{"line":462,"column":1,"offset":17989},"end":{"line":462,"column":77,"offset":18065},"indent":[]}},{"type":"inlineCode","value":"board_id","position":{"start":{"line":462,"column":77,"offset":18065},"end":{"line":462,"column":87,"offset":18075},"indent":[]}},{"type":"text","value":". We can create indexes with ","position":{"start":{"line":462,"column":87,"offset":18075},"end":{"line":462,"column":116,"offset":18104},"indent":[]}},{"type":"inlineCode","value":"CREATE INDEX [idx name] ON <table> (<attribute>)","position":{"start":{"line":462,"column":116,"offset":18104},"end":{"line":462,"column":166,"offset":18154},"indent":[]}}],"position":{"start":{"line":462,"column":1,"offset":17989},"end":{"line":462,"column":166,"offset":18154},"indent":[]}},{"type":"code","lang":"sql","meta":null,"value":"message_boards=# CREATE INDEX comments_board_id_idx ON comments (board_id);\nCREATE INDEX\nmessage_boards=# EXPLAIN SELECT comment_id, user_id, time, LEFT(comment, 20) FROM comments WHERE board_id = 39 ORDER BY time DESC LIMIT 40;\n                                           QUERY PLAN\n-------------------------------------------------------------------------------------------------\n Limit  (cost=33.73..33.76 rows=12 width=48)\n   ->  Sort  (cost=33.73..33.76 rows=12 width=48)\n         Sort Key: \"time\" DESC\n         ->  Bitmap Heap Scan on comments  (cost=4.37..33.51 rows=12 width=48)\n               Recheck Cond: (board_id = 39)\n               ->  Bitmap Index Scan on comments_board_id_idx  (cost=0.00..4.37 rows=12 width=0)\n                     Index Cond: (board_id = 39)\n(7 rows)","position":{"start":{"line":464,"column":1,"offset":18156},"end":{"line":478,"column":4,"offset":18952},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"The cost is now much better!","position":{"start":{"line":480,"column":1,"offset":18954},"end":{"line":480,"column":29,"offset":18982},"indent":[]}}],"position":{"start":{"line":480,"column":1,"offset":18954},"end":{"line":480,"column":29,"offset":18982},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"You can drop the index with ","position":{"start":{"line":482,"column":1,"offset":18984},"end":{"line":482,"column":29,"offset":19012},"indent":[]}},{"type":"inlineCode","value":"DROP INDEX [idx_name];","position":{"start":{"line":482,"column":29,"offset":19012},"end":{"line":482,"column":53,"offset":19036},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":482,"column":53,"offset":19036},"end":{"line":482,"column":54,"offset":19037},"indent":[]}}],"position":{"start":{"line":482,"column":1,"offset":18984},"end":{"line":482,"column":54,"offset":19037},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"To create a unique index, we could use ","position":{"start":{"line":484,"column":1,"offset":19039},"end":{"line":484,"column":40,"offset":19078},"indent":[]}},{"type":"inlineCode","value":"CREATE UNIQUE INDEX username_idx on users(username);","position":{"start":{"line":484,"column":40,"offset":19078},"end":{"line":484,"column":94,"offset":19132},"indent":[]}},{"type":"text","value":". This looks similar to a ","position":{"start":{"line":484,"column":94,"offset":19132},"end":{"line":484,"column":120,"offset":19158},"indent":[]}},{"type":"inlineCode","value":"UNIQUE","position":{"start":{"line":484,"column":120,"offset":19158},"end":{"line":484,"column":128,"offset":19166},"indent":[]}},{"type":"text","value":" constraint on an attribute.","position":{"start":{"line":484,"column":128,"offset":19166},"end":{"line":484,"column":156,"offset":19194},"indent":[]}}],"position":{"start":{"line":484,"column":1,"offset":19039},"end":{"line":484,"column":156,"offset":19194},"indent":[]}},{"type":"code","lang":"sql","meta":null,"value":"message_boards=# CREATE UNIQUE INDEX username_idx on users(username);\nCREATE INDEX\nmessage_boards=# SELECT username FROM users WHERE user_id = 10;\n  username\n-------------\n asandiland9\n(1 row)","position":{"start":{"line":486,"column":1,"offset":19196},"end":{"line":494,"column":4,"offset":19399},"indent":[1,1,1,1,1,1,1,1]}},{"type":"export","value":"export const _frontmatter = {}","position":{"start":{"line":497,"column":1,"offset":19402},"end":{"line":497,"column":31,"offset":19432},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":497,"column":31,"offset":19432}}},"scopeImports":[],"scopeIdentifiers":[],"rawMDXOutput":"/* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\nimport DefaultLayout from \"/Users/dennis.okeeffe/Project-Imposter/developer-notes/node_modules/gatsby-theme-docz/src/base/Layout.js\"\nexport const _frontmatter = {};\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\")\n  return <div {...props}/>\n};\n\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1 {...{\n      \"id\": \"sql\"\n    }}>{`SQL`}</h1>\n    <h2 {...{\n      \"id\": \"resources\"\n    }}>{`Resources`}</h2>\n    <ol>\n      <li parentName=\"ol\"><a parentName=\"li\" {...{\n          \"href\": \"https://btholt.github.io/complete-intro-to-databases/intro-to-sql-databases\"\n        }}>{`Complete Intro To Databases`}</a></li>\n    </ol>\n    <h2 {...{\n      \"id\": \"what-is-sql\"\n    }}>{`What is SQL?`}</h2>\n    <p>{`Pronounced through the letters instead of \"sequel\".`}</p>\n    <p>{`SQL means \"relational database\" (referring to relational database management systems).`}</p>\n    <p>{`The best thing to think about is with \"excel\" with a table of data.`}</p>\n    <p>{`It has a defined and a very structured schema.`}</p>\n    <p>{`SQL databases are very good at describing relations. In things like Mongo, you do not want to join collections to other collections.`}</p>\n    <h2 {...{\n      \"id\": \"postgresql\"\n    }}>{`PostgresQL`}</h2>\n    <p>{`Enjoys a lot of market share and has some killer features.`}</p>\n    <p>{`For this course, Brian runs Postgres in a Docker container. After pulling the image, we can start a `}<inlineCode parentName=\"p\">{`hello-postgres`}</inlineCode>{` container:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-s\"\n      }}>{`# Start the container\ndocker run --name hello-postgres -p 5432:5432 -e POSTGRES_PASSWORD=mysecretpassword -d --rm postgres\n# Attach to the container\ndocker exec -it -u postgres hello-postgres psql\n`}</code></pre>\n    <p>{`In the new Postgres program, run the following to create a database and attach:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-s\"\n      }}>{`postgres=# CREATE DATABASE message_boards;\nCREATE DATABASE\n# \\\\c is short for \\`connect\\`\npostgres=# \\\\c message_boards;\nYou are now connected to database \"message_boards\" as user \"postgres\".\n`}</code></pre>\n    <p>{`Other useful commands:`}</p>\n    <table>\n      <thead parentName=\"table\">\n        <tr parentName=\"thead\">\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Command`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Description`}</th>\n        </tr>\n      </thead>\n      <tbody parentName=\"table\">\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`\\\\c`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Connect`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`\\\\d`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Show Tables`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`\\\\?`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Will show commands`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`\\\\h`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Displays kinds of queries that you can do`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}><inlineCode parentName=\"td\">{`-- [input]`}</inlineCode></td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`How to do a comment`}</td>\n        </tr>\n      </tbody>\n    </table>\n    <h2 {...{\n      \"id\": \"creating-a-database\"\n    }}>{`Creating a database`}</h2>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-s\"\n      }}>{`message_boards=# CREATE TABLE users (\n# This is to autoincrement the IDs\nmessage_boards(# user_id INTEGER PRIMARY KEY GENERATED ALWAYS AS IDENTITY,\n# VARCHAR ( NUMBER ) sets a limit for the characters\nmessage_boards(# username VARCHAR ( 25 ) UNIQUE NOT NULL,\nmessage_boards(# email VARCHAR ( 50 ) UNIQUE NOT NULL,\nmessage_boards(# full_name VARCHAR ( 100 ) NOT NULL,\nmessage_boards(# last_login TIMESTAMP,\nmessage_boards(# created_on TIMESTAMP NOT NULL\nmessage_boards(# );\nCREATE TABLE\nmessage_boards=# \\\\d\n                List of relations\n Schema |       Name        |   Type   |  Owner\n--------+-------------------+----------+----------\n public | users             | table    | postgres\n public | users_user_id_seq | sequence | postgres\n(2 rows)\n\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"inserting-into-a-database-table\"\n    }}>{`Inserting into a database table`}</h2>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-s\"\n      }}>{`message_boards=# INSERT INTO users (username, email, full_name, created_on) VALUES ('btholt', 'foo@baz.com', 'Brian Holt', NOW());\n# 0 represents OID, 1 represents success\nINSERT 0 1\n\nmessage_boards=# SELECT * FROM users;\n user_id | username |    email    | full_name  | last_login |         created_on\n---------+----------+-------------+------------+------------+----------------------------\n       1 | btholt   | foo@baz.com | Brian Holt |            | 2021-02-02 07:07:17.482125\n(1 row)\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"select-limit-where\"\n    }}>{`SELECT, LIMIT, WHERE`}</h2>\n    <p>{`There is dummy data installed from the `}<a parentName=\"p\" {...{\n        \"href\": \"https://btholt.github.io/complete-intro-to-databases/querying-postgresql\"\n      }}>{`website`}</a>{`.`}</p>\n    <p>{`After it is done, you will have a ton of data.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-s\"\n      }}>{`message_boards=# \\\\d\n                     List of relations\n Schema |            Name             |   Type   |  Owner\n--------+-----------------------------+----------+----------\n public | boards                      | table    | postgres\n public | boards_board_id_seq         | sequence | postgres\n public | comments                    | table    | postgres\n public | comments_comment_id_seq     | sequence | postgres\n public | rich_content                | table    | postgres\n public | rich_content_content_id_seq | sequence | postgres\n public | users                       | table    | postgres\n public | users_user_id_seq           | sequence | postgres\n(8 rows)\n\nmessage_boards=# SELECT * FROM users LIMIT 5;\n user_id |  username  |          email           |    full_name    |         last_login         |\n   created_on\n---------+------------+--------------------------+-----------------+----------------------------+------\n----------------------\n       1 | dpuckring0 | dpuckring0@wikimedia.org | Dicky Puckring  |                            | 2021-01-26 07:11:40.091563\n       2 | ssiviour1  | ssiviour1@ow.ly          | Suzanna Siviour | 2021-01-31 07:11:40.091563 | 2021-01-30 07:11:40.091563\n       3 | gsomerled2 | gsomerled2@auda.org.au   | Geneva Somerled |                            | 2021-01-29 07:11:40.091563\n       4 | wedginton3 | wedginton3@google.com    | Winny Edginton  | 2021-01-28 07:11:40.091563 | 2021-01-27 07:11:40.091563\n       5 | mshine4    | mshine4@army.mil         | Mitchael Shine  | 2021-01-26 07:11:40.091563 | 2021-01-25 07:11:40.091563\n(5 rows)\n`}</code></pre>\n    <p>{`The `}<inlineCode parentName=\"p\">{`WHERE`}</inlineCode>{` clause is a straightforward projection:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-s\"\n      }}>{`message_boards=# SELECT * FROM users WHERE user_id = 1;\n user_id |  username  |          email           |   full_name    | last_login |         created_on\n---------+------------+--------------------------+----------------+------------+----------------------------\n       1 | dpuckring0 | dpuckring0@wikimedia.org | Dicky Puckring |            | 2021-01-26 07:11:40.091563\n(1 row)\n\nmessage_boards=# SELECT username, email, user_id FROM users WHERE last_login IS NULL AND created_on < NOW() - interval '6 months' LIMIT 10;\n  username   |         email          | user_id\n-------------+------------------------+---------\n ggodboltfl  | ggodboltfl@hc360.com   |     562\n gplankfp    | gplankfp@google.nl     |     566\n gturlefs    | gturlefs@nsw.gov.au    |     569\n aordemannfx | aordemannfx@i2i.jp     |     574\n taldisfz    | taldisfz@ameblo.jp     |     576\n cwayong2    | cwayong2@biglobe.ne.jp |     579\n yraittg3    | yraittg3@msu.edu       |     580\n dbyrthg4    | dbyrthg4@sakura.ne.jp  |     581\n cmorsheadg5 | cmorsheadg5@go.com     |     582\n dkoppensg7  | dkoppensg7@globo.com   |     584\n(10 rows)\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"count-sort-update-and-delete\"\n    }}>{`COUNT, SORT, UPDATE and DELETE`}</h2>\n    <p>{`Sorted by `}<inlineCode parentName=\"p\">{`created_on`}</inlineCode>{`:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-s\"\n      }}>{`# Oldest\nmessage_boards=# SELECT user_id, email, created_on FROM users ORDER BY created_on LIMIT 10;\n user_id |            email            |         created_on\n---------+-----------------------------+----------------------------\n     926 | edepp@360.cn                | 2020-01-31 07:11:40.091563\n     929 | saspinps@wired.com          | 2020-01-31 07:11:40.091563\n     923 | kdohertypm@mayoclinic.com   | 2020-01-31 07:11:40.091563\n     925 | hderrickpo@wsj.com          | 2020-01-31 07:11:40.091563\n     927 | jsappypq@sciencedaily.com   | 2020-01-31 07:11:40.091563\n     928 | cmottepr@bbc.co.uk          | 2020-01-31 07:11:40.091563\n     921 | akarlemanpk@blogs.com       | 2020-01-31 07:11:40.091563\n     922 | gtivolierpl@istockphoto.com | 2020-01-31 07:11:40.091563\n     924 | vwindridgepn@umn.edu        | 2020-01-31 07:11:40.091563\n     930 | bbrookespt@skyrock.com      | 2020-01-31 07:11:40.091563\n(10 rows)\n\n# Newest\nmessage_boards=# SELECT user_id, email, created_on FROM users ORDER BY created_on DESC LIMIT 10;\n user_id |              email              |         created_on\n---------+---------------------------------+----------------------------\n       2 | ssiviour1@ow.ly                 | 2021-01-30 07:11:40.091563\n       3 | gsomerled2@auda.org.au          | 2021-01-29 07:11:40.091563\n       4 | wedginton3@google.com           | 2021-01-27 07:11:40.091563\n       1 | dpuckring0@wikimedia.org        | 2021-01-26 07:11:40.091563\n       5 | mshine4@army.mil                | 2021-01-25 07:11:40.091563\n       6 | marnli5@google.co.uk            | 2021-01-23 07:11:40.091563\n       7 | wjohnston6@omniture.com         | 2021-01-21 07:11:40.091563\n       8 | shenstone7@networksolutions.com | 2021-01-19 07:11:40.091563\n       9 | chuffey8@csmonitor.com          | 2021-01-17 07:11:40.091563\n      10 | asandiland9@sun.com             | 2021-01-15 07:11:40.091563\n(10 rows)\n`}</code></pre>\n    <p><inlineCode parentName=\"p\">{`COUNT`}</inlineCode>{` can return the number:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-s\"\n      }}>{`message_boards=# SELECT COUNT(*) FROM users;\n count\n-------\n  1000\n(1 row)\n\n# Users that have logged in\nmessage_boards=# SELECT COUNT(last_login) FROM users;\n count\n-------\n   678\n(1 row)\n`}</code></pre>\n    <p><inlineCode parentName=\"p\">{`UPDATE`}</inlineCode>{` to change records:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-s\"\n      }}>{`message_boards=# UPDATE users SET last_login=NOW() WHERE user_id=1;\nUPDATE 1\n# To update and return the values\nmessage_boards=# UPDATE users SET last_login=NOW() WHERE user_id=1 RETURNING *;\n user_id |  username  |          email           |   full_name    |         last_login         |         created_on\n---------+------------+--------------------------+----------------+----------------------------+----------------------------\n       1 | dpuckring0 | dpuckring0@wikimedia.org | Dicky Puckring | 2021-02-02 07:23:42.988165 | 2021-01-26 07:11:40.091563\n(1 row)\n\nUPDATE 1\n`}</code></pre>\n    <p><inlineCode parentName=\"p\">{`DELETE`}</inlineCode>{` is also fairly straight forward:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-s\"\n      }}>{`message_boards=# DELETE FROM users WHERE user_id=1000;\nDELETE 1\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"foreign-keys\"\n    }}>{`Foreign Keys`}</h2>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-sql\"\n      }}>{`CREATE TABLE users (\n  user_id INTEGER PRIMARY KEY GENERATED ALWAYS AS IDENTITY,\n  username VARCHAR ( 25 ) UNIQUE NOT NULL,\n  email VARCHAR ( 50 ) UNIQUE NOT NULL,\n  full_name VARCHAR ( 100 ) NOT NULL,\n  last_login TIMESTAMP,\n  created_on TIMESTAMP NOT NULL\n);\n\nCREATE TABLE boards (\n  board_id INTEGER PRIMARY KEY GENERATED ALWAYS AS IDENTITY,\n  board_name VARCHAR ( 50 ) UNIQUE NOT NULL,\n  board_description TEXT NOT NULL\n);\n\nCREATE TABLE comments (\n  comment_id INTEGER PRIMARY KEY GENERATED ALWAYS AS IDENTITY,\n  -- Says to reference the \\`user_id\\` from the user table.\n  -- ON DELETE CASCADE means if the user gets deleted, go into\n  -- comments and delete related cascade.\n  -- By default (ON DELETE NO ACTION), it would say \"you cannot delete user\".\n  -- There is even a ON DELETE SET NULL to set that value to NULL if deleted.\n  user_id INT REFERENCES users(user_id) ON DELETE CASCADE,\n  board_id INT REFERENCES boards(board_id) ON DELETE CASCADE,\n  comment TEXT NOT NULL,\n  time TIMESTAMP\n);\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"join\"\n    }}>{`JOIN`}</h2>\n    <p><img alt=\"Join types\" src={require(\"./joins.png\")} /></p>\n    <p>{`For an inner join - it allows us to match up all the keys from one table to another.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-sql\"\n      }}>{`SELECT\n  comment_id, comments.user_id, users.username, time, LEFT(comment, 20) AS preview\nFROM\n  comments\nINNER JOIN\n  users\nON\n  comments.user_id = users.user_id\nWHERE\n  board_id = 39;\n`}</code></pre>\n    <p><inlineCode parentName=\"p\">{`INNER JOIN`}</inlineCode>{` which allows us to match up all the keys from one table to another. We do that in ON clause where we say userids match is where you can join together those records into one record.`}</p>\n    <p>{`A `}<inlineCode parentName=\"p\">{`LEFT JOIN`}</inlineCode>{` would say \"if a comment has a user_id that doesn't exist, include it anyway.\" A RIGHT JOIN wouldn't make much sense here but it would include users even if they didn't have a comment on that board.`}</p>\n    <p>{`We can also an `}<inlineCode parentName=\"p\">{`OUTER JOIN`}</inlineCode>{` which would be everything that doesn't match. In our database, that would be nothing because we're guaranteed everything has match due to our constraints.`}</p>\n    <p>{`You can also do a `}<inlineCode parentName=\"p\">{`FULL OUTER JOIN`}</inlineCode>{` which says just include everything. If it doesn't have a match from either side, include it. If it does have a match, include it.`}</p>\n    <p>{`Another rarely useful join is the `}<inlineCode parentName=\"p\">{`CROSS JOIN`}</inlineCode>{`. This gives the Cartesian product of the two tables which can be enormous. A Cartesian product would be every row matched with every other row in the other table. If you have A, B, and C in one table with D and E in the other, your CROSS JOIN would be AD, AE, BD, BE, CD, an CE. If you do a cross join between two tables with 1,000 rows each, you'd get 1,000,000 records back.`}</p>\n    <p>{`Tables can also be self-joined. Imagine you have a table of employees and one of the fields is directreports which contains employeeids of employees that report the original employee. You could do a `}<inlineCode parentName=\"p\">{`SELF JOIN`}</inlineCode>{` to get the information for the reports.`}</p>\n    <blockquote>\n      <p parentName=\"blockquote\">{`\"95% of what I do is covered by INNER and LEFT joins.\" - Brian`}</p>\n    </blockquote>\n    <p>{`Something we can do is a `}<inlineCode parentName=\"p\">{`NATURAL JOIN`}</inlineCode>{`:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-sql\"\n      }}>{`SELECT\n  comment_id, comments.user_id, users.username, time, LEFT(comment, 20) AS preview\nFROM\n  comments\nNATURAL INNER JOIN\n  users\nWHERE\n  board_id = 39;\n`}</code></pre>\n    <p>{`This will work like it did above. `}<inlineCode parentName=\"p\">{`NATURAL JOIN`}</inlineCode>{` tells PostgreSQL \"I named things the same in both tables, go ahead and match it together yourself. It is often better to be explicit what about your intent is for joins. So use cautiously and/or for neat party tricks.`}</p>\n    <h2 {...{\n      \"id\": \"subqueries\"\n    }}>{`Subqueries`}</h2>\n    <p>{`Just be wary with this in terms of cost...`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-sql\"\n      }}>{`SELECT comment_id, user_id, LEFT(comment, 20) FROM comments WHERE user_id = (SELECT user_id FROM users WHERE full_name = 'Maynord Simonich');\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"group-by\"\n    }}>{`GROUP BY`}</h2>\n    <p>{`What if you were making a report and you wante to show the top ten most posted-to message boards?`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-sql\"\n      }}>{`SELECT\n  boards.board_name, COUNT(*) AS comment_count\nFROM\n  comments\nINNER JOIN\n  boards\nON\n  boards.board_id = comments.board_id\nGROUP BY\n  boards.board_name\nORDER BY\n  comment_count DESC\nLIMIT 10;\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"json\"\n    }}>{`JSON`}</h2>\n    <blockquote>\n      <p parentName=\"blockquote\">{`This course incorrectly chooses to use the `}<inlineCode parentName=\"p\">{`JSON`}</inlineCode>{` data type when it should have used the `}<inlineCode parentName=\"p\">{`JSONB`}</inlineCode>{` data type. You want to choose JSONB because it stores the data in a more queryable format and more optimized for querying whereas JSON is a glorified text field.`}</p>\n    </blockquote>\n    <p>{`There is a schemaless JSON type in PostgresQL. This does not exist in many SQL types. This is one place where document based databases like MongoDB really shine; their schemaless database works really well in these situations.`}</p>\n    <p>{`Here is an example of creating some JSONB values:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-sql\"\n      }}>{`DROP TABLE IF EXISTS rich_content;\n\nCREATE TABLE rich_content (\n  content_id INTEGER PRIMARY KEY GENERATED ALWAYS AS IDENTITY,\n  comment_id INT REFERENCES comments(comment_id) ON DELETE CASCADE,\n  content JSONB NOT NULL\n);\n\nINSERT INTO rich_content\n  (comment_id, content)\nVALUES\n  (63, '{ \"type\": \"poll\", \"question\": \"What is your favorite color?\", \"options\": [\"blue\", \"red\", \"green\", \"yellow\"] }'),\n  (358, '{ \"type\": \"video\", \"url\": \"https://youtu.be/dQw4w9WgXcQ\", \"dimensions\": { \"height\": 1080, \"width\": 1920 }}'),\n  (358, '{ \"type\": \"poll\", \"question\": \"Is this your favorite video?\", \"options\": [\"yes\", \"no\", \"oh you\"] }'),\n  (410, '{ \"type\": \"image\", \"url\": \"https://btholt.github.io/complete-intro-to-linux-and-the-cli/WORDMARK-Small.png\", \"dimensions\": { \"height\": 400, \"width\": 1084 }}'),\n  (485, '{ \"type\": \"image\", \"url\": \"https://btholt.github.io/complete-intro-to-linux-and-the-cli/HEADER.png\", \"dimensions\": { \"height\": 237 , \"width\": 3301 }}');\n`}</code></pre>\n    <ol>\n      <li parentName=\"ol\">{`The JSONB data type is the shining star here. This allows us to insert JSON objects to be queried later.`}</li>\n      <li parentName=\"ol\">{`PostgreSQL won't let you insert malformatted JSON so it does validate it for you.`}</li>\n      <li parentName=\"ol\">{`Notice you can have as much nesting as you want. Any valid JSON is valid here.`}</li>\n    </ol>\n    <blockquote>\n      <p parentName=\"blockquote\"><em parentName=\"p\">{`'We're going to use two new symbols, -> and ->>. The -> means \"give me back the JSON object\". The return type will be a JSON object, even if it's just a string. It's basically a black box to PostgreSQL and it treats all JSON the same, whether it's an array, object, or just a string. The ->> means \"give me this back as a string.\"'`}</em></p>\n    </blockquote>\n    <p>{`Here is some queriying is `}<inlineCode parentName=\"p\">{`psql`}</inlineCode>{` in action:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-sql\"\n      }}>{`message_boards=# SELECT * FROM rich_content;\n content_id | comment_id |                                                                          content\n\n------------+------------+----------------------------------------------------------------------------------------------------------------------------------------------\n-------------\n          1 |         63 | {\"type\": \"poll\", \"options\": [\"blue\", \"red\", \"green\", \"yellow\"], \"question\": \"What is your favorite color?\"}\n          2 |        358 | {\"url\": \"https://youtu.be/dQw4w9WgXcQ\", \"type\": \"video\", \"dimensions\": {\"width\": 1920, \"height\": 1080}}\n          3 |        358 | {\"type\": \"poll\", \"options\": [\"yes\", \"no\", \"oh you\"], \"question\": \"Is this your favorite video?\"}\n          4 |        410 | {\"url\": \"https://btholt.github.io/complete-intro-to-linux-and-the-cli/WORDMARK-Small.png\", \"type\": \"image\", \"dimensions\": {\"width\": 1084, \"height\": 400}}\n          5 |        485 | {\"url\": \"https://btholt.github.io/complete-intro-to-linux-and-the-cli/HEADER.png\", \"type\": \"image\", \"dimensions\": {\"width\": 3301, \"height\": 237}}\n(5 rows)\n\nmessage_boards=# SELECT content -> 'type' FROM rich_content;\n ?column?\n----------\n \"poll\"\n \"video\"\n \"poll\"\n \"image\"\n \"image\"\n(5 rows)\n\n-- Ensure to use actual content\nmessage_boards=# SELECT content -> 'type' AS content_type FROM rich_content;\n content_type\n--------------\n \"poll\"\n \"video\"\n \"poll\"\n \"image\"\n \"image\"\n(5 rows)\n\n-- You can \"cast\" to be enable to use operations of a particular data type\nmessage_boards=# SELECT DISTINCT CAST(content -> 'type' AS TEXT) AS content_type FROM rich_content;\n content_type\n--------------\n \"image\"\n \"poll\"\n \"video\"\n(3 rows)\n\n-- We can cast immediately here to a string with ->>\nmessage_boards=# SELECT DISTINCT content ->> 'type' AS content_type FROM rich_content;\n content_type\n--------------\n video\n poll\n image\n(3 rows)\n`}</code></pre>\n    <p>{`For going deeper into the JSON object:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-sql\"\n      }}>{`SELECT\n  content -> 'dimensions' ->> 'height' AS height,\n  content -> 'dimensions' ->> 'width' AS width,\n  comment_id\nFROM\n  rich_content\nWHERE\n  content -> 'dimensions' IS NOT NULL;\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"indexes-in-postgressql\"\n    }}>{`Indexes in PostgresSQL`}</h2>\n    <p>{`Performance is always a concern.`}</p>\n    <p>{`You can put `}<inlineCode parentName=\"p\">{`EXPLAIN`}</inlineCode>{` in front of any query and it will given you an overview about how the query will run:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-sql\"\n      }}>{`message_boards=# EXPLAIN SELECT comment_id, user_id, time, LEFT(comment, 20) FROM comments WHERE board_id = 39 ORDER BY time DESC LIMIT 40;\n                              QUERY PLAN\n-----------------------------------------------------------------------\n Limit  (cost=65.75..65.78 rows=12 width=48)\n   ->  Sort  (cost=65.75..65.78 rows=12 width=48)\n         Sort Key: \"time\" DESC\n         ->  Seq Scan on comments  (cost=0.00..65.53 rows=12 width=48)\n               Filter: (board_id = 39)\n(5 rows)\n`}</code></pre>\n    <p>{`65 is not a great search and we are seeing the `}<inlineCode parentName=\"p\">{`sequential scans`}</inlineCode>{` that we are not hoping to see.`}</p>\n    <p>{`In this scenario, given the access pattern, we will want to add an index on `}<inlineCode parentName=\"p\">{`board_id`}</inlineCode>{`. We can create indexes with `}<inlineCode parentName=\"p\">{`CREATE INDEX [idx name] ON <table> (<attribute>)`}</inlineCode></p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-sql\"\n      }}>{`message_boards=# CREATE INDEX comments_board_id_idx ON comments (board_id);\nCREATE INDEX\nmessage_boards=# EXPLAIN SELECT comment_id, user_id, time, LEFT(comment, 20) FROM comments WHERE board_id = 39 ORDER BY time DESC LIMIT 40;\n                                           QUERY PLAN\n-------------------------------------------------------------------------------------------------\n Limit  (cost=33.73..33.76 rows=12 width=48)\n   ->  Sort  (cost=33.73..33.76 rows=12 width=48)\n         Sort Key: \"time\" DESC\n         ->  Bitmap Heap Scan on comments  (cost=4.37..33.51 rows=12 width=48)\n               Recheck Cond: (board_id = 39)\n               ->  Bitmap Index Scan on comments_board_id_idx  (cost=0.00..4.37 rows=12 width=0)\n                     Index Cond: (board_id = 39)\n(7 rows)\n`}</code></pre>\n    <p>{`The cost is now much better!`}</p>\n    <p>{`You can drop the index with `}<inlineCode parentName=\"p\">{`DROP INDEX [idx_name];`}</inlineCode>{`.`}</p>\n    <p>{`To create a unique index, we could use `}<inlineCode parentName=\"p\">{`CREATE UNIQUE INDEX username_idx on users(username);`}</inlineCode>{`. This looks similar to a `}<inlineCode parentName=\"p\">{`UNIQUE`}</inlineCode>{` constraint on an attribute.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-sql\"\n      }}>{`message_boards=# CREATE UNIQUE INDEX username_idx on users(username);\nCREATE INDEX\nmessage_boards=# SELECT username FROM users WHERE user_id = 10;\n  username\n-------------\n asandiland9\n(1 row)\n`}</code></pre>\n\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;"}}