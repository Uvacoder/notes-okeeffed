{"expireTime":9007200852878418000,"key":"gatsby-plugin-mdx-entire-payload-f7b4fb8ba645c63ba525221229822578-","val":{"mdast":{"type":"root","children":[{"type":"import","value":"import DefaultLayout from \"/Users/dennis.okeeffe/Project-Imposter/developer-notes/node_modules/gatsby-theme-docz/src/base/Layout.js\"","position":{"start":{"line":3,"column":1,"offset":2},"end":{"line":3,"column":133,"offset":134},"indent":[]}},{"type":"export","default":true,"value":"export default DefaultLayout","position":{"start":{"line":5,"column":1,"offset":136},"end":{"line":5,"column":29,"offset":164},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"OAUTH AND PASSPORT FOR EXPRESS","position":{"start":{"line":7,"column":1,"offset":166},"end":{"line":7,"column":31,"offset":196},"indent":[]}}],"position":{"start":{"line":7,"column":1,"offset":166},"end":{"line":7,"column":31,"offset":196},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"/////////////////////////////////////////////////////////","position":{"start":{"line":9,"column":1,"offset":198},"end":{"line":9,"column":58,"offset":255},"indent":[]}}],"position":{"start":{"line":9,"column":1,"offset":198},"end":{"line":9,"column":58,"offset":255},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"/","position":{"start":{"line":11,"column":1,"offset":257},"end":{"line":11,"column":2,"offset":258},"indent":[]}},{"type":"strong","children":[{"type":"strong","children":[{"type":"strong","children":[{"type":"strong","children":[{"type":"strong","children":[{"type":"strong","children":[{"type":"text","value":"****","position":{"start":{"line":11,"column":14,"offset":270},"end":{"line":11,"column":18,"offset":274},"indent":[]}}],"position":{"start":{"line":11,"column":12,"offset":268},"end":{"line":11,"column":20,"offset":276},"indent":[]}}],"position":{"start":{"line":11,"column":10,"offset":266},"end":{"line":11,"column":22,"offset":278},"indent":[]}}],"position":{"start":{"line":11,"column":8,"offset":264},"end":{"line":11,"column":24,"offset":280},"indent":[]}}],"position":{"start":{"line":11,"column":6,"offset":262},"end":{"line":11,"column":26,"offset":282},"indent":[]}}],"position":{"start":{"line":11,"column":4,"offset":260},"end":{"line":11,"column":28,"offset":284},"indent":[]}}],"position":{"start":{"line":11,"column":2,"offset":258},"end":{"line":11,"column":30,"offset":286},"indent":[]}}],"position":{"start":{"line":11,"column":1,"offset":257},"end":{"line":11,"column":30,"offset":286},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"code","lang":null,"meta":null,"value":"\t\t\t\t\t*","position":{"start":{"line":12,"column":3,"offset":289},"end":{"line":12,"column":10,"offset":296},"indent":[]}},{"type":"list","ordered":true,"start":1,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"What is OAuth?","position":{"start":{"line":13,"column":7,"offset":303},"end":{"line":13,"column":21,"offset":317},"indent":[]}}],"position":{"start":{"line":13,"column":7,"offset":303},"end":{"line":13,"column":21,"offset":317},"indent":[]}}],"position":{"start":{"line":13,"column":2,"offset":298},"end":{"line":13,"column":21,"offset":317},"indent":[]}}],"position":{"start":{"line":13,"column":2,"offset":298},"end":{"line":13,"column":21,"offset":317},"indent":[]}}],"position":{"start":{"line":12,"column":1,"offset":287},"end":{"line":13,"column":21,"offset":317},"indent":[1]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"code","lang":null,"meta":null,"value":"\t\t\t\t\t*","position":{"start":{"line":14,"column":3,"offset":320},"end":{"line":14,"column":10,"offset":327},"indent":[]}},{"type":"paragraph","children":[{"type":"strong","children":[{"type":"strong","children":[{"type":"strong","children":[{"type":"strong","children":[{"type":"strong","children":[{"type":"strong","children":[{"type":"text","value":"****","position":{"start":{"line":15,"column":13,"offset":340},"end":{"line":15,"column":17,"offset":344},"indent":[]}}],"position":{"start":{"line":15,"column":11,"offset":338},"end":{"line":15,"column":19,"offset":346},"indent":[]}}],"position":{"start":{"line":15,"column":9,"offset":336},"end":{"line":15,"column":21,"offset":348},"indent":[]}}],"position":{"start":{"line":15,"column":7,"offset":334},"end":{"line":15,"column":23,"offset":350},"indent":[]}}],"position":{"start":{"line":15,"column":5,"offset":332},"end":{"line":15,"column":25,"offset":352},"indent":[]}}],"position":{"start":{"line":15,"column":3,"offset":330},"end":{"line":15,"column":27,"offset":354},"indent":[]}}],"position":{"start":{"line":15,"column":1,"offset":328},"end":{"line":15,"column":29,"offset":356},"indent":[]}},{"type":"text","value":"/","position":{"start":{"line":15,"column":29,"offset":356},"end":{"line":15,"column":30,"offset":357},"indent":[]}}],"position":{"start":{"line":15,"column":1,"offset":328},"end":{"line":15,"column":30,"offset":357},"indent":[]}}],"position":{"start":{"line":14,"column":1,"offset":318},"end":{"line":15,"column":30,"offset":357},"indent":[1]}}],"position":{"start":{"line":12,"column":1,"offset":287},"end":{"line":15,"column":30,"offset":357},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"It is authorization, not authentication.","position":{"start":{"line":17,"column":1,"offset":359},"end":{"line":17,"column":41,"offset":399},"indent":[]}}],"position":{"start":{"line":17,"column":1,"offset":359},"end":{"line":17,"column":41,"offset":399},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Authorization is used for what you can do.","position":{"start":{"line":19,"column":1,"offset":401},"end":{"line":19,"column":43,"offset":443},"indent":[]}}],"position":{"start":{"line":19,"column":1,"offset":401},"end":{"line":19,"column":43,"offset":443},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"You usually get tokens...","position":{"start":{"line":21,"column":1,"offset":445},"end":{"line":21,"column":26,"offset":470},"indent":[]}}],"position":{"start":{"line":21,"column":1,"offset":445},"end":{"line":21,"column":26,"offset":470},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Access Token","position":{"start":{"line":22,"column":3,"offset":473},"end":{"line":22,"column":15,"offset":485},"indent":[]}}],"position":{"start":{"line":22,"column":3,"offset":473},"end":{"line":22,"column":15,"offset":485},"indent":[]}}],"position":{"start":{"line":22,"column":1,"offset":471},"end":{"line":22,"column":15,"offset":485},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Refresh Token","position":{"start":{"line":23,"column":3,"offset":488},"end":{"line":23,"column":16,"offset":501},"indent":[]}}],"position":{"start":{"line":23,"column":3,"offset":488},"end":{"line":23,"column":16,"offset":501},"indent":[]}}],"position":{"start":{"line":23,"column":1,"offset":486},"end":{"line":23,"column":16,"offset":501},"indent":[]}}],"position":{"start":{"line":22,"column":1,"offset":471},"end":{"line":23,"column":16,"offset":501},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"/","position":{"start":{"line":25,"column":1,"offset":503},"end":{"line":25,"column":2,"offset":504},"indent":[]}},{"type":"strong","children":[{"type":"strong","children":[{"type":"strong","children":[{"type":"strong","children":[{"type":"strong","children":[{"type":"strong","children":[{"type":"text","value":"****","position":{"start":{"line":25,"column":14,"offset":516},"end":{"line":25,"column":18,"offset":520},"indent":[]}}],"position":{"start":{"line":25,"column":12,"offset":514},"end":{"line":25,"column":20,"offset":522},"indent":[]}}],"position":{"start":{"line":25,"column":10,"offset":512},"end":{"line":25,"column":22,"offset":524},"indent":[]}}],"position":{"start":{"line":25,"column":8,"offset":510},"end":{"line":25,"column":24,"offset":526},"indent":[]}}],"position":{"start":{"line":25,"column":6,"offset":508},"end":{"line":25,"column":26,"offset":528},"indent":[]}}],"position":{"start":{"line":25,"column":4,"offset":506},"end":{"line":25,"column":28,"offset":530},"indent":[]}}],"position":{"start":{"line":25,"column":2,"offset":504},"end":{"line":25,"column":30,"offset":532},"indent":[]}}],"position":{"start":{"line":25,"column":1,"offset":503},"end":{"line":25,"column":30,"offset":532},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"code","lang":null,"meta":null,"value":"\t\t\t\t\t*","position":{"start":{"line":26,"column":3,"offset":535},"end":{"line":26,"column":10,"offset":542},"indent":[]}},{"type":"list","ordered":true,"start":2,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Setting up Passport","position":{"start":{"line":27,"column":5,"offset":547},"end":{"line":27,"column":24,"offset":566},"indent":[]}}],"position":{"start":{"line":27,"column":5,"offset":547},"end":{"line":27,"column":24,"offset":566},"indent":[]}}],"position":{"start":{"line":27,"column":2,"offset":544},"end":{"line":27,"column":24,"offset":566},"indent":[]}}],"position":{"start":{"line":27,"column":2,"offset":544},"end":{"line":27,"column":24,"offset":566},"indent":[]}}],"position":{"start":{"line":26,"column":1,"offset":533},"end":{"line":27,"column":24,"offset":566},"indent":[1]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"code","lang":null,"meta":null,"value":"\t\t\t\t\t*","position":{"start":{"line":28,"column":3,"offset":569},"end":{"line":28,"column":10,"offset":576},"indent":[]}},{"type":"paragraph","children":[{"type":"strong","children":[{"type":"strong","children":[{"type":"strong","children":[{"type":"strong","children":[{"type":"strong","children":[{"type":"strong","children":[{"type":"text","value":"****","position":{"start":{"line":29,"column":13,"offset":589},"end":{"line":29,"column":17,"offset":593},"indent":[]}}],"position":{"start":{"line":29,"column":11,"offset":587},"end":{"line":29,"column":19,"offset":595},"indent":[]}}],"position":{"start":{"line":29,"column":9,"offset":585},"end":{"line":29,"column":21,"offset":597},"indent":[]}}],"position":{"start":{"line":29,"column":7,"offset":583},"end":{"line":29,"column":23,"offset":599},"indent":[]}}],"position":{"start":{"line":29,"column":5,"offset":581},"end":{"line":29,"column":25,"offset":601},"indent":[]}}],"position":{"start":{"line":29,"column":3,"offset":579},"end":{"line":29,"column":27,"offset":603},"indent":[]}}],"position":{"start":{"line":29,"column":1,"offset":577},"end":{"line":29,"column":29,"offset":605},"indent":[]}},{"type":"text","value":"/","position":{"start":{"line":29,"column":29,"offset":605},"end":{"line":29,"column":30,"offset":606},"indent":[]}}],"position":{"start":{"line":29,"column":1,"offset":577},"end":{"line":29,"column":30,"offset":606},"indent":[]}}],"position":{"start":{"line":28,"column":1,"offset":567},"end":{"line":29,"column":30,"offset":606},"indent":[1]}}],"position":{"start":{"line":26,"column":1,"offset":533},"end":{"line":29,"column":30,"offset":606},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"// THE SETUP STRATERGY","position":{"start":{"line":31,"column":1,"offset":608},"end":{"line":31,"column":23,"offset":630},"indent":[]}}],"position":{"start":{"line":31,"column":1,"offset":608},"end":{"line":31,"column":23,"offset":630},"indent":[]}},{"type":"list","ordered":true,"start":1,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Install Strategy","position":{"start":{"line":33,"column":4,"offset":635},"end":{"line":33,"column":20,"offset":651},"indent":[]}}],"position":{"start":{"line":33,"column":4,"offset":635},"end":{"line":33,"column":20,"offset":651},"indent":[]}}],"position":{"start":{"line":33,"column":1,"offset":632},"end":{"line":33,"column":20,"offset":651},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Create 'Application' on OAuth Provider","position":{"start":{"line":34,"column":4,"offset":655},"end":{"line":34,"column":42,"offset":693},"indent":[]}}],"position":{"start":{"line":34,"column":4,"offset":655},"end":{"line":34,"column":42,"offset":693},"indent":[]}}],"position":{"start":{"line":34,"column":1,"offset":652},"end":{"line":34,"column":42,"offset":693},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Configure Strategy","position":{"start":{"line":35,"column":4,"offset":697},"end":{"line":35,"column":22,"offset":715},"indent":[]}}],"position":{"start":{"line":35,"column":4,"offset":697},"end":{"line":35,"column":22,"offset":715},"indent":[]}}],"position":{"start":{"line":35,"column":1,"offset":694},"end":{"line":35,"column":22,"offset":715},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Create routes for the provider","position":{"start":{"line":36,"column":4,"offset":719},"end":{"line":36,"column":34,"offset":749},"indent":[]}}],"position":{"start":{"line":36,"column":4,"offset":719},"end":{"line":36,"column":34,"offset":749},"indent":[]}}],"position":{"start":{"line":36,"column":1,"offset":716},"end":{"line":36,"column":34,"offset":749},"indent":[]}}],"position":{"start":{"line":33,"column":1,"offset":632},"end":{"line":36,"column":34,"offset":749},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"// installing Github auth","position":{"start":{"line":38,"column":1,"offset":751},"end":{"line":38,"column":26,"offset":776},"indent":[]}}],"position":{"start":{"line":38,"column":1,"offset":751},"end":{"line":38,"column":26,"offset":776},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"npm install passport-github --save","position":{"start":{"line":40,"column":1,"offset":778},"end":{"line":40,"column":35,"offset":812},"indent":[]}}],"position":{"start":{"line":40,"column":1,"offset":778},"end":{"line":40,"column":35,"offset":812},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"from here you can register the application on Github in settings","position":{"start":{"line":42,"column":3,"offset":816},"end":{"line":42,"column":67,"offset":880},"indent":[]}}],"position":{"start":{"line":42,"column":3,"offset":816},"end":{"line":42,"column":67,"offset":880},"indent":[]}}],"position":{"start":{"line":42,"column":1,"offset":814},"end":{"line":42,"column":67,"offset":880},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"grab tokens","position":{"start":{"line":43,"column":3,"offset":883},"end":{"line":43,"column":14,"offset":894},"indent":[]}}],"position":{"start":{"line":43,"column":3,"offset":883},"end":{"line":43,"column":14,"offset":894},"indent":[]}}],"position":{"start":{"line":43,"column":1,"offset":881},"end":{"line":43,"column":14,"offset":894},"indent":[]}}],"position":{"start":{"line":42,"column":1,"offset":814},"end":{"line":43,"column":14,"offset":894},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"|||||||||||||||||||||||||||||||||||||||||||||","position":{"start":{"line":45,"column":1,"offset":896},"end":{"line":45,"column":46,"offset":941},"indent":[]}}],"position":{"start":{"line":45,"column":1,"offset":896},"end":{"line":45,"column":46,"offset":941},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"npm install passport --save\nnpm install express-session --save","position":{"start":{"line":47,"column":1,"offset":943},"end":{"line":48,"column":35,"offset":1005},"indent":[1]}}],"position":{"start":{"line":47,"column":1,"offset":943},"end":{"line":48,"column":35,"offset":1005},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"We'll use persistent session store with mongoDB to keep the login persistent","position":{"start":{"line":50,"column":1,"offset":1007},"end":{"line":50,"column":77,"offset":1083},"indent":[]}}],"position":{"start":{"line":50,"column":1,"offset":1007},"end":{"line":50,"column":77,"offset":1083},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"// in app.js","position":{"start":{"line":52,"column":1,"offset":1085},"end":{"line":52,"column":13,"offset":1097},"indent":[]}}],"position":{"start":{"line":52,"column":1,"offset":1085},"end":{"line":52,"column":13,"offset":1097},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"var passport = require('passport');\nvar GitHubStrategy = require('passport-github').Strategy;\nvar FacebookStrategy = require('passport-facebook').Strategy;\nvar session = require('express-session');\nvar MongoStore = require('connect-mongo')(session);","position":{"start":{"line":54,"column":1,"offset":1099},"end":{"line":58,"column":52,"offset":1348},"indent":[1,1,1,1]}}],"position":{"start":{"line":54,"column":1,"offset":1099},"end":{"line":58,"column":52,"offset":1348},"indent":[1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"function generateOrFindUser (accessToken, refreshToken, profile, done) {\n\tUser.findOneAndUpdate({\n\t\temail: profile.emails","position":{"start":{"line":60,"column":1,"offset":1350},"end":{"line":62,"column":24,"offset":1471},"indent":[1,1]}},{"type":"linkReference","identifier":"0","label":"0","referenceType":"shortcut","children":[{"type":"text","value":"0","position":{"start":{"line":62,"column":25,"offset":1472},"end":{"line":62,"column":26,"offset":1473},"indent":[]}}],"position":{"start":{"line":62,"column":24,"offset":1471},"end":{"line":62,"column":27,"offset":1474},"indent":[]}},{"type":"text","value":".value\n\t}, {\n\t\tname: profile.displayName || profile.username,\n\t\temail: profile.emails","position":{"start":{"line":62,"column":27,"offset":1474},"end":{"line":65,"column":24,"offset":1559},"indent":[1,1,1]}},{"type":"linkReference","identifier":"0","label":"0","referenceType":"shortcut","children":[{"type":"text","value":"0","position":{"start":{"line":65,"column":25,"offset":1560},"end":{"line":65,"column":26,"offset":1561},"indent":[]}}],"position":{"start":{"line":65,"column":24,"offset":1559},"end":{"line":65,"column":27,"offset":1562},"indent":[]}},{"type":"text","value":".value,\n\t\tphoto: profile.photos","position":{"start":{"line":65,"column":27,"offset":1562},"end":{"line":66,"column":24,"offset":1593},"indent":[1]}},{"type":"linkReference","identifier":"0","label":"0","referenceType":"shortcut","children":[{"type":"text","value":"0","position":{"start":{"line":66,"column":25,"offset":1594},"end":{"line":66,"column":26,"offset":1595},"indent":[]}}],"position":{"start":{"line":66,"column":24,"offset":1593},"end":{"line":66,"column":27,"offset":1596},"indent":[]}},{"type":"text","value":".value\n\t}, {\n\t\tupsert: true\n\t}, \n\tdone);\n\t} else {\n\t\tvar noEmailError = new Error(\"Your email privacy settings prevent you from signing into bookworm!\");\n\t\tdone(noEmailError, null);\n\t}\n}","position":{"start":{"line":66,"column":27,"offset":1596},"end":{"line":75,"column":2,"offset":1782},"indent":[1,1,1,1,1,1,1,1,1]}}],"position":{"start":{"line":60,"column":1,"offset":1350},"end":{"line":75,"column":2,"offset":1782},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"// config the strategy\npassport.use(new GitHubStrategy({\n\t// do not enter your actual ID and Key here!\n\tclientID: process.env.GITHUB_CLIENT_ID,\n\tclientSecret: process.env.GITHUB_CLIENT_SECRET,\n\tcallbackURL: \"","position":{"start":{"line":77,"column":1,"offset":1784},"end":{"line":82,"column":16,"offset":1992},"indent":[1,1,1,1,1]}},{"type":"link","title":null,"url":"http://localhost:3000/auth/github/return","children":[{"type":"text","value":"http://localhost:3000/auth/github/return","position":{"start":{"line":82,"column":16,"offset":1992},"end":{"line":82,"column":56,"offset":2032},"indent":[]}}],"position":{"start":{"line":82,"column":16,"offset":1992},"end":{"line":82,"column":56,"offset":2032},"indent":[]}},{"type":"text","value":"\"\n\t}, generateOrFindUser));","position":{"start":{"line":82,"column":56,"offset":2032},"end":{"line":83,"column":26,"offset":2059},"indent":[1]}}],"position":{"start":{"line":77,"column":1,"offset":1784},"end":{"line":83,"column":26,"offset":2059},"indent":[1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"passport.use(new FacebookStrategy({\n\t// do not enter your actual ID and Key here!\n\tclientID: process.env.FACEBOOK_APP_ID,\n\tclientSecret: process.env.FACEBOOK_APP_SECRET,\n\tcallbackURL: \"","position":{"start":{"line":85,"column":1,"offset":2061},"end":{"line":89,"column":16,"offset":2246},"indent":[1,1,1,1]}},{"type":"link","title":null,"url":"http://localhost:3000/auth/facebook/return\"","children":[{"type":"text","value":"http://localhost:3000/auth/facebook/return\"","position":{"start":{"line":89,"column":16,"offset":2246},"end":{"line":89,"column":59,"offset":2289},"indent":[]}}],"position":{"start":{"line":89,"column":16,"offset":2246},"end":{"line":89,"column":59,"offset":2289},"indent":[]}},{"type":"text","value":",\n\tprofileFields: ","position":{"start":{"line":89,"column":59,"offset":2289},"end":{"line":90,"column":17,"offset":2307},"indent":[1]}},{"type":"linkReference","identifier":"'id', 'displayname', 'photos', 'email'","label":"'id', 'displayName', 'photos', 'email'","referenceType":"shortcut","children":[{"type":"text","value":"'id', 'displayName', 'photos', 'email'","position":{"start":{"line":90,"column":18,"offset":2308},"end":{"line":90,"column":56,"offset":2346},"indent":[]}}],"position":{"start":{"line":90,"column":17,"offset":2307},"end":{"line":90,"column":57,"offset":2347},"indent":[]}},{"type":"text","value":"\n}), generateOrFindUser);","position":{"start":{"line":90,"column":57,"offset":2347},"end":{"line":91,"column":25,"offset":2372},"indent":[1]}}],"position":{"start":{"line":85,"column":1,"offset":2061},"end":{"line":91,"column":25,"offset":2372},"indent":[1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"passport.serializeUser(function (user, done) {\n\tdone(null, user._id);\n});","position":{"start":{"line":94,"column":1,"offset":2375},"end":{"line":96,"column":4,"offset":2448},"indent":[1,1]}}],"position":{"start":{"line":94,"column":1,"offset":2375},"end":{"line":96,"column":4,"offset":2448},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"passport.deserializeUser(function(userId, done) {\n\tUser.findById(userId, done); // done is a callback function\n});","position":{"start":{"line":98,"column":1,"offset":2450},"end":{"line":100,"column":4,"offset":2564},"indent":[1,1]}}],"position":{"start":{"line":98,"column":1,"offset":2450},"end":{"line":100,"column":4,"offset":2564},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"...","position":{"start":{"line":102,"column":1,"offset":2566},"end":{"line":102,"column":4,"offset":2569},"indent":[]}}],"position":{"start":{"line":102,"column":1,"offset":2566},"end":{"line":102,"column":4,"offset":2569},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"var auth = require('./routes/auth');","position":{"start":{"line":104,"column":1,"offset":2571},"end":{"line":104,"column":37,"offset":2607},"indent":[]}}],"position":{"start":{"line":104,"column":1,"offset":2571},"end":{"line":104,"column":37,"offset":2607},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"...","position":{"start":{"line":106,"column":1,"offset":2609},"end":{"line":106,"column":4,"offset":2612},"indent":[]}}],"position":{"start":{"line":106,"column":1,"offset":2609},"end":{"line":106,"column":4,"offset":2612},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"// after db connection\n// Session config for Passport and MongoDB","position":{"start":{"line":109,"column":1,"offset":2615},"end":{"line":110,"column":43,"offset":2680},"indent":[1]}}],"position":{"start":{"line":109,"column":1,"offset":2615},"end":{"line":110,"column":43,"offset":2680},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"var sessionOptions = {\n\tsecret: \"this is a super secret dadada\",\n\tresave: true,\n\tsaveUninitialized: true,\n\tstore: new MongoStore({\n\t\tmongooseConnection: db\n\t})\n}","position":{"start":{"line":112,"column":1,"offset":2682},"end":{"line":119,"column":2,"offset":2843},"indent":[1,1,1,1,1,1,1]}}],"position":{"start":{"line":112,"column":1,"offset":2682},"end":{"line":119,"column":2,"offset":2843},"indent":[1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"app.use(session(sessionOptions));","position":{"start":{"line":121,"column":1,"offset":2845},"end":{"line":121,"column":34,"offset":2878},"indent":[]}}],"position":{"start":{"line":121,"column":1,"offset":2845},"end":{"line":121,"column":34,"offset":2878},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"// Init Passport\napp.use(passport.initialize());","position":{"start":{"line":123,"column":1,"offset":2880},"end":{"line":124,"column":32,"offset":2928},"indent":[1]}}],"position":{"start":{"line":123,"column":1,"offset":2880},"end":{"line":124,"column":32,"offset":2928},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"// Restore Session\napp.use(passport.session());","position":{"start":{"line":126,"column":1,"offset":2930},"end":{"line":127,"column":29,"offset":2977},"indent":[1]}}],"position":{"start":{"line":126,"column":1,"offset":2930},"end":{"line":127,"column":29,"offset":2977},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"app.use('/auth', auth);","position":{"start":{"line":129,"column":1,"offset":2979},"end":{"line":129,"column":24,"offset":3002},"indent":[]}}],"position":{"start":{"line":129,"column":1,"offset":2979},"end":{"line":129,"column":24,"offset":3002},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"// in routes > auth.js","position":{"start":{"line":131,"column":1,"offset":3004},"end":{"line":131,"column":23,"offset":3026},"indent":[]}}],"position":{"start":{"line":131,"column":1,"offset":3004},"end":{"line":131,"column":23,"offset":3026},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"var express = require('express');\nvar router = express.Router();\nvar passport = require('passport');","position":{"start":{"line":133,"column":1,"offset":3028},"end":{"line":135,"column":36,"offset":3128},"indent":[1,1]}}],"position":{"start":{"line":133,"column":1,"offset":3028},"end":{"line":135,"column":36,"offset":3128},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"// Get /auth/login/github","position":{"start":{"line":137,"column":1,"offset":3130},"end":{"line":137,"column":26,"offset":3155},"indent":[]}}],"position":{"start":{"line":137,"column":1,"offset":3130},"end":{"line":137,"column":26,"offset":3155},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"router.get('/login/github',\n\tpassport.authenticate('github'));","position":{"start":{"line":139,"column":1,"offset":3157},"end":{"line":140,"column":35,"offset":3219},"indent":[1]}}],"position":{"start":{"line":139,"column":1,"offset":3157},"end":{"line":140,"column":35,"offset":3219},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"// Get /auth/github/return","position":{"start":{"line":142,"column":1,"offset":3221},"end":{"line":142,"column":27,"offset":3247},"indent":[]}}],"position":{"start":{"line":142,"column":1,"offset":3221},"end":{"line":142,"column":27,"offset":3247},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"router.get('/github/return',\n\tpassport.authenticate('github', {failedRedirect: '/'}),\n\tfunction(req, res) {\n\t\t//Succes Auth, redirect to page for now\n\t\tres.redirect('/profile');\n\t});","position":{"start":{"line":144,"column":1,"offset":3249},"end":{"line":149,"column":5,"offset":3431},"indent":[1,1,1,1,1]}}],"position":{"start":{"line":144,"column":1,"offset":3249},"end":{"line":149,"column":5,"offset":3431},"indent":[1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"// Get /auth/login/facebook","position":{"start":{"line":151,"column":1,"offset":3433},"end":{"line":151,"column":28,"offset":3460},"indent":[]}}],"position":{"start":{"line":151,"column":1,"offset":3433},"end":{"line":151,"column":28,"offset":3460},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"router.get('/login/facebook',\n\tpassport.authenticate('facebook', { scope: ","position":{"start":{"line":153,"column":1,"offset":3462},"end":{"line":154,"column":45,"offset":3536},"indent":[1]}},{"type":"linkReference","identifier":"\"email\"","label":"\"email\"","referenceType":"shortcut","children":[{"type":"text","value":"\"email\"","position":{"start":{"line":154,"column":46,"offset":3537},"end":{"line":154,"column":53,"offset":3544},"indent":[]}}],"position":{"start":{"line":154,"column":45,"offset":3536},"end":{"line":154,"column":54,"offset":3545},"indent":[]}},{"type":"text","value":"}));","position":{"start":{"line":154,"column":54,"offset":3545},"end":{"line":154,"column":58,"offset":3549},"indent":[]}}],"position":{"start":{"line":153,"column":1,"offset":3462},"end":{"line":154,"column":58,"offset":3549},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"// Get /auth/facebook/return","position":{"start":{"line":156,"column":1,"offset":3551},"end":{"line":156,"column":29,"offset":3579},"indent":[]}}],"position":{"start":{"line":156,"column":1,"offset":3551},"end":{"line":156,"column":29,"offset":3579},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"router.get('/facebook/return',\n\tpassport.authenticate('facebook', {failedRedirect: '/'}),\n\tfunction(req, res) {\n\t\t//Succes Auth, redirect to page for now\n\t\tres.redirect('/profile');\n\t});","position":{"start":{"line":158,"column":1,"offset":3581},"end":{"line":163,"column":5,"offset":3767},"indent":[1,1,1,1,1]}}],"position":{"start":{"line":158,"column":1,"offset":3581},"end":{"line":163,"column":5,"offset":3767},"indent":[1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"// GET /auth/logout","position":{"start":{"line":165,"column":1,"offset":3769},"end":{"line":165,"column":20,"offset":3788},"indent":[]}}],"position":{"start":{"line":165,"column":1,"offset":3769},"end":{"line":165,"column":20,"offset":3788},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"router.get('/logout', function(req, res) {\n\treq.logout();\n\tres.redirect('/');\n})","position":{"start":{"line":167,"column":1,"offset":3790},"end":{"line":170,"column":3,"offset":3870},"indent":[1,1,1]}}],"position":{"start":{"line":167,"column":1,"offset":3790},"end":{"line":170,"column":3,"offset":3870},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"module.exports = router;","position":{"start":{"line":172,"column":1,"offset":3872},"end":{"line":172,"column":25,"offset":3896},"indent":[]}}],"position":{"start":{"line":172,"column":1,"offset":3872},"end":{"line":172,"column":25,"offset":3896},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"// to use vars in command line...","position":{"start":{"line":174,"column":1,"offset":3898},"end":{"line":174,"column":34,"offset":3931},"indent":[]}}],"position":{"start":{"line":174,"column":1,"offset":3898},"end":{"line":174,"column":34,"offset":3931},"indent":[]}},{"type":"blockquote","children":[{"type":"paragraph","children":[{"type":"text","value":"GITHUB_CLIENT_ID=123432 GITHUB_CLIENT_SECRET=892u3rw9u ./bin/www","position":{"start":{"line":176,"column":3,"offset":3935},"end":{"line":176,"column":67,"offset":3999},"indent":[]}}],"position":{"start":{"line":176,"column":3,"offset":3935},"end":{"line":176,"column":67,"offset":3999},"indent":[]}}],"position":{"start":{"line":176,"column":1,"offset":3933},"end":{"line":176,"column":67,"offset":3999},"indent":[]}},{"type":"export","value":"export const _frontmatter = {}","position":{"start":{"line":190,"column":1,"offset":4013},"end":{"line":190,"column":31,"offset":4043},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":190,"column":31,"offset":4043}}},"scopeImports":[],"scopeIdentifiers":[],"rawMDXOutput":"/* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\nimport DefaultLayout from \"/Users/dennis.okeeffe/Project-Imposter/developer-notes/node_modules/gatsby-theme-docz/src/base/Layout.js\"\nexport const _frontmatter = {};\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\")\n  return <div {...props}/>\n};\n\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <p>{`OAUTH AND PASSPORT FOR EXPRESS`}</p>\n    <p>{`/////////////////////////////////////////////////////////`}</p>\n    <p>{`/`}<strong parentName=\"p\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\">{`****`}</strong></strong></strong></strong></strong></strong></p>\n    <ul>\n      <li parentName=\"ul\"><pre parentName=\"li\"><code parentName=\"pre\" {...{}}>{`                    *\n`}</code></pre><ol parentName=\"li\">\n          <li parentName=\"ol\">{`What is OAuth?`}</li>\n        </ol></li>\n      <li parentName=\"ul\"><pre parentName=\"li\"><code parentName=\"pre\" {...{}}>{`                    *\n`}</code></pre><strong parentName=\"li\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\">{`****`}</strong></strong></strong></strong></strong></strong>{`/`}</li>\n    </ul>\n    <p>{`It is authorization, not authentication.`}</p>\n    <p>{`Authorization is used for what you can do.`}</p>\n    <p>{`You usually get tokens...`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Access Token`}</li>\n      <li parentName=\"ul\">{`Refresh Token`}</li>\n    </ul>\n    <p>{`/`}<strong parentName=\"p\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\">{`****`}</strong></strong></strong></strong></strong></strong></p>\n    <ul>\n      <li parentName=\"ul\"><pre parentName=\"li\"><code parentName=\"pre\" {...{}}>{`                    *\n`}</code></pre><ol parentName=\"li\" {...{\n          \"start\": 2\n        }}>\n          <li parentName=\"ol\">{`Setting up Passport`}</li>\n        </ol></li>\n      <li parentName=\"ul\"><pre parentName=\"li\"><code parentName=\"pre\" {...{}}>{`                    *\n`}</code></pre><strong parentName=\"li\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\">{`****`}</strong></strong></strong></strong></strong></strong>{`/`}</li>\n    </ul>\n    <p>{`// THE SETUP STRATERGY`}</p>\n    <ol>\n      <li parentName=\"ol\">{`Install Strategy`}</li>\n      <li parentName=\"ol\">{`Create 'Application' on OAuth Provider`}</li>\n      <li parentName=\"ol\">{`Configure Strategy`}</li>\n      <li parentName=\"ol\">{`Create routes for the provider`}</li>\n    </ol>\n    <p>{`// installing Github auth`}</p>\n    <p>{`npm install passport-github --save`}</p>\n    <ul>\n      <li parentName=\"ul\">{`from here you can register the application on Github in settings`}</li>\n      <li parentName=\"ul\">{`grab tokens`}</li>\n    </ul>\n    <p>{`|||||||||||||||||||||||||||||||||||||||||||||`}</p>\n    <p>{`npm install passport --save\nnpm install express-session --save`}</p>\n    <p>{`We'll use persistent session store with mongoDB to keep the login persistent`}</p>\n    <p>{`// in app.js`}</p>\n    <p>{`var passport = require('passport');\nvar GitHubStrategy = require('passport-github').Strategy;\nvar FacebookStrategy = require('passport-facebook').Strategy;\nvar session = require('express-session');\nvar MongoStore = require('connect-mongo')(session);`}</p>\n    <p>{`function generateOrFindUser (accessToken, refreshToken, profile, done) {\nUser.findOneAndUpdate({\nemail: profile.emails`}{`[0]`}{`.value\n}, {\nname: profile.displayName || profile.username,\nemail: profile.emails`}{`[0]`}{`.value,\nphoto: profile.photos`}{`[0]`}{`.value\n}, {\nupsert: true\n},\ndone);\n} else {\nvar noEmailError = new Error(\"Your email privacy settings prevent you from signing into bookworm!\");\ndone(noEmailError, null);\n}\n}`}</p>\n    <p>{`// config the strategy\npassport.use(new GitHubStrategy({\n// do not enter your actual ID and Key here!\nclientID: process.env.GITHUB_CLIENT_ID,\nclientSecret: process.env.GITHUB_CLIENT_SECRET,\ncallbackURL: \"`}<a parentName=\"p\" {...{\n        \"href\": \"http://localhost:3000/auth/github/return\"\n      }}>{`http://localhost:3000/auth/github/return`}</a>{`\"\n}, generateOrFindUser));`}</p>\n    <p>{`passport.use(new FacebookStrategy({\n// do not enter your actual ID and Key here!\nclientID: process.env.FACEBOOK_APP_ID,\nclientSecret: process.env.FACEBOOK_APP_SECRET,\ncallbackURL: \"`}<a parentName=\"p\" {...{\n        \"href\": \"http://localhost:3000/auth/facebook/return%22\"\n      }}>{`http://localhost:3000/auth/facebook/return\"`}</a>{`,\nprofileFields: `}{`['id', 'displayName', 'photos', 'email']`}{`\n}), generateOrFindUser);`}</p>\n    <p>{`passport.serializeUser(function (user, done) {\ndone(null, user._id);\n});`}</p>\n    <p>{`passport.deserializeUser(function(userId, done) {\nUser.findById(userId, done); // done is a callback function\n});`}</p>\n    <p>{`...`}</p>\n    <p>{`var auth = require('./routes/auth');`}</p>\n    <p>{`...`}</p>\n    <p>{`// after db connection\n// Session config for Passport and MongoDB`}</p>\n    <p>{`var sessionOptions = {\nsecret: \"this is a super secret dadada\",\nresave: true,\nsaveUninitialized: true,\nstore: new MongoStore({\nmongooseConnection: db\n})\n}`}</p>\n    <p>{`app.use(session(sessionOptions));`}</p>\n    <p>{`// Init Passport\napp.use(passport.initialize());`}</p>\n    <p>{`// Restore Session\napp.use(passport.session());`}</p>\n    <p>{`app.use('/auth', auth);`}</p>\n    <p>{`// in routes > auth.js`}</p>\n    <p>{`var express = require('express');\nvar router = express.Router();\nvar passport = require('passport');`}</p>\n    <p>{`// Get /auth/login/github`}</p>\n    <p>{`router.get('/login/github',\npassport.authenticate('github'));`}</p>\n    <p>{`// Get /auth/github/return`}</p>\n    <p>{`router.get('/github/return',\npassport.authenticate('github', {failedRedirect: '/'}),\nfunction(req, res) {\n//Succes Auth, redirect to page for now\nres.redirect('/profile');\n});`}</p>\n    <p>{`// Get /auth/login/facebook`}</p>\n    <p>{`router.get('/login/facebook',\npassport.authenticate('facebook', { scope: `}{`[\"email\"]`}{`}));`}</p>\n    <p>{`// Get /auth/facebook/return`}</p>\n    <p>{`router.get('/facebook/return',\npassport.authenticate('facebook', {failedRedirect: '/'}),\nfunction(req, res) {\n//Succes Auth, redirect to page for now\nres.redirect('/profile');\n});`}</p>\n    <p>{`// GET /auth/logout`}</p>\n    <p>{`router.get('/logout', function(req, res) {\nreq.logout();\nres.redirect('/');\n})`}</p>\n    <p>{`module.exports = router;`}</p>\n    <p>{`// to use vars in command line...`}</p>\n    <blockquote>\n      <p parentName=\"blockquote\">{`GITHUB_CLIENT_ID=123432 GITHUB_CLIENT_SECRET=892u3rw9u ./bin/www`}</p>\n    </blockquote>\n\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;"}}