{"expireTime":9007200848610887000,"key":"gatsby-plugin-mdx-entire-payload-c448eff83bd9142366e52078dfd1d035-","val":{"mdast":{"type":"root","children":[{"type":"import","value":"import DefaultLayout from \"/Users/dennis.okeeffe/Project-Imposter/developer-notes/node_modules/gatsby-theme-docz/src/base/Layout.js\"","position":{"start":{"line":3,"column":1,"offset":2},"end":{"line":3,"column":133,"offset":134},"indent":[]}},{"type":"export","default":true,"value":"export default DefaultLayout","position":{"start":{"line":5,"column":1,"offset":136},"end":{"line":5,"column":29,"offset":164},"indent":[]}},{"type":"heading","depth":1,"children":[{"type":"text","value":"Kubernetes Basics","position":{"start":{"line":8,"column":3,"offset":169},"end":{"line":8,"column":20,"offset":186},"indent":[]}}],"position":{"start":{"line":8,"column":1,"offset":167},"end":{"line":8,"column":20,"offset":186},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Node Architecture","position":{"start":{"line":10,"column":5,"offset":192},"end":{"line":10,"column":22,"offset":209},"indent":[]}}],"position":{"start":{"line":10,"column":1,"offset":188},"end":{"line":10,"column":22,"offset":209},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Within each node can be a collection of pods routed by iptables and within each pod are the Docker containers.","position":{"start":{"line":12,"column":1,"offset":211},"end":{"line":12,"column":111,"offset":321},"indent":[]}}],"position":{"start":{"line":12,"column":1,"offset":211},"end":{"line":12,"column":111,"offset":321},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"These containers can talk easily to each other using localhost and ports.","position":{"start":{"line":14,"column":1,"offset":323},"end":{"line":14,"column":74,"offset":396},"indent":[]}}],"position":{"start":{"line":14,"column":1,"offset":323},"end":{"line":14,"column":74,"offset":396},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Each node also has a ","position":{"start":{"line":16,"column":1,"offset":398},"end":{"line":16,"column":22,"offset":419},"indent":[]}},{"type":"inlineCode","value":"kubelet","position":{"start":{"line":16,"column":22,"offset":419},"end":{"line":16,"column":31,"offset":428},"indent":[]}},{"type":"text","value":" and ","position":{"start":{"line":16,"column":31,"offset":428},"end":{"line":16,"column":36,"offset":433},"indent":[]}},{"type":"inlineCode","value":"kube-proxy","position":{"start":{"line":16,"column":36,"offset":433},"end":{"line":16,"column":48,"offset":445},"indent":[]}},{"type":"text","value":". The ","position":{"start":{"line":16,"column":48,"offset":445},"end":{"line":16,"column":54,"offset":451},"indent":[]}},{"type":"inlineCode","value":"kubelet","position":{"start":{"line":16,"column":54,"offset":451},"end":{"line":16,"column":63,"offset":460},"indent":[]}},{"type":"text","value":" talks to the master node and ","position":{"start":{"line":16,"column":63,"offset":460},"end":{"line":16,"column":93,"offset":490},"indent":[]}},{"type":"inlineCode","value":"kube-proxy","position":{"start":{"line":16,"column":93,"offset":490},"end":{"line":16,"column":105,"offset":502},"indent":[]}},{"type":"text","value":" talks to the iptables.","position":{"start":{"line":16,"column":105,"offset":502},"end":{"line":16,"column":128,"offset":525},"indent":[]}}],"position":{"start":{"line":16,"column":1,"offset":398},"end":{"line":16,"column":128,"offset":525},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"A service itself can be like the load balancer. The service will be publicly available.","position":{"start":{"line":18,"column":1,"offset":527},"end":{"line":18,"column":88,"offset":614},"indent":[]}}],"position":{"start":{"line":18,"column":1,"offset":527},"end":{"line":18,"column":88,"offset":614},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"When we look deeper at a pod yaml file, we have the containers called as the specs.","position":{"start":{"line":20,"column":1,"offset":616},"end":{"line":20,"column":84,"offset":699},"indent":[]}}],"position":{"start":{"line":20,"column":1,"offset":616},"end":{"line":20,"column":84,"offset":699},"indent":[]}},{"type":"code","lang":"yaml","meta":null,"value":"# pod-helloworld.yml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nodehelloworld.example.com\n  labels:\n  app: helloworld\nspec:\n  # The containers are listed here\n  containers:\n  - name: k8s-demo\n    image: okeeffed/docker-demo\n    ports:\n    - containerPort: 3000","position":{"start":{"line":22,"column":1,"offset":701},"end":{"line":37,"column":4,"offset":974},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Replication Controller","position":{"start":{"line":39,"column":5,"offset":980},"end":{"line":39,"column":27,"offset":1002},"indent":[]}}],"position":{"start":{"line":39,"column":1,"offset":976},"end":{"line":39,"column":27,"offset":1002},"indent":[]}},{"type":"heading","depth":4,"children":[{"type":"text","value":"Scaling","position":{"start":{"line":41,"column":6,"offset":1009},"end":{"line":41,"column":13,"offset":1016},"indent":[]}}],"position":{"start":{"line":41,"column":1,"offset":1004},"end":{"line":41,"column":13,"offset":1016},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"If your application is ","position":{"start":{"line":43,"column":1,"offset":1018},"end":{"line":43,"column":24,"offset":1041},"indent":[]}},{"type":"inlineCode","value":"stateless","position":{"start":{"line":43,"column":24,"offset":1041},"end":{"line":43,"column":35,"offset":1052},"indent":[]}},{"type":"text","value":" you can horizontally scale it.","position":{"start":{"line":43,"column":35,"offset":1052},"end":{"line":43,"column":66,"offset":1083},"indent":[]}}],"position":{"start":{"line":43,"column":1,"offset":1018},"end":{"line":43,"column":66,"offset":1083},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Stateless = your appllication doesn't have a ","position":{"start":{"line":45,"column":5,"offset":1089},"end":{"line":45,"column":50,"offset":1134},"indent":[]}},{"type":"inlineCode","value":"state","position":{"start":{"line":45,"column":50,"offset":1134},"end":{"line":45,"column":57,"offset":1141},"indent":[]}},{"type":"text","value":", it doesn't write any local files / keeps local sessions. This prevents pods from falling out of sync.","position":{"start":{"line":45,"column":57,"offset":1141},"end":{"line":45,"column":160,"offset":1244},"indent":[]}}],"position":{"start":{"line":45,"column":5,"offset":1089},"end":{"line":45,"column":160,"offset":1244},"indent":[]}}],"position":{"start":{"line":45,"column":1,"offset":1085},"end":{"line":45,"column":160,"offset":1244},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"All traditional databases are ","position":{"start":{"line":46,"column":5,"offset":1249},"end":{"line":46,"column":35,"offset":1279},"indent":[]}},{"type":"inlineCode","value":"stateful","position":{"start":{"line":46,"column":35,"offset":1279},"end":{"line":46,"column":45,"offset":1289},"indent":[]}}],"position":{"start":{"line":46,"column":5,"offset":1249},"end":{"line":46,"column":45,"offset":1289},"indent":[]}}],"position":{"start":{"line":46,"column":1,"offset":1245},"end":{"line":46,"column":45,"offset":1289},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Most ","position":{"start":{"line":47,"column":5,"offset":1294},"end":{"line":47,"column":10,"offset":1299},"indent":[]}},{"type":"inlineCode","value":"web applications","position":{"start":{"line":47,"column":10,"offset":1299},"end":{"line":47,"column":28,"offset":1317},"indent":[]}},{"type":"text","value":" can be made stateless","position":{"start":{"line":47,"column":28,"offset":1317},"end":{"line":47,"column":50,"offset":1339},"indent":[]}}],"position":{"start":{"line":47,"column":5,"offset":1294},"end":{"line":47,"column":50,"offset":1339},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Session management needs to be done outside the container","position":{"start":{"line":48,"column":9,"offset":1348},"end":{"line":48,"column":66,"offset":1405},"indent":[]}}],"position":{"start":{"line":48,"column":9,"offset":1348},"end":{"line":48,"column":66,"offset":1405},"indent":[]}}],"position":{"start":{"line":48,"column":5,"offset":1344},"end":{"line":48,"column":66,"offset":1405},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Any file to be saved cannot be saved locally","position":{"start":{"line":49,"column":9,"offset":1414},"end":{"line":49,"column":53,"offset":1458},"indent":[]}}],"position":{"start":{"line":49,"column":9,"offset":1414},"end":{"line":49,"column":53,"offset":1458},"indent":[]}}],"position":{"start":{"line":49,"column":5,"offset":1410},"end":{"line":49,"column":53,"offset":1458},"indent":[]}}],"position":{"start":{"line":48,"column":5,"offset":1344},"end":{"line":49,"column":53,"offset":1458},"indent":[5]}}],"position":{"start":{"line":47,"column":1,"offset":1290},"end":{"line":49,"column":53,"offset":1458},"indent":[1,1]}}],"position":{"start":{"line":45,"column":1,"offset":1085},"end":{"line":49,"column":53,"offset":1458},"indent":[1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"If needed, you can use ","position":{"start":{"line":51,"column":1,"offset":1460},"end":{"line":51,"column":24,"offset":1483},"indent":[]}},{"type":"inlineCode","value":"volumes","position":{"start":{"line":51,"column":24,"offset":1483},"end":{"line":51,"column":33,"offset":1492},"indent":[]}},{"type":"text","value":" to still run stateful apps.","position":{"start":{"line":51,"column":33,"offset":1492},"end":{"line":51,"column":61,"offset":1520},"indent":[]}}],"position":{"start":{"line":51,"column":1,"offset":1460},"end":{"line":51,"column":61,"offset":1520},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Those stateful apps can't horizontally scale, but you can run them in a single container and vertically scale (allocate more CPU/Mem/Disk).","position":{"start":{"line":53,"column":1,"offset":1522},"end":{"line":53,"column":140,"offset":1661},"indent":[]}}],"position":{"start":{"line":53,"column":1,"offset":1522},"end":{"line":53,"column":140,"offset":1661},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Scaling in Kubernetes can be done using the ","position":{"start":{"line":55,"column":1,"offset":1663},"end":{"line":55,"column":45,"offset":1707},"indent":[]}},{"type":"inlineCode","value":"Replication Controller","position":{"start":{"line":55,"column":45,"offset":1707},"end":{"line":55,"column":69,"offset":1731},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":55,"column":69,"offset":1731},"end":{"line":55,"column":70,"offset":1732},"indent":[]}}],"position":{"start":{"line":55,"column":1,"offset":1663},"end":{"line":55,"column":70,"offset":1732},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The replication controller will ensure a specified number of pod replicas will run at all times.","position":{"start":{"line":57,"column":1,"offset":1734},"end":{"line":57,"column":97,"offset":1830},"indent":[]}}],"position":{"start":{"line":57,"column":1,"offset":1734},"end":{"line":57,"column":97,"offset":1830},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"A pod created with the replica controller will automatically be replaced if they fail, get deleted or are terminated.","position":{"start":{"line":59,"column":1,"offset":1832},"end":{"line":59,"column":118,"offset":1949},"indent":[]}}],"position":{"start":{"line":59,"column":1,"offset":1832},"end":{"line":59,"column":118,"offset":1949},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Using the replication controller is also recommended if you just want to make sure 1 pod is always running, even after reboots.","position":{"start":{"line":61,"column":1,"offset":1951},"end":{"line":61,"column":128,"offset":2078},"indent":[]}}],"position":{"start":{"line":61,"column":1,"offset":1951},"end":{"line":61,"column":128,"offset":2078},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"You can then run a replication controller with just 1 replica to ensure that it is always running.","position":{"start":{"line":63,"column":1,"offset":2080},"end":{"line":63,"column":99,"offset":2178},"indent":[]}}],"position":{"start":{"line":63,"column":1,"offset":2080},"end":{"line":63,"column":99,"offset":2178},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"To create a replication controller:","position":{"start":{"line":65,"column":1,"offset":2180},"end":{"line":65,"column":36,"offset":2215},"indent":[]}}],"position":{"start":{"line":65,"column":1,"offset":2180},"end":{"line":65,"column":36,"offset":2215},"indent":[]}},{"type":"code","lang":"yaml","meta":null,"value":"# rc-helloworld.yml\napiVersion: v1\nkind: ReplicationController # Changed from Pod\nmetadata:\n  name: helloworld-container\nspec: # Replation controller also has a spec\n  replicas: 2 # set two pod replicas\n  selector:  # select the app\n  app: helloworld\n  template:\n  # stand Pod metadata and spec\n  metadata:\n    name: nodehelloworld.example.com\n    labels:\n    app: helloworld\n  spec:\n    # The containers are listed here\n    containers:\n    - name: k8s-demo\n      image: okeeffed/docker-demo\n      ports:\n      - containerPort: 3000","position":{"start":{"line":67,"column":1,"offset":2217},"end":{"line":90,"column":4,"offset":2761},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"When this controller is created with ","position":{"start":{"line":92,"column":1,"offset":2763},"end":{"line":92,"column":38,"offset":2800},"indent":[]}},{"type":"inlineCode","value":"kubectl","position":{"start":{"line":92,"column":38,"offset":2800},"end":{"line":92,"column":47,"offset":2809},"indent":[]}},{"type":"text","value":", you will see that the two pods are created with a differing suffix.","position":{"start":{"line":92,"column":47,"offset":2809},"end":{"line":92,"column":116,"offset":2878},"indent":[]}}],"position":{"start":{"line":92,"column":1,"offset":2763},"end":{"line":92,"column":116,"offset":2878},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Now we have horizontally scaled this pod.","position":{"start":{"line":94,"column":1,"offset":2880},"end":{"line":94,"column":42,"offset":2921},"indent":[]}}],"position":{"start":{"line":94,"column":1,"offset":2880},"end":{"line":94,"column":42,"offset":2921},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"If one of these pods is now deleted, the master node will automatically schedule a new one.","position":{"start":{"line":96,"column":1,"offset":2923},"end":{"line":96,"column":92,"offset":3014},"indent":[]}}],"position":{"start":{"line":96,"column":1,"offset":2923},"end":{"line":96,"column":92,"offset":3014},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"We can also scale this by using ","position":{"start":{"line":98,"column":1,"offset":3016},"end":{"line":98,"column":33,"offset":3048},"indent":[]}},{"type":"inlineCode","value":"kubectl scale --replicas=4 -f <replication-controller-name.yml>","position":{"start":{"line":98,"column":33,"offset":3048},"end":{"line":98,"column":98,"offset":3113},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":98,"column":98,"offset":3113},"end":{"line":98,"column":99,"offset":3114},"indent":[]}}],"position":{"start":{"line":98,"column":1,"offset":3016},"end":{"line":98,"column":99,"offset":3114},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"We can also use it with the following:","position":{"start":{"line":100,"column":1,"offset":3116},"end":{"line":100,"column":39,"offset":3154},"indent":[]}}],"position":{"start":{"line":100,"column":1,"offset":3116},"end":{"line":100,"column":39,"offset":3154},"indent":[]}},{"type":"code","lang":"shell","meta":null,"value":"kubectl get rc # get replication controllers\n# assume helloworld-controller shows up\nkubectl scale --replicas=1 rc/helloworld-container\nkubectl get pods # will show only one pod remaining","position":{"start":{"line":102,"column":1,"offset":3156},"end":{"line":107,"column":4,"offset":3356},"indent":[1,1,1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Deployments","position":{"start":{"line":109,"column":4,"offset":3361},"end":{"line":109,"column":15,"offset":3372},"indent":[]}}],"position":{"start":{"line":109,"column":1,"offset":3358},"end":{"line":109,"column":15,"offset":3372},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Replication Set is the next gen Replication Controller:","position":{"start":{"line":111,"column":1,"offset":3374},"end":{"line":111,"column":56,"offset":3429},"indent":[]}}],"position":{"start":{"line":111,"column":1,"offset":3374},"end":{"line":111,"column":56,"offset":3429},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"It supports new selector that can do selection based on filtering according a set of values eg environment either \"dev\" or \"qa\"","position":{"start":{"line":113,"column":5,"offset":3435},"end":{"line":113,"column":132,"offset":3562},"indent":[]}}],"position":{"start":{"line":113,"column":5,"offset":3435},"end":{"line":113,"column":132,"offset":3562},"indent":[]}}],"position":{"start":{"line":113,"column":1,"offset":3431},"end":{"line":113,"column":132,"offset":3562},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"It's not only based on equality. You can do more complex things.","position":{"start":{"line":114,"column":5,"offset":3567},"end":{"line":114,"column":69,"offset":3631},"indent":[]}}],"position":{"start":{"line":114,"column":5,"offset":3567},"end":{"line":114,"column":69,"offset":3631},"indent":[]}}],"position":{"start":{"line":114,"column":1,"offset":3563},"end":{"line":114,"column":69,"offset":3631},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"This RS is used by the Deployment.","position":{"start":{"line":115,"column":5,"offset":3636},"end":{"line":115,"column":39,"offset":3670},"indent":[]}}],"position":{"start":{"line":115,"column":5,"offset":3636},"end":{"line":115,"column":39,"offset":3670},"indent":[]}}],"position":{"start":{"line":115,"column":1,"offset":3632},"end":{"line":115,"column":39,"offset":3670},"indent":[]}}],"position":{"start":{"line":113,"column":1,"offset":3431},"end":{"line":115,"column":39,"offset":3670},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"A deployment is a declaration that allows you to do app ","position":{"start":{"line":117,"column":1,"offset":3672},"end":{"line":117,"column":57,"offset":3728},"indent":[]}},{"type":"inlineCode","value":"deployments","position":{"start":{"line":117,"column":57,"offset":3728},"end":{"line":117,"column":70,"offset":3741},"indent":[]}},{"type":"text","value":" and ","position":{"start":{"line":117,"column":70,"offset":3741},"end":{"line":117,"column":75,"offset":3746},"indent":[]}},{"type":"inlineCode","value":"updates","position":{"start":{"line":117,"column":75,"offset":3746},"end":{"line":117,"column":84,"offset":3755},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":117,"column":84,"offset":3755},"end":{"line":117,"column":85,"offset":3756},"indent":[]}}],"position":{"start":{"line":117,"column":1,"offset":3672},"end":{"line":117,"column":85,"offset":3756},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"When using the deployment object, you definte the ","position":{"start":{"line":119,"column":1,"offset":3758},"end":{"line":119,"column":51,"offset":3808},"indent":[]}},{"type":"inlineCode","value":"state","position":{"start":{"line":119,"column":51,"offset":3808},"end":{"line":119,"column":58,"offset":3815},"indent":[]}},{"type":"text","value":" of your application. Kubernetes will then make sure the clusters matches your desired state.","position":{"start":{"line":119,"column":58,"offset":3815},"end":{"line":119,"column":151,"offset":3908},"indent":[]}}],"position":{"start":{"line":119,"column":1,"offset":3758},"end":{"line":119,"column":151,"offset":3908},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Just using the replication controller or replication set might be cumbersome to deploy apps.","position":{"start":{"line":121,"column":1,"offset":3910},"end":{"line":121,"column":93,"offset":4002},"indent":[]}}],"position":{"start":{"line":121,"column":1,"offset":3910},"end":{"line":121,"column":93,"offset":4002},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"With a deployment object you can:","position":{"start":{"line":123,"column":1,"offset":4004},"end":{"line":123,"column":34,"offset":4037},"indent":[]}}],"position":{"start":{"line":123,"column":1,"offset":4004},"end":{"line":123,"column":34,"offset":4037},"indent":[]}},{"type":"list","ordered":true,"start":1,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Create a deployment (e.g. deploying an app)","position":{"start":{"line":125,"column":5,"offset":4043},"end":{"line":125,"column":48,"offset":4086},"indent":[]}}],"position":{"start":{"line":125,"column":5,"offset":4043},"end":{"line":125,"column":48,"offset":4086},"indent":[]}}],"position":{"start":{"line":125,"column":1,"offset":4039},"end":{"line":125,"column":48,"offset":4086},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Update a deployment (e.g. new version)","position":{"start":{"line":126,"column":5,"offset":4091},"end":{"line":126,"column":43,"offset":4129},"indent":[]}}],"position":{"start":{"line":126,"column":5,"offset":4091},"end":{"line":126,"column":43,"offset":4129},"indent":[]}}],"position":{"start":{"line":126,"column":1,"offset":4087},"end":{"line":126,"column":43,"offset":4129},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Do rolling updates (zero downtime deployments)","position":{"start":{"line":127,"column":5,"offset":4134},"end":{"line":127,"column":51,"offset":4180},"indent":[]}}],"position":{"start":{"line":127,"column":5,"offset":4134},"end":{"line":127,"column":51,"offset":4180},"indent":[]}}],"position":{"start":{"line":127,"column":1,"offset":4130},"end":{"line":127,"column":51,"offset":4180},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Roll back","position":{"start":{"line":128,"column":5,"offset":4185},"end":{"line":128,"column":14,"offset":4194},"indent":[]}}],"position":{"start":{"line":128,"column":5,"offset":4185},"end":{"line":128,"column":14,"offset":4194},"indent":[]}}],"position":{"start":{"line":128,"column":1,"offset":4181},"end":{"line":128,"column":14,"offset":4194},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Pause/resume a deployment (ie rollout to only certain percentage of pods)","position":{"start":{"line":129,"column":5,"offset":4199},"end":{"line":129,"column":78,"offset":4272},"indent":[]}}],"position":{"start":{"line":129,"column":5,"offset":4199},"end":{"line":129,"column":78,"offset":4272},"indent":[]}}],"position":{"start":{"line":129,"column":1,"offset":4195},"end":{"line":129,"column":78,"offset":4272},"indent":[]}}],"position":{"start":{"line":125,"column":1,"offset":4039},"end":{"line":129,"column":78,"offset":4272},"indent":[1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"An example of a deployment:","position":{"start":{"line":131,"column":1,"offset":4274},"end":{"line":131,"column":28,"offset":4301},"indent":[]}}],"position":{"start":{"line":131,"column":1,"offset":4274},"end":{"line":131,"column":28,"offset":4301},"indent":[]}},{"type":"code","lang":"yaml","meta":null,"value":"# deployment-helloworld.yml\napiVersion: extensions/v1beta1\nkind: Deployment # Changed from Pod\nmetadata:\n  name: helloworld-deployment\nspec: # Replation controller also has a spec\n  replicas: 3 # set two pod replicas\n  template:\n  # stand Pod metadata and spec\n  metadata:\n    labels:\n    app: helloworld\n  spec:\n    # The containers are listed here\n    containers:\n    - name: k8s-demo\n      image: okeeffed/docker-demo\n      ports:\n      - containerPort: 3000","position":{"start":{"line":133,"column":1,"offset":4303},"end":{"line":153,"column":4,"offset":4776},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Useful commands","position":{"start":{"line":155,"column":5,"offset":4782},"end":{"line":155,"column":20,"offset":4797},"indent":[]}}],"position":{"start":{"line":155,"column":1,"offset":4778},"end":{"line":155,"column":20,"offset":4797},"indent":[]}},{"type":"table","align":[null,null],"children":[{"type":"tableRow","children":[{"type":"tableCell","children":[{"type":"text","value":"Command","position":{"start":{"line":157,"column":3,"offset":4801},"end":{"line":157,"column":10,"offset":4808},"indent":[]}}],"position":{"start":{"line":157,"column":3,"offset":4801},"end":{"line":157,"column":73,"offset":4871},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"Description","position":{"start":{"line":157,"column":76,"offset":4874},"end":{"line":157,"column":87,"offset":4885},"indent":[]}}],"position":{"start":{"line":157,"column":76,"offset":4874},"end":{"line":157,"column":119,"offset":4917},"indent":[]}}],"position":{"start":{"line":157,"column":1,"offset":4799},"end":{"line":157,"column":121,"offset":4919},"indent":[]}},{"type":"tableRow","children":[{"type":"tableCell","children":[{"type":"text","value":"kubectl get deployments","position":{"start":{"line":159,"column":3,"offset":5043},"end":{"line":159,"column":26,"offset":5066},"indent":[]}}],"position":{"start":{"line":159,"column":3,"offset":5043},"end":{"line":159,"column":73,"offset":5113},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"Get info on current deployments","position":{"start":{"line":159,"column":76,"offset":5116},"end":{"line":159,"column":107,"offset":5147},"indent":[]}}],"position":{"start":{"line":159,"column":76,"offset":5116},"end":{"line":159,"column":119,"offset":5159},"indent":[]}}],"position":{"start":{"line":159,"column":1,"offset":5041},"end":{"line":159,"column":121,"offset":5161},"indent":[]}},{"type":"tableRow","children":[{"type":"tableCell","children":[{"type":"text","value":"kubectl get rs","position":{"start":{"line":160,"column":3,"offset":5164},"end":{"line":160,"column":17,"offset":5178},"indent":[]}}],"position":{"start":{"line":160,"column":3,"offset":5164},"end":{"line":160,"column":73,"offset":5234},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"Get info about the replica set","position":{"start":{"line":160,"column":76,"offset":5237},"end":{"line":160,"column":106,"offset":5267},"indent":[]}}],"position":{"start":{"line":160,"column":76,"offset":5237},"end":{"line":160,"column":119,"offset":5280},"indent":[]}}],"position":{"start":{"line":160,"column":1,"offset":5162},"end":{"line":160,"column":121,"offset":5282},"indent":[]}},{"type":"tableRow","children":[{"type":"tableCell","children":[{"type":"text","value":"kubectl get pods --show-labels","position":{"start":{"line":161,"column":3,"offset":5285},"end":{"line":161,"column":33,"offset":5315},"indent":[]}}],"position":{"start":{"line":161,"column":3,"offset":5285},"end":{"line":161,"column":73,"offset":5355},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"Get pods + labels attached to pods","position":{"start":{"line":161,"column":76,"offset":5358},"end":{"line":161,"column":110,"offset":5392},"indent":[]}}],"position":{"start":{"line":161,"column":76,"offset":5358},"end":{"line":161,"column":119,"offset":5401},"indent":[]}}],"position":{"start":{"line":161,"column":1,"offset":5283},"end":{"line":161,"column":121,"offset":5403},"indent":[]}},{"type":"tableRow","children":[{"type":"tableCell","children":[{"type":"text","value":"kubectl rollout status deployment/helloworld-deployment","position":{"start":{"line":162,"column":3,"offset":5406},"end":{"line":162,"column":58,"offset":5461},"indent":[]}}],"position":{"start":{"line":162,"column":3,"offset":5406},"end":{"line":162,"column":73,"offset":5476},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"Get deployment status","position":{"start":{"line":162,"column":76,"offset":5479},"end":{"line":162,"column":97,"offset":5500},"indent":[]}}],"position":{"start":{"line":162,"column":76,"offset":5479},"end":{"line":162,"column":119,"offset":5522},"indent":[]}}],"position":{"start":{"line":162,"column":1,"offset":5404},"end":{"line":162,"column":121,"offset":5524},"indent":[]}},{"type":"tableRow","children":[{"type":"tableCell","children":[{"type":"text","value":"kubectl set image deployment/helloworld-deployment k8s-demo=k8s-demo:2","position":{"start":{"line":163,"column":3,"offset":5527},"end":{"line":163,"column":73,"offset":5597},"indent":[]}}],"position":{"start":{"line":163,"column":3,"offset":5527},"end":{"line":163,"column":73,"offset":5597},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"Run k8s-demo with the image label version 2","position":{"start":{"line":163,"column":76,"offset":5600},"end":{"line":163,"column":119,"offset":5643},"indent":[]}}],"position":{"start":{"line":163,"column":76,"offset":5600},"end":{"line":163,"column":119,"offset":5643},"indent":[]}}],"position":{"start":{"line":163,"column":1,"offset":5525},"end":{"line":163,"column":121,"offset":5645},"indent":[]}},{"type":"tableRow","children":[{"type":"tableCell","children":[{"type":"text","value":"kubectl edit deployment/helloworld-deployment","position":{"start":{"line":164,"column":3,"offset":5648},"end":{"line":164,"column":48,"offset":5693},"indent":[]}}],"position":{"start":{"line":164,"column":3,"offset":5648},"end":{"line":164,"column":73,"offset":5718},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"Edit the deployment object","position":{"start":{"line":164,"column":76,"offset":5721},"end":{"line":164,"column":102,"offset":5747},"indent":[]}}],"position":{"start":{"line":164,"column":76,"offset":5721},"end":{"line":164,"column":119,"offset":5764},"indent":[]}}],"position":{"start":{"line":164,"column":1,"offset":5646},"end":{"line":164,"column":121,"offset":5766},"indent":[]}},{"type":"tableRow","children":[{"type":"tableCell","children":[{"type":"text","value":"kubectl rollout status deployment/helloworld-deployment","position":{"start":{"line":165,"column":3,"offset":5769},"end":{"line":165,"column":58,"offset":5824},"indent":[]}}],"position":{"start":{"line":165,"column":3,"offset":5769},"end":{"line":165,"column":73,"offset":5839},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"Get the status of the rollout","position":{"start":{"line":165,"column":76,"offset":5842},"end":{"line":165,"column":105,"offset":5871},"indent":[]}}],"position":{"start":{"line":165,"column":76,"offset":5842},"end":{"line":165,"column":119,"offset":5885},"indent":[]}}],"position":{"start":{"line":165,"column":1,"offset":5767},"end":{"line":165,"column":121,"offset":5887},"indent":[]}},{"type":"tableRow","children":[{"type":"tableCell","children":[{"type":"text","value":"kubectl rollout history ","position":{"start":{"line":166,"column":3,"offset":5890},"end":{"line":166,"column":27,"offset":5914},"indent":[]}},{"type":"linkReference","identifier":"deployment","label":"deployment","referenceType":"shortcut","children":[{"type":"text","value":"deployment","position":{"start":{"line":166,"column":28,"offset":5915},"end":{"line":166,"column":38,"offset":5925},"indent":[]}}],"position":{"start":{"line":166,"column":27,"offset":5914},"end":{"line":166,"column":39,"offset":5926},"indent":[]}}],"position":{"start":{"line":166,"column":3,"offset":5890},"end":{"line":166,"column":73,"offset":5960},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"Get the rollout history","position":{"start":{"line":166,"column":76,"offset":5963},"end":{"line":166,"column":99,"offset":5986},"indent":[]}}],"position":{"start":{"line":166,"column":76,"offset":5963},"end":{"line":166,"column":119,"offset":6006},"indent":[]}}],"position":{"start":{"line":166,"column":1,"offset":5888},"end":{"line":166,"column":121,"offset":6008},"indent":[]}},{"type":"tableRow","children":[{"type":"tableCell","children":[{"type":"text","value":"kubectl rollout undo ","position":{"start":{"line":167,"column":3,"offset":6011},"end":{"line":167,"column":24,"offset":6032},"indent":[]}},{"type":"linkReference","identifier":"deployment","label":"deployment","referenceType":"shortcut","children":[{"type":"text","value":"deployment","position":{"start":{"line":167,"column":25,"offset":6033},"end":{"line":167,"column":35,"offset":6043},"indent":[]}}],"position":{"start":{"line":167,"column":24,"offset":6032},"end":{"line":167,"column":36,"offset":6044},"indent":[]}}],"position":{"start":{"line":167,"column":3,"offset":6011},"end":{"line":167,"column":73,"offset":6081},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"Rollback to previous version","position":{"start":{"line":167,"column":76,"offset":6084},"end":{"line":167,"column":104,"offset":6112},"indent":[]}}],"position":{"start":{"line":167,"column":76,"offset":6084},"end":{"line":167,"column":119,"offset":6127},"indent":[]}}],"position":{"start":{"line":167,"column":1,"offset":6009},"end":{"line":167,"column":121,"offset":6129},"indent":[]}},{"type":"tableRow","children":[{"type":"tableCell","children":[{"type":"text","value":"kubectl rollout undo ","position":{"start":{"line":168,"column":3,"offset":6132},"end":{"line":168,"column":24,"offset":6153},"indent":[]}},{"type":"linkReference","identifier":"deployment","label":"deployment","referenceType":"shortcut","children":[{"type":"text","value":"deployment","position":{"start":{"line":168,"column":25,"offset":6154},"end":{"line":168,"column":35,"offset":6164},"indent":[]}}],"position":{"start":{"line":168,"column":24,"offset":6153},"end":{"line":168,"column":36,"offset":6165},"indent":[]}},{"type":"text","value":" --to-revision=n","position":{"start":{"line":168,"column":36,"offset":6165},"end":{"line":168,"column":52,"offset":6181},"indent":[]}}],"position":{"start":{"line":168,"column":3,"offset":6132},"end":{"line":168,"column":73,"offset":6202},"indent":[]}},{"type":"tableCell","children":[{"type":"text","value":"Rollback to previous version","position":{"start":{"line":168,"column":76,"offset":6205},"end":{"line":168,"column":104,"offset":6233},"indent":[]}}],"position":{"start":{"line":168,"column":76,"offset":6205},"end":{"line":168,"column":119,"offset":6248},"indent":[]}}],"position":{"start":{"line":168,"column":1,"offset":6130},"end":{"line":168,"column":121,"offset":6250},"indent":[]}}],"position":{"start":{"line":157,"column":1,"offset":4799},"end":{"line":168,"column":121,"offset":6250},"indent":[1,1,1,1,1,1,1,1,1,1,1]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Demo: Deployment notes","position":{"start":{"line":170,"column":5,"offset":6256},"end":{"line":170,"column":27,"offset":6278},"indent":[]}}],"position":{"start":{"line":170,"column":1,"offset":6252},"end":{"line":170,"column":27,"offset":6278},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Again, get pods will sho the pods with appended suffixes auto-determined by Kubernetes.","position":{"start":{"line":172,"column":1,"offset":6280},"end":{"line":172,"column":88,"offset":6367},"indent":[]}}],"position":{"start":{"line":172,"column":1,"offset":6280},"end":{"line":172,"column":88,"offset":6367},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"You can verify rollout status using the commands above.","position":{"start":{"line":174,"column":1,"offset":6369},"end":{"line":174,"column":56,"offset":6424},"indent":[]}}],"position":{"start":{"line":174,"column":1,"offset":6369},"end":{"line":174,"column":56,"offset":6424},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Services","position":{"start":{"line":176,"column":4,"offset":6429},"end":{"line":176,"column":12,"offset":6437},"indent":[]}}],"position":{"start":{"line":176,"column":1,"offset":6426},"end":{"line":176,"column":12,"offset":6437},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Pods themselves are very dynamic, they come and go on the Kubernetes cluster.","position":{"start":{"line":178,"column":1,"offset":6439},"end":{"line":178,"column":78,"offset":6516},"indent":[]}}],"position":{"start":{"line":178,"column":1,"offset":6439},"end":{"line":178,"column":78,"offset":6516},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"When using a ","position":{"start":{"line":180,"column":5,"offset":6522},"end":{"line":180,"column":18,"offset":6535},"indent":[]}},{"type":"inlineCode","value":"Replication Controller","position":{"start":{"line":180,"column":18,"offset":6535},"end":{"line":180,"column":42,"offset":6559},"indent":[]}},{"type":"text","value":", pods are termined and created during scaling operations.","position":{"start":{"line":180,"column":42,"offset":6559},"end":{"line":180,"column":100,"offset":6617},"indent":[]}}],"position":{"start":{"line":180,"column":5,"offset":6522},"end":{"line":180,"column":100,"offset":6617},"indent":[]}}],"position":{"start":{"line":180,"column":1,"offset":6518},"end":{"line":180,"column":100,"offset":6617},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Wehn using ","position":{"start":{"line":181,"column":5,"offset":6622},"end":{"line":181,"column":16,"offset":6633},"indent":[]}},{"type":"inlineCode","value":"Deployments","position":{"start":{"line":181,"column":16,"offset":6633},"end":{"line":181,"column":29,"offset":6646},"indent":[]}},{"type":"text","value":", when updating the image version, pods are terminated and new pods take the place of older pods.","position":{"start":{"line":181,"column":29,"offset":6646},"end":{"line":181,"column":126,"offset":6743},"indent":[]}}],"position":{"start":{"line":181,"column":5,"offset":6622},"end":{"line":181,"column":126,"offset":6743},"indent":[]}}],"position":{"start":{"line":181,"column":1,"offset":6618},"end":{"line":181,"column":126,"offset":6743},"indent":[]}}],"position":{"start":{"line":180,"column":1,"offset":6518},"end":{"line":181,"column":126,"offset":6743},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"That's why Pods should never be accessed directly, but always through a Service.","position":{"start":{"line":183,"column":1,"offset":6745},"end":{"line":183,"column":81,"offset":6825},"indent":[]}}],"position":{"start":{"line":183,"column":1,"offset":6745},"end":{"line":183,"column":81,"offset":6825},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"A service is the ","position":{"start":{"line":185,"column":1,"offset":6827},"end":{"line":185,"column":18,"offset":6844},"indent":[]}},{"type":"inlineCode","value":"logical bridge","position":{"start":{"line":185,"column":18,"offset":6844},"end":{"line":185,"column":34,"offset":6860},"indent":[]}},{"type":"text","value":" between the \"mortal\" pods and other services or end-users.","position":{"start":{"line":185,"column":34,"offset":6860},"end":{"line":185,"column":93,"offset":6919},"indent":[]}}],"position":{"start":{"line":185,"column":1,"offset":6827},"end":{"line":185,"column":93,"offset":6919},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"When using the ","position":{"start":{"line":187,"column":1,"offset":6921},"end":{"line":187,"column":16,"offset":6936},"indent":[]}},{"type":"inlineCode","value":"kubectl expose","position":{"start":{"line":187,"column":16,"offset":6936},"end":{"line":187,"column":32,"offset":6952},"indent":[]}},{"type":"text","value":" command, you create a service for you pod to be accessed externally.","position":{"start":{"line":187,"column":32,"offset":6952},"end":{"line":187,"column":101,"offset":7021},"indent":[]}}],"position":{"start":{"line":187,"column":1,"offset":6921},"end":{"line":187,"column":101,"offset":7021},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Creating a service will create an endpoint for your pod(s):","position":{"start":{"line":189,"column":1,"offset":7023},"end":{"line":189,"column":60,"offset":7082},"indent":[]}}],"position":{"start":{"line":189,"column":1,"offset":7023},"end":{"line":189,"column":60,"offset":7082},"indent":[]}},{"type":"list","ordered":true,"start":1,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"A ClusterIP: a virtual IP address only reachable from within the cluster (this is default)","position":{"start":{"line":191,"column":5,"offset":7088},"end":{"line":191,"column":95,"offset":7178},"indent":[]}}],"position":{"start":{"line":191,"column":5,"offset":7088},"end":{"line":191,"column":95,"offset":7178},"indent":[]}}],"position":{"start":{"line":191,"column":1,"offset":7084},"end":{"line":191,"column":95,"offset":7178},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"A NodePort: a port that is the same on each node that is also reachable externally.","position":{"start":{"line":192,"column":5,"offset":7183},"end":{"line":192,"column":88,"offset":7266},"indent":[]}}],"position":{"start":{"line":192,"column":5,"offset":7183},"end":{"line":192,"column":88,"offset":7266},"indent":[]}}],"position":{"start":{"line":192,"column":1,"offset":7179},"end":{"line":192,"column":88,"offset":7266},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"A LoadBalancer: created by the Cloud provider that will route external traffic on every node on the NodePort","position":{"start":{"line":193,"column":5,"offset":7271},"end":{"line":193,"column":113,"offset":7379},"indent":[]}}],"position":{"start":{"line":193,"column":5,"offset":7271},"end":{"line":193,"column":113,"offset":7379},"indent":[]}}],"position":{"start":{"line":193,"column":1,"offset":7267},"end":{"line":193,"column":113,"offset":7379},"indent":[]}}],"position":{"start":{"line":191,"column":1,"offset":7084},"end":{"line":193,"column":113,"offset":7379},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"The options shown only allow virtual IPs and ports.","position":{"start":{"line":195,"column":1,"offset":7381},"end":{"line":195,"column":52,"offset":7432},"indent":[]}}],"position":{"start":{"line":195,"column":1,"offset":7381},"end":{"line":195,"column":52,"offset":7432},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"There is also a possibility to use ","position":{"start":{"line":197,"column":1,"offset":7434},"end":{"line":197,"column":36,"offset":7469},"indent":[]}},{"type":"inlineCode","value":"DNS Names","position":{"start":{"line":197,"column":36,"offset":7469},"end":{"line":197,"column":47,"offset":7480},"indent":[]}}],"position":{"start":{"line":197,"column":1,"offset":7434},"end":{"line":197,"column":47,"offset":7480},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The ","position":{"start":{"line":199,"column":1,"offset":7482},"end":{"line":199,"column":5,"offset":7486},"indent":[]}},{"type":"inlineCode","value":"ExternalName","position":{"start":{"line":199,"column":5,"offset":7486},"end":{"line":199,"column":19,"offset":7500},"indent":[]}},{"type":"text","value":" can provide a DNS name for the service e.g. for service discovery using DNS.","position":{"start":{"line":199,"column":19,"offset":7500},"end":{"line":199,"column":96,"offset":7577},"indent":[]}}],"position":{"start":{"line":199,"column":1,"offset":7482},"end":{"line":199,"column":96,"offset":7577},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"This ","position":{"start":{"line":201,"column":1,"offset":7579},"end":{"line":201,"column":6,"offset":7584},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"only","position":{"start":{"line":201,"column":8,"offset":7586},"end":{"line":201,"column":12,"offset":7590},"indent":[]}}],"position":{"start":{"line":201,"column":6,"offset":7584},"end":{"line":201,"column":14,"offset":7592},"indent":[]}},{"type":"text","value":" works when the DNS add-on is enabled.","position":{"start":{"line":201,"column":14,"offset":7592},"end":{"line":201,"column":52,"offset":7630},"indent":[]}}],"position":{"start":{"line":201,"column":1,"offset":7579},"end":{"line":201,"column":52,"offset":7630},"indent":[]}},{"type":"code","lang":"yaml","meta":null,"value":"# helloworld-service.yml\napiVersion: v1\nkind: Service\nmetadata:\n  name: helloworld-service\nspec:\n  ports: # specify the ports the service uses\n  - port: 31001\n    nodePort: 31001\n    # name below defined from pod\n    targetPort: nodejs-port\n    protocol: TCP\n  selector:\n  # service for this app\n  app: helloworld\n  type: NodePort","position":{"start":{"line":203,"column":1,"offset":7632},"end":{"line":220,"column":4,"offset":7974},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Tags","position":{"start":{"line":222,"column":4,"offset":7979},"end":{"line":222,"column":8,"offset":7983},"indent":[]}}],"position":{"start":{"line":222,"column":1,"offset":7976},"end":{"line":222,"column":8,"offset":7983},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Similar to Labels for AWS","position":{"start":{"line":224,"column":1,"offset":7985},"end":{"line":224,"column":26,"offset":8010},"indent":[]}}],"position":{"start":{"line":224,"column":1,"offset":7985},"end":{"line":224,"column":26,"offset":8010},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"For example, you can label your objects.","position":{"start":{"line":226,"column":1,"offset":8012},"end":{"line":226,"column":41,"offset":8052},"indent":[]}}],"position":{"start":{"line":226,"column":1,"offset":8012},"end":{"line":226,"column":41,"offset":8052},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"For instance: Key could be ","position":{"start":{"line":228,"column":1,"offset":8054},"end":{"line":228,"column":28,"offset":8081},"indent":[]}},{"type":"inlineCode","value":"environment","position":{"start":{"line":228,"column":28,"offset":8081},"end":{"line":228,"column":41,"offset":8094},"indent":[]}},{"type":"text","value":", and the value could be ","position":{"start":{"line":228,"column":41,"offset":8094},"end":{"line":228,"column":66,"offset":8119},"indent":[]}},{"type":"inlineCode","value":"dev","position":{"start":{"line":228,"column":66,"offset":8119},"end":{"line":228,"column":71,"offset":8124},"indent":[]}},{"type":"text","value":"/","position":{"start":{"line":228,"column":71,"offset":8124},"end":{"line":228,"column":72,"offset":8125},"indent":[]}},{"type":"inlineCode","value":"staging","position":{"start":{"line":228,"column":72,"offset":8125},"end":{"line":228,"column":81,"offset":8134},"indent":[]}},{"type":"text","value":"/","position":{"start":{"line":228,"column":81,"offset":8134},"end":{"line":228,"column":82,"offset":8135},"indent":[]}},{"type":"inlineCode","value":"qa","position":{"start":{"line":228,"column":82,"offset":8135},"end":{"line":228,"column":86,"offset":8139},"indent":[]}},{"type":"text","value":"/","position":{"start":{"line":228,"column":86,"offset":8139},"end":{"line":228,"column":87,"offset":8140},"indent":[]}},{"type":"inlineCode","value":"prod","position":{"start":{"line":228,"column":87,"offset":8140},"end":{"line":228,"column":93,"offset":8146},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":228,"column":93,"offset":8146},"end":{"line":228,"column":94,"offset":8147},"indent":[]}}],"position":{"start":{"line":228,"column":1,"offset":8054},"end":{"line":228,"column":94,"offset":8147},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Maybe you could also tag the department that is comes from etc.","position":{"start":{"line":230,"column":1,"offset":8149},"end":{"line":230,"column":64,"offset":8212},"indent":[]}}],"position":{"start":{"line":230,"column":1,"offset":8149},"end":{"line":230,"column":64,"offset":8212},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Labels are not unique. You can then use ","position":{"start":{"line":232,"column":1,"offset":8214},"end":{"line":232,"column":41,"offset":8254},"indent":[]}},{"type":"inlineCode","value":"label selectors","position":{"start":{"line":232,"column":41,"offset":8254},"end":{"line":232,"column":58,"offset":8271},"indent":[]}},{"type":"text","value":" to match labels.","position":{"start":{"line":232,"column":58,"offset":8271},"end":{"line":232,"column":75,"offset":8288},"indent":[]}}],"position":{"start":{"line":232,"column":1,"offset":8214},"end":{"line":232,"column":75,"offset":8288},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Eg. a particular pod can only run on a node label with \"evironment\" equals \"development\".","position":{"start":{"line":234,"column":1,"offset":8290},"end":{"line":234,"column":90,"offset":8379},"indent":[]}}],"position":{"start":{"line":234,"column":1,"offset":8290},"end":{"line":234,"column":90,"offset":8379},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"More complex matching: \"environment\" in \"development\" or \"qa\".","position":{"start":{"line":236,"column":1,"offset":8381},"end":{"line":236,"column":63,"offset":8443},"indent":[]}}],"position":{"start":{"line":236,"column":1,"offset":8381},"end":{"line":236,"column":63,"offset":8443},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"You can also use labels to tag nodes. Once tagged, you can use labels selectors to let pods only run on specific nodes.","position":{"start":{"line":238,"column":1,"offset":8445},"end":{"line":238,"column":120,"offset":8564},"indent":[]}}],"position":{"start":{"line":238,"column":1,"offset":8445},"end":{"line":238,"column":120,"offset":8564},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"There are two steps required to run a pod on a specific set of nodes:","position":{"start":{"line":240,"column":1,"offset":8566},"end":{"line":240,"column":70,"offset":8635},"indent":[]}}],"position":{"start":{"line":240,"column":1,"offset":8566},"end":{"line":240,"column":70,"offset":8635},"indent":[]}},{"type":"list","ordered":true,"start":1,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"First you tag the node","position":{"start":{"line":242,"column":5,"offset":8641},"end":{"line":242,"column":27,"offset":8663},"indent":[]}}],"position":{"start":{"line":242,"column":5,"offset":8641},"end":{"line":242,"column":27,"offset":8663},"indent":[]}}],"position":{"start":{"line":242,"column":1,"offset":8637},"end":{"line":242,"column":27,"offset":8663},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Then you add a ","position":{"start":{"line":243,"column":5,"offset":8668},"end":{"line":243,"column":20,"offset":8683},"indent":[]}},{"type":"inlineCode","value":"nodeSelector","position":{"start":{"line":243,"column":20,"offset":8683},"end":{"line":243,"column":34,"offset":8697},"indent":[]}},{"type":"text","value":" to your pod configuration","position":{"start":{"line":243,"column":34,"offset":8697},"end":{"line":243,"column":60,"offset":8723},"indent":[]}}],"position":{"start":{"line":243,"column":5,"offset":8668},"end":{"line":243,"column":60,"offset":8723},"indent":[]}}],"position":{"start":{"line":243,"column":1,"offset":8664},"end":{"line":243,"column":60,"offset":8723},"indent":[]}}],"position":{"start":{"line":242,"column":1,"offset":8637},"end":{"line":243,"column":60,"offset":8723},"indent":[1]}},{"type":"code","lang":null,"meta":null,"value":"kubectl label nodes node1 hardware=high-spec\nkubectl label nodes node1 hardware=low-spec","position":{"start":{"line":245,"column":1,"offset":8725},"end":{"line":248,"column":4,"offset":8821},"indent":[1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Secondly, add a pod that uses those labels:","position":{"start":{"line":250,"column":1,"offset":8823},"end":{"line":250,"column":44,"offset":8866},"indent":[]}}],"position":{"start":{"line":250,"column":1,"offset":8823},"end":{"line":250,"column":44,"offset":8866},"indent":[]}},{"type":"code","lang":"yaml","meta":null,"value":"# pod-helloworld.yml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nodehelloworld.example.com\n  labels:\n  app: helloworld\nspec:\n  # The containers are listed here\n  containers:\n  - name: k8s-demo\n    image: okeeffed/docker-demo\n    ports:\n    - containerPort: 3000\n  nodeSelector:\n  hardware: high-spec","position":{"start":{"line":252,"column":1,"offset":8868},"end":{"line":269,"column":4,"offset":9179},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Demo: Using tags","position":{"start":{"line":271,"column":5,"offset":9185},"end":{"line":271,"column":21,"offset":9201},"indent":[]}}],"position":{"start":{"line":271,"column":1,"offset":9181},"end":{"line":271,"column":21,"offset":9201},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"It only really makes sense if you have multiple nodes (doesn't really make sense on minikube).","position":{"start":{"line":273,"column":1,"offset":9203},"end":{"line":273,"column":95,"offset":9297},"indent":[]}}],"position":{"start":{"line":273,"column":1,"offset":9203},"end":{"line":273,"column":95,"offset":9297},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Healthchecks","position":{"start":{"line":275,"column":4,"offset":9302},"end":{"line":275,"column":16,"offset":9314},"indent":[]}}],"position":{"start":{"line":275,"column":1,"offset":9299},"end":{"line":275,"column":16,"offset":9314},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"If the application malfunctions, the pod and container may still be running but the application may no longer be running. This is where health checks come in.","position":{"start":{"line":277,"column":1,"offset":9316},"end":{"line":277,"column":159,"offset":9474},"indent":[]}}],"position":{"start":{"line":277,"column":1,"offset":9316},"end":{"line":277,"column":159,"offset":9474},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Two types:","position":{"start":{"line":279,"column":1,"offset":9476},"end":{"line":279,"column":11,"offset":9486},"indent":[]}}],"position":{"start":{"line":279,"column":1,"offset":9476},"end":{"line":279,"column":11,"offset":9486},"indent":[]}},{"type":"list","ordered":true,"start":1,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Running a command in the container periodically","position":{"start":{"line":281,"column":5,"offset":9492},"end":{"line":281,"column":52,"offset":9539},"indent":[]}}],"position":{"start":{"line":281,"column":5,"offset":9492},"end":{"line":281,"column":52,"offset":9539},"indent":[]}}],"position":{"start":{"line":281,"column":1,"offset":9488},"end":{"line":281,"column":52,"offset":9539},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Periodic checks on a URL","position":{"start":{"line":282,"column":5,"offset":9544},"end":{"line":282,"column":29,"offset":9568},"indent":[]}}],"position":{"start":{"line":282,"column":5,"offset":9544},"end":{"line":282,"column":29,"offset":9568},"indent":[]}}],"position":{"start":{"line":282,"column":1,"offset":9540},"end":{"line":282,"column":29,"offset":9568},"indent":[]}}],"position":{"start":{"line":281,"column":1,"offset":9488},"end":{"line":282,"column":29,"offset":9568},"indent":[1]}},{"type":"paragraph","children":[{"type":"text","value":"The typical prod application behind a load balancer should always have health checks implemented in some way to ensure availability and resiliency.","position":{"start":{"line":284,"column":1,"offset":9570},"end":{"line":284,"column":148,"offset":9717},"indent":[]}}],"position":{"start":{"line":284,"column":1,"offset":9570},"end":{"line":284,"column":148,"offset":9717},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Below you can see where the healthcheck is. You can check the port or container port name.","position":{"start":{"line":286,"column":1,"offset":9719},"end":{"line":286,"column":91,"offset":9809},"indent":[]}}],"position":{"start":{"line":286,"column":1,"offset":9719},"end":{"line":286,"column":91,"offset":9809},"indent":[]}},{"type":"code","lang":"yaml","meta":null,"value":"# pod-helloworld.yml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nodehelloworld.example.com\n  labels:\n  app: helloworld\nspec:\n  # The containers are listed here\n  containers:\n  - name: k8s-demo\n    image: okeeffed/docker-demo\n    ports:\n    - containerPort: 3000\n    # ! This is the health check\n    livenessProbe:\n    httpGet:\n      path: /\n      port: 3000\n    initialDelaySeconds: 15\n    timeoutSeconds: 30","position":{"start":{"line":288,"column":1,"offset":9811},"end":{"line":310,"column":4,"offset":10231},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Secrets","position":{"start":{"line":312,"column":4,"offset":10236},"end":{"line":312,"column":11,"offset":10243},"indent":[]}}],"position":{"start":{"line":312,"column":1,"offset":10233},"end":{"line":312,"column":11,"offset":10243},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"A way to distribute credentials, keys, passwords or secret data to the pods.","position":{"start":{"line":314,"column":1,"offset":10245},"end":{"line":314,"column":77,"offset":10321},"indent":[]}}],"position":{"start":{"line":314,"column":1,"offset":10245},"end":{"line":314,"column":77,"offset":10321},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Kubernetes itself uses this Secrets mechanism to provide the credentials to access the internal API.","position":{"start":{"line":316,"column":1,"offset":10323},"end":{"line":316,"column":101,"offset":10423},"indent":[]}}],"position":{"start":{"line":316,"column":1,"offset":10323},"end":{"line":316,"column":101,"offset":10423},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"You can use the same mechanism to provide secrets to your application.","position":{"start":{"line":318,"column":1,"offset":10425},"end":{"line":318,"column":71,"offset":10495},"indent":[]}}],"position":{"start":{"line":318,"column":1,"offset":10425},"end":{"line":318,"column":71,"offset":10495},"indent":[]}},{"type":"paragraph","children":[{"type":"inlineCode","value":"secrets","position":{"start":{"line":320,"column":1,"offset":10497},"end":{"line":320,"column":10,"offset":10506},"indent":[]}},{"type":"text","value":" is just one way to provide secrets that is native to Kubernetes. There are still other ways to do this.","position":{"start":{"line":320,"column":10,"offset":10506},"end":{"line":320,"column":114,"offset":10610},"indent":[]}}],"position":{"start":{"line":320,"column":1,"offset":10497},"end":{"line":320,"column":114,"offset":10610},"indent":[]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"How to use them","position":{"start":{"line":322,"column":5,"offset":10616},"end":{"line":322,"column":20,"offset":10631},"indent":[]}}],"position":{"start":{"line":322,"column":1,"offset":10612},"end":{"line":322,"column":20,"offset":10631},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Use as env vars","position":{"start":{"line":324,"column":5,"offset":10637},"end":{"line":324,"column":20,"offset":10652},"indent":[]}}],"position":{"start":{"line":324,"column":5,"offset":10637},"end":{"line":324,"column":20,"offset":10652},"indent":[]}}],"position":{"start":{"line":324,"column":1,"offset":10633},"end":{"line":324,"column":20,"offset":10652},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Use as a file in a pod","position":{"start":{"line":325,"column":5,"offset":10657},"end":{"line":325,"column":27,"offset":10679},"indent":[]}}],"position":{"start":{"line":325,"column":5,"offset":10657},"end":{"line":325,"column":27,"offset":10679},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"This requires volumes to be mounted","position":{"start":{"line":326,"column":9,"offset":10688},"end":{"line":326,"column":44,"offset":10723},"indent":[]}}],"position":{"start":{"line":326,"column":9,"offset":10688},"end":{"line":326,"column":44,"offset":10723},"indent":[]}}],"position":{"start":{"line":326,"column":5,"offset":10684},"end":{"line":326,"column":44,"offset":10723},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"In this volume you have files","position":{"start":{"line":327,"column":9,"offset":10732},"end":{"line":327,"column":38,"offset":10761},"indent":[]}}],"position":{"start":{"line":327,"column":9,"offset":10732},"end":{"line":327,"column":38,"offset":10761},"indent":[]}}],"position":{"start":{"line":327,"column":5,"offset":10728},"end":{"line":327,"column":38,"offset":10761},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"This can be use for things like dotenv files","position":{"start":{"line":328,"column":9,"offset":10770},"end":{"line":328,"column":53,"offset":10814},"indent":[]}}],"position":{"start":{"line":328,"column":9,"offset":10770},"end":{"line":328,"column":53,"offset":10814},"indent":[]}}],"position":{"start":{"line":328,"column":5,"offset":10766},"end":{"line":328,"column":53,"offset":10814},"indent":[]}}],"position":{"start":{"line":326,"column":5,"offset":10684},"end":{"line":328,"column":53,"offset":10814},"indent":[5,5]}}],"position":{"start":{"line":325,"column":1,"offset":10653},"end":{"line":328,"column":53,"offset":10814},"indent":[1,1,1]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"You can use an external image to pull secrets (private image registry)","position":{"start":{"line":329,"column":5,"offset":10819},"end":{"line":329,"column":75,"offset":10889},"indent":[]}}],"position":{"start":{"line":329,"column":5,"offset":10819},"end":{"line":329,"column":75,"offset":10889},"indent":[]}}],"position":{"start":{"line":329,"column":1,"offset":10815},"end":{"line":329,"column":75,"offset":10889},"indent":[]}}],"position":{"start":{"line":324,"column":1,"offset":10633},"end":{"line":329,"column":75,"offset":10889},"indent":[1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Generating:","position":{"start":{"line":331,"column":1,"offset":10891},"end":{"line":331,"column":12,"offset":10902},"indent":[]}}],"position":{"start":{"line":331,"column":1,"offset":10891},"end":{"line":331,"column":12,"offset":10902},"indent":[]}},{"type":"code","lang":"bash","meta":null,"value":"echo -n \"root\" > ./username.txt\necho -n \"password\" > ./password.txt\nkubectl create secret generic db-user-pass --from-file=./username.txt --from-file=./password.txt\n# > secret \"db-user-pass\" created","position":{"start":{"line":333,"column":1,"offset":10904},"end":{"line":338,"column":4,"offset":11114},"indent":[1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"A secret can also be a SSH key or SSL cert.","position":{"start":{"line":340,"column":1,"offset":11116},"end":{"line":340,"column":44,"offset":11159},"indent":[]}}],"position":{"start":{"line":340,"column":1,"offset":11116},"end":{"line":340,"column":44,"offset":11159},"indent":[]}},{"type":"code","lang":"bash","meta":null,"value":"kubectl create secret generic ssl-cert --from-file=ssh-privatekey=~/.ssh/id_rsa --ssl-cert-=ssl-cert=mysslcert.crt","position":{"start":{"line":342,"column":1,"offset":11161},"end":{"line":344,"column":4,"offset":11287},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"To generate secrets using yaml defs:","position":{"start":{"line":346,"column":1,"offset":11289},"end":{"line":346,"column":37,"offset":11325},"indent":[]}}],"position":{"start":{"line":346,"column":1,"offset":11289},"end":{"line":346,"column":37,"offset":11325},"indent":[]}},{"type":"code","lang":"yaml","meta":null,"value":"apiVersion: v1\nkind: Secret\nmetadata:\n  name: db-secret\ntype: Opaque\ndata:\n  password: pwd\n  username: usr","position":{"start":{"line":348,"column":1,"offset":11327},"end":{"line":357,"column":4,"offset":11445},"indent":[1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Then, you can generate it as base64 like so:","position":{"start":{"line":359,"column":1,"offset":11447},"end":{"line":359,"column":45,"offset":11491},"indent":[]}}],"position":{"start":{"line":359,"column":1,"offset":11447},"end":{"line":359,"column":45,"offset":11491},"indent":[]}},{"type":"code","lang":"bash","meta":null,"value":"echo -n \"password\" | base64\n# > pwd\n\nkubectl create -f secrets-db-secret.yml\n# > secret \"db-secret\" created","position":{"start":{"line":361,"column":1,"offset":11493},"end":{"line":367,"column":4,"offset":11612},"indent":[1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"To create a pod that uses secrets:","position":{"start":{"line":369,"column":1,"offset":11614},"end":{"line":369,"column":35,"offset":11648},"indent":[]}}],"position":{"start":{"line":369,"column":1,"offset":11614},"end":{"line":369,"column":35,"offset":11648},"indent":[]}},{"type":"code","lang":"yaml","meta":null,"value":"# pod-helloworld.yml w/ secrets\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nodehelloworld.example.com\n  labels:\n  app: helloworld\nspec:\n  # The containers are listed here\n  containers:\n  - name: k8s-demo\n    image: okeeffed/docker-demo\n    ports:\n    - containerPort: 3000\n    # @@@ This are the envs\n    env:\n    - name: SECRET_USERNAME\n      valueFrom:\n      secretKeyRef:\n        name: db-secret\n        key: username\n    - name: SECRET_PASSWORD\n      [...]","position":{"start":{"line":371,"column":1,"offset":11650},"end":{"line":395,"column":4,"offset":12122},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"paragraph","children":[{"type":"text","value":"Alternatively when providing in a file:","position":{"start":{"line":397,"column":1,"offset":12124},"end":{"line":397,"column":40,"offset":12163},"indent":[]}}],"position":{"start":{"line":397,"column":1,"offset":12124},"end":{"line":397,"column":40,"offset":12163},"indent":[]}},{"type":"code","lang":"yaml","meta":null,"value":"# pod-helloworld.yml w/ secrets\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nodehelloworld.example.com\n  labels:\n  app: helloworld\nspec:\n  # The containers are listed here\n  containers:\n  - name: k8s-demo\n  image: okeeffed/docker-demo\n  ports:\n  - containerPort: 3000\n  # @@@ This are the envs in a volume mount\n  volumeMounts:\n  - name: credvolume\n    mountPath: /etc/creds\n    readOnly: true\n  volumes:\n  - name: credvolume\n  secret:\n    secretName: db-secrets","position":{"start":{"line":399,"column":1,"offset":12165},"end":{"line":423,"column":4,"offset":12638},"indent":[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Demo: Wordpress Secrets","position":{"start":{"line":425,"column":5,"offset":12644},"end":{"line":425,"column":28,"offset":12667},"indent":[]}}],"position":{"start":{"line":425,"column":1,"offset":12640},"end":{"line":425,"column":28,"offset":12667},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"This demo ends up creating a secrets file, a pod definition and a service to expose the wordpress pod.","position":{"start":{"line":427,"column":1,"offset":12669},"end":{"line":427,"column":103,"offset":12771},"indent":[]}}],"position":{"start":{"line":427,"column":1,"offset":12669},"end":{"line":427,"column":103,"offset":12771},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"However, note that deleting the current setup will result in a container restarting to maintain state, but when that happens the WordPress site has to be re-installed because the data was not saved. The solution for this will be in the volumes lab.","position":{"start":{"line":429,"column":1,"offset":12773},"end":{"line":429,"column":249,"offset":13021},"indent":[]}}],"position":{"start":{"line":429,"column":1,"offset":12773},"end":{"line":429,"column":249,"offset":13021},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Web UI","position":{"start":{"line":431,"column":4,"offset":13026},"end":{"line":431,"column":10,"offset":13032},"indent":[]}}],"position":{"start":{"line":431,"column":1,"offset":13023},"end":{"line":431,"column":10,"offset":13032},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Kubernetes comes with a ","position":{"start":{"line":433,"column":1,"offset":13034},"end":{"line":433,"column":25,"offset":13058},"indent":[]}},{"type":"inlineCode","value":"Web UI","position":{"start":{"line":433,"column":25,"offset":13058},"end":{"line":433,"column":33,"offset":13066},"indent":[]}},{"type":"text","value":" you can use instead of kubectl commands.","position":{"start":{"line":433,"column":33,"offset":13066},"end":{"line":433,"column":74,"offset":13107},"indent":[]}}],"position":{"start":{"line":433,"column":1,"offset":13034},"end":{"line":433,"column":74,"offset":13107},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"You can use it to:","position":{"start":{"line":435,"column":1,"offset":13109},"end":{"line":435,"column":19,"offset":13127},"indent":[]}}],"position":{"start":{"line":435,"column":1,"offset":13109},"end":{"line":435,"column":19,"offset":13127},"indent":[]}},{"type":"list","ordered":true,"start":1,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Get an overview of running applications on your cluster","position":{"start":{"line":437,"column":5,"offset":13133},"end":{"line":437,"column":60,"offset":13188},"indent":[]}}],"position":{"start":{"line":437,"column":5,"offset":13133},"end":{"line":437,"column":60,"offset":13188},"indent":[]}}],"position":{"start":{"line":437,"column":1,"offset":13129},"end":{"line":437,"column":60,"offset":13188},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Creating and modifying individual Kubernetes resources and workloads (like kubectl create and delete)","position":{"start":{"line":438,"column":5,"offset":13193},"end":{"line":438,"column":106,"offset":13294},"indent":[]}}],"position":{"start":{"line":438,"column":5,"offset":13193},"end":{"line":438,"column":106,"offset":13294},"indent":[]}}],"position":{"start":{"line":438,"column":1,"offset":13189},"end":{"line":438,"column":106,"offset":13294},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Retrieve info on state or resources.","position":{"start":{"line":439,"column":5,"offset":13299},"end":{"line":439,"column":41,"offset":13335},"indent":[]}}],"position":{"start":{"line":439,"column":5,"offset":13299},"end":{"line":439,"column":41,"offset":13335},"indent":[]}}],"position":{"start":{"line":439,"column":1,"offset":13295},"end":{"line":439,"column":41,"offset":13335},"indent":[]}}],"position":{"start":{"line":437,"column":1,"offset":13129},"end":{"line":439,"column":41,"offset":13335},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"You can reach this UI at ","position":{"start":{"line":441,"column":1,"offset":13337},"end":{"line":441,"column":26,"offset":13362},"indent":[]}},{"type":"inlineCode","value":"https://<kubernetes-master>/ui","position":{"start":{"line":441,"column":26,"offset":13362},"end":{"line":441,"column":58,"offset":13394},"indent":[]}}],"position":{"start":{"line":441,"column":1,"offset":13337},"end":{"line":441,"column":58,"offset":13394},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"If you cannot access it, you can install it manually:","position":{"start":{"line":443,"column":1,"offset":13396},"end":{"line":443,"column":54,"offset":13449},"indent":[]}}],"position":{"start":{"line":443,"column":1,"offset":13396},"end":{"line":443,"column":54,"offset":13449},"indent":[]}},{"type":"code","lang":"bash","meta":null,"value":"kubectl create -f https://rawgit.com/kubernetes/dashboard/master/src/deploy/kubernetes-dashboard.yaml\n# If the password is asked\nkubectl config view\n\n# If you're on minikube\nminikube dashboard # or --url for the url","position":{"start":{"line":445,"column":1,"offset":13451},"end":{"line":452,"column":4,"offset":13678},"indent":[1,1,1,1,1,1,1]}},{"type":"heading","depth":3,"children":[{"type":"text","value":"Demo: Web UI","position":{"start":{"line":454,"column":5,"offset":13684},"end":{"line":454,"column":17,"offset":13696},"indent":[]}}],"position":{"start":{"line":454,"column":1,"offset":13680},"end":{"line":454,"column":17,"offset":13696},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Using the web ui you can see some really interesting info and graphs on usage.","position":{"start":{"line":456,"column":1,"offset":13698},"end":{"line":456,"column":79,"offset":13776},"indent":[]}}],"position":{"start":{"line":456,"column":1,"offset":13698},"end":{"line":456,"column":79,"offset":13776},"indent":[]}},{"type":"export","value":"export const _frontmatter = {}","position":{"start":{"line":458,"column":1,"offset":13778},"end":{"line":458,"column":31,"offset":13808},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":458,"column":31,"offset":13808}}},"scopeImports":[],"scopeIdentifiers":[],"rawMDXOutput":"/* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\nimport DefaultLayout from \"/Users/dennis.okeeffe/Project-Imposter/developer-notes/node_modules/gatsby-theme-docz/src/base/Layout.js\"\nexport const _frontmatter = {};\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\")\n  return <div {...props}/>\n};\n\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1 {...{\n      \"id\": \"kubernetes-basics\"\n    }}>{`Kubernetes Basics`}</h1>\n    <h3 {...{\n      \"id\": \"node-architecture\"\n    }}>{`Node Architecture`}</h3>\n    <p>{`Within each node can be a collection of pods routed by iptables and within each pod are the Docker containers.`}</p>\n    <p>{`These containers can talk easily to each other using localhost and ports.`}</p>\n    <p>{`Each node also has a `}<inlineCode parentName=\"p\">{`kubelet`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`kube-proxy`}</inlineCode>{`. The `}<inlineCode parentName=\"p\">{`kubelet`}</inlineCode>{` talks to the master node and `}<inlineCode parentName=\"p\">{`kube-proxy`}</inlineCode>{` talks to the iptables.`}</p>\n    <p>{`A service itself can be like the load balancer. The service will be publicly available.`}</p>\n    <p>{`When we look deeper at a pod yaml file, we have the containers called as the specs.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`# pod-helloworld.yml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nodehelloworld.example.com\n  labels:\n  app: helloworld\nspec:\n  # The containers are listed here\n  containers:\n  - name: k8s-demo\n    image: okeeffed/docker-demo\n    ports:\n    - containerPort: 3000\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"replication-controller\"\n    }}>{`Replication Controller`}</h3>\n    <h4 {...{\n      \"id\": \"scaling\"\n    }}>{`Scaling`}</h4>\n    <p>{`If your application is `}<inlineCode parentName=\"p\">{`stateless`}</inlineCode>{` you can horizontally scale it.`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Stateless = your appllication doesn't have a `}<inlineCode parentName=\"li\">{`state`}</inlineCode>{`, it doesn't write any local files / keeps local sessions. This prevents pods from falling out of sync.`}</li>\n      <li parentName=\"ul\">{`All traditional databases are `}<inlineCode parentName=\"li\">{`stateful`}</inlineCode></li>\n      <li parentName=\"ul\">{`Most `}<inlineCode parentName=\"li\">{`web applications`}</inlineCode>{` can be made stateless`}<ul parentName=\"li\">\n          <li parentName=\"ul\">{`Session management needs to be done outside the container`}</li>\n          <li parentName=\"ul\">{`Any file to be saved cannot be saved locally`}</li>\n        </ul></li>\n    </ul>\n    <p>{`If needed, you can use `}<inlineCode parentName=\"p\">{`volumes`}</inlineCode>{` to still run stateful apps.`}</p>\n    <p>{`Those stateful apps can't horizontally scale, but you can run them in a single container and vertically scale (allocate more CPU/Mem/Disk).`}</p>\n    <p>{`Scaling in Kubernetes can be done using the `}<inlineCode parentName=\"p\">{`Replication Controller`}</inlineCode>{`.`}</p>\n    <p>{`The replication controller will ensure a specified number of pod replicas will run at all times.`}</p>\n    <p>{`A pod created with the replica controller will automatically be replaced if they fail, get deleted or are terminated.`}</p>\n    <p>{`Using the replication controller is also recommended if you just want to make sure 1 pod is always running, even after reboots.`}</p>\n    <p>{`You can then run a replication controller with just 1 replica to ensure that it is always running.`}</p>\n    <p>{`To create a replication controller:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`# rc-helloworld.yml\napiVersion: v1\nkind: ReplicationController # Changed from Pod\nmetadata:\n  name: helloworld-container\nspec: # Replation controller also has a spec\n  replicas: 2 # set two pod replicas\n  selector:  # select the app\n  app: helloworld\n  template:\n  # stand Pod metadata and spec\n  metadata:\n    name: nodehelloworld.example.com\n    labels:\n    app: helloworld\n  spec:\n    # The containers are listed here\n    containers:\n    - name: k8s-demo\n      image: okeeffed/docker-demo\n      ports:\n      - containerPort: 3000\n`}</code></pre>\n    <p>{`When this controller is created with `}<inlineCode parentName=\"p\">{`kubectl`}</inlineCode>{`, you will see that the two pods are created with a differing suffix.`}</p>\n    <p>{`Now we have horizontally scaled this pod.`}</p>\n    <p>{`If one of these pods is now deleted, the master node will automatically schedule a new one.`}</p>\n    <p>{`We can also scale this by using `}<inlineCode parentName=\"p\">{`kubectl scale --replicas=4 -f <replication-controller-name.yml>`}</inlineCode>{`.`}</p>\n    <p>{`We can also use it with the following:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-shell\"\n      }}>{`kubectl get rc # get replication controllers\n# assume helloworld-controller shows up\nkubectl scale --replicas=1 rc/helloworld-container\nkubectl get pods # will show only one pod remaining\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"deployments\"\n    }}>{`Deployments`}</h2>\n    <p>{`Replication Set is the next gen Replication Controller:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`It supports new selector that can do selection based on filtering according a set of values eg environment either \"dev\" or \"qa\"`}</li>\n      <li parentName=\"ul\">{`It's not only based on equality. You can do more complex things.`}</li>\n      <li parentName=\"ul\">{`This RS is used by the Deployment.`}</li>\n    </ul>\n    <p>{`A deployment is a declaration that allows you to do app `}<inlineCode parentName=\"p\">{`deployments`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`updates`}</inlineCode>{`.`}</p>\n    <p>{`When using the deployment object, you definte the `}<inlineCode parentName=\"p\">{`state`}</inlineCode>{` of your application. Kubernetes will then make sure the clusters matches your desired state.`}</p>\n    <p>{`Just using the replication controller or replication set might be cumbersome to deploy apps.`}</p>\n    <p>{`With a deployment object you can:`}</p>\n    <ol>\n      <li parentName=\"ol\">{`Create a deployment (e.g. deploying an app)`}</li>\n      <li parentName=\"ol\">{`Update a deployment (e.g. new version)`}</li>\n      <li parentName=\"ol\">{`Do rolling updates (zero downtime deployments)`}</li>\n      <li parentName=\"ol\">{`Roll back`}</li>\n      <li parentName=\"ol\">{`Pause/resume a deployment (ie rollout to only certain percentage of pods)`}</li>\n    </ol>\n    <p>{`An example of a deployment:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`# deployment-helloworld.yml\napiVersion: extensions/v1beta1\nkind: Deployment # Changed from Pod\nmetadata:\n  name: helloworld-deployment\nspec: # Replation controller also has a spec\n  replicas: 3 # set two pod replicas\n  template:\n  # stand Pod metadata and spec\n  metadata:\n    labels:\n    app: helloworld\n  spec:\n    # The containers are listed here\n    containers:\n    - name: k8s-demo\n      image: okeeffed/docker-demo\n      ports:\n      - containerPort: 3000\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"useful-commands\"\n    }}>{`Useful commands`}</h3>\n    <table>\n      <thead parentName=\"table\">\n        <tr parentName=\"thead\">\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Command`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Description`}</th>\n        </tr>\n      </thead>\n      <tbody parentName=\"table\">\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`kubectl get deployments`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Get info on current deployments`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`kubectl get rs`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Get info about the replica set`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`kubectl get pods --show-labels`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Get pods + labels attached to pods`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`kubectl rollout status deployment/helloworld-deployment`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Get deployment status`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`kubectl set image deployment/helloworld-deployment k8s-demo=k8s-demo:2`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Run k8s-demo with the image label version 2`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`kubectl edit deployment/helloworld-deployment`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Edit the deployment object`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`kubectl rollout status deployment/helloworld-deployment`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Get the status of the rollout`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`kubectl rollout history `}{`[deployment]`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Get the rollout history`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`kubectl rollout undo `}{`[deployment]`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Rollback to previous version`}</td>\n        </tr>\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`kubectl rollout undo `}{`[deployment]`}{` --to-revision=n`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Rollback to previous version`}</td>\n        </tr>\n      </tbody>\n    </table>\n    <h3 {...{\n      \"id\": \"demo-deployment-notes\"\n    }}>{`Demo: Deployment notes`}</h3>\n    <p>{`Again, get pods will sho the pods with appended suffixes auto-determined by Kubernetes.`}</p>\n    <p>{`You can verify rollout status using the commands above.`}</p>\n    <h2 {...{\n      \"id\": \"services\"\n    }}>{`Services`}</h2>\n    <p>{`Pods themselves are very dynamic, they come and go on the Kubernetes cluster.`}</p>\n    <ul>\n      <li parentName=\"ul\">{`When using a `}<inlineCode parentName=\"li\">{`Replication Controller`}</inlineCode>{`, pods are termined and created during scaling operations.`}</li>\n      <li parentName=\"ul\">{`Wehn using `}<inlineCode parentName=\"li\">{`Deployments`}</inlineCode>{`, when updating the image version, pods are terminated and new pods take the place of older pods.`}</li>\n    </ul>\n    <p>{`That's why Pods should never be accessed directly, but always through a Service.`}</p>\n    <p>{`A service is the `}<inlineCode parentName=\"p\">{`logical bridge`}</inlineCode>{` between the \"mortal\" pods and other services or end-users.`}</p>\n    <p>{`When using the `}<inlineCode parentName=\"p\">{`kubectl expose`}</inlineCode>{` command, you create a service for you pod to be accessed externally.`}</p>\n    <p>{`Creating a service will create an endpoint for your pod(s):`}</p>\n    <ol>\n      <li parentName=\"ol\">{`A ClusterIP: a virtual IP address only reachable from within the cluster (this is default)`}</li>\n      <li parentName=\"ol\">{`A NodePort: a port that is the same on each node that is also reachable externally.`}</li>\n      <li parentName=\"ol\">{`A LoadBalancer: created by the Cloud provider that will route external traffic on every node on the NodePort`}</li>\n    </ol>\n    <p>{`The options shown only allow virtual IPs and ports.`}</p>\n    <p>{`There is also a possibility to use `}<inlineCode parentName=\"p\">{`DNS Names`}</inlineCode></p>\n    <p>{`The `}<inlineCode parentName=\"p\">{`ExternalName`}</inlineCode>{` can provide a DNS name for the service e.g. for service discovery using DNS.`}</p>\n    <p>{`This `}<strong parentName=\"p\">{`only`}</strong>{` works when the DNS add-on is enabled.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`# helloworld-service.yml\napiVersion: v1\nkind: Service\nmetadata:\n  name: helloworld-service\nspec:\n  ports: # specify the ports the service uses\n  - port: 31001\n    nodePort: 31001\n    # name below defined from pod\n    targetPort: nodejs-port\n    protocol: TCP\n  selector:\n  # service for this app\n  app: helloworld\n  type: NodePort\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"tags\"\n    }}>{`Tags`}</h2>\n    <p>{`Similar to Labels for AWS`}</p>\n    <p>{`For example, you can label your objects.`}</p>\n    <p>{`For instance: Key could be `}<inlineCode parentName=\"p\">{`environment`}</inlineCode>{`, and the value could be `}<inlineCode parentName=\"p\">{`dev`}</inlineCode>{`/`}<inlineCode parentName=\"p\">{`staging`}</inlineCode>{`/`}<inlineCode parentName=\"p\">{`qa`}</inlineCode>{`/`}<inlineCode parentName=\"p\">{`prod`}</inlineCode>{`.`}</p>\n    <p>{`Maybe you could also tag the department that is comes from etc.`}</p>\n    <p>{`Labels are not unique. You can then use `}<inlineCode parentName=\"p\">{`label selectors`}</inlineCode>{` to match labels.`}</p>\n    <p>{`Eg. a particular pod can only run on a node label with \"evironment\" equals \"development\".`}</p>\n    <p>{`More complex matching: \"environment\" in \"development\" or \"qa\".`}</p>\n    <p>{`You can also use labels to tag nodes. Once tagged, you can use labels selectors to let pods only run on specific nodes.`}</p>\n    <p>{`There are two steps required to run a pod on a specific set of nodes:`}</p>\n    <ol>\n      <li parentName=\"ol\">{`First you tag the node`}</li>\n      <li parentName=\"ol\">{`Then you add a `}<inlineCode parentName=\"li\">{`nodeSelector`}</inlineCode>{` to your pod configuration`}</li>\n    </ol>\n    <pre><code parentName=\"pre\" {...{}}>{`kubectl label nodes node1 hardware=high-spec\nkubectl label nodes node1 hardware=low-spec\n`}</code></pre>\n    <p>{`Secondly, add a pod that uses those labels:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`# pod-helloworld.yml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nodehelloworld.example.com\n  labels:\n  app: helloworld\nspec:\n  # The containers are listed here\n  containers:\n  - name: k8s-demo\n    image: okeeffed/docker-demo\n    ports:\n    - containerPort: 3000\n  nodeSelector:\n  hardware: high-spec\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"demo-using-tags\"\n    }}>{`Demo: Using tags`}</h3>\n    <p>{`It only really makes sense if you have multiple nodes (doesn't really make sense on minikube).`}</p>\n    <h2 {...{\n      \"id\": \"healthchecks\"\n    }}>{`Healthchecks`}</h2>\n    <p>{`If the application malfunctions, the pod and container may still be running but the application may no longer be running. This is where health checks come in.`}</p>\n    <p>{`Two types:`}</p>\n    <ol>\n      <li parentName=\"ol\">{`Running a command in the container periodically`}</li>\n      <li parentName=\"ol\">{`Periodic checks on a URL`}</li>\n    </ol>\n    <p>{`The typical prod application behind a load balancer should always have health checks implemented in some way to ensure availability and resiliency.`}</p>\n    <p>{`Below you can see where the healthcheck is. You can check the port or container port name.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`# pod-helloworld.yml\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nodehelloworld.example.com\n  labels:\n  app: helloworld\nspec:\n  # The containers are listed here\n  containers:\n  - name: k8s-demo\n    image: okeeffed/docker-demo\n    ports:\n    - containerPort: 3000\n    # ! This is the health check\n    livenessProbe:\n    httpGet:\n      path: /\n      port: 3000\n    initialDelaySeconds: 15\n    timeoutSeconds: 30\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"secrets\"\n    }}>{`Secrets`}</h2>\n    <p>{`A way to distribute credentials, keys, passwords or secret data to the pods.`}</p>\n    <p>{`Kubernetes itself uses this Secrets mechanism to provide the credentials to access the internal API.`}</p>\n    <p>{`You can use the same mechanism to provide secrets to your application.`}</p>\n    <p><inlineCode parentName=\"p\">{`secrets`}</inlineCode>{` is just one way to provide secrets that is native to Kubernetes. There are still other ways to do this.`}</p>\n    <h3 {...{\n      \"id\": \"how-to-use-them\"\n    }}>{`How to use them`}</h3>\n    <ul>\n      <li parentName=\"ul\">{`Use as env vars`}</li>\n      <li parentName=\"ul\">{`Use as a file in a pod`}<ul parentName=\"li\">\n          <li parentName=\"ul\">{`This requires volumes to be mounted`}</li>\n          <li parentName=\"ul\">{`In this volume you have files`}</li>\n          <li parentName=\"ul\">{`This can be use for things like dotenv files`}</li>\n        </ul></li>\n      <li parentName=\"ul\">{`You can use an external image to pull secrets (private image registry)`}</li>\n    </ul>\n    <p>{`Generating:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`echo -n \"root\" > ./username.txt\necho -n \"password\" > ./password.txt\nkubectl create secret generic db-user-pass --from-file=./username.txt --from-file=./password.txt\n# > secret \"db-user-pass\" created\n`}</code></pre>\n    <p>{`A secret can also be a SSH key or SSL cert.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`kubectl create secret generic ssl-cert --from-file=ssh-privatekey=~/.ssh/id_rsa --ssl-cert-=ssl-cert=mysslcert.crt\n`}</code></pre>\n    <p>{`To generate secrets using yaml defs:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`apiVersion: v1\nkind: Secret\nmetadata:\n  name: db-secret\ntype: Opaque\ndata:\n  password: pwd\n  username: usr\n`}</code></pre>\n    <p>{`Then, you can generate it as base64 like so:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`echo -n \"password\" | base64\n# > pwd\n\nkubectl create -f secrets-db-secret.yml\n# > secret \"db-secret\" created\n`}</code></pre>\n    <p>{`To create a pod that uses secrets:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`# pod-helloworld.yml w/ secrets\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nodehelloworld.example.com\n  labels:\n  app: helloworld\nspec:\n  # The containers are listed here\n  containers:\n  - name: k8s-demo\n    image: okeeffed/docker-demo\n    ports:\n    - containerPort: 3000\n    # @@@ This are the envs\n    env:\n    - name: SECRET_USERNAME\n      valueFrom:\n      secretKeyRef:\n        name: db-secret\n        key: username\n    - name: SECRET_PASSWORD\n      [...]\n`}</code></pre>\n    <p>{`Alternatively when providing in a file:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-yaml\"\n      }}>{`# pod-helloworld.yml w/ secrets\napiVersion: v1\nkind: Pod\nmetadata:\n  name: nodehelloworld.example.com\n  labels:\n  app: helloworld\nspec:\n  # The containers are listed here\n  containers:\n  - name: k8s-demo\n  image: okeeffed/docker-demo\n  ports:\n  - containerPort: 3000\n  # @@@ This are the envs in a volume mount\n  volumeMounts:\n  - name: credvolume\n    mountPath: /etc/creds\n    readOnly: true\n  volumes:\n  - name: credvolume\n  secret:\n    secretName: db-secrets\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"demo-wordpress-secrets\"\n    }}>{`Demo: Wordpress Secrets`}</h3>\n    <p>{`This demo ends up creating a secrets file, a pod definition and a service to expose the wordpress pod.`}</p>\n    <p>{`However, note that deleting the current setup will result in a container restarting to maintain state, but when that happens the WordPress site has to be re-installed because the data was not saved. The solution for this will be in the volumes lab.`}</p>\n    <h2 {...{\n      \"id\": \"web-ui\"\n    }}>{`Web UI`}</h2>\n    <p>{`Kubernetes comes with a `}<inlineCode parentName=\"p\">{`Web UI`}</inlineCode>{` you can use instead of kubectl commands.`}</p>\n    <p>{`You can use it to:`}</p>\n    <ol>\n      <li parentName=\"ol\">{`Get an overview of running applications on your cluster`}</li>\n      <li parentName=\"ol\">{`Creating and modifying individual Kubernetes resources and workloads (like kubectl create and delete)`}</li>\n      <li parentName=\"ol\">{`Retrieve info on state or resources.`}</li>\n    </ol>\n    <p>{`You can reach this UI at `}<inlineCode parentName=\"p\">{`https://<kubernetes-master>/ui`}</inlineCode></p>\n    <p>{`If you cannot access it, you can install it manually:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-bash\"\n      }}>{`kubectl create -f https://rawgit.com/kubernetes/dashboard/master/src/deploy/kubernetes-dashboard.yaml\n# If the password is asked\nkubectl config view\n\n# If you're on minikube\nminikube dashboard # or --url for the url\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"demo-web-ui\"\n    }}>{`Demo: Web UI`}</h3>\n    <p>{`Using the web ui you can see some really interesting info and graphs on usage.`}</p>\n\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;"}}