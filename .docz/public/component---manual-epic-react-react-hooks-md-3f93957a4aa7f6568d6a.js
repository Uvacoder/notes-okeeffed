(window.webpackJsonp=window.webpackJsonp||[]).push([[245],{oBWX:function(e,n,t){"use strict";t.r(n),t.d(n,"_frontmatter",(function(){return s})),t.d(n,"default",(function(){return i}));t("1c7q"),t("abGl"),t("gZHo"),t("Fdmb"),t("Ir+3"),t("2mQt"),t("mXGw");var o=t("/FXl"),a=t("TjRS");t("aD51");function r(){return(r=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(this,arguments)}var s={};void 0!==s&&s&&s===Object(s)&&Object.isExtensible(s)&&!s.hasOwnProperty("__filemeta")&&Object.defineProperty(s,"__filemeta",{configurable:!0,value:{name:"_frontmatter",filename:"manual/Epic-React/React-Hooks.md"}});var l={_frontmatter:s},m=a.a;function i(e){var n=e.components,a=function(e,n){if(null==e)return{};var t,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,["components"]);return Object(o.b)(m,r({},l,a,{components:n,mdxType:"MDXLayout"}),Object(o.b)("h1",{id:"react-hooks"},"React Hooks"),Object(o.b)("h2",{id:"usestate"},"useState"),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},"\"Normally an interactive application will need to hold state somewhere. In React, you use special functions called 'hooks' to do this.\"")),Object(o.b)("p",null,"An example app setting names:"),Object(o.b)("pre",null,Object(o.b)("code",r({parentName:"pre"},{className:"language-js"}),"// useState: greeting\n// http://localhost:3000/isolated/exercise/01.js\n\nimport * as React from 'react';\n\nfunction Greeting() {\n  const [name, setName] = React.useState('');\n\n  function handleChange(event) {\n    // üê® update the name here based on event.target.value\n    setName(event.target.value);\n  }\n\n  return (\n    <div>\n      <form>\n        <label htmlFor=\"name\">Name: </label>\n        <input onChange={handleChange} id=\"name\" />\n      </form>\n      {name ? <strong>Hello {name}</strong> : 'Please type your name'}\n    </div>\n  );\n}\n\nfunction App() {\n  return <Greeting />;\n}\n\nexport default App;\n")),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},'\'I have no mechanism for saying, "Hey, React, I changed the name value. I want you to re-render this and get some new JSX based on the state update that I have made." That\'s what React useState Hook is intended to do. It says, "Hey, React, this component can re-render any time this state that I want you to manage is going to change."\'')),Object(o.b)("h2",{id:"useeffect-persistent-state"},"useEffect (persistent state)"),Object(o.b)("blockquote",null,Object(o.b)("p",{parentName:"blockquote"},'"',Object(o.b)("inlineCode",{parentName:"p"},"React.useEffect"),' is a built-in hook that allows you to run some custom code after React renders (and re-renders) your component to the DOM. It accepts a callback function which React will call after the DOM has been updated."')),Object(o.b)("pre",null,Object(o.b)("code",r({parentName:"pre"},{className:"language-js"}),"React.useEffect(() => {\n  // your side-effect code here.\n  // this is where you can make HTTP requests or interact with browser APIs.\n});\n")),Object(o.b)("p",null,Object(o.b)("img",{alt:"Hook Flow",src:t("tcZH")})),Object(o.b)("h3",{id:"lazy-state-initialization"},"Lazy State Initialization"),Object(o.b)("p",null,"Right now, every time our component function is run, our function reads from localStorage. This is problematic because it could be a performance bottleneck (reading from localStorage can be slow). And what‚Äôs more we only actually need to know the value from localStorage the first time this component is rendered! So the additional reads are wasted effort."),Object(o.b)("p",null,"To avoid this problem, React‚Äôs useState hook allows you to pass a function instead of the actual value, and then it will only call that function to get the state value when the component is rendered the first time. So you can go from this: ",Object(o.b)("inlineCode",{parentName:"p"},"React.useState(someExpensiveComputation())")," To this: ",Object(o.b)("inlineCode",{parentName:"p"},"React.useState(() => someExpensiveComputation())"),"."),Object(o.b)("p",null,"And the ",Object(o.b)("inlineCode",{parentName:"p"},"someExpensiveComputation")," function will only be called when it‚Äôs needed!"),Object(o.b)("p",null,"Make the ",Object(o.b)("inlineCode",{parentName:"p"},"React.useState")," call use lazy initialization to avoid a performance bottleneck of reading into localStorage on every render."),Object(o.b)("pre",null,Object(o.b)("code",r({parentName:"pre"},{className:"language-js"}),"// useEffect: persistent state\n// http://localhost:3000/isolated/exercise/02.js\n\nimport * as React from 'react';\n\nfunction Greeting({ initialName = '' }) {\n  const [name, setName] = React.useState(\n    () => window.localStorage.getItem('name') || initialName,\n  );\n\n  // ... code omitted\n\n  return (\n    <div>\n      <form>\n        <label htmlFor=\"name\">Name: </label>\n        <input onChange={handleChange} id=\"name\" />\n      </form>\n      {name ? <strong>Hello {name}</strong> : 'Please type your name'}\n    </div>\n  );\n}\n")),Object(o.b)("h3",{id:"effect-dependencies"},"Effect Dependencies"),Object(o.b)("p",null,"The callback we‚Äôre passing to ",Object(o.b)("inlineCode",{parentName:"p"},"React.useEffect")," is called after every render of our component (including re-renders). This is exactly what we want because we want to make sure that the name is saved into localStorage whenever it changes, but there are various reasons a component can be re-rendered (for example, when a parent component in the application tree gets re-rendered). We use a dependencies array to fix this issue."),Object(o.b)("pre",null,Object(o.b)("code",r({parentName:"pre"},{className:"language-js"}),"// useEffect: persistent state\n// http://localhost:3000/isolated/exercise/02.js\n\nimport * as React from 'react';\n\nfunction Greeting({ initialName = '' }) {\n  // Here is our new useEffect callback\n  React.useEffect(() => {\n    window.localStorage.setItem('name', name);\n  }, [name]);\n\n  function handleChange(event) {\n    setName(event.target.value);\n  }\n  return (\n    <div>\n      <form>\n        <label htmlFor=\"name\">Name: </label>\n        <input onChange={handleChange} id=\"name\" />\n      </form>\n      {name ? <strong>Hello {name}</strong> : 'Please type your name'}\n    </div>\n  );\n}\n\nfunction App() {\n  return <Greeting />;\n}\n\nexport default App;\n")),Object(o.b)("h3",{id:"custom-hook"},"Custom Hook"),Object(o.b)("p",null,"If we think this logic will be used elsewhere, we can abstract it into a custom hook:"),Object(o.b)("pre",null,Object(o.b)("code",r({parentName:"pre"},{className:"language-js"}),"// useEffect: persistent state\n// http://localhost:3000/isolated/exercise/02.js\n\nimport * as React from 'react';\n\n// Here is our new custom hook!\nfunction useLocalStorageState(key, defaultValue) {\n  const [state, setState] = React.useState(\n    () => window.localStorage.getItem(key) || defaultValue,\n  );\n\n  React.useEffect(() => {\n    window.localStorage.setItem(key, state);\n  }, [key, state]);\n\n  return [state, setState];\n}\n\nfunction Greeting({ initialName = '' }) {\n  const [name, setName] = useLocalStorageState('name', initialName);\n\n  function handleChange(event) {\n    setName(event.target.value);\n  }\n  return (\n    <div>\n      <form>\n        <label htmlFor=\"name\">Name: </label>\n        <input value={name} onChange={handleChange} id=\"name\" />\n      </form>\n      {name ? <strong>Hello {name}</strong> : 'Please type your name'}\n    </div>\n  );\n}\n\nfunction App() {\n  return <Greeting />;\n}\n\nexport default App;\n")),Object(o.b)("h3",{id:"flexible-custom-hook"},"Flexible Custom Hook"),Object(o.b)("p",null,"To make this hook more reuseable, we can make some changes to take any data type:"),Object(o.b)("pre",null,Object(o.b)("code",r({parentName:"pre"},{className:"language-js"}),"// useEffect: persistent state\n// http://localhost:3000/isolated/exercise/02.js\n\nimport * as React from 'react';\n\n// Here is our new custom hook!\nfunction useLocalStorageState(\n  key,\n  defaultValue,\n  { serialize = JSON.stringify, deserialise = JSON.parse } = {},\n) {\n  const [state, setState] = React.useState(() => {\n    const valueInLocalStorage = window.localStorage.getItem(key);\n\n    if (valueInLocalStorage) {\n      return deserialize(valueInLocalStorage);\n    }\n\n    // can handle function to call to set default value if computationally expensive\n    return typeof defaultValue === 'function' ? defaultValue() : defaultValue;\n  });\n\n  const prevKeyRef = React.useRef(key);\n\n  React.useEffect(() => {\n    const prevKey = prevKeyRef.current;\n    if (prevKey !== key) {\n      window.localStorage.removeItem(prevKey);\n    }\n\n    prevKeyRef.current = key;\n    window.localStorage.setItem(key, serialize(state));\n  }, [key, serialize, state]);\n\n  return [state, setState];\n}\n\nfunction Greeting({ initialName = '' }) {\n  const [name, setName] = useLocalStorageState('name', initialName);\n\n  function handleChange(event) {\n    setName(event.target.value);\n  }\n  return (\n    <div>\n      <form>\n        <label htmlFor=\"name\">Name: </label>\n        <input value={name} onChange={handleChange} id=\"name\" />\n      </form>\n      {name ? <strong>Hello {name}</strong> : 'Please type your name'}\n    </div>\n  );\n}\n\nfunction App() {\n  return <Greeting />;\n}\n\nexport default App;\n")),Object(o.b)("h2",{id:"lifting-state"},"Lifting State"),Object(o.b)("p",null,"This section covers the idea of moving state up or down the component hierarchy based on requirements."),Object(o.b)("p",null,"Not too much to add here."),Object(o.b)("h2",{id:"usestate-tic-tac-toe"},"useState: tic tac toe"),Object(o.b)("p",null,"The final code sets initial state lazily from Local Storage (or fallsback to an empty array) and derived state is done based on that state value on each render."),Object(o.b)("p",null,"The final code is as so:"),Object(o.b)("pre",null,Object(o.b)("code",r({parentName:"pre"},{className:"language-js"}),"// useState: tic tac toe\n// http://localhost:3000/isolated/exercise/04.js\n\nimport * as React from 'react';\n\nfunction Board() {\n  const [squares, setSquares] = React.useState(\n    () =>\n      JSON.parse(window.localStorage.getItem('squares')) || Array(9).fill(null),\n  );\n\n  React.useEffect(() => {\n    window.localStorage.setItem('squares', JSON.stringify(squares));\n  }, [squares]);\n\n  // üê® We'll need the following bits of derived state:\n  const nextValue = calculateNextValue(squares);\n  const winner = calculateWinner(squares);\n  const status = calculateStatus(winner, squares, nextValue);\n  // üí∞ I've written the calculations for you! So you can use my utilities\n  // below to create these variables\n\n  // This is the function your square click handler will call. `square` should\n  // be an index. So if they click the center square, this will be `4`.\n  function selectSquare(square) {\n    if (winner || squares[square]) {\n      return;\n    }\n    // üê® first, if there's already winner or there's already a value at the\n    // given square index (like someone clicked a square that's already been\n    // clicked), then return early so we don't make any state changes\n    //\n    // ü¶â It's typically a bad idea to mutate or directly change state in React.\n    // Doing so can lead to subtle bugs that can easily slip into production.\n    //\n    // üê® make a copy of the squares array\n    // üí∞ `[...squares]` will do it!)\n    //\n    // üê® set the value of the square that was selected\n    // üí∞ `squaresCopy[square] = nextValue`\n    //\n    // üê® set the squares to your copy\n    const squaresCopy = [...squares];\n    squaresCopy[square] = nextValue;\n    setSquares(squaresCopy);\n  }\n\n  function restart() {\n    // üê® reset the squares\n    // üí∞ `Array(9).fill(null)` will do it!\n    setSquares(Array(9).fill(null));\n  }\n\n  function renderSquare(i) {\n    return (\n      <button className=\"square\" onClick={() => selectSquare(i)}>\n        {squares[i]}\n      </button>\n    );\n  }\n\n  return (\n    <div>\n      {/* üê® put the status in the div below */}\n      <div className=\"status\">{status}</div>\n      <div className=\"board-row\">\n        {renderSquare(0)}\n        {renderSquare(1)}\n        {renderSquare(2)}\n      </div>\n      <div className=\"board-row\">\n        {renderSquare(3)}\n        {renderSquare(4)}\n        {renderSquare(5)}\n      </div>\n      <div className=\"board-row\">\n        {renderSquare(6)}\n        {renderSquare(7)}\n        {renderSquare(8)}\n      </div>\n      <button className=\"restart\" onClick={restart}>\n        restart\n      </button>\n    </div>\n  );\n}\n\nfunction Game() {\n  return (\n    <div className=\"game\">\n      <div className=\"game-board\">\n        <Board />\n      </div>\n    </div>\n  );\n}\n\n// eslint-disable-next-line no-unused-vars\nfunction calculateStatus(winner, squares, nextValue) {\n  return winner\n    ? `Winner: ${winner}`\n    : squares.every(Boolean)\n    ? `Scratch: Cat's game`\n    : `Next player: ${nextValue}`;\n}\n\n// eslint-disable-next-line no-unused-vars\nfunction calculateNextValue(squares) {\n  const xSquaresCount = squares.filter(r => r === 'X').length;\n  const oSquaresCount = squares.filter(r => r === 'O').length;\n  return oSquaresCount === xSquaresCount ? 'X' : 'O';\n}\n\n// eslint-disable-next-line no-unused-vars\nfunction calculateWinner(squares) {\n  const lines = [\n    [0, 1, 2],\n    [3, 4, 5],\n    [6, 7, 8],\n    [0, 3, 6],\n    [1, 4, 7],\n    [2, 5, 8],\n    [0, 4, 8],\n    [2, 4, 6],\n  ];\n  for (let i = 0; i < lines.length; i++) {\n    const [a, b, c] = lines[i];\n    if (squares[a] && squares[a] === squares[b] && squares[a] === squares[c]) {\n      return squares[a];\n    }\n  }\n  return null;\n}\n\nfunction App() {\n  return <Game />;\n}\n\nexport default App;\n")),Object(o.b)("h2",{id:"useref-and-useeffect-dom-interaction"},"useRef and useEffect: DOM interaction"),Object(o.b)("p",null,"The main pointers here were to use ",Object(o.b)("inlineCode",{parentName:"p"},"useRef")," for mutable DOM manipulation and was used for an example library where the interaction is set once during ",Object(o.b)("inlineCode",{parentName:"p"},"useEffect")," with a return function to destroy the instance."),Object(o.b)("h2",{id:"useeffect-http-requests"},"useEffect: HTTP requests"),Object(o.b)("p",null,"HTTP requests are another common side-effect that we need to do in applications. This is no different from the side-effects we need to apply to a rendered DOM or when interacting with browser APIs like ",Object(o.b)("inlineCode",{parentName:"p"},"localStorage"),". In all these cases, we do that within a ",Object(o.b)("inlineCode",{parentName:"p"},"useEffect")," hook callback. This hook allows us to ensure that whenever certain changes take place, we apply the side-effects based on those changes."),Object(o.b)("p",null,"One important thing to note about the ",Object(o.b)("inlineCode",{parentName:"p"},"useEffect")," hook is that you cannot return anything other than the cleanup function. This has interesting implications with regard to async/await syntax:"),Object(o.b)("pre",null,Object(o.b)("code",r({parentName:"pre"},{className:"language-js"}),"// this does not work, don't do this:\nReact.useEffect(async () => {\n  const result = await doSomeAsyncThing();\n  // do something with the result\n});\n")),Object(o.b)("p",null,"The reason this doesn‚Äôt work is because when you make a function async, it automatically returns a promise (whether you‚Äôre not returning anything at all, or explicitly returning a function). This is due to the semantics of async/await syntax. So if you want to use async/await, the best way to do that is like so:"),Object(o.b)("pre",null,Object(o.b)("code",r({parentName:"pre"},{className:"language-js"}),"React.useEffect(() => {\n  async function effect() {\n    const result = await doSomeAsyncThing();\n    // do something with the result\n  }\n  effect();\n});\n")),Object(o.b)("p",null,"This ensures that you don‚Äôt return anything but a cleanup function."),Object(o.b)("p",null,"Kent mentions that he typically finds it easier to abstract all async code into a utility function that can be called using promise-based ",Object(o.b)("inlineCode",{parentName:"p"},".then"),":"),Object(o.b)("pre",null,Object(o.b)("code",r({parentName:"pre"},{className:"language-js"}),"React.useEffect(() => {\n  doSomeAsyncThing().then(result => {\n    // do something with the result\n  });\n});\n")),Object(o.b)("h3",{id:"http-request-exercise"},"HTTP request exercise"),Object(o.b)("p",null,"In the first exercise, we want to update the state based on a side-effect to do with a changing ",Object(o.b)("inlineCode",{parentName:"p"},"pokemonName"),"."),Object(o.b)("p",null,"The solution is as follows:"),Object(o.b)("pre",null,Object(o.b)("code",r({parentName:"pre"},{className:"language-js"}),"// useEffect: HTTP requests\n// http://localhost:3000/isolated/exercise/06.js\n\nimport * as React from 'react';\n// üê® you'll want the following additional things from '../pokemon':\n// fetchPokemon: the function we call to get the pokemon info\n// PokemonInfoFallback: the thing we show while we're loading the pokemon info\n// PokemonDataView: the stuff we use to display the pokemon info\nimport {\n  PokemonForm,\n  fetchPokemon,\n  PokemonInfoFallback,\n  PokemonDataView,\n} from '../pokemon';\n\nfunction PokemonInfo({ pokemonName }) {\n  // üê® Have state for the pokemon (null)\n  const [pokemon, setPokemon] = React.useState(null);\n  // üê® use React.useEffect where the callback should be called whenever the\n  // pokemon name changes.\n  React.useEffect(() => {\n    if (!pokemonName) {\n      return;\n    }\n\n    fetchPokemon(pokemonName)\n      .then(pokemonData => {\n        setPokemon(pokemonData);\n      })\n      .catch(err => console.dir(err));\n  }, [pokemonName]);\n  // üí∞ DON'T FORGET THE DEPENDENCIES ARRAY!\n  // üí∞ if the pokemonName is falsy (an empty string) then don't bother making the request (exit early).\n  // üê® before calling `fetchPokemon`, clear the current pokemon state by setting it to null\n  // üí∞ Use the `fetchPokemon` function to fetch a pokemon by its name:\n  //   fetchPokemon('Pikachu').then(\n  //     pokemonData => { /* update all the state here */},\n  //   )\n  // üê® return the following things based on the `pokemon` state and `pokemonName` prop:\n  //   1. no pokemonName: 'Submit a pokemon'\n  //   2. pokemonName but no pokemon: <PokemonInfoFallback name={pokemonName} />\n  //   3. pokemon: <PokemonDataView pokemon={pokemon} />\n  const hasPokemonDataAndPokemonName = pokemonName && pokemon;\n\n  return (\n    <div>\n      {!pokemon && <p>Submit a pokemon</p>}\n      {!hasPokemonDataAndPokemonName && (\n        <PokemonInfoFallback name={pokemonName} />\n      )}\n      {hasPokemonDataAndPokemonName && <PokemonDataView pokemon={pokemon} />}\n    </div>\n  );\n}\n\nfunction App() {\n  const [pokemonName, setPokemonName] = React.useState('');\n\n  function handleSubmit(newPokemonName) {\n    setPokemonName(newPokemonName);\n  }\n\n  return (\n    <div className=\"pokemon-info-app\">\n      <PokemonForm pokemonName={pokemonName} onSubmit={handleSubmit} />\n      <hr />\n      <div className=\"pokemon-info\">\n        <PokemonInfo pokemonName={pokemonName} />\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n")),Object(o.b)("h3",{id:"handling-errors"},"Handling errors"),Object(o.b)("p",null,"The code was updated to handle when an error occurs:"),Object(o.b)("pre",null,Object(o.b)("code",r({parentName:"pre"},{className:"language-js"}),"// useEffect: HTTP requests\n// http://localhost:3000/isolated/exercise/06.js\n\nimport * as React from 'react';\n// üê® you'll want the following additional things from '../pokemon':\n// fetchPokemon: the function we call to get the pokemon info\n// PokemonInfoFallback: the thing we show while we're loading the pokemon info\n// PokemonDataView: the stuff we use to display the pokemon info\nimport {\n  PokemonForm,\n  fetchPokemon,\n  PokemonInfoFallback,\n  PokemonDataView,\n} from '../pokemon';\n\nfunction PokemonInfo({ pokemonName }) {\n  const [pokemon, setPokemon] = React.useState(null);\n  const [error, setError] = React.useState(null);\n\n  React.useEffect(() => {\n    if (!pokemonName) {\n      return;\n    }\n\n    fetchPokemon(pokemonName)\n      .then(pokemonData => {\n        setError(null);\n        setPokemon(pokemonData);\n      })\n      // handling of the error\n      .catch(err => setError(err));\n  }, [pokemonName]);\n\n  const hasPokemonDataAndPokemonName = pokemonName && pokemon;\n\n  return error ? (\n    <div role=\"alert\">\n      There was an error:{' '}\n      <pre style={{ whiteSpace: 'normal' }}>{error.message}</pre>\n    </div>\n  ) : (\n    <div>\n      {!pokemon && <p>Submit a pokemon</p>}\n      {!hasPokemonDataAndPokemonName && (\n        <PokemonInfoFallback name={pokemonName} />\n      )}\n      {hasPokemonDataAndPokemonName && <PokemonDataView pokemon={pokemon} />}\n    </div>\n  );\n}\n\nfunction App() {\n  const [pokemonName, setPokemonName] = React.useState('');\n\n  function handleSubmit(newPokemonName) {\n    setPokemonName(newPokemonName);\n  }\n\n  return (\n    <div className=\"pokemon-info-app\">\n      <PokemonForm pokemonName={pokemonName} onSubmit={handleSubmit} />\n      <hr />\n      <div className=\"pokemon-info\">\n        <PokemonInfo pokemonName={pokemonName} />\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n")),Object(o.b)("h3",{id:"supporting-request-state"},"Supporting request state"),Object(o.b)("p",null,'Instead of relying on booleans, we can use "request state" to help identify what to display:'),Object(o.b)("pre",null,Object(o.b)("code",r({parentName:"pre"},{className:"language-js"}),"// useEffect: HTTP requests\n// http://localhost:3000/isolated/exercise/06.js\n\nimport * as React from 'react';\n// üê® you'll want the following additional things from '../pokemon':\n// fetchPokemon: the function we call to get the pokemon info\n// PokemonInfoFallback: the thing we show while we're loading the pokemon info\n// PokemonDataView: the stuff we use to display the pokemon info\nimport {\n  PokemonForm,\n  fetchPokemon,\n  PokemonInfoFallback,\n  PokemonDataView,\n} from '../pokemon';\n\nfunction PokemonInfo({ pokemonName }) {\n  // üê® Have state for the pokemon (null)\n  const [pokemon, setPokemon] = React.useState(null);\n  const [error, setError] = React.useState(null);\n  const [state, setState] = React.useState('idle');\n  // üê® use React.useEffect where the callback should be called whenever the\n  // pokemon name changes.\n  React.useEffect(() => {\n    if (!pokemonName) {\n      return;\n    }\n\n    setState('pending');\n\n    fetchPokemon(pokemonName)\n      .then(pokemonData => {\n        setError(null);\n        setPokemon(pokemonData);\n        setState('resolved');\n      })\n      .catch(err => {\n        setError(err);\n        setState('rejected');\n      });\n  }, [pokemonName]);\n\n  switch (state) {\n    case 'resolved':\n      return <PokemonDataView pokemon={pokemon} />;\n    case 'rejected':\n      return (\n        <div role=\"alert\">\n          There was an error:{' '}\n          <pre style={{ whiteSpace: 'normal' }}>{error.message}</pre>\n        </div>\n      );\n    case 'pending':\n      return <PokemonInfoFallback name={pokemonName} />;\n    case 'idle':\n    default:\n      return <p>Submit a pokemon</p>;\n  }\n}\n\nfunction App() {\n  const [pokemonName, setPokemonName] = React.useState('');\n\n  function handleSubmit(newPokemonName) {\n    setPokemonName(newPokemonName);\n  }\n\n  return (\n    <div className=\"pokemon-info-app\">\n      <PokemonForm pokemonName={pokemonName} onSubmit={handleSubmit} />\n      <hr />\n      <div className=\"pokemon-info\">\n        <PokemonInfo pokemonName={pokemonName} />\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n")),Object(o.b)("h2",{id:"store-state-as-an-object"},"Store state as an object"),Object(o.b)("p",null,"To ensure we don't run into issues from state updates happening in an async callback, we update the state to use an object."),Object(o.b)("p",null,"Note: there is a more elegant solution using reducers that will be shown in future."),Object(o.b)("pre",null,Object(o.b)("code",r({parentName:"pre"},{className:"language-js"}),"// useEffect: HTTP requests\n// http://localhost:3000/isolated/exercise/06.js\n\nimport * as React from 'react';\n// üê® you'll want the following additional things from '../pokemon':\n// fetchPokemon: the function we call to get the pokemon info\n// PokemonInfoFallback: the thing we show while we're loading the pokemon info\n// PokemonDataView: the stuff we use to display the pokemon info\nimport {\n  PokemonForm,\n  fetchPokemon,\n  PokemonInfoFallback,\n  PokemonDataView,\n} from '../pokemon';\n\nfunction PokemonInfo({ pokemonName }) {\n  // üê® Have state for the pokemon (null)\n  const [state, setState] = React.useState({\n    status: 'idle',\n    error: null,\n    pokemon: null,\n  });\n  // üê® use React.useEffect where the callback should be called whenever the\n  // pokemon name changes.\n  React.useEffect(() => {\n    if (!pokemonName) {\n      return;\n    }\n\n    setState({\n      pokemon: null,\n      error: null,\n      status: 'pending',\n    });\n\n    fetchPokemon(pokemonName)\n      .then(pokemonData => {\n        setState({\n          status: 'resolved',\n          pokemon: pokemonData,\n          error: null,\n        });\n      })\n      .catch(err => {\n        setState({\n          status: 'rejected',\n          pokemon: null,\n          error: err,\n        });\n      });\n  }, [pokemonName]);\n\n  switch (state.status) {\n    case 'resolved':\n      return <PokemonDataView pokemon={state.pokemon} />;\n    case 'rejected':\n      return (\n        <div role=\"alert\">\n          There was an error:{' '}\n          <pre style={{ whiteSpace: 'normal' }}>{state.error.message}</pre>\n        </div>\n      );\n    case 'pending':\n      return <PokemonInfoFallback name={pokemonName} />;\n    case 'idle':\n    default:\n      return <p>Submit a pokemon</p>;\n  }\n}\n\nfunction App() {\n  const [pokemonName, setPokemonName] = React.useState('');\n\n  function handleSubmit(newPokemonName) {\n    setPokemonName(newPokemonName);\n  }\n\n  return (\n    <div className=\"pokemon-info-app\">\n      <PokemonForm pokemonName={pokemonName} onSubmit={handleSubmit} />\n      <hr />\n      <div className=\"pokemon-info\">\n        <PokemonInfo pokemonName={pokemonName} />\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n")),Object(o.b)("h3",{id:"adding-an-error-boundary"},"Adding an error boundary"),Object(o.b)("p",null,"We can use classes to add an error boundary. The ",Object(o.b)("inlineCode",{parentName:"p"},"componentDidCatch")," method also gives an ",Object(o.b)("inlineCode",{parentName:"p"},"error")," which is the usual error object and ",Object(o.b)("inlineCode",{parentName:"p"},"errorInfo")," variable that displays information about the component stack."),Object(o.b)("pre",null,Object(o.b)("code",r({parentName:"pre"},{className:"language-js"}),"// useEffect: HTTP requests\n// http://localhost:3000/isolated/exercise/06.js\n\nimport * as React from 'react';\n// üê® you'll want the following additional things from '../pokemon':\n// fetchPokemon: the function we call to get the pokemon info\n// PokemonInfoFallback: the thing we show while we're loading the pokemon info\n// PokemonDataView: the stuff we use to display the pokemon info\nimport {\n  PokemonForm,\n  fetchPokemon,\n  PokemonInfoFallback,\n  PokemonDataView,\n} from '../pokemon';\n\nclass ErrorBoundary extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = { hasError: false };\n  }\n\n  static getDerivedStateFromError(error) {\n    // Update state so the next render will show the fallback UI.\n    return { hasError: true };\n  }\n\n  componentDidCatch(error, errorInfo) {\n    // You can also log the error to an error reporting service\n    console.log('error:', error);\n    console.log('errorInfo:', errorInfo);\n  }\n\n  render() {\n    if (this.state.hasError) {\n      // You can render any custom fallback UI\n      return <h1>Something went wrong.</h1>;\n    }\n\n    return this.props.children;\n  }\n}\n\nfunction PokemonInfo({ pokemonName }) {\n  // üê® Have state for the pokemon (null)\n  const [state, setState] = React.useState({\n    status: 'idle',\n    error: null,\n    pokemon: null,\n  });\n  // üê® use React.useEffect where the callback should be called whenever the\n  // pokemon name changes.\n  React.useEffect(() => {\n    if (!pokemonName) {\n      return;\n    }\n\n    setState({\n      pokemon: null,\n      error: null,\n      status: 'pending',\n    });\n\n    fetchPokemon(pokemonName)\n      .then(pokemonData => {\n        setState({\n          status: 'resolved',\n          pokemon: pokemonData,\n          error: null,\n        });\n      })\n      .catch(err => {\n        setState({\n          status: 'rejected',\n          pokemon: null,\n          error: err,\n        });\n      });\n  }, [pokemonName]);\n\n  switch (state.status) {\n    case 'resolved':\n      return <PokemonDataView pokemon={state.pokemon} />;\n    case 'rejected':\n      throw state.error;\n    case 'pending':\n      return <PokemonInfoFallback name={pokemonName} />;\n    case 'idle':\n    default:\n      return <p>Submit a pokemon</p>;\n  }\n}\n\nfunction App() {\n  const [pokemonName, setPokemonName] = React.useState('');\n\n  function handleSubmit(newPokemonName) {\n    setPokemonName(newPokemonName);\n  }\n\n  return (\n    <ErrorBoundary>\n      <div className=\"pokemon-info-app\">\n        <PokemonForm pokemonName={pokemonName} onSubmit={handleSubmit} />\n        <hr />\n        <div className=\"pokemon-info\">\n          <PokemonInfo pokemonName={pokemonName} />\n        </div>\n      </div>\n    </ErrorBoundary>\n  );\n}\n\nexport default App;\n")),Object(o.b)("h3",{id:"resetting-an-error-boundary"},"Resetting an error boundary"),Object(o.b)("p",null,"We can clean the state and pass a key to the error boundary to get a way to clean things up:"),Object(o.b)("pre",null,Object(o.b)("code",r({parentName:"pre"},{className:"language-js"}),"// useEffect: HTTP requests\n// http://localhost:3000/isolated/exercise/06.js\n\nimport * as React from 'react';\n// üê® you'll want the following additional things from '../pokemon':\n// fetchPokemon: the function we call to get the pokemon info\n// PokemonInfoFallback: the thing we show while we're loading the pokemon info\n// PokemonDataView: the stuff we use to display the pokemon info\nimport {\n  PokemonForm,\n  fetchPokemon,\n  PokemonInfoFallback,\n  PokemonDataView,\n} from '../pokemon';\n\nclass ErrorBoundary extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = { hasError: false };\n  }\n\n  static getDerivedStateFromError(error) {\n    // Update state so the next render will show the fallback UI.\n    return { hasError: true };\n  }\n\n  componentDidCatch(error, errorInfo) {\n    // You can also log the error to an error reporting service\n    console.log('error:', error);\n    console.log('errorInfo:', errorInfo);\n  }\n\n  render() {\n    if (this.state.hasError) {\n      // You can render any custom fallback UI\n      return (\n        <div>\n          <h1>Something went wrong.</h1>\n          <button onClick={() => this.props.setPokemonName(null)}>\n            Reset pokemon name\n          </button>\n        </div>\n      );\n    }\n\n    return this.props.children;\n  }\n}\n\nfunction PokemonInfo({ pokemonName }) {\n  // üê® Have state for the pokemon (null)\n  const [state, setState] = React.useState({\n    status: 'idle',\n    error: null,\n    pokemon: null,\n  });\n  // üê® use React.useEffect where the callback should be called whenever the\n  // pokemon name changes.\n  React.useEffect(() => {\n    if (!pokemonName) {\n      return;\n    }\n\n    setState({\n      pokemon: null,\n      error: null,\n      status: 'pending',\n    });\n\n    fetchPokemon(pokemonName)\n      .then(pokemonData => {\n        setState({\n          status: 'resolved',\n          pokemon: pokemonData,\n          error: null,\n        });\n      })\n      .catch(err => {\n        setState({\n          status: 'rejected',\n          pokemon: null,\n          error: err,\n        });\n      });\n  }, [pokemonName]);\n\n  switch (state.status) {\n    case 'resolved':\n      return <PokemonDataView pokemon={state.pokemon} />;\n    case 'rejected':\n      throw state.error;\n    case 'pending':\n      return <PokemonInfoFallback name={pokemonName} />;\n    case 'idle':\n    default:\n      return <p>Submit a pokemon</p>;\n  }\n}\n\nfunction App() {\n  const [pokemonName, setPokemonName] = React.useState('');\n\n  function handleSubmit(newPokemonName) {\n    setPokemonName(newPokemonName);\n  }\n\n  return (\n    <ErrorBoundary key={pokemonName} setPokemonName={setPokemonName}>\n      <div className=\"pokemon-info-app\">\n        <PokemonForm pokemonName={pokemonName} onSubmit={handleSubmit} />\n        <hr />\n        <div className=\"pokemon-info\">\n          <PokemonInfo pokemonName={pokemonName} />\n        </div>\n      </div>\n    </ErrorBoundary>\n  );\n}\n\nexport default App;\n")),Object(o.b)("h3",{id:"using-react-error-boundary"},"using react-error-boundary"),Object(o.b)("pre",null,Object(o.b)("code",r({parentName:"pre"},{className:"language-js"}),"import * as React from 'react';\n// üê® you'll want the following additional things from '../pokemon':\n// fetchPokemon: the function we call to get the pokemon info\n// PokemonInfoFallback: the thing we show while we're loading the pokemon info\n// PokemonDataView: the stuff we use to display the pokemon info\nimport {\n  PokemonForm,\n  fetchPokemon,\n  PokemonInfoFallback,\n  PokemonDataView,\n} from '../pokemon';\nimport { resetErrorBoundary, ErrorBoundary } from 'react-error-boundary';\n\nfunction PokemonInfo({ pokemonName }) {\n  // üê® Have state for the pokemon (null)\n  const [state, setState] = React.useState({\n    status: 'idle',\n    error: null,\n    pokemon: null,\n  });\n  // üê® use React.useEffect where the callback should be called whenever the\n  // pokemon name changes.\n  React.useEffect(() => {\n    if (!pokemonName) {\n      return;\n    }\n\n    setState({\n      pokemon: null,\n      error: null,\n      status: 'pending',\n    });\n\n    fetchPokemon(pokemonName)\n      .then(pokemonData => {\n        setState({\n          status: 'resolved',\n          pokemon: pokemonData,\n          error: null,\n        });\n      })\n      .catch(err => {\n        setState({\n          status: 'rejected',\n          pokemon: null,\n          error: err,\n        });\n      });\n  }, [pokemonName]);\n\n  switch (state.status) {\n    case 'resolved':\n      return <PokemonDataView pokemon={state.pokemon} />;\n    case 'rejected':\n      throw state.error;\n    case 'pending':\n      return <PokemonInfoFallback name={pokemonName} />;\n    case 'idle':\n    default:\n      return <p>Submit a pokemon</p>;\n  }\n}\n\nfunction App() {\n  const [pokemonName, setPokemonName] = React.useState('');\n\n  function handleSubmit(newPokemonName) {\n    setPokemonName(newPokemonName);\n  }\n\n  return (\n    <div className=\"pokemon-info-app\">\n      <PokemonForm pokemonName={pokemonName} onSubmit={handleSubmit} />\n      <hr />\n      <div className=\"pokemon-info\">\n        <ErrorBoundary\n          key={pokemonName}\n          FallbackComponent={() => (\n            <div>\n              <h1>Something went wrong.</h1>\n              <button onClick={() => setPokemonName(null)}>\n                Reset pokemon name\n              </button>\n            </div>\n          )}\n        >\n          <PokemonInfo pokemonName={pokemonName} />\n        </ErrorBoundary>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n")),Object(o.b)("h3",{id:"reset-the-errorboundary"},"Reset the ErrorBoundary"),Object(o.b)("p",null,"At the moment due to using the ",Object(o.b)("inlineCode",{parentName:"p"},"key")," in the ",Object(o.b)("inlineCode",{parentName:"p"},"ErrorBoundary"),", we are unmounting the error boundary which in turn unmounts the ",Object(o.b)("inlineCode",{parentName:"p"},"PokemonInfo"),"."),Object(o.b)("p",null,"We can fix this by using ",Object(o.b)("inlineCode",{parentName:"p"},"resetErrorBoundary")," from the ",Object(o.b)("inlineCode",{parentName:"p"},"react-error-boundary")," library."),Object(o.b)("pre",null,Object(o.b)("code",r({parentName:"pre"},{className:"language-js"}),"// useEffect: HTTP requests\n// http://localhost:3000/isolated/exercise/06.js\n\nimport * as React from 'react';\n// üê® you'll want the following additional things from '../pokemon':\n// fetchPokemon: the function we call to get the pokemon info\n// PokemonInfoFallback: the thing we show while we're loading the pokemon info\n// PokemonDataView: the stuff we use to display the pokemon info\nimport {\n  PokemonForm,\n  fetchPokemon,\n  PokemonInfoFallback,\n  PokemonDataView,\n} from '../pokemon';\nimport { ErrorBoundary } from 'react-error-boundary';\n\nfunction PokemonInfo({ pokemonName }) {\n  // üê® Have state for the pokemon (null)\n  const [state, setState] = React.useState({\n    status: pokemonName ? 'pending' : 'idle',\n    error: null,\n    pokemon: null,\n  });\n  // üê® use React.useEffect where the callback should be called whenever the\n  // pokemon name changes.\n  React.useEffect(() => {\n    if (!pokemonName) {\n      return;\n    }\n\n    setState({\n      pokemon: null,\n      error: null,\n      status: 'pending',\n    });\n\n    fetchPokemon(pokemonName)\n      .then(pokemonData => {\n        setState({\n          status: 'resolved',\n          pokemon: pokemonData,\n          error: null,\n        });\n      })\n      .catch(error => {\n        setState({\n          status: 'rejected',\n          pokemon: null,\n          error: error,\n        });\n      });\n  }, [pokemonName]);\n\n  switch (state.status) {\n    case 'resolved':\n      return <PokemonDataView pokemon={state.pokemon} />;\n    case 'rejected':\n      throw state.error;\n    case 'pending':\n      return <PokemonInfoFallback name={pokemonName} />;\n    case 'idle':\n    default:\n      return <p>Submit a pokemon</p>;\n  }\n}\n\nfunction ErrorFallback({ error, resetErrorBoundary }) {\n  return (\n    <div>\n      <h1>Something went wrong.</h1>\n      <p>{error.message}</p>\n      <button onClick={resetErrorBoundary}>Try again</button>\n    </div>\n  );\n}\n\nfunction App() {\n  const [pokemonName, setPokemonName] = React.useState('');\n\n  function handleSubmit(newPokemonName) {\n    setPokemonName(newPokemonName);\n  }\n\n  function handleReset() {\n    setPokemonName('');\n  }\n\n  return (\n    <div className=\"pokemon-info-app\">\n      <PokemonForm pokemonName={pokemonName} onSubmit={handleSubmit} />\n      <hr />\n      <div className=\"pokemon-info\">\n        <ErrorBoundary FallbackComponent={ErrorFallback} onReset={handleReset}>\n          <PokemonInfo pokemonName={pokemonName} />\n        </ErrorBoundary>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n")),Object(o.b)("h3",{id:"using-resetkeys-for-react-error-boundary"},"using resetKeys for React Error Boundary"),Object(o.b)("p",null,"We can use keys to help the issue where interacting with something outside of the ",Object(o.b)("inlineCode",{parentName:"p"},"resetErrorBoundary")," function will allow us to resolve our issue with the function:"),Object(o.b)("pre",null,Object(o.b)("code",r({parentName:"pre"},{className:"language-js"}),"// useEffect: HTTP requests\n// http://localhost:3000/isolated/exercise/06.js\n\nimport * as React from 'react';\n// üê® you'll want the following additional things from '../pokemon':\n// fetchPokemon: the function we call to get the pokemon info\n// PokemonInfoFallback: the thing we show while we're loading the pokemon info\n// PokemonDataView: the stuff we use to display the pokemon info\nimport {\n  PokemonForm,\n  fetchPokemon,\n  PokemonInfoFallback,\n  PokemonDataView,\n} from '../pokemon';\nimport { ErrorBoundary } from 'react-error-boundary';\n\nfunction PokemonInfo({ pokemonName }) {\n  // üê® Have state for the pokemon (null)\n  const [state, setState] = React.useState({\n    status: pokemonName ? 'pending' : 'idle',\n    error: null,\n    pokemon: null,\n  });\n  // üê® use React.useEffect where the callback should be called whenever the\n  // pokemon name changes.\n  React.useEffect(() => {\n    if (!pokemonName) {\n      return;\n    }\n\n    setState({\n      pokemon: null,\n      error: null,\n      status: 'pending',\n    });\n\n    fetchPokemon(pokemonName)\n      .then(pokemonData => {\n        setState({\n          status: 'resolved',\n          pokemon: pokemonData,\n          error: null,\n        });\n      })\n      .catch(error => {\n        setState({\n          status: 'rejected',\n          pokemon: null,\n          error: error,\n        });\n      });\n  }, [pokemonName]);\n\n  switch (state.status) {\n    case 'resolved':\n      return <PokemonDataView pokemon={state.pokemon} />;\n    case 'rejected':\n      throw state.error;\n    case 'pending':\n      return <PokemonInfoFallback name={pokemonName} />;\n    case 'idle':\n    default:\n      return <p>Submit a pokemon</p>;\n  }\n}\n\nfunction ErrorFallback({ error, resetErrorBoundary }) {\n  return (\n    <div>\n      <h1>Something went wrong.</h1>\n      <p>{error.message}</p>\n      <button onClick={resetErrorBoundary}>Try again</button>\n    </div>\n  );\n}\n\nfunction App() {\n  const [pokemonName, setPokemonName] = React.useState('');\n\n  function handleSubmit(newPokemonName) {\n    setPokemonName(newPokemonName);\n  }\n\n  function handleReset() {\n    setPokemonName('');\n  }\n\n  return (\n    <div className=\"pokemon-info-app\">\n      <PokemonForm pokemonName={pokemonName} onSubmit={handleSubmit} />\n      <hr />\n      <div className=\"pokemon-info\">\n        <ErrorBoundary\n          FallbackComponent={ErrorFallback}\n          onReset={handleReset}\n          resetKeys={[pokemonName]}\n        >\n          <PokemonInfo pokemonName={pokemonName} />\n        </ErrorBoundary>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n")))}i&&i===Object(i)&&Object.isExtensible(i)&&!i.hasOwnProperty("__filemeta")&&Object.defineProperty(i,"__filemeta",{configurable:!0,value:{name:"MDXContent",filename:"manual/Epic-React/React-Hooks.md"}}),i.isMDXComponent=!0},tcZH:function(e,n,t){e.exports=t.p+"static/hook-flow-15b4e92a6010531b4b06ae357d7b0a25.png"}}]);
//# sourceMappingURL=component---manual-epic-react-react-hooks-md-3f93957a4aa7f6568d6a.js.map