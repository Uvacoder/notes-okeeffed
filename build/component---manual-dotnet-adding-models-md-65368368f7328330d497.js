(window.webpackJsonp=window.webpackJsonp||[]).push([[189],{txKP:function(e,t,n){"use strict";n.r(t),n.d(t,"_frontmatter",(function(){return r})),n.d(t,"default",(function(){return b}));n("1c7q"),n("abGl"),n("gZHo"),n("Fdmb"),n("Ir+3"),n("2mQt"),n("mXGw");var a=n("/FXl"),o=n("TjRS");n("aD51");function i(){return(i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}var r={};void 0!==r&&r&&r===Object(r)&&Object.isExtensible(r)&&!r.hasOwnProperty("__filemeta")&&Object.defineProperty(r,"__filemeta",{configurable:!0,value:{name:"_frontmatter",filename:"manual/Dotnet/Adding-Models.md"}});var l={_frontmatter:r},c=o.a;function b(e){var t=e.components,n=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,["components"]);return Object(a.b)(c,i({},l,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h1",{id:"adding-models"},"Adding Models"),Object(a.b)("h2",{id:"resources"},"Resources"),Object(a.b)("ol",null,Object(a.b)("li",{parentName:"ol"},Object(a.b)("a",i({parentName:"li"},{href:"https://docs.microsoft.com/en-us/aspnet/core/tutorials/first-mvc-app/adding-model?view=aspnetcore-3.1&tabs=visual-studio"}),"Microsoft Docs: Add a model to an ASP.NET Core MVC app")),Object(a.b)("li",{parentName:"ol"},Object(a.b)("a",i({parentName:"li"},{href:"https://docs.microsoft.com/en-us/dotnet/api/system.componentmodel.dataannotations?view=netframework-4.8"}),"DataAnnotatons used in tutorial"))),Object(a.b)("h2",{id:"add-a-data-model-class"},"Add a data model class"),Object(a.b)("p",null,"Update the ",Object(a.b)("inlineCode",{parentName:"p"},"Models/Movie.cs")," file with the following code:"),Object(a.b)("pre",null,Object(a.b)("code",i({parentName:"pre"},{className:"language-csharp"}),"using System;\nusing System.ComponentModel.DataAnnotations;\n\nnamespace MvcMovie.Models\n{\n    public class Movie\n    {\n        public int Id { get; set; }\n        public string Title { get; set; }\n\n        [DataType(DataType.Date)]\n        public DateTime ReleaseDate { get; set; }\n        public string Genre { get; set; }\n        public decimal Price { get; set; }\n    }\n}\n")),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"The Movie class contains an ",Object(a.b)("inlineCode",{parentName:"li"},"Id")," field, which is required by the database for the primary key."),Object(a.b)("li",{parentName:"ul"},"The DataType attribute on ReleaseDate specifies the type of the data (Date). With this attribute:",Object(a.b)("ol",{parentName:"li"},Object(a.b)("li",{parentName:"ol"},"The user is not required to enter time information in the date field."),Object(a.b)("li",{parentName:"ol"},"Only the date is displayed, not time information.")))),Object(a.b)("p",null,"DataAnnotations are covered in a later tutorial."),Object(a.b)("h2",{id:"add-nuget-packages"},"Add NuGet Packages"),Object(a.b)("p",null,"Reference ",Object(a.b)("strong",{parentName:"p"},"Resource ","[1]")," in order to see installation examples for Visual Studio for Mac."),Object(a.b)("p",null,Object(a.b)("em",{parentName:"p"},"Note: I haven't confirmed, but you may be able to get away with installing through dotnet CLI. From what I see later in the tutorial, NuGet may be required.")),Object(a.b)("p",null,"Packages required in this tutorial:"),Object(a.b)("ol",null,Object(a.b)("li",{parentName:"ol"},"Microsoft.EntityFrameworkCore.SQLite"),Object(a.b)("li",{parentName:"ol"},"Microsoft.VisualStudio.Web.CodeGeneration.Design (likely not needed if installing by CLI)"),Object(a.b)("li",{parentName:"ol"},"Microsoft.EntityFrameworkCore.SqlServer"),Object(a.b)("li",{parentName:"ol"},"Microsoft.EntityFrameworkCore.Design")),Object(a.b)("h2",{id:"create-database-context-class"},"Create database context class"),Object(a.b)("p",null,"A database context class is needed to coordinate EF Core functionality (Create, Read, Update, Delete) for the Movie model. The database context is derived from ",Object(a.b)("inlineCode",{parentName:"p"},"Microsoft.EntityFrameworkCore.DbContext")," and specifies the entities to include in the data model."),Object(a.b)("p",null,"Create a Data folder."),Object(a.b)("p",null,"Add a Data/MvcMovieContext.cs file with the following code:"),Object(a.b)("pre",null,Object(a.b)("code",i({parentName:"pre"},{className:"language-cs"}),"using Microsoft.EntityFrameworkCore;\nusing MvcMovie.Models;\n\nnamespace MvcMovie.Data\n{\n    public class MvcMovieContext : DbContext\n    {\n        public MvcMovieContext (DbContextOptions<MvcMovieContext> options)\n            : base(options)\n        {\n        }\n\n        public DbSet<Movie> Movie { get; set; }\n    }\n}\n")),Object(a.b)("p",null,"The preceding code creates a ",Object(a.b)("inlineCode",{parentName:"p"},"DbSet<Movie>")," property for the entity set. In Entity Framework terminology, an entity set typically corresponds to a database table. An entity corresponds to a row in the table."),Object(a.b)("h2",{id:"register-the-database-context"},"Register the database context"),Object(a.b)("p",null,"ASP.NET Core is built with dependency injection (DI). Services (such as the EF Core DB context) must be registered with DI during application startup. Components that require these services (such as Razor Pages) are provided these services via constructor parameters. The constructor code that gets a DB context instance is shown later in the tutorial. In this section, you register the database context with the DI container."),Object(a.b)("p",null,"Add to the top of Startup.cs:"),Object(a.b)("pre",null,Object(a.b)("code",i({parentName:"pre"},{className:"language-cs"}),"using MvcMovie.Data;\nusing Microsoft.EntityFrameworkCore;\n")),Object(a.b)("p",null,"Add the following for ",Object(a.b)("inlineCode",{parentName:"p"},"Startup.ConfigureServices"),":"),Object(a.b)("pre",null,Object(a.b)("code",i({parentName:"pre"},{className:"language-cs"}),'public void ConfigureServices(IServiceCollection services)\n{\n    services.AddControllersWithViews();\n\n    services.AddDbContext<MvcMovieContext>(options =>\n            options.UseSqlite(Configuration.GetConnectionString("MvcMovieContext")));\n}\n')),Object(a.b)("h2",{id:"add-a-database-connection-string"},"Add a database connection string"),Object(a.b)("p",null,"Add ",Object(a.b)("inlineCode",{parentName:"p"},"ConnectionStrings")," config to ",Object(a.b)("inlineCode",{parentName:"p"},"appsettings.json"),":"),Object(a.b)("pre",null,Object(a.b)("code",i({parentName:"pre"},{className:"language-json"}),'{\n  "Logging": {\n    "LogLevel": {\n      "Default": "Information",\n      "Microsoft": "Warning",\n      "Microsoft.Hosting.Lifetime": "Information"\n    }\n  },\n  "AllowedHosts": "*",\n  "ConnectionStrings": {\n    "MvcMovieContext": "Data Source=MvcMovie.db"\n  }\n}\n')),Object(a.b)("h2",{id:"scaffold-movie-pages"},"Scaffold movie pages"),Object(a.b)("p",null,"Use the scaffolding tool to produce Create, Read, Update, and Delete (CRUD) pages for the movie model."),Object(a.b)("pre",null,Object(a.b)("code",i({parentName:"pre"},{className:"language-shell"}),"dotnet aspnet-codegenerator controller -name MoviesController -m Movie -dc MvcMovieContext --relativeFolderPath Controllers --useDefaultLayout --referenceScriptLibraries\n")),Object(a.b)("p",null,"The following table details the ASP.NET Core code generator parameters:"),Object(a.b)("table",null,Object(a.b)("thead",{parentName:"table"},Object(a.b)("tr",{parentName:"thead"},Object(a.b)("th",i({parentName:"tr"},{align:null}),"Parameter"),Object(a.b)("th",i({parentName:"tr"},{align:null}),"Description"))),Object(a.b)("tbody",{parentName:"table"},Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",i({parentName:"tr"},{align:null}),"-m"),Object(a.b)("td",i({parentName:"tr"},{align:null}),"The name of the model.")),Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",i({parentName:"tr"},{align:null}),"-dc"),Object(a.b)("td",i({parentName:"tr"},{align:null}),"The data context.")),Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",i({parentName:"tr"},{align:null}),"-udl"),Object(a.b)("td",i({parentName:"tr"},{align:null}),"Use the default layout.")),Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",i({parentName:"tr"},{align:null}),"--relativeFolderPath"),Object(a.b)("td",i({parentName:"tr"},{align:null}),"The relative output folder path to create the files.")),Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",i({parentName:"tr"},{align:null}),"--useDefaultLayout"),Object(a.b)("td",i({parentName:"tr"},{align:null}),"The default layout should be used for the views.")),Object(a.b)("tr",{parentName:"tbody"},Object(a.b)("td",i({parentName:"tr"},{align:null}),"--referenceScriptLibraries"),Object(a.b)("td",i({parentName:"tr"},{align:null}),"Adds ","_","ValidationScriptsPartial to Edit and Create pages")))),Object(a.b)("p",null,"Note: for more help run ",Object(a.b)("inlineCode",{parentName:"p"},"dotnet aspnet-codegenerator controller -h")),Object(a.b)("h2",{id:"initial-migration"},"Initial migration"),Object(a.b)("p",null,"Use the EF Core Migrations feature to create the database. Migrations is a set of tools that let you create and update a database to match your data model."),Object(a.b)("pre",null,Object(a.b)("code",i({parentName:"pre"},{className:"language-shell"}),"dotnet ef migrations add InitialCreate\ndotnet ef database update\n")),Object(a.b)("h2",{id:"the-initialcreate-class"},"The InitialCreate class"),Object(a.b)("p",null,"Examine the ",Object(a.b)("inlineCode",{parentName:"p"},"Migrations/{timestamp}_InitialCreate.cs")," migration file:"),Object(a.b)("pre",null,Object(a.b)("code",i({parentName:"pre"},{className:"language-cs"}),'public partial class Initial : Migration\n{\n    protected override void Up(MigrationBuilder migrationBuilder)\n    {\n        migrationBuilder.CreateTable(\n            name: "Movie",\n            columns: table => new\n            {\n                Id = table.Column<int>(nullable: false)\n                    .Annotation("SqlServer:ValueGenerationStrategy",\n                                 SqlServerValueGenerationStrategy.IdentityColumn),\n                Title = table.Column<string>(nullable: true),\n                ReleaseDate = table.Column<DateTime>(nullable: false),\n                Genre = table.Column<string>(nullable: true),\n                Price = table.Column<decimal>(nullable: false)\n            },\n            constraints: table =>\n            {\n                table.PrimaryKey("PK_Movie", x => x.Id);\n            });\n    }\n\n    protected override void Down(MigrationBuilder migrationBuilder)\n    {\n        migrationBuilder.DropTable(\n            name: "Movie");\n    }\n}\n')),Object(a.b)("p",null,"The ",Object(a.b)("inlineCode",{parentName:"p"},"Up")," method creates the ",Object(a.b)("inlineCode",{parentName:"p"},"Movie")," table and configures ",Object(a.b)("inlineCode",{parentName:"p"},"Id")," as the primary key. The ",Object(a.b)("inlineCode",{parentName:"p"},"Down")," method reverts the schema changes made by the ",Object(a.b)("inlineCode",{parentName:"p"},"Up")," migration."),Object(a.b)("h2",{id:"dependency-injection-in-the-controller"},"Dependency injection in the controller"),Object(a.b)("p",null,"Finish off the tutorial notes ",Object(a.b)("a",i({parentName:"p"},{href:"https://docs.microsoft.com/en-us/aspnet/core/tutorials/first-mvc-app/adding-model?view=aspnetcore-3.1&tabs=visual-studio-mac#dependency-injection-in-the-controller"}),"from here")),Object(a.b)("p",null,"Note: Stopping since the context is enough for other work to be completed."))}b&&b===Object(b)&&Object.isExtensible(b)&&!b.hasOwnProperty("__filemeta")&&Object.defineProperty(b,"__filemeta",{configurable:!0,value:{name:"MDXContent",filename:"manual/Dotnet/Adding-Models.md"}}),b.isMDXComponent=!0}}]);
//# sourceMappingURL=component---manual-dotnet-adding-models-md-65368368f7328330d497.js.map