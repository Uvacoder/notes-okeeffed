{"version":3,"sources":["webpack:///../manual/Kubernetes/EKS-In-Depth.md"],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","alt","src","isMDXComponent"],"mappings":"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","file":"component---manual-kubernetes-eks-in-depth-md-9b2db80d899d4662929b.js","sourcesContent":["import React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nimport DefaultLayout from \"/Users/dennis.okeeffe/Project-Imposter/developer-notes/node_modules/gatsby-theme-docz/src/base/Layout.js\";\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1 {...{\n      \"id\": \"eks-in-depth\"\n    }}>{`EKS in Depth`}</h1>\n    <p>{`This is more of a basic theory section to understand how EKS works.`}</p>\n    <h2 {...{\n      \"id\": \"pricing\"\n    }}>{`Pricing`}</h2>\n    <p>{`USD$0.20 per hours for each EKS cluster you make. That's ~USD$144/month.`}</p>\n    <p>{`You pay normally for all the other resources related to running your apps:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Worker nodes (EC2)`}</li>\n      <li parentName=\"ul\">{`EBS volumes`}</li>\n      <li parentName=\"ul\">{`Network traffic`}</li>\n      <li parentName=\"ul\">{`Load balancers`}</li>\n    </ul>\n    <p>{`Check online for if pricing ever changes.`}</p>\n    <h2 {...{\n      \"id\": \"eks-control-place\"\n    }}>{`EKS Control Place`}</h2>\n    <p>{`The control plane sets up the cluster to be highly available (in 3 availability zones).`}</p>\n    <p>{`Each AZ will have a master node and etcd that is AWS managed. The workers nodes are what we supply.`}</p>\n    <p>{`Our local `}<inlineCode parentName=\"p\">{`kubectl`}</inlineCode>{` will talk directly to EKS.`}</p>\n    <h3 {...{\n      \"id\": \"under-the-hood\"\n    }}>{`Under the hood`}</h3>\n    <p><img alt=\"Under the hood\" src=\"https://res.cloudinary.com/gitgoodclub/image/upload/v1548213794/eks-course/Screen_Shot_2019-01-23_at_2.22.40_pm.png\" /></p>\n    <ul>\n      <li parentName=\"ul\">{`Single tenant (you do not share it with other customers)`}</li>\n      <li parentName=\"ul\">{`Made of native AWS component (EC2, ELB, ASG, NLB, VPC)`}</li>\n    </ul>\n    <h2 {...{\n      \"id\": \"eks-networking\"\n    }}>{`EKS Networking`}</h2>\n    <p><img alt=\"Network\" src=\"https://res.cloudinary.com/gitgoodclub/image/upload/v1548213958/eks-course/Screen_Shot_2019-01-23_at_2.25.49_pm.png\" /></p>\n    <p>{`Recommended to have:`}</p>\n    <ol>\n      <li parentName=\"ol\">{`Private subnets: containers all the worker nodes to have application deployed. Must be large CIDR.`}</li>\n      <li parentName=\"ol\">{`Public subnets: Will contain any internet-facing load balancer to expose the applications.`}</li>\n      <li parentName=\"ol\">{`The VPC must have DNS hostname and DNS resolution support, otherwise nodes can't register.`}</li>\n    </ol>\n    <h3 {...{\n      \"id\": \"security-groups\"\n    }}>{`Security groups`}</h3>\n    <p><img alt=\"Security groups explored\" src=\"https://res.cloudinary.com/gitgoodclub/image/upload/v1548214249/eks-course/Screen_Shot_2019-01-23_at_2.30.35_pm.png\" /></p>\n    <p>{`You have 2 security groups: `}<inlineCode parentName=\"p\">{`Control Plane`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`Worker Nodes`}</inlineCode>{`.`}</p>\n    <p>{`Read up on `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/freach/kubernetes-security-best-practice\"\n      }}>{`https://github.com/freach/kubernetes-security-best-practice`}</a>{`.`}</p>\n    <h3 {...{\n      \"id\": \"eks-pod-networking\"\n    }}>{`EKS Pod Networking`}</h3>\n    <ul>\n      <li parentName=\"ul\">{`Amazon VPC CNI plugin: each pod receivers 1 IP address (=ENI => Elastic Network Interface) in VPC.`}</li>\n      <li parentName=\"ul\">{`Pods have the same IP address inside the EKS cluster and outside of it.`}</li>\n      <li parentName=\"ul\">{`Subnet limitations: CIRD /24 is 254 IP, not enough to run a lot of pods. You'll need a way bigger CIDR. Recommended is a CIDR /18.`}</li>\n      <li parentName=\"ul\">{`EC2 limitations: limited to amount of ENI/IP addresses it can have. Based on the network types, AWS has documentation on EC2 limits for ENIs, IPv4s and IPv6s.`}</li>\n    </ul>\n    <p>{`See `}<a parentName=\"p\" {...{\n        \"href\": \"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html\"\n      }}>{`https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-eni.html`}</a>{` for more information on ENI limits.`}</p>\n    <h3 {...{\n      \"id\": \"network-security-with-calico\"\n    }}>{`Network security with Calico`}</h3>\n    <ul>\n      <li parentName=\"ul\">{`Security groups allow all worker nodes to communicate to each other on any ports.`}</li>\n      <li parentName=\"ul\">{`This may be a problem if you want to segement applications, tenants or environments.`}</li>\n      <li parentName=\"ul\">{`You can use the Calico project instead of AWS Security Groups in this case.`}</li>\n      <li parentName=\"ul\">{`Network policies are directly assigned to pods (instead of worker nodes).`}</li>\n      <li parentName=\"ul\">{`More granular.`}</li>\n    </ul>\n    <h3 {...{\n      \"id\": \"iam-and-rbac-integration\"\n    }}>{`IAM and RBAC Integration`}</h3>\n    <p><img alt=\"IAM and RBAC in action\" src=\"https://res.cloudinary.com/gitgoodclub/image/upload/v1548215421/eks-course/Screen_Shot_2019-01-23_at_2.50.02_pm.png\" /></p>\n    <p>{`Note: RBAC means \"Role-Based-Access-Control\".`}</p>\n    <ul>\n      <li parentName=\"ul\">{`When you talk to Kubernetes, authentication is held by IAM.`}</li>\n      <li parentName=\"ul\">{`Authorization is done by Kubernetes RBAC (native auth for K8s).`}</li>\n      <li parentName=\"ul\">{`Done through collaboration between AWS and Heptio.`}</li>\n      <li parentName=\"ul\">{`You can assign RBAC directly through IAM entities.`}</li>\n      <li parentName=\"ul\">{`By default, the role you assign to your K8s cluster has system:master permissions.`}</li>\n    </ul>\n    <h3 {...{\n      \"id\": \"k8s-worker-nodes\"\n    }}>{`K8s Worker Nodes`}</h3>\n    <p><img alt=\"K8s Worker Nodes\" src=\"https://res.cloudinary.com/gitgoodclub/image/upload/v1548216415/eks-course/Screen_Shot_2019-01-23_at_3.06.44_pm.png\" /></p>\n    <ul>\n      <li parentName=\"ul\">{`When the join the cluster, they are assigned an IAM role and authorized in RBAC to join `}<inlineCode parentName=\"li\">{`system:bootstrappers`}</inlineCode>{` and `}<inlineCode parentName=\"li\">{`system: nodes`}</inlineCode>{` in your ConfigMap.`}</li>\n    </ul>\n    <p>{`You can write your own rules in the ConfigMap.`}</p>\n    <h3 {...{\n      \"id\": \"eks-load-balancers\"\n    }}>{`EKS Load Balancers`}</h3>\n    <ul>\n      <li parentName=\"ul\">{`EKS support `}<inlineCode parentName=\"li\">{`Classic Load Balancer`}</inlineCode>{`, `}<inlineCode parentName=\"li\">{`Application Load Balancer`}</inlineCode>{` and `}<inlineCode parentName=\"li\">{`Network Load Balancer`}</inlineCode>{`.`}</li>\n      <li parentName=\"ul\">{`Classic and Network Load Balancer is for Service of type `}<inlineCode parentName=\"li\">{`LoadBalancer`}</inlineCode>{`.`}</li>\n      <li parentName=\"ul\">{`Application Load Balancer is for Ingress Controller.`}</li>\n    </ul>\n    <h3 {...{\n      \"id\": \"loadbalancer\"\n    }}>{`LoadBalancer`}</h3>\n    <p>{`Through the service of type `}<inlineCode parentName=\"p\">{`LoadBalancer`}</inlineCode>{`, EKS will create a:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Classic Load Balancer by default.`}</li>\n      <li parentName=\"ul\">{`Netword Load Balancer if this is specified: `}<inlineCode parentName=\"li\">{`service.beta.kubernetes.io/aws-load-balancer-type:nlb`}</inlineCode>{`.`}</li>\n      <li parentName=\"ul\">{`There is also support for internal load balancers: `}<inlineCode parentName=\"li\">{`service.beta.kubernetes.io//aws-load-balancer-internal:0.0.0.0/0`}</inlineCode>{`.`}</li>\n      <li parentName=\"ul\">{`You can control the configuration of LBs using annotations in your manifest.`}</li>\n      <li parentName=\"ul\">{`All documentation for `}<inlineCode parentName=\"li\">{`LoadBalancer`}</inlineCode>{` on AWS is diretly on the Kubernetes project.`}</li>\n      <li parentName=\"ul\">{`ALB Ingress is open source and found on GitHub.`}</li>\n      <li parentName=\"ul\">{`Supports target group of instance mode (hooked into NodePort).`}</li>\n      <li parentName=\"ul\">{`Supports target group of IP mode (directly communicating with the pod).`}</li>\n      <li parentName=\"ul\">{`Supports Application Load Balancer listener rules.`}</li>\n    </ul>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}