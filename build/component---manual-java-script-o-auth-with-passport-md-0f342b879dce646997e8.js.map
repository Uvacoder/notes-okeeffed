{"version":3,"sources":["webpack:///../manual/JavaScript/O-Auth-With-Passport.md"],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"mappings":"sfAMO,IAAMA,EAAe,Q,2NAE5B,IAKMC,EAAc,CAClBD,gBAEIE,EAAYC,IACH,SAASC,EAAT,GAGZ,IAFDC,EAEC,EAFDA,WACGC,E,oIACF,mBACD,OAAO,YAACJ,EAAD,KAAeD,EAAiBK,EAAhC,CAAuCD,WAAYA,EAAYE,QAAQ,cAG5E,uDACA,kFACA,yBAAQ,sBAAQC,WAAW,KAAI,sBAAQA,WAAW,UAAS,sBAAQA,WAAW,UAAS,sBAAQA,WAAW,UAAS,sBAAQA,WAAW,UAAS,sBAAQA,WAAW,UAAnB,cAC/I,sBACE,kBAAIA,WAAW,MAAK,mBAAKA,WAAW,MAAK,sBAAMA,WAAW,OAAU,IAA3B,4BAChC,kBAAIA,WAAW,MACpB,kBAAIA,WAAW,MAAf,oBAEJ,kBAAIA,WAAW,MAAK,mBAAKA,WAAW,MAAK,sBAAMA,WAAW,OAAU,IAA3B,4BAChC,sBAAQA,WAAW,MAAK,sBAAQA,WAAW,UAAS,sBAAQA,WAAW,UAAS,sBAAQA,WAAW,UAAS,sBAAQA,WAAW,UAAS,sBAAQA,WAAW,UAAnB,aADjJ,MAGF,iEACA,mEACA,kDACA,sBACE,kBAAIA,WAAW,MAAf,gBACA,kBAAIA,WAAW,MAAf,kBAEF,yBAAQ,sBAAQA,WAAW,KAAI,sBAAQA,WAAW,UAAS,sBAAQA,WAAW,UAAS,sBAAQA,WAAW,UAAS,sBAAQA,WAAW,UAAS,sBAAQA,WAAW,UAAnB,cAC/I,sBACE,kBAAIA,WAAW,MAAK,mBAAKA,WAAW,MAAK,sBAAMA,WAAW,OAAU,IAA3B,4BAChC,oBAAIA,WAAW,MAAS,CAC7B,MAAS,IAET,kBAAIA,WAAW,MAAf,yBAEJ,kBAAIA,WAAW,MAAK,mBAAKA,WAAW,MAAK,sBAAMA,WAAW,OAAU,IAA3B,4BAChC,sBAAQA,WAAW,MAAK,sBAAQA,WAAW,UAAS,sBAAQA,WAAW,UAAS,sBAAQA,WAAW,UAAS,sBAAQA,WAAW,UAAS,sBAAQA,WAAW,UAAnB,aADjJ,MAGF,+CACA,sBACE,kBAAIA,WAAW,MAAf,oBACA,kBAAIA,WAAW,MAAf,0CACA,kBAAIA,WAAW,MAAf,sBACA,kBAAIA,WAAW,MAAf,mCAEF,kDACA,2DACA,sBACE,kBAAIA,WAAW,MAAf,oEACA,kBAAIA,WAAW,MAAf,gBAEF,sEACA,wFAEA,qGACA,qCACA,sRAKA,odAgBA,yOAKY,mBAAGA,WAAW,KAAQ,CAC9B,KAAQ,6CADA,4CALZ,+BASA,iNAIY,mBAAGA,WAAW,KAAQ,CAC9B,KAAQ,kDADA,+CAJZ,8FASA,mGAGA,4IAGA,4BACA,6DACA,4BACA,2FAEA,0LAQA,0DACA,0EAEA,yEAEA,gDACA,+CACA,+HAGA,kDACA,uFAEA,mDACA,6MAMA,oDACA,sHAEA,qDACA,iNAMA,4CACA,0GAIA,iDACA,0DACA,8BACE,iBAAGA,WAAW,cAAd,sE,kNAMNJ,EAAWK,gBAAiB","file":"component---manual-java-script-o-auth-with-passport-md-0f342b879dce646997e8.js","sourcesContent":["import React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nimport DefaultLayout from \"/Users/dennis.okeeffe/Project-Imposter/developer-notes/node_modules/gatsby-theme-docz/src/base/Layout.js\";\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <p>{`OAUTH AND PASSPORT FOR EXPRESS`}</p>\n    <p>{`/////////////////////////////////////////////////////////`}</p>\n    <p>{`/`}<strong parentName=\"p\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\">{`****`}</strong></strong></strong></strong></strong></strong></p>\n    <ul>\n      <li parentName=\"ul\"><pre parentName=\"li\"><code parentName=\"pre\" {...{}}>{`                    *\n`}</code></pre><ol parentName=\"li\">\n          <li parentName=\"ol\">{`What is OAuth?`}</li>\n        </ol></li>\n      <li parentName=\"ul\"><pre parentName=\"li\"><code parentName=\"pre\" {...{}}>{`                    *\n`}</code></pre><strong parentName=\"li\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\">{`****`}</strong></strong></strong></strong></strong></strong>{`/`}</li>\n    </ul>\n    <p>{`It is authorization, not authentication.`}</p>\n    <p>{`Authorization is used for what you can do.`}</p>\n    <p>{`You usually get tokens...`}</p>\n    <ul>\n      <li parentName=\"ul\">{`Access Token`}</li>\n      <li parentName=\"ul\">{`Refresh Token`}</li>\n    </ul>\n    <p>{`/`}<strong parentName=\"p\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\">{`****`}</strong></strong></strong></strong></strong></strong></p>\n    <ul>\n      <li parentName=\"ul\"><pre parentName=\"li\"><code parentName=\"pre\" {...{}}>{`                    *\n`}</code></pre><ol parentName=\"li\" {...{\n          \"start\": 2\n        }}>\n          <li parentName=\"ol\">{`Setting up Passport`}</li>\n        </ol></li>\n      <li parentName=\"ul\"><pre parentName=\"li\"><code parentName=\"pre\" {...{}}>{`                    *\n`}</code></pre><strong parentName=\"li\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\"><strong parentName=\"strong\">{`****`}</strong></strong></strong></strong></strong></strong>{`/`}</li>\n    </ul>\n    <p>{`// THE SETUP STRATERGY`}</p>\n    <ol>\n      <li parentName=\"ol\">{`Install Strategy`}</li>\n      <li parentName=\"ol\">{`Create 'Application' on OAuth Provider`}</li>\n      <li parentName=\"ol\">{`Configure Strategy`}</li>\n      <li parentName=\"ol\">{`Create routes for the provider`}</li>\n    </ol>\n    <p>{`// installing Github auth`}</p>\n    <p>{`npm install passport-github --save`}</p>\n    <ul>\n      <li parentName=\"ul\">{`from here you can register the application on Github in settings`}</li>\n      <li parentName=\"ul\">{`grab tokens`}</li>\n    </ul>\n    <p>{`|||||||||||||||||||||||||||||||||||||||||||||`}</p>\n    <p>{`npm install passport --save\nnpm install express-session --save`}</p>\n    <p>{`We'll use persistent session store with mongoDB to keep the login persistent`}</p>\n    <p>{`// in app.js`}</p>\n    <p>{`var passport = require('passport');\nvar GitHubStrategy = require('passport-github').Strategy;\nvar FacebookStrategy = require('passport-facebook').Strategy;\nvar session = require('express-session');\nvar MongoStore = require('connect-mongo')(session);`}</p>\n    <p>{`function generateOrFindUser (accessToken, refreshToken, profile, done) {\nUser.findOneAndUpdate({\nemail: profile.emails`}{`[0]`}{`.value\n}, {\nname: profile.displayName || profile.username,\nemail: profile.emails`}{`[0]`}{`.value,\nphoto: profile.photos`}{`[0]`}{`.value\n}, {\nupsert: true\n},\ndone);\n} else {\nvar noEmailError = new Error(\"Your email privacy settings prevent you from signing into bookworm!\");\ndone(noEmailError, null);\n}\n}`}</p>\n    <p>{`// config the strategy\npassport.use(new GitHubStrategy({\n// do not enter your actual ID and Key here!\nclientID: process.env.GITHUB_CLIENT_ID,\nclientSecret: process.env.GITHUB_CLIENT_SECRET,\ncallbackURL: \"`}<a parentName=\"p\" {...{\n        \"href\": \"http://localhost:3000/auth/github/return\"\n      }}>{`http://localhost:3000/auth/github/return`}</a>{`\"\n}, generateOrFindUser));`}</p>\n    <p>{`passport.use(new FacebookStrategy({\n// do not enter your actual ID and Key here!\nclientID: process.env.FACEBOOK_APP_ID,\nclientSecret: process.env.FACEBOOK_APP_SECRET,\ncallbackURL: \"`}<a parentName=\"p\" {...{\n        \"href\": \"http://localhost:3000/auth/facebook/return%22\"\n      }}>{`http://localhost:3000/auth/facebook/return\"`}</a>{`,\nprofileFields: `}{`['id', 'displayName', 'photos', 'email']`}{`\n}), generateOrFindUser);`}</p>\n    <p>{`passport.serializeUser(function (user, done) {\ndone(null, user._id);\n});`}</p>\n    <p>{`passport.deserializeUser(function(userId, done) {\nUser.findById(userId, done); // done is a callback function\n});`}</p>\n    <p>{`...`}</p>\n    <p>{`var auth = require('./routes/auth');`}</p>\n    <p>{`...`}</p>\n    <p>{`// after db connection\n// Session config for Passport and MongoDB`}</p>\n    <p>{`var sessionOptions = {\nsecret: \"this is a super secret dadada\",\nresave: true,\nsaveUninitialized: true,\nstore: new MongoStore({\nmongooseConnection: db\n})\n}`}</p>\n    <p>{`app.use(session(sessionOptions));`}</p>\n    <p>{`// Init Passport\napp.use(passport.initialize());`}</p>\n    <p>{`// Restore Session\napp.use(passport.session());`}</p>\n    <p>{`app.use('/auth', auth);`}</p>\n    <p>{`// in routes > auth.js`}</p>\n    <p>{`var express = require('express');\nvar router = express.Router();\nvar passport = require('passport');`}</p>\n    <p>{`// Get /auth/login/github`}</p>\n    <p>{`router.get('/login/github',\npassport.authenticate('github'));`}</p>\n    <p>{`// Get /auth/github/return`}</p>\n    <p>{`router.get('/github/return',\npassport.authenticate('github', {failedRedirect: '/'}),\nfunction(req, res) {\n//Succes Auth, redirect to page for now\nres.redirect('/profile');\n});`}</p>\n    <p>{`// Get /auth/login/facebook`}</p>\n    <p>{`router.get('/login/facebook',\npassport.authenticate('facebook', { scope: `}{`[\"email\"]`}{`}));`}</p>\n    <p>{`// Get /auth/facebook/return`}</p>\n    <p>{`router.get('/facebook/return',\npassport.authenticate('facebook', {failedRedirect: '/'}),\nfunction(req, res) {\n//Succes Auth, redirect to page for now\nres.redirect('/profile');\n});`}</p>\n    <p>{`// GET /auth/logout`}</p>\n    <p>{`router.get('/logout', function(req, res) {\nreq.logout();\nres.redirect('/');\n})`}</p>\n    <p>{`module.exports = router;`}</p>\n    <p>{`// to use vars in command line...`}</p>\n    <blockquote>\n      <p parentName=\"blockquote\">{`GITHUB_CLIENT_ID=123432 GITHUB_CLIENT_SECRET=892u3rw9u ./bin/www`}</p>\n    </blockquote>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}