(window.webpackJsonp=window.webpackJsonp||[]).push([[91],{RwJu:function(e,n,t){"use strict";t.r(n),t.d(n,"_frontmatter",(function(){return s})),t.d(n,"default",(function(){return l}));t("1c7q"),t("abGl"),t("gZHo"),t("Fdmb"),t("Ir+3"),t("2mQt"),t("mXGw");var r=t("/FXl"),o=t("TjRS");t("aD51");function a(){return(a=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)}var s={};void 0!==s&&s&&s===Object(s)&&Object.isExtensible(s)&&!s.hasOwnProperty("__filemeta")&&Object.defineProperty(s,"__filemeta",{configurable:!0,value:{name:"_frontmatter",filename:"manual/Braintree/Sandbox.md"}});var i={_frontmatter:s},c=o.a;function l(e){var n=e.components,t=function(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,["components"]);return Object(r.b)(c,a({},i,t,{components:n,mdxType:"MDXLayout"}),Object(r.b)("h1",{id:"getting-started-with-the-braintree-sandbox"},"Getting started with the Braintree Sandbox"),Object(r.b)("p",null,"Published: October 5th 2018"),Object(r.b)("p",null,"Braintree is one of those methods to get started with payments."),Object(r.b)("p",null,"I've been looking for alternatives to Stripe more for comparisons sake to see what would be easiest to implement and more relevant to what I am trying to achieve en masse down the road."),Object(r.b)("p",null,"This is a small hello world into getting up and running with Braintree using Express on the serverside and React on the frontend."),Object(r.b)("h2",{id:"prerequisites"},"Prerequisites"),Object(r.b)("p",null,"If you are following along, you should sign up for a Sandbox account."),Object(r.b)("p",null,"This tutorial will use create-react-app and a user contributed npm module to abstract some of the time required for setup."),Object(r.b)("p",null,"Another useful link comes from ",Object(r.b)("a",a({parentName:"p"},{href:"https://developers.braintreepayments.com/start/tutorial"}),"their website for Node.js and JS"),". Although I will be deterring away from it, it is still a useful reference."),Object(r.b)("p",null,"We are going to treat this project as a monorepo for now, so in the root directory we need to create a subdirectory for the frontend and a directory for the server."),Object(r.b)("h2",{id:"building-the-express-server"},"Building the Express server"),Object(r.b)("h3",{id:"installation"},"Installation"),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-bash"}),"mkdir server\ncd server\nyarn init -y\nyarn add express body-parser morgan cors dotenv braintree\nmkdir routes\ntouch server.js .env .gitignore routes/index.js\n")),Object(r.b)("h3",{id:"gitignore"},".gitignore"),Object(r.b)("p",null,"For the sake of doing things right, let's just quickly update our file to ignore ",Object(r.b)("inlineCode",{parentName:"p"},"node_modules")," and the ",Object(r.b)("inlineCode",{parentName:"p"},".env")," file."),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-bash"}),".env\nnode_modules/\n")),Object(r.b)("h3",{id:"env"},".env"),Object(r.b)("p",null,"Here we need to update our file with the sandbox tokens given to us from the Braintree sandbox environment. The keys and configuration can be found on your Braintree dashboard:"),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-bash"}),"BRAINTREE_MERCHANT_ID=<use_your_merchant_id>\nBRAINTREE_PUBLIC_KEY=<use_your_public_key>\nBRAINTREE_PRIVATE_KEY=<use_your_private_key>\n")),Object(r.b)("p",null,"Now we can use ",Object(r.b)("inlineCode",{parentName:"p"},"dotenv")," in our app to access the variables and keep them out of our git history."),Object(r.b)("h3",{id:"serverjs"},"server.js"),Object(r.b)("p",null,"To set up the main server, update the server.js file to look like so:"),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-javascript"}),"// Add variables from dotenv into process.env vars\nrequire('dotenv').config();\n\n// Main starting point of the application\nconst express = require('express');\nconst http = require('http');\nconst bodyParser = require('body-parser');\nconst morgan = require('morgan');\nconst app = express();\nconst cors = require('cors');\n\n// Routes Setup\nconst routes = require('./routes');\n\n// App Setup\nconst morganFormat = process.env.NODE_ENV === 'production' ? 'combined' : 'dev';\napp.use(morgan(morganFormat));\napp.use(cors());\napp.use(bodyParser.json());\napp.use(bodyParser.urlencoded({ extended: true }));\n\n// Add routes after setting up middleware\nroutes(app);\n\n// Server Setup\nconst port = process.env.NODE_ENV == 'production' ? 80 : 5000;\nconst server = http.createServer(app);\nserver.listen(port);\nconsole.log('Server listening on:', port);\n")),Object(r.b)("p",null,"This ",Object(r.b)("inlineCode",{parentName:"p"},"server.js")," file will load the ",Object(r.b)("inlineCode",{parentName:"p"},"routes/index.js")," file, which we will now update."),Object(r.b)("h3",{id:"routesindexjs"},"routes/index.js"),Object(r.b)("p",null,"Let's now update our ",Object(r.b)("inlineCode",{parentName:"p"},"routes/index.js")," to take setup the gateway and setup three routes - one for a simple ping test, another for fetching a client token and a third for making a payment:"),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-javascript"}),"const braintree = require('braintree');\n\nvar gateway = braintree.connect({\n  environment: braintree.Environment.Sandbox,\n  // Use your own credentials from the sandbox Control Panel here\n  merchantId: process.env.BRAINTREE_MERCHANT_ID,\n  publicKey: process.env.BRAINTREE_PUBLIC_KEY,\n  privateKey: process.env.BRAINTREE_PRIVATE_KEY\n});\n\nmodule.exports = function(app) {\n  app.get('/braintree', function(req, res) {\n    res.send('Braintree route is healthy');\n  });\n\n  app.get('/api/braintree/v1/getToken', async function(req, res) {\n    try {\n      gateway.clientToken.generate({}, function(err, response) {\n        if (err) {\n          res.status(500).send(err);\n        } else {\n          res.send(response);\n        }\n      });\n    } catch (err) {\n      res.status(500).send(err);\n    }\n  });\n\n  app.post('/api/braintree/v1/sandbox', async function(req, res) {\n    try {\n      // Use the payment method nonce here\n      var nonceFromTheClient = req.body.paymentMethodNonce;\n      // Create a new transaction for $10\n      var newTransaction = gateway.transaction.sale(\n        {\n          amount: '10.00',\n          paymentMethodNonce: nonceFromTheClient,\n          options: {\n            // This option requests the funds from the transaction once it has been\n            // authorized successfully\n            submitForSettlement: true\n          }\n        },\n        function(error, result) {\n          if (result) {\n            res.send(result);\n          } else {\n            res.status(500).send(error);\n          }\n        }\n      );\n    } catch (err) {\n      // Deal with an error\n      console.log(err);\n      res.send(err);\n    }\n  });\n};\n")),Object(r.b)("p",null,"Now if we run ",Object(r.b)("inlineCode",{parentName:"p"},"node server.js"),", we should have our app up and running on port 5000!"),Object(r.b)("p",null,"We can run ",Object(r.b)("inlineCode",{parentName:"p"},"curl http://localhost:5000/braintree")," from another terminal to see our ",Object(r.b)("inlineCode",{parentName:"p"},"Braintree route is healthy")," response."),Object(r.b)("p",null,"Now we need to set up the clientside."),Object(r.b)("h2",{id:"building-the-react-frontend"},"Building the React frontend"),Object(r.b)("h3",{id:"react-installation"},"React Installation"),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-bash"}),"create-react-app clientside\ncd clientside\nyarn add braintree-web braintree-web-drop-in-react axios\n")),Object(r.b)("h3",{id:"updating-the-app"},"Updating the app"),Object(r.b)("p",null,"Go to our App.js file and clean it out. Replace the file with the following:"),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-javascript"}),"import React, { Component } from 'react';\nimport './App.css';\nimport 'braintree-web';\nimport axios from 'axios';\nimport DropIn from 'braintree-web-drop-in-react';\n\nclass App extends Component {\n  instance;\n\n  state = {\n    clientToken: null\n  };\n\n  async componentDidMount() {\n    try {\n      // Get a client token for authorization from your server\n      const response = await axios.get(\n        'http://localhost:5000/api/braintree/v1/getToken'\n      );\n      const clientToken = response.data.clientToken;\n\n      this.setState({ clientToken });\n    } catch (err) {\n      console.error(err);\n    }\n  }\n\n  async buy() {\n    try {\n      // Send the nonce to your server\n      const { nonce } = await this.instance.requestPaymentMethod();\n      const response = await axios.post(\n        'http://localhost:5000/api/braintree/v1/sandbox',\n        nonce\n      );\n      console.log(response);\n    } catch (err) {\n      console.error(err);\n    }\n  }\n\n  render() {\n    if (!this.state.clientToken) {\n      return (\n        <div>\n          <h1>Loading...</h1>\n        </div>\n      );\n    } else {\n      return (\n        <div>\n          <DropIn\n            options={{\n              authorization: this.state.clientToken\n            }}\n            onInstance={(instance) => (this.instance = instance)}\n          />\n          <button onClick={this.buy.bind(this)}>Buy</button>\n        </div>\n      );\n    }\n  }\n}\n\nexport default App;\n")),Object(r.b)("p",null,"This code is a variation of the intro code found on the ",Object(r.b)("a",a({parentName:"p"},{href:"https://github.com/cretezy/braintree-web-drop-in-react"}),"Braintree Web Drop-in React Github intro"),"."),Object(r.b)("p",null,"If we run ",Object(r.b)("inlineCode",{parentName:"p"},"yarn start")," we should load up the React app on locahost and you should be able to see the following:"),Object(r.b)("p",null,Object(r.b)("img",{alt:"React Frontend",src:"https://res.cloudinary.com/gitgoodclub/image/upload/v1538698065/samples/braintree-one.png"})),Object(r.b)("p",null,"If that is the case, perfect! We are ready to roll."),Object(r.b)("h3",{id:"making-the-payment"},"Making the payment"),Object(r.b)("p",null,"The following comes directly from the ",Object(r.b)("a",a({parentName:"p"},{href:"https://developers.braintreepayments.com/start/tutorial"}),"Node.js quickstart for Braintree"),"."),Object(r.b)("pre",null,Object(r.b)("code",a({parentName:"pre"},{className:"language-bash"}),"Card number: 4111 1111 1111 1111\nExpiry: 09/20\nCVV: 400\nPostal Code: 40000\n")),Object(r.b)("p",null,"If we insert both the card number and expiry, that should be enough for us to get to the end of the road! After inserting and making the payment, our front end should look like the following:"),Object(r.b)("p",null,Object(r.b)("img",{alt:"Payment made",src:"https://res.cloudinary.com/gitgoodclub/image/upload/v1538698064/samples/braintree-two.png"})),Object(r.b)("p",null,"Opening up ",Object(r.b)("inlineCode",{parentName:"p"},"devtools"),", we can even inspect the response object we are logging to see our great success!"),Object(r.b)("p",null,Object(r.b)("img",{alt:"Devtools",src:"https://res.cloudinary.com/gitgoodclub/image/upload/v1538698065/samples/braintree-three.png"})),Object(r.b)("p",null,"Bingo!"),Object(r.b)("h3",{id:"the-server-terminal"},"The server terminal"),Object(r.b)("p",null,"If we checkout the server terminal, we should be able to see how events went down thanks to Morgan doing our logging:"),Object(r.b)("p",null,Object(r.b)("img",{alt:"Express App",src:"https://res.cloudinary.com/gitgoodclub/image/upload/v1538698063/samples/braintree-four.png"})),Object(r.b)("p",null,"The image above can help us fully understand the process. When our frontend app loads, we make a ",Object(r.b)("inlineCode",{parentName:"p"},"GET")," request to fetch the token from ",Object(r.b)("inlineCode",{parentName:"p"},"/api/braintree/v1/getToken"),". This token is required for when that final payment request was made. The ",Object(r.b)("inlineCode",{parentName:"p"},"OPTIONS")," 204 request we see there secondly is a CORS preflight request made to ensure we are allowed to make the call and finally and ",Object(r.b)("inlineCode",{parentName:"p"},"POST")," 200 to ",Object(r.b)("inlineCode",{parentName:"p"},"/api/braintree/v1/sandbox")," is our success response after making the payment."),Object(r.b)("h2",{id:"confirmation"},"Confirmation"),Object(r.b)("p",null,"If we now go back to our Sandbox dashboard, we can now see the successful transaction has been recorded!"),Object(r.b)("p",null,Object(r.b)("img",{alt:"Success",src:"https://res.cloudinary.com/gitgoodclub/image/upload/v1538698732/braintreedashboard.png"})),Object(r.b)("p",null,"Very cool. We just went from 0 to payment in a short amount of time."),Object(r.b)("h2",{id:"next-steps"},"Next steps"),Object(r.b)("p",null,"What's next? Something I like about Braintree is UI extensibility. Although we used a frontend package on this occassion, try building out your own UI for taking payments!"),Object(r.b)("p",null,"Whether or not you are a fan of Braintree or Stripe really is up to you and your business needs at the end of the day. It is worth looking up both the pros and cons of the developer docs and the rates to decide what is best for your specific usecase (or any other payment platform for that case)."),Object(r.b)("p",null,"Original post: ",Object(r.b)("a",a({parentName:"p"},{href:"https://www.dennisokeeffe.com/blog/braintree-node-react"}),"https://www.dennisokeeffe.com/blog/braintree-node-react")),Object(r.b)("p",null,"Git repo: ",Object(r.b)("a",a({parentName:"p"},{href:"https://github.com/okeeffed/hello-braintree"}),"https://github.com/okeeffed/hello-braintree")),Object(r.b)("p",null,Object(r.b)("em",{parentName:"p"},Object(r.b)("strong",{parentName:"em"},"Depth"),' is a series that goes into more detail for projects than it\'s friendly counterpart series "Hello".')))}l&&l===Object(l)&&Object.isExtensible(l)&&!l.hasOwnProperty("__filemeta")&&Object.defineProperty(l,"__filemeta",{configurable:!0,value:{name:"MDXContent",filename:"manual/Braintree/Sandbox.md"}}),l.isMDXComponent=!0}}]);
//# sourceMappingURL=component---manual-braintree-sandbox-md-012a663951315668ffc1.js.map