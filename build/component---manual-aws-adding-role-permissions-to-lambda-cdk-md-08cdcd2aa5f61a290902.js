(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{"kG/x":function(e,n,t){"use strict";t.r(n),t.d(n,"_frontmatter",(function(){return o})),t.d(n,"default",(function(){return d}));t("1c7q"),t("abGl"),t("gZHo"),t("Fdmb"),t("Ir+3"),t("2mQt"),t("mXGw");var a=t("/FXl"),s=t("TjRS");t("aD51");function r(){return(r=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e}).apply(this,arguments)}var o={};void 0!==o&&o&&o===Object(o)&&Object.isExtensible(o)&&!o.hasOwnProperty("__filemeta")&&Object.defineProperty(o,"__filemeta",{configurable:!0,value:{name:"_frontmatter",filename:"manual/AWS/Adding-Role-Permissions-To-Lambda-CDK.md"}});var i={_frontmatter:o},c=s.a;function d(e){var n=e.components,t=function(e,n){if(null==e)return{};var t,a,s={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(s[t]=e[t]);return s}(e,["components"]);return Object(a.b)(c,r({},i,t,{components:n,mdxType:"MDXLayout"}),Object(a.b)("h1",{id:"adding-secrets-via-cli-or-cdk"},"Adding Secrets Via CLI or CDK"),Object(a.b)("h2",{id:"resources"},"Resources"),Object(a.b)("ol",null,Object(a.b)("li",{parentName:"ol"},Object(a.b)("a",r({parentName:"li"},{href:"https://stackoverflow.com/questions/52636929/specifying-a-custom-role-for-lambda-with-the-aws-cdk"}),"Stack Overflow"))),Object(a.b)("h2",{id:"example"},"Example"),Object(a.b)("pre",null,Object(a.b)("code",r({parentName:"pre"},{className:"language-ts"}),"import events = require('@aws-cdk/aws-events');\nimport targets = require('@aws-cdk/aws-events-targets');\nimport lambda = require('@aws-cdk/aws-lambda');\nimport cdk = require('@aws-cdk/core');\nimport assets = require('@aws-cdk/aws-s3-assets');\nimport iam = require('@aws-cdk/aws-iam');\n\nrequire('dotenv').config();\n\ntype LambdaFn = { id: string; cron: string; relativeFunctionPath: string };\ntype LambdaCronStackProps = cdk.StackProps & {\n  fns: Array<LambdaFn>;\n};\n\n/**\n * Update the LambdaAsset, functions path\n * and handler\n */\nexport class LambdaCronStack extends cdk.Stack {\n  constructor(app: cdk.App, id: string, props: LambdaCronStackProps) {\n    super(app, id);\n\n    for (const fn of props.fns) {\n      // The following JavaScript example defines an directory\n      // asset which is archived as a .zip file and uploaded to\n      // S3 during deployment.\n      // See https://docs.aws.amazon.com/cdk/api/latest/docs/aws-s3-assets-readme.html\n      const myLambdaAsset = new assets.Asset(\n        // @ts-ignore - this expects Construct not cdk.Construct :thinking:\n        this,\n        `${fn.id}CronJonBotAssetsZip`,\n        {\n          path: fn.relativeFunctionPath,\n        },\n      );\n\n      const lambdaFn = new lambda.Function(this, `${fn.id}LambdaAssetFn`, {\n        code: lambda.Code.fromBucket(\n          // @ts-ignore\n          myLambdaAsset.bucket,\n          myLambdaAsset.s3ObjectKey,\n        ),\n        timeout: cdk.Duration.seconds(300),\n        runtime: lambda.Runtime.NODEJS_12_X,\n        handler: 'index.handler',\n      });\n\n      // Add policy for sending SES template\n      lambdaFn.addToRolePolicy(\n        new iam.PolicyStatement({\n          effect: iam.Effect.ALLOW,\n          actions: ['ses:SendTemplatedEmail'],\n          resources: [\n            'arn:aws:ses:us-east-1:178467697118:identity/hello@dennisokeeffe.com',\n          ],\n        }),\n      );\n\n      // Run every Sunday at 12:50PM UTC\n      // See https://docs.aws.amazon.com/lambda/latest/dg/tutorial-scheduled-events-schedule-expressions.html\n      const rule = new events.Rule(this, `${fn.id}Rule`, {\n        schedule: events.Schedule.expression(fn.cron),\n      });\n\n      rule.addTarget(new targets.LambdaFunction(lambdaFn));\n    }\n  }\n}\n")))}d&&d===Object(d)&&Object.isExtensible(d)&&!d.hasOwnProperty("__filemeta")&&Object.defineProperty(d,"__filemeta",{configurable:!0,value:{name:"MDXContent",filename:"manual/AWS/Adding-Role-Permissions-To-Lambda-CDK.md"}}),d.isMDXComponent=!0}}]);
//# sourceMappingURL=component---manual-aws-adding-role-permissions-to-lambda-cdk-md-08cdcd2aa5f61a290902.js.map