{"version":3,"sources":["webpack:///../manual/Programming-Languages/Code-Transformation-and-Linting-with-ASTs.md"],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"mappings":"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","file":"component---manual-programming-languages-code-transformation-and-linting-with-as-ts-md-790b37fb5576cbf49dbf.js","sourcesContent":["import React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsx mdx */\n\nimport DefaultLayout from \"/Users/dennis.okeeffe/Project-Imposter/developer-notes/node_modules/gatsby-theme-docz/src/base/Layout.js\";\nexport const _frontmatter = {};\n\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n  console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n  return <div {...props} />;\n};\n\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1 {...{\n      \"id\": \"code-transformation-and-lintings-with-asts\"\n    }}>{`Code Transformation and Lintings with ASTs`}</h1>\n    <h2 {...{\n      \"id\": \"resources\"\n    }}>{`Resources`}</h2>\n    <ol>\n      <li parentName=\"ol\"><a parentName=\"li\" {...{\n          \"href\": \"https://frontendmasters.com/courses/linting-asts/\"\n        }}>{`FE Masters Course`}</a></li>\n      <li parentName=\"ol\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/kentcdodds/asts-workshop\"\n        }}>{`Workshop Git Repo`}</a></li>\n      <li parentName=\"ol\"><a parentName=\"li\" {...{\n          \"href\": \"https://slides.com/kentcdodds/asts-workshop#/\"\n        }}>{`Workshop Slides`}</a></li>\n      <li parentName=\"ol\"><a parentName=\"li\" {...{\n          \"href\": \"https://openbase.io/js/babel-plugin-module-resolver\"\n        }}>{`Module Resolver`}</a></li>\n      <li parentName=\"ol\"><a parentName=\"li\" {...{\n          \"href\": \"https://astexplorer.net/#/gist/fc5316331bd7d36af6ce9b23c5e5d861/latest\"\n        }}>{`AST Explorer in JS`}</a></li>\n      <li parentName=\"ol\"><a parentName=\"li\" {...{\n          \"href\": \"https://resources.jointjs.com/demos/rappid/apps/Ast/index.html\"\n        }}>{`JS AST Visualizers`}</a></li>\n      <li parentName=\"ol\"><a parentName=\"li\" {...{\n          \"href\": \"https://eslint.org/docs/developer-guide/working-with-rules#the-context-object\"\n        }}>{`ESLint Context Object`}</a></li>\n      <li parentName=\"ol\"><a parentName=\"li\" {...{\n          \"href\": \"https://babeljs.io/docs/en/babel-types\"\n        }}>{`Babel plugins`}</a></li>\n      <li parentName=\"ol\"><a parentName=\"li\" {...{\n          \"href\": \"https://github.com/codemod-js/codemod\"\n        }}>{`Babel codemod`}</a></li>\n    </ol>\n    <h2 {...{\n      \"id\": \"introduction\"\n    }}>{`Introduction`}</h2>\n    <p>{`This chat is about Abstract Syntax Trees and why that is important.`}</p>\n    <p>{`If you want to follow the workshop, run the following:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-shell\"\n      }}>{`git clone https://github.com/kentcdodds/asts-workshop.git\ncd asts-workshop\nyarn run setup --silent\nnode scripts/autofill-feedback-email.js YOUR_EMAIL@DOMAIN.COM\ngit commit -am \"ready to go\"\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"examples-of-asts\"\n    }}>{`Examples of ASTs`}</h2>\n    <p>{`Babel enhances the dev experience AND user experience by enables syntax to transform to something useful. An example is the module resolver babel transformer.`}</p>\n    <p>{`ESLint is a linter for JS, and can be very plugable. The example he shows is `}<inlineCode parentName=\"p\">{`eslint-plugin-import`}</inlineCode>{` that ensures that paths resolve during imports.`}</p>\n    <p>{`Codemods are better than find/replace. You can use them for things that transfer from things like one test framework to another etc.`}</p>\n    <h2 {...{\n      \"id\": \"asts\"\n    }}>{`ASTs`}</h2>\n    <p>{`ASTs for JavaScript are basically just one big JS object. The resources given for the explorer and visualizer are great tools to understand how ASTs work.`}</p>\n    <p>{`For JavaScript, the course will use `}<inlineCode parentName=\"p\">{`espree`}</inlineCode>{`.`}</p>\n    <h3 {...{\n      \"id\": \"eslint\"\n    }}>{`ESLint`}</h3>\n    <p>{`This is great for style issues but also logical issues.`}</p>\n    <p>{`The example we are doing in the `}<inlineCode parentName=\"p\">{`astexplorer`}</inlineCode>{` uses `}<inlineCode parentName=\"p\">{`babel-eslint`}</inlineCode>{` with a Transformation turned on.`}</p>\n    <p>{`The example here is to ensure all if statements have a block.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`// invalid\nif (something > 3) console.log('something is greather than three');\n\n// valid\nif (something > 3) {\n  console.log('something is greather than three');\n}\n`}</code></pre>\n    <p>{`ESLint uses the Visitor pattern. This pattern makes it easier for you to traverse your AST.`}</p>\n    <p>{`Without the Visitor pattern, you need to know every Node type and there is a lot of complexity. Visitor allows us to say \"we only care about this Node type\". With the visitor pattern, we only need to specific the node type that we care about. In this case, it will be `}<inlineCode parentName=\"p\">{`IfStatement`}</inlineCode>{`.`}</p>\n    <p>{`As for the ESLint function, we end up with this.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`module.exports = {\n  meta: {\n    docs: {\n      descripton: 'disallow IfStatements without blocks',\n      category: 'Stylistic Issues',\n      recommended: true,\n    },\n    fixable: 'code',\n    schema: [], // no options\n  },\n  create(context) {\n    return {\n      // visitor\n      IfStatement(node) {\n        console.log(node);\n      },\n    };\n  },\n};\n`}</code></pre>\n    <p>{`With the above code, we will log out the two Nodes for the two if statements in our code block we are testing.`}</p>\n    <p>{`For our example, we can see the `}<inlineCode parentName=\"p\">{`consequent`}</inlineCode>{` are different. One is a `}<inlineCode parentName=\"p\">{`BlockStatement`}</inlineCode>{`, the other is a `}<inlineCode parentName=\"p\">{`BinaryExpression`}</inlineCode>{`.`}</p>\n    <p>{`To ensure we have the block statement, we can update our code for the following:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`module.exports = {\n  meta: {\n    docs: {\n      descripton: 'disallow IfStatements without blocks',\n      category: 'Stylistic Issues',\n      recommended: true,\n    },\n    fixable: 'code',\n    schema: [], // no options\n  },\n  create(context) {\n    return {\n      // visitor\n      IfStatement(node) {\n        if (node.consequent.type === 'BlockStatement') {\n          return;\n        }\n        context.report({\n          node: node,\n          message: 'y u no block',\n        });\n      },\n    };\n  },\n};\n`}</code></pre>\n    <p>{`Running this is the AST Explorer will show us the problem! If we want it to be covering `}<inlineCode parentName=\"p\">{`else`}</inlineCode>{` statements as well, we need to update the `}<inlineCode parentName=\"p\">{`consequent`}</inlineCode>{` and the `}<inlineCode parentName=\"p\">{`alternate`}</inlineCode>{`.`}</p>\n    <blockquote>\n      <p parentName=\"blockquote\">{`Note: The context is the ESLint API. See `}<a parentName=\"p\" {...{\n          \"href\": \"https://eslint.org/docs/developer-guide/working-with-rules#the-context-object\"\n        }}>{`ESLint docs`}</a>{` for more info.`}</p>\n    </blockquote>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`module.exports = {\n  meta: {\n    docs: {\n      descripton: 'disallow IfStatements without blocks',\n      category: 'Stylistic Issues',\n      recommended: true,\n    },\n    fixable: 'code',\n    schema: [], // no options\n  },\n  create(context) {\n    return {\n      // visitor\n      IfStatement(node) {\n        if (isBlock(node.consequent) && isBlock(node.alternate)) {\n          return;\n        }\n\n        if (!isBlock(consequent)) {\n          context.report({\n            node: node,\n            message: 'y u no block',\n          });\n        } else (!isBlock(alternate)) {\n          context.report({\n            node: node,\n            message: 'y u no block',\n          });\n        }\n      },\n    };\n  },\n};\n\nfunction isBlock(node) {\n  if !node || node.block === 'BlockStatement'\n}\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"making-a-plugin\"\n    }}>{`Making a plugin`}</h2>\n    <p>{`With the provided code, you can write test code using `}<inlineCode parentName=\"p\">{`RuleTester`}</inlineCode>{` from `}<inlineCode parentName=\"p\">{`eslint`}</inlineCode>{`.`}</p>\n    <p>{`An example:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`const { RuleTester } = require('eslint');\nconst rule = require('./01_eslint');\n\nconst ruleTester = new RuleTester();\nruleTester.run('no-console', rule, {\n  valid: ['foo.console()', 'console()', 'info()'],\n  invalid: [\n    {\n      code: \\`console.log()\\`,\n      errors: [\n        {\n          message: 'Using console is not allowed',\n          type: 'MemberExpression',\n        },\n      ],\n    },\n  ],\n});\n`}</code></pre>\n    <p>{`The code to make this pass:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`module.exports = {\n  meta: {\n    docs: {\n      description: 'Disallow use of console',\n      category: 'Best Practices',\n      recommended: true,\n    },\n  },\n  create(context) {\n    return {\n      MemberExpression(node) {\n        if (node.object.name === 'console') {\n          context.report({\n            node,\n            message: 'Using console is not allowed',\n          });\n        }\n      },\n    };\n  },\n};\n`}</code></pre>\n    <p>{`[TODO - add the other challenges + solutions]`}</p>\n    <h2 {...{\n      \"id\": \"babel-plugin-and-ast\"\n    }}>{`Babel Plugin and AST`}</h2>\n    <p>{`Again from the AST explorer, we are using the parser `}<inlineCode parentName=\"p\">{`babylon6`}</inlineCode>{` and transformer `}<inlineCode parentName=\"p\">{`babelv6`}</inlineCode>{`.`}</p>\n    <p>{`Babel plugins will be transformed by Babel, so you can use whatever the babelrc is configured with. For babel, we export a function that is called with a utility library.`}</p>\n    <p><a parentName=\"p\" {...{\n        \"href\": \"https://babeljs.io/docs/en/babel-types\"\n      }}>{`Here is a list`}</a>{` of the `}<inlineCode parentName=\"p\">{`types`}</inlineCode>{` that Babel has. It can really useful for Babel plugins.`}</p>\n    <p>{`The below code can be logged just to understand more about the `}<inlineCode parentName=\"p\">{`RegExpLiteral`}</inlineCode>{` path that we will be using to parse our code and hoist the RegExpLiteral.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`// base code\ngetVersion('3.4.5');\n\nfunction getVersion(versionString) {\n  const versionRegex = /(\\\\d+)\\\\.(\\\\d+)\\\\.(\\\\d+)/;\n  const [, major, minor, patch] = versionRegex.exec(versionString);\n  return { major, minor, patch };\n}\n\n// babel plugin code\nexport default function(babel) {\n  const { types: t } = babel;\n\n  return {\n    name: 'regexHoister', // not required\n    visitor: {\n      // visitor\n      RegExpLiteral(path) {\n        const newIdentifier = path.scope.generateUidIdentifier();\n        // we'll see a new Node from this\n        console.log(newIdentifier);\n      },\n    },\n  };\n}\n`}</code></pre>\n    <p>{`What we want to do is find any `}<inlineCode parentName=\"p\">{`RegExpLiteral`}</inlineCode>{` and hoist it. Luckily for us, Babel `}<inlineCode parentName=\"p\">{`types`}</inlineCode>{` allow us to create new nodes. The code will end up like the following:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`// babel function\nexport default function(babel) {\n  const { types: t } = babel;\n\n  return {\n    name: 'regexHoister', // not required\n    visitor: {\n      // visitor\n      RegExpLiteral(path) {\n        console.log(path.parent.id.name); // the name of the variable from the tree want versionRegex\n        // arg can help name generated ID.\n        // Babel also understands scope of entire file to ensure no clashes.\n        const newIdentifier = path.scope.generateUidIdentifier(\n          path.parent.id.name,\n        );\n        // we'll see a new Node from this\n        console.log(newIdentifier);\n        const variableDeclaration = t.variableDeclaration('const', [\n          t.variableDeclarator(newIdentifier, path.node),\n        ]);\n        path.scope.rename;\n        console.log(variableDeclaration);\n        const program = path.findParent(t.isProgram);\n        // if you want to see the program itself!\n        console.log(program.node.body);\n        program.node.body.unshift(variableDeclaration);\n        path.parentPath.remove();\n      },\n    },\n  };\n}\n\n// takes this...\ngetVersion('3.4.5');\n\nfunction getVersion(versionString) {\n  const versionRegex = /(\\\\d+)\\\\.(\\\\d+)\\\\.(\\\\d+)/;\n  const [, major, minor, patch] = versionRegex.exec(versionString);\n  return { major, minor, patch };\n}\n\n// and transforms it to this...\nconst _versionRegex = /(\\\\d+)\\\\.(\\\\d+)\\\\.(\\\\d+)/;\ngetVersion('3.4.5');\n\nfunction getVersion(versionString) {\n  const [, major, minor, patch] = versionRegex.exec(versionString);\n  return { major, minor, patch };\n}\n`}</code></pre>\n    <h3 {...{\n      \"id\": \"example-on-testing-for-an-eslint-plugin\"\n    }}>{`Example on testing for an ESLint plugin`}</h3>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`// the plugin\nexport default devPlugin;\n\nfunction devPlugin({ types: t }) {\n  return {\n    name: 'line-plugin',\n    visitor: {\n      Identifier(path) {\n        const {\n          node: { name },\n        } = path;\n        if (name === '__DEV__') {\n          path.replaceWith(\n            t.booleanLiteral(process.env.NODE_ENV === 'development'),\n          );\n        }\n      },\n    },\n  };\n}\n\n// the tests\nimport { stripIndent } from 'common-tags';\nimport * as babel from 'babel-core';\nimport devPlugin from './05_babel';\n\nconst env = process.env.NODE_ENV;\n\nafterEach(() => {\n  process.env.NODE_ENV = env;\n});\n\ntest('transpiles __DEV__ to false', () => {\n  process.env.NODE_ENV = 'production';\n  const source = stripIndent\\`\n    if (__DEV__) {\n      console.log('You are in dev mode!')\n    }\n  \\`;\n  const { code } = babel.transform(source, {\n    babelrc: false,\n    plugins: [devPlugin],\n  });\n  expect(code).not.toContain('__DEV__');\n  expect(code).toMatchSnapshot();\n});\n\ntest('transpiles __DEV__ to true', () => {\n  process.env.NODE_ENV = 'development';\n  const source = stripIndent\\`\n    if (__DEV__) {\n      console.log('You are in dev mode!')\n    }\n  \\`;\n  const { code } = babel.transform(source, {\n    babelrc: false,\n    plugins: [devPlugin],\n  });\n  expect(code).not.toContain('__DEV__');\n  expect(code).toMatchSnapshot();\n});\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"codemods\"\n    }}>{`Codemods`}</h2>\n    <p>{`The example of an API is when you change everything from callbacks to promises. It is an easy way to make this modification completely feasible.`}</p>\n    <p>{`For this, the parser we will use is `}<inlineCode parentName=\"p\">{`recast`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`jscodeshift`}</inlineCode>{` is the transformer.`}</p>\n    <p>{`The base code that you get for the `}<inlineCode parentName=\"p\">{`jscodeshift`}</inlineCode>{`. This transformer does not use the Visitor pattern. It is possible to use Babel, and there is a CLI tool that can use a babel transform that you can see on GitHub `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/codemod-js/codemod\"\n      }}>{`here`}</a>{`.`}</p>\n    <p>{`Codemods are designed to change the source code it uses as input.`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-javascript\"\n      }}>{`// Press ctrl+space for code completion\nexport default function transformer(file, api) {\n  const j = api.jscodeshift;\n\n  return j(file.source)\n    .find(j.Identifier)\n    .forEach(path => {\n      j(path).replaceWith(\n        j.identifier(\n          path.node.name\n            .split('')\n            .reverse()\n            .join(''),\n        ),\n      );\n    })\n    .toSource();\n}\n`}</code></pre>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}